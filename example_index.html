<hr>
Commits from 2024-12-24 00:00:00 to 2024-12-30 13:11:44

<hr>
<h1>Commit List</h1>
<ul>
<li><a href="#54908ebd">54908ebd Fix the bug in create_dataset function (#4284)</a></li>
<li><a href="#3ba2b8d8">3ba2b8d8 Fix agent session list by user_id. (#4285)</a></li>
<li><a href="#713b8372">713b8372  Feat: Translate the system prompt of the generate operator #3993 (#4283)</a></li>
<li><a href="#8feb4c1a">8feb4c1a Fix BaiduFanyi TestRun parameter validation and debug method missing … (#4275)</a></li>
<li><a href="#dd13a5d0">dd13a5d0 Fix some bugs in text2sql.(#4279)(#4281) (#4280)</a></li>
<li><a href="#8cdf1014">8cdf1014 Initial draft of the begin component reference (#4272)</a></li>
<li><a href="#7773afa5">7773afa5 Update text2sql agent manual document (#4226) (#4271)</a></li>
<li><a href="#798eb364">798eb364 Fix chat listing error. (#4270)</a></li>
<li><a href="#2d17e5aa">2d17e5aa Feat: Delete useless code #4242 (#4267)</a></li>
<li><a href="#c75aa11a">c75aa11a Fix: The edit box for the headers parameter of the invoke operator is always loading. #4265 (#4266)</a></li>
<li><a href="#c7818770">c7818770 Fix Python SDK example error. (#4263)</a></li>
<li><a href="#6f6303d0">6f6303d0 Fix Python SDK example error. (#4262)</a></li>
<li><a href="#146e8bb7">146e8bb7 Feat: Limit the iteration start node to only be the source node #4242 (#4260)</a></li>
<li><a href="#f948c0d9">f948c0d9 Clean query. (#4259)</a></li>
<li><a href="#c3e3f0fb">c3e3f0fb Add iteration for agent. (#4258)</a></li>
<li><a href="#a1a825c8">a1a825c8 Feat: Add the iteration Node #4242 (#4247)</a></li>
<li><a href="#a6f41537">a6f41537 Update UI text (#4248)</a></li>
<li><a href="#097aab09">097aab09 Replace image2text model check with internal image. (#4250)</a></li>
<li><a href="#600f435d">600f435d Fix text (#4244)</a></li>
<li><a href="#722545e5">722545e5 Fix bugs (#4241)</a></li>
<li><a href="#9fa73771">9fa73771 Fixed invoke component parameters #4236 (#4237)</a></li>
<li><a href="#fe279754">fe279754 Update version info (#4232)</a></li>
<li><a href="#7e063283">7e063283 Removing invisible chars before tokenization. (#4233)</a></li>
<li><a href="#28eeb29b">28eeb29b Fix component input error. (#4231)</a></li>
<li><a href="#85511cb1">85511cb1 Miscellaneous updates (#4228)</a></li>
<li><a href="#a3eeb5de">a3eeb5de Fix: Q&A chunk modification (#4227)</a></li>
<li><a href="#1160b58b">1160b58b Update pyproject.toml to 0.15.1 (#4222)</a></li>
<li><a href="#61790ebe">61790ebe Fix: Rename chat name, missing field 'avatar' #4125 (#4221)</a></li>
<li><a href="#bc3288d3">bc3288d3 Fix misspell. (#4219)</a></li>
<li><a href="#4e5f92f0">4e5f92f0 Fix interface as input variable for component. (#4212)</a></li>
<li><a href="#7d8e0602">7d8e0602 Remove session owner check. (#4211)</a></li>
<li><a href="#03cbbf77">03cbbf77 Add user_id for third-party system to record sessions. (#4206)</a></li>
<li><a href="#b7a74134">b7a74134 Bump infinity to 0.5.2 (#4207)</a></li>
<li><a href="#321e9f37">321e9f37 fix: stop rerank by model when search result is empty (#4203)</a></li>
<li><a href="#76cd23ee">76cd23ee Catch the exception while parsing pptx. (#4202)</a></li>
</ul>
<hr>
<h2>Classified Commits</h2>
<div><h2>Bug Fixes</h2>
<ul>
  <li><a href="#54908ebd">54908ebd</a> Fix the bug in create_dataset function (#4284)</li>
  <li><a href="#3ba2b8d8">3ba2b8d8</a> Fix agent session list by user_id. (#4285)</li>
  <li><a href="#8feb4c1a">8feb4c1a</a> Fix BaiduFanyi TestRun parameter validation and debug method missing … (#4275)</li>
  <li><a href="#dd13a5d0">dd13a5d0</a> Fix some bugs in text2sql.(#4279)(#4281) (#4280)</li>
  <li><a href="#798eb364">798eb364</a> Fix chat listing error. (#4270)</li>
  <li><a href="#c75aa11a">c75aa11a</a> Fix: The edit box for the headers parameter of the invoke operator is always loading. #4265 (#4266)</li>
  <li><a href="#c7818770">c7818770</a> Fix Python SDK example error. (#4263)</li>
  <li><a href="#6f6303d0">6f6303d0</a> Fix Python SDK example error. (#4262)</li>
  <li><a href="#722545e5">722545e5</a> Fix bugs (#4241)</li>
  <li><a href="#9fa73771">9fa73771</a> Fixed invoke component parameters #4236 (#4237)</li>
  <li><a href="#28eeb29b">28eeb29b</a> Fix component input error. (#4231)</li>
  <li><a href="#a3eeb5de">a3eeb5de</a> Fix: Q&A chunk modification (#4227)</li>
  <li><a href="#61790ebe">61790ebe</a> Fix: Rename chat name, missing field 'avatar' #4125 (#4221)</li>
  <li><a href="#bc3288d3">bc3288d3</a> Fix misspell. (#4219)</li>
  <li><a href="#4e5f92f0">4e5f92f0</a> Fix interface as input variable for component. (#4212)</li>
  <li><a href="#321e9f37">321e9f37</a> fix: stop rerank by model when search result is empty (#4203)</li>
  <li><a href="#76cd23ee">76cd23ee</a> Catch the exception while parsing pptx. (#4202)</li>
</ul>

<h2>Feature Updates</h2>
<ul>
  <li><a href="#713b8372">713b8372</a> Feat: Translate the system prompt of the generate operator #3993 (#4283)</li>
  <li><a href="#2d17e5aa">2d17e5aa</a> Feat: Delete useless code #4242 (#4267)</li>
  <li><a href="#146e8bb7">146e8bb7</a> Feat: Limit the iteration start node to only be the source node #4242 (#4260)</li>
  <li><a href="#c3e3f0fb">c3e3f0fb</a> Add iteration for agent. (#4258)</li>
  <li><a href="#a1a825c8">a1a825c8</a> Feat: Add the iteration Node #4242 (#4247)</li>
  <li><a href="#097aab09">097aab09</a> Replace image2text model check with internal image. (#4250)</li>
  <li><a href="#03cbbf77">03cbbf77</a> Add user_id for third-party system to record sessions. (#4206)</li>
</ul>

<h2>Version Updates</h2>
<ul>
  <li><a href="#fe279754">fe279754</a> Update version info (#4232)</li>
  <li><a href="#1160b58b">1160b58b</a> Update pyproject.toml to 0.15.1 (#4222)</li>
  <li><a href="#b7a74134">b7a74134</a> Bump infinity to 0.5.2 (#4207)</li>
</ul>

<h2>Miscellaneous</h2>
<ul>
  <li><a href="#8cdf1014">8cdf1014</a> Initial draft of the begin component reference (#4272)</li>
  <li><a href="#7773afa5">7773afa5</a> Update text2sql agent manual document (#4226) (#4271)</li>
  <li><a href="#f948c0d9">f948c0d9</a> Clean query. (#4259)</li>
  <li><a href="#a6f41537">a6f41537</a> Update UI text (#4248)</li>
  <li><a href="#600f435d">600f435d</a> Fix text (#4244)</li>
  <li><a href="#7e063283">7e063283</a> Removing invisible chars before tokenization. (#4233)</li>
  <li><a href="#85511cb1">85511cb1</a> Miscellaneous updates (#4228)</li>
  <li><a href="#7d8e0602">7d8e0602</a> Remove session owner check. (#4211)</li>
</ul></div>
<hr>
<div id="54908ebd"></div>
<h2>54908ebd</h2>

<p><strong>Message:</strong> Fix the bug in create_dataset function (#4284)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 54908ebd30077d61df519c66c591d5f21474091e
Author: liuhua &lt;10215101452@stu.ecnu.edu.cn&gt;
Date:   Mon Dec 30 13:04:51 2024 +0800

Fix the bug in create_dataset function (#4284)

### What problem does this PR solve?

Fix the bug in create_dataset function #4136

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---------</span>

Co-authored-by: liuhua &lt;10215101452@stu.ecun.edu.cn&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/python_api_reference.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/python_api_reference.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 281c7bcc..d94ec444 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/python_api_reference.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/python_api_reference.md</span>
@@ -28,7 +28,7 @@ RAGFlow.create_dataset(
name: str,
avatar: str = &quot;&quot;,
description: str = &quot;&quot;,
<span style="background-color: #f8d7da; color: #d73a49;">-    embedding_model: str = "BAAI/bge-zh-v1.5",</span>
<span style="background-color: #d4edda; color: #28a745;">+    embedding_model: str = "BAAI/bge-large-zh-v1.5",</span>
language: str = &quot;English&quot;,
permission: str = &quot;me&quot;,
chunk_method: str = &quot;naive&quot;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/sdk/python/ragflow_sdk/ragflow.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/sdk/python/ragflow_sdk/ragflow.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 472cec49..05158f6f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/sdk/python/ragflow_sdk/ragflow.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/sdk/python/ragflow_sdk/ragflow.py</span>
@@ -46,13 +46,15 @@ class RAGFlow:
res = requests.put(url=self.api_url + path, json= json,headers=self.authorization_header)
return res

<span style="background-color: #f8d7da; color: #d73a49;">-    def create_dataset(self, name: str, avatar: str = "", description: str = "", language: str = "English",</span>
<span style="background-color: #d4edda; color: #28a745;">+    def create_dataset(self, name: str, avatar: str = "", description: str = "", embedding_model:str = "BAAI/bge-large-zh-v1.5",</span>
<span style="background-color: #d4edda; color: #28a745;">+                       language: str = "English",</span>
permission: str = &quot;me&quot;,chunk_method: str = &quot;naive&quot;,
parser_config: DataSet.ParserConfig = None) -&gt; DataSet:
if parser_config:
parser_config = parser_config.to_json()
res = self.post(&quot;/datasets&quot;,
<span style="background-color: #f8d7da; color: #d73a49;">-                        {"name": name, "avatar": avatar, "description": description, "language": language,</span>
<span style="background-color: #d4edda; color: #28a745;">+                        {"name": name, "avatar": avatar, "description": description,"embedding_model":embedding_model,</span>
<span style="background-color: #d4edda; color: #28a745;">+                         "language": language,</span>
&quot;permission&quot;: permission, &quot;chunk_method&quot;: chunk_method,
&quot;parser_config&quot;: parser_config
}
</code></pre>

<div id="3ba2b8d8"></div>
<h2>3ba2b8d8</h2>

<p><strong>Message:</strong> Fix agent session list by user_id. (#4285)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 3ba2b8d80f4045917fcb1865a71164043d6b2a52
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Mon Dec 30 12:18:16 2024 +0800

Fix agent session list by user_id. (#4285)

### What problem does this PR solve?


### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/sdk/session.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/sdk/session.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 6c89dc99..eff4dcfe 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/sdk/session.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/sdk/session.py</span>
@@ -247,6 +247,7 @@ def list_agent_session(tenant_id, agent_id):
if not UserCanvasService.query(user_id=tenant_id, id=agent_id):
return get_error_data_result(message=f&quot;You don'#39;t own the agent {agent_id}.&quot;)
id = request.args.get(&quot;id&quot;)
<span style="background-color: #d4edda; color: #28a745;">+    user_id = request.args.get("user_id")</span>
page_number = int(request.args.get(&quot;page&quot;, 1))
items_per_page = int(request.args.get(&quot;page_size&quot;, 30))
orderby = request.args.get(&quot;orderby&quot;, &quot;update_time&quot;)
@@ -254,7 +255,7 @@ def list_agent_session(tenant_id, agent_id):
desc = False
else:
desc = True
<span style="background-color: #f8d7da; color: #d73a49;">-    convs = API4ConversationService.get_list(agent_id, tenant_id, page_number, items_per_page, orderby, desc, id)</span>
<span style="background-color: #d4edda; color: #28a745;">+    convs = API4ConversationService.get_list(agent_id, tenant_id, page_number, items_per_page, orderby, desc, id, user_id)</span>
if not convs:
return get_result(data=[])
for conv in convs:
</code></pre>

<div id="713b8372"></div>
<h2>713b8372</h2>

<p><strong>Message:</strong>  Feat: Translate the system prompt of the generate operator #3993 (#4283)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 713b8372762c52a9ea478da936d9837abf7c97f7
Author: balibabu &lt;cike8899@users.noreply.github.com&gt;
Date:   Mon Dec 30 12:07:06 2024 +0800

Feat: Translate the system prompt of the generate operator #3993 (#4283)

### What problem does this PR solve?

Feat: Translate the system prompt of the generate operator #3993

### Type of change


<span style="background-color: #f8d7da; color: #d73a49;">- [x] New Feature (non-breaking change which adds functionality)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/en.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/en.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 99624e74..edf012a4 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/en.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/en.ts</span>
@@ -1096,6 +1096,7 @@ This delimiter is used to split the input text into several text pieces echo of
addVariable: '#39;Add variable'#39;,
variableSettings: '#39;Variable settings'#39;,
globalVariables: '#39;Global variables'#39;,
<span style="background-color: #d4edda; color: #28a745;">+      systemPrompt: 'System prompt',</span>
},
footer: {
profile: '#39;All rights reserved @ React'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/zh-traditional.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/zh-traditional.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f47e102f..75665e45 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/zh-traditional.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/zh-traditional.ts</span>
@@ -1032,6 +1032,7 @@ export default {
},
addVariable: '#39;新增變數'#39;,
variableSettings: '#39;變數設定'#39;,
<span style="background-color: #d4edda; color: #28a745;">+      systemPrompt: '系統提示詞',</span>
},
footer: {
profile: '#39;“保留所有權利 @ react”'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/zh.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/zh.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 2d12f43d..f3506bab 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/zh.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/zh.ts</span>
@@ -1076,6 +1076,7 @@ export default {
},
addVariable: '#39;新增变量'#39;,
variableSettings: '#39;变量设置'#39;,
<span style="background-color: #d4edda; color: #28a745;">+      systemPrompt: '系统提示词',</span>
},
footer: {
profile: '#39;All rights reserved @ React'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/generate-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/generate-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 500d42fb..ad6396d9 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/generate-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/generate-form/index.tsx</span>
@@ -25,7 +25,7 @@ const GenerateForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
&lt;/Form.Item&gt;
&lt;Form.Item
name={['#39;prompt'#39;]}
<span style="background-color: #f8d7da; color: #d73a49;">-        label="System"</span>
<span style="background-color: #d4edda; color: #28a745;">+        label={t('systemPrompt')}</span>
initialValue={t('#39;promptText'#39;)}
tooltip={t('#39;promptTip'#39;, { keyPrefix: '#39;knowledgeConfiguration'#39; })}
rules={[
</code></pre>

<div id="8feb4c1a"></div>
<h2>8feb4c1a</h2>

<p><strong>Message:</strong> Fix BaiduFanyi TestRun parameter validation and debug method missing … (#4275)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 8feb4c1a999eb71aa538ec8a4e3f782ae43f7a9e
Author: WANGRUI-ZB &lt;50860994+WANGRUI-ZB@users.noreply.github.com&gt;
Date:   Mon Dec 30 10:34:57 2024 +0800

Fix BaiduFanyi TestRun parameter validation and debug method missing … (#4275)

### What problem does this PR solve?

Fix BaiduFanyi TestRun parameter validation and debug method missing
errors
![Uploading Snipaste_2024-12-27_19-56-31.png…]()


### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---------</span>

Co-authored-by: wangrui &lt;wangrui@haima.me&gt;
Co-authored-by: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/baidufanyi.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/baidufanyi.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index c1c526bd..f6eada60 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/baidufanyi.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/baidufanyi.py</span>
@@ -39,9 +39,6 @@ class BaiduFanyiParam(ComponentParamBase):
self.check_empty(self.appid, &quot;BaiduFanyi APPID&quot;)
self.check_empty(self.secret_key, &quot;BaiduFanyi Secret Key&quot;)
self.check_valid_value(self.trans_type, &quot;Translate type&quot;, ['#39;translate'#39;, '#39;fieldtranslate'#39;])
<span style="background-color: #f8d7da; color: #d73a49;">-        self.check_valid_value(self.trans_type, "Translate domain",</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                               ['it', 'finance', 'machinery', 'senimed', 'novel', 'academic', 'aerospace', 'wiki',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                                'news', 'law', 'contract'])</span>
self.check_valid_value(self.source_lang, &quot;Source language&quot;,
['#39;auto'#39;, '#39;zh'#39;, '#39;en'#39;, '#39;yue'#39;, '#39;wyw'#39;, '#39;jp'#39;, '#39;kor'#39;, '#39;fra'#39;, '#39;spa'#39;, '#39;th'#39;, '#39;ara'#39;, '#39;ru'#39;, '#39;pt'#39;,
'#39;de'#39;, '#39;it'#39;, '#39;el'#39;, '#39;nl'#39;, '#39;pl'#39;, '#39;bul'#39;, '#39;est'#39;, '#39;dan'#39;, '#39;fin'#39;, '#39;cs'#39;, '#39;rom'#39;, '#39;slo'#39;, '#39;swe'#39;,
@@ -96,3 +93,4 @@ class BaiduFanyi(ComponentBase, ABC):

except Exception as e:
BaiduFanyi.be_output(&quot;**Error**:&quot; + str(e))
<span style="background-color: #d4edda; color: #28a745;">+</span>
</code></pre>

<div id="dd13a5d0"></div>
<h2>dd13a5d0</h2>

<p><strong>Message:</strong> Fix some bugs in text2sql.(#4279)(#4281) (#4280)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit dd13a5d05c3eb57f24639917ac759e6f844aa5a3
Author: TeslaZY &lt;TeslaZY@outlook.com&gt;
Date:   Mon Dec 30 10:32:19 2024 +0800

Fix some bugs in text2sql.(#4279)(#4281) (#4280)

Fix some bugs in text2sql.(#4279)(#4281)

### What problem does this PR solve?
<span style="background-color: #f8d7da; color: #d73a49;">- The incorrect results in parsing CSV files of the QA knowledge base in</span>
the text2sql scenario. Process CSV files using the csv library. Decouple
CSV parsing from TXT parsing
<span style="background-color: #f8d7da; color: #d73a49;">- Most llm return results in markdown format ```sql query ```, Fix</span>
execution error caused by LLM output SQLmarkdown format.### Type of
change
<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/exesql.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/exesql.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 1b48b6b6..253dac5a 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/exesql.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/exesql.py</span>
@@ -65,20 +65,16 @@ class ExeSQL(ComponentBase, ABC):
self._loop += 1

ans = self.get_input()
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
ans = &quot;&quot;.join([str(a) for a in ans[&quot;content&quot;]]) if &quot;content&quot; in ans else &quot;&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-        if self._param.db_type == 'mssql':</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            # improve the information extraction, most llm return results in markdown format ```sql query ```</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            match = re.search(r"```sql\s*(.*?)\s*```", ans, re.DOTALL)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            if match:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                ans = match.group(1)  # Query content</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                print(ans)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            else:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                print("no markdown")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            ans = re.sub(r'^.*?SELECT ', 'SELECT ', (ans), flags=re.IGNORECASE)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        # improve the information extraction, most llm return results in markdown format ```sql query ```</span>
<span style="background-color: #d4edda; color: #28a745;">+        match = re.search(r"```sql\s*(.*?)\s*```", ans, re.DOTALL)</span>
<span style="background-color: #d4edda; color: #28a745;">+        if match:</span>
<span style="background-color: #d4edda; color: #28a745;">+            ans = match.group(1)  # Query content</span>
<span style="background-color: #d4edda; color: #28a745;">+            print(ans)</span>
else:
<span style="background-color: #f8d7da; color: #d73a49;">-            ans = re.sub(r'^.*?SELECT ', 'SELECT ', repr(ans), flags=re.IGNORECASE)</span>
<span style="background-color: #d4edda; color: #28a745;">+            print("no markdown")</span>
<span style="background-color: #d4edda; color: #28a745;">+        ans = re.sub(r'^.*?SELECT ', 'SELECT ', (ans), flags=re.IGNORECASE)</span>
ans = re.sub(r'#39;;.*?SELECT '#39;, '#39;; SELECT '#39;, ans, flags=re.IGNORECASE)
ans = re.sub(r'#39;;[^;]*$'#39;, r'#39;;'#39;, ans)
if not ans:
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/rag/app/qa.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/rag/app/qa.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index d77daebd..824a398b 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/rag/app/qa.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/rag/app/qa.py</span>
@@ -12,6 +12,7 @@
#
import logging
import re
<span style="background-color: #d4edda; color: #28a745;">+import csv</span>
from copy import deepcopy
from io import BytesIO
from timeit import default_timer as timer
@@ -25,7 +26,6 @@ from docx import Document
from PIL import Image
from markdown import markdown

<span style="background-color: #f8d7da; color: #d73a49;">-</span>
class Excel(ExcelParser):
def __call__(self, fnm, binary=None, callback=None):
if not binary:
@@ -320,7 +320,7 @@ def chunk(filename, binary=None, lang=&quot;Chinese&quot;, callback=None, **kwargs):
res.append(beAdoc(deepcopy(doc), q, a, eng))
return res

<span style="background-color: #f8d7da; color: #d73a49;">-    elif re.search(r"\.(txt|csv)$", filename, re.IGNORECASE):</span>
<span style="background-color: #d4edda; color: #28a745;">+    elif re.search(r"\.(txt)$", filename, re.IGNORECASE):</span>
callback(0.1, &quot;Start to parse.&quot;)
txt = get_text(filename, binary)
lines = txt.split(&quot;\n&quot;)
@@ -359,6 +359,38 @@ def chunk(filename, binary=None, lang=&quot;Chinese&quot;, callback=None, **kwargs):

return res

<span style="background-color: #d4edda; color: #28a745;">+    elif re.search(r"\.(csv)$", filename, re.IGNORECASE):</span>
<span style="background-color: #d4edda; color: #28a745;">+        callback(0.1, "Start to parse.")</span>
<span style="background-color: #d4edda; color: #28a745;">+        txt = get_text(filename, binary)</span>
<span style="background-color: #d4edda; color: #28a745;">+        lines = txt.split("\n")</span>
<span style="background-color: #d4edda; color: #28a745;">+        delimiter = "\t" if any("\t" in line for line in lines) else ","</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        fails = []</span>
<span style="background-color: #d4edda; color: #28a745;">+        question, answer = "", ""</span>
<span style="background-color: #d4edda; color: #28a745;">+        res = []</span>
<span style="background-color: #d4edda; color: #28a745;">+        reader = csv.reader(lines, delimiter=delimiter)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        for i, row in enumerate(reader):</span>
<span style="background-color: #d4edda; color: #28a745;">+            if len(row) != 2:</span>
<span style="background-color: #d4edda; color: #28a745;">+                if question:</span>
<span style="background-color: #d4edda; color: #28a745;">+                    answer += "\n" + lines[i]</span>
<span style="background-color: #d4edda; color: #28a745;">+                else:</span>
<span style="background-color: #d4edda; color: #28a745;">+                    fails.append(str(i + 1))</span>
<span style="background-color: #d4edda; color: #28a745;">+            elif len(row) == 2:</span>
<span style="background-color: #d4edda; color: #28a745;">+                if question and answer:</span>
<span style="background-color: #d4edda; color: #28a745;">+                    res.append(beAdoc(deepcopy(doc), question, answer, eng))</span>
<span style="background-color: #d4edda; color: #28a745;">+                question, answer = row</span>
<span style="background-color: #d4edda; color: #28a745;">+            if len(res) % 999 == 0:</span>
<span style="background-color: #d4edda; color: #28a745;">+                callback(len(res) * 0.6 / len(lines), ("Extract Q&A: {}".format(len(res)) + (</span>
<span style="background-color: #d4edda; color: #28a745;">+                    f"{len(fails)} failure, line: %s..." % (",".join(fails[:3])) if fails else "")))</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        if question:</span>
<span style="background-color: #d4edda; color: #28a745;">+            res.append(beAdoc(deepcopy(doc), question, answer, eng))</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        callback(0.6, ("Extract Q&A: {}".format(len(res)) + (</span>
<span style="background-color: #d4edda; color: #28a745;">+            f"{len(fails)} failure, line: %s..." % (",".join(fails[:3])) if fails else "")))</span>
<span style="background-color: #d4edda; color: #28a745;">+        return res</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
elif re.search(r&quot;\.pdf$&quot;, filename, re.IGNORECASE):
callback(0.1, &quot;Start to parse.&quot;)
pdf_parser = Pdf()
</code></pre>

<div id="8cdf1014"></div>
<h2>8cdf1014</h2>

<p><strong>Message:</strong> Initial draft of the begin component reference (#4272)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 8cdf10148d12a32e80b82589b069676a39d64282
Author: writinwaters &lt;93570324+writinwaters@users.noreply.github.com&gt;
Date:   Fri Dec 27 17:07:31 2024 +0800

Initial draft of the begin component reference (#4272)

### What problem does this PR solve?

### Type of change


<span style="background-color: #f8d7da; color: #d73a49;">- [x] Documentation Update</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/templates/general_chat_bot.json</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/templates/general_chat_bot.json</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 6645e988..331782fa 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/templates/general_chat_bot.json</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/templates/general_chat_bot.json</span>
@@ -85,7 +85,7 @@
},
&quot;5. chitchatting&quot;: {
&quot;description&quot;: &quot;Regarding the issues of small talk, companionship, sharing, and emotional intimacy.&quot;,
<span style="background-color: #f8d7da; color: #d73a49;">-                  "examples": "What's your name?\nAre you female o male.\nWhat a bad day!\nTerrible day.\nHow are you today?\nDo you have boy friend?",</span>
<span style="background-color: #d4edda; color: #28a745;">+                  "examples": "What's your name?\nWhat a bad day!\nTerrible day.\nHow are you today?",</span>
&quot;to&quot;: &quot;Generate:FiveDragonsLay&quot;
}
},
@@ -637,7 +637,7 @@
},
&quot;5. chitchatting&quot;: {
&quot;description&quot;: &quot;Regarding the issues of small talk, companionship, sharing, and emotional intimacy.&quot;,
<span style="background-color: #f8d7da; color: #d73a49;">-                    "examples": "What's your name?\nAre you female o male.\nWhat a bad day!\nTerrible day.\nHow are you today?\nDo you have boy friend?",</span>
<span style="background-color: #d4edda; color: #28a745;">+                    "examples": "What's your name?\nWhat a bad day!\nTerrible day.\nHow are you today?",</span>
&quot;to&quot;: &quot;Generate:FiveDragonsLay&quot;
}
},
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/_category_.json</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/agent/_category_.json</div>
similarity index 100%
rename from docs/guides/agentic_rag/_category_.json
rename to docs/guides/agent/_category_.json
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/agent_introduction.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/agent/agent_introduction.md</div>
similarity index 100%
rename from docs/guides/agentic_rag/agent_introduction.md
rename to docs/guides/agent/agent_introduction.md
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/general_purpose_chatbot.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/agent/general_purpose_chatbot.md</div>
similarity index 100%
rename from docs/guides/agentic_rag/general_purpose_chatbot.md
rename to docs/guides/agent/general_purpose_chatbot.md
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/text2sql_agent.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/agent/text2sql_agent.md</div>
similarity index 99%
rename from docs/guides/agentic_rag/text2sql_agent.md
rename to docs/guides/agent/text2sql_agent.md
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index aa8766f8..da0d35a9 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/guides/agentic_rag/text2sql_agent.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/guides/agent/text2sql_agent.md</span>
@@ -4,8 +4,11 @@ slug: /text2sql_agent
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>

# Create a Text2SQL agent
<span style="background-color: #d4edda; color: #28a745;">+</span>
Build a Text2SQL agent leverging RAGFlow'#39;s RAG capabilities. Contributed by @TeslaZY.
<span style="background-color: #d4edda; color: #28a745;">+</span>
## Scenario
<span style="background-color: #d4edda; color: #28a745;">+</span>
The Text2SQL agent is designed to bridge the gap between Natural Language Processing (NLP) and Structured Query Language (SQL). Its key advantages are as follows:

<span style="background-color: #f8d7da; color: #d73a49;">- **Assisting non-technical users with SQL**: Not all users have a background in SQL or understand the structure of the tables involved in queries. With a Text2SQL agent, users can pose questions or request data in natural language without needing an in-depth knowledge of the database structure or SQL syntax.</span>
@@ -35,9 +38,11 @@ A list of components required:
<span style="background-color: #f8d7da; color: #d73a49;">- ExeSQL</span>

## Procedure
<span style="background-color: #d4edda; color: #28a745;">+</span>
### Preparation of Data

#### Database Environment
<span style="background-color: #d4edda; color: #28a745;">+</span>
Mysql-8.0.39

#### Database Table Creation Statements
@@ -261,7 +266,9 @@ CREATE TABLE OrderDetails (
![DDL knowledge base](https://github.com/user-attachments/assets/2c073e1b-8fdd-443e-98ca-4fd36f9d93e0)

#### Configure DB_Description Knowledge Base
<span style="background-color: #d4edda; color: #28a745;">+</span>
1. the content of the DB_Description text is as follows:
<span style="background-color: #d4edda; color: #28a745;">+2.</span>
```markdown
### Customers (Customer Information Table)
The Customers table records detailed information about different customers in the online store. Here is the meaning of each field within this table:
@@ -294,6 +301,7 @@ The OrderDetails table provides detailed information about each item in an order
<span style="background-color: #f8d7da; color: #d73a49;">- Quantity: The number of units of the product ordered.</span>
<span style="background-color: #f8d7da; color: #d73a49;">- TotalPrice: The total price for this particular item in the order, calculated as UnitPrice * Quantity.</span>
```
<span style="background-color: #d4edda; color: #28a745;">+</span>
2. set the chunk data for the DB_Description knowledge base
![DB_Description knowledge base](https://github.com/user-attachments/assets/0e3f1cad-dd67-4d7c-ae2d-b31ca3be664d)
#### Configure Q-&gt;SQL Knowledge Base
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/agent_component_reference/_category_.json</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/agent_component_reference/_category_.json</div>
similarity index 90%
rename from docs/guides/agentic_rag/agent_component_reference/_category_.json
rename to docs/references/agent_component_reference/_category_.json
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 50383113..28678a5f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/guides/agentic_rag/agent_component_reference/_category_.json</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/agent_component_reference/_category_.json</span>
@@ -1,6 +1,6 @@
{
&quot;label&quot;: &quot;Agent Component Reference&quot;,
<span style="background-color: #f8d7da; color: #d73a49;">-  "position": 1,</span>
<span style="background-color: #d4edda; color: #28a745;">+  "position": 3,</span>
&quot;link&quot;: {
&quot;type&quot;: &quot;generated-index&quot;,
&quot;description&quot;: &quot;A complete reference for RAGFlow'#39;s agent components.&quot;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/agent_component_reference/begin.mdx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/agent_component_reference/begin.mdx</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..701835fe</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/agent_component_reference/begin.mdx</span>
@@ -0,0 +1,70 @@
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+sidebar_position: 1</span>
<span style="background-color: #d4edda; color: #28a745;">+slug: /begin_component</span>
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+# Begin component</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+The starting component in a workflow.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+The **Begin** component sets an opening greeting or accepts inputs from the user. It is automatically populated onto the canvas when you create an agent, whether from a template or from scratch (from a blank template). There should be only one **Begin** component in the workflow.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Scenarios</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+A **Begin** component is essential in all cases. Every agent includes a **Begin** component, which cannot be deleted.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Configurations</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+Click the component to display its **Configuration** window. Here, you can set an opening greeting and the input parameters (global variables) for the agent.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### ID</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+The ID is the unique identifier for the component within the workflow. Unlike the IDs of other components, the ID of the **Begin** component *cannot* be changed.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Opening greeting</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+An opening greeting is the agent's first message to the user. It can be a welcoming remark or an instruction to guide the user forward.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Global variables</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+You can set global variables within the **Begin** component, which can be either required or optional. Once established, users will need to provide values for these variables when interacting or with the agent. Click **+ Add variable** to add a global variable, each with the following attributes:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Key**: *Required*</span>
<span style="background-color: #d4edda; color: #28a745;">+  The unique variable name.</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Name**: *Required*</span>
<span style="background-color: #d4edda; color: #28a745;">+  A descriptive name providing additional details about the variable.</span>
<span style="background-color: #d4edda; color: #28a745;">+  For example, if **Key** is set to `lang`, you can set its **Name** to `Target language`.</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Type**: *Required*</span>
<span style="background-color: #d4edda; color: #28a745;">+  The type of the variable:</span>
<span style="background-color: #d4edda; color: #28a745;">+  - **line**: Accepts a single line of text without line breaks.</span>
<span style="background-color: #d4edda; color: #28a745;">+  - **paragraph**: Accepts multiple lines of text, including line breaks.</span>
<span style="background-color: #d4edda; color: #28a745;">+  - **options**: Requires the user to select a value for this variable from a dropdown menu. And you are required to set *at least* one option for the dropdown menu.</span>
<span style="background-color: #d4edda; color: #28a745;">+  - **file**: Requires the user to upload a file from their device.</span>
<span style="background-color: #d4edda; color: #28a745;">+  - **integer**: Accepts an integer as input.</span>
<span style="background-color: #d4edda; color: #28a745;">+  - **boolean**: Requires the user to toggle between on and off.</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Optional**: A toggle indicating whether the variable is optional.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Examples</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+As mentioned earlier, the **Begin** component is indispensable for an agent. Still, you can take a look at our three-step interpreter agent, where the **Begin** component takes two global variables:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+1. Click the **Agent** tab in the middle top of the page to show the **Agent** page.</span>
<span style="background-color: #d4edda; color: #28a745;">+2. Click **+ Create agent** on the top right of the page to show the **agent template** page.</span>
<span style="background-color: #d4edda; color: #28a745;">+3. On the **agent template** page, hover over the card on **Interperter** and click **Use this template**.</span>
<span style="background-color: #d4edda; color: #28a745;">+4. Name the new agent and click **OK** to enter the workflow editor.</span>
<span style="background-color: #d4edda; color: #28a745;">+5. Click the **Begin** component to display its **Configuration** window.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Frequently asked questions</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Is the uploaded file in a knowledge base?</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+No. Files uploaded to an agent as input are not stored in a knowledge base and will not be chunked using RAGFlow's built-in chunk methods. However, RAGFlow's built-in OSR, DLR, and TSR models will still be applied to process the document.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### File size limit for uploaded file</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+The maximum file size for each uploaded file is determined by the variable `MAX_CONTENT_LENGTH` in `/docker/.env`. It defaults to 128 MB. If you change the default file size, ensure you also update the value of `client_max_body_size` in `/docker/nginx/nginx.conf` accordingly.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/faq.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/faq.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 8be0c86a..c0de0294 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/faq.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/faq.md</span>
@@ -1,5 +1,5 @@
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>
<span style="background-color: #f8d7da; color: #d73a49;">-sidebar_position: 3</span>
<span style="background-color: #d4edda; color: #28a745;">+sidebar_position: 10</span>
slug: /faq
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/release_notes.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/release_notes.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 8587bd65..0c146748 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/release_notes.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/release_notes.md</span>
@@ -21,6 +21,7 @@ Released on December 25, 2024.
This release fixes the following issues:

<span style="background-color: #f8d7da; color: #d73a49;">- The `SCORE not found` and `position_int` errors returned by [Infinity](https://github.com/infiniflow/infinity).</span>
<span style="background-color: #d4edda; color: #28a745;">+- Once an embedding model in a specific knowledge base is changed, embedding models in other knowledge bases can no longer be changed.</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Slow response in question-answering and AI search due to repetitive loading of the embedding model.</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Fails to parse documents with RAPTOR.</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Using the **Table** parsing method results in information loss.</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/en.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/en.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 040bcbd5..99624e74 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/en.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/en.ts</span>
@@ -350,7 +350,7 @@ The above is the content you need to summarize.`,
language: '#39;Language'#39;,
emptyResponse: '#39;Empty response'#39;,
emptyResponseTip: `Set this as a response if no results are retrieved from the knowledge bases for your query, or leave this field blank to allow the LLM to improvise when nothing is found.`,
<span style="background-color: #f8d7da; color: #d73a49;">-      setAnOpener: 'Set an opener',</span>
<span style="background-color: #d4edda; color: #28a745;">+      setAnOpener: 'Opening greeting',</span>
setAnOpenerInitial: `Hi! I'#39;m your assistant, what can I do for you?`,
setAnOpenerTip: '#39;Set an opening greeting for users.'#39;,
knowledgeBases: '#39;Knowledge bases'#39;,
@@ -677,7 +677,7 @@ The above is the content you need to summarize.`,
msg: '#39;Messages'#39;,
messagePlaceholder: '#39;message'#39;,
messageMsg: '#39;Please input message or delete this field.'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      addField: 'Add field',</span>
<span style="background-color: #d4edda; color: #28a745;">+      addField: 'Add option',</span>
addMessage: '#39;Add message'#39;,
loop: '#39;Loop'#39;,
loopTip:
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/begin-form/begin-dynamic-options.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/begin-form/begin-dynamic-options.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index b68a13d5..bcc9c578 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/begin-form/begin-dynamic-options.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/begin-form/begin-dynamic-options.tsx</span>
@@ -55,7 +55,7 @@ const BeginDynamicOptions = () =&gt; {
icon={&lt;PlusOutlined /&gt;}
block
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-              Add field</span>
<span style="background-color: #d4edda; color: #28a745;">+              Add option</span>
&lt;/Button&gt;
&lt;Form.ErrorList errors={errors} /&gt;
&lt;/Form.Item&gt;
</code></pre>

<div id="7773afa5"></div>
<h2>7773afa5</h2>

<p><strong>Message:</strong> Update text2sql agent manual document (#4226) (#4271)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 7773afa561532ac278625c27a30d296480f4256b
Author: TeslaZY &lt;TeslaZY@outlook.com&gt;
Date:   Fri Dec 27 16:48:17 2024 +0800

Update text2sql agent manual document (#4226) (#4271)

### What problem does this PR solve?
<span style="background-color: #f8d7da; color: #d73a49;">- Create a text2sql agent document: Receipe, procedure, debug (</span>
including step run), run.

### Type of change
<span style="background-color: #f8d7da; color: #d73a49;">- [ ] Documentation Update</span>

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---------</span>

Co-authored-by: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/text2sql_agent.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/agentic_rag/text2sql_agent.md</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..aa8766f8</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/guides/agentic_rag/text2sql_agent.md</span>
@@ -0,0 +1,408 @@
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+sidebar_position: 3</span>
<span style="background-color: #d4edda; color: #28a745;">+slug: /text2sql_agent</span>
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+# Create a Text2SQL agent</span>
<span style="background-color: #d4edda; color: #28a745;">+Build a Text2SQL agent leverging RAGFlow's RAG capabilities. Contributed by @TeslaZY.</span>
<span style="background-color: #d4edda; color: #28a745;">+## Scenario</span>
<span style="background-color: #d4edda; color: #28a745;">+The Text2SQL agent is designed to bridge the gap between Natural Language Processing (NLP) and Structured Query Language (SQL). Its key advantages are as follows:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Assisting non-technical users with SQL**: Not all users have a background in SQL or understand the structure of the tables involved in queries. With a Text2SQL agent, users can pose questions or request data in natural language without needing an in-depth knowledge of the database structure or SQL syntax.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Enhancing SQL development efficiency**: For those familiar with SQL, the Text2SQL agent streamlines the process by enabling users to construct complex queries quickly, without the need to code each part manually.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Minimizing errors**: Manually writing SQL queries can be error-prone, particularly for complex queries or for users not well-versed in the database structure. The Text2SQL agent can interpret natural language instructions and generate accurate SQL queries, thereby reducing potential syntax and logic errors.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Boosting data analysis capabilities**: In business intelligence and data analysis, swiftly gaining insights from data is critical. The Text2SQL agent facilitates extracting valuable information from databases more directly and conveniently, thus aiding in accelerating decision-making.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Automation and integration**: The Text2SQL agent can be integrated into larger systems to support automated workflows, such as automatic report generation and data monitoring. It can also integrate seamlessly with other services and technologies, offering richer application possibilities.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Support for multiple languages and varied expressions**: People can express the same idea in numerous ways. An effective Text2SQL system should be capable of understanding diverse expressions and accurately converting them into SQL queries.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+In summary, the Text2SQL agent seeks to make database queries more intuitive and user-friendly while ensuring efficiency and accuracy. It caters to a broad spectrum of users, from completely non-technical individuals to seasoned data analysts and developers.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+However, traditional Text2SQL solutions often require model fine-tuning, which can substantially escalate deployment and maintenance costs when implemented in enterprise environments alongside RAG or Agent components. RAGFlow’s RAG-based Text2SQL utilizes an existing (connected) large language model (LLM), allowing for seamless integration with other RAG/Agent components without the necessity for additional fine-tuned models.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Recipe</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+A list of components required:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- Begin</span>
<span style="background-color: #d4edda; color: #28a745;">+- Interface</span>
<span style="background-color: #d4edda; color: #28a745;">+- Retrieval</span>
<span style="background-color: #d4edda; color: #28a745;">+- Generate</span>
<span style="background-color: #d4edda; color: #28a745;">+- ExeSQL</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Procedure</span>
<span style="background-color: #d4edda; color: #28a745;">+### Preparation of Data</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+#### Database Environment</span>
<span style="background-color: #d4edda; color: #28a745;">+Mysql-8.0.39</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+#### Database Table Creation Statements</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+```sql</span>
<span style="background-color: #d4edda; color: #28a745;">+SET NAMES utf8mb4;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+-- Table structure for Customers</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+DROP TABLE IF EXISTS `Customers`;</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE `Customers` (</span>
<span style="background-color: #d4edda; color: #28a745;">+  `CustomerID` int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `UserName` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `Email` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `PhoneNumber` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (`CustomerID`)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+-- Table structure for Products</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+DROP TABLE IF EXISTS `Products`;</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE `Products` (</span>
<span style="background-color: #d4edda; color: #28a745;">+  `ProductID` int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `ProductName` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `Description` text COLLATE utf8mb4_unicode_ci,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `Price` decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `StockQuantity` int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (`ProductID`)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+-- Table structure for Orders</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+DROP TABLE IF EXISTS `Orders`;</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE `Orders` (</span>
<span style="background-color: #d4edda; color: #28a745;">+  `OrderID` int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `CustomerID` int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `OrderDate` date DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `TotalPrice` decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (`OrderID`),</span>
<span style="background-color: #d4edda; color: #28a745;">+  KEY `CustomerID` (`CustomerID`)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+-- Table structure for OrderDetails</span>
<span style="background-color: #d4edda; color: #28a745;">+-- ----------------------------</span>
<span style="background-color: #d4edda; color: #28a745;">+DROP TABLE IF EXISTS `OrderDetails`;</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE `OrderDetails` (</span>
<span style="background-color: #d4edda; color: #28a745;">+  `OrderDetailID` int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `OrderID` int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `ProductID` int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `UnitPrice` decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `Quantity` int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  `TotalPrice` decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (`OrderDetailID`),</span>
<span style="background-color: #d4edda; color: #28a745;">+  KEY `OrderID` (`OrderID`),</span>
<span style="background-color: #d4edda; color: #28a745;">+  KEY `ProductID` (`ProductID`)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+#### Generate Test Data</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+```sql</span>
<span style="background-color: #d4edda; color: #28a745;">+START TRANSACTION;</span>
<span style="background-color: #d4edda; color: #28a745;">+INSERT INTO Customers (UserName, Email, PhoneNumber) VALUES</span>
<span style="background-color: #d4edda; color: #28a745;">+('Alice', 'alice@example.com', '123456789'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Bob', 'bob@example.com', '987654321'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Charlie', 'charlie@example.com', '112233445'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Diana', 'diana@example.com', '555666777'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Eve', 'eve@example.com', '999888777'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Frank', 'frank@example.com', '123123123'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Grace', 'grace@example.com', '456456456'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Hugo', 'hugo@example.com', '789789789'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Ivy', 'ivy@example.com', '321321321'),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Jack', 'jack@example.com', '654654654');</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+INSERT INTO Products (ProductName, Description, Price, StockQuantity) VALUES</span>
<span style="background-color: #d4edda; color: #28a745;">+('Laptop', 'High performance laptop', 1200.00, 50),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Smartphone', 'Latest model smartphone', 800.00, 100),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Tablet', 'Portable tablet device', 300.00, 75),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Headphones', 'Noise-cancelling headphones', 150.00, 200),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Camera', 'Professional camera', 600.00, 30),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Monitor', '24-inch Full HD monitor', 200.00, 45),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Keyboard', 'Mechanical keyboard', 100.00, 150),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Mouse', 'Ergonomic gaming mouse', 50.00, 250),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Speaker', 'Wireless Bluetooth speaker', 80.00, 120),</span>
<span style="background-color: #d4edda; color: #28a745;">+('Router', 'Wi-Fi router with high speed', 120.00, 90);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+INSERT INTO Orders (CustomerID, OrderDate, TotalPrice) VALUES</span>
<span style="background-color: #d4edda; color: #28a745;">+(1, '2024-01-15', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(2, '2024-02-01', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(3, '2024-03-05', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(4, '2024-04-10', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(5, '2024-05-15', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(6, '2024-06-20', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(7, '2024-07-25', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(8, '2024-08-30', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(9, '2024-09-05', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(10, '2024-10-10', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(1, '2024-11-15', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(2, '2024-12-01', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(3, '2024-01-05', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(4, '2024-02-10', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(5, '2024-03-15', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(6, '2024-04-20', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(7, '2024-05-25', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(8, '2024-06-30', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(9, '2024-07-05', 0),</span>
<span style="background-color: #d4edda; color: #28a745;">+(10, '2024-08-10', 0);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+INSERT INTO OrderDetails (OrderID, ProductID, UnitPrice, Quantity, TotalPrice) VALUES</span>
<span style="background-color: #d4edda; color: #28a745;">+(1, 1, (SELECT Price FROM Products WHERE ProductID = 1), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 1)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(1, 2, (SELECT Price FROM Products WHERE ProductID = 2), 1, (SELECT Price FROM Products WHERE ProductID = 2)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(2, 3, (SELECT Price FROM Products WHERE ProductID = 3), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 3)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(2, 4, (SELECT Price FROM Products WHERE ProductID = 4), 1, (SELECT Price FROM Products WHERE ProductID = 4)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(3, 5, (SELECT Price FROM Products WHERE ProductID = 5), 1, (SELECT Price FROM Products WHERE ProductID = 5)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(3, 6, (SELECT Price FROM Products WHERE ProductID = 6), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 6)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(4, 7, (SELECT Price FROM Products WHERE ProductID = 7), 5, (SELECT Price * 5 FROM Products WHERE ProductID = 7)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(5, 8, (SELECT Price FROM Products WHERE ProductID = 8), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 8)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(5, 9, (SELECT Price FROM Products WHERE ProductID = 9), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 9)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(6, 10, (SELECT Price FROM Products WHERE ProductID = 10), 4, (SELECT Price * 4 FROM Products WHERE ProductID = 10)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(7, 2, (SELECT Price FROM Products WHERE ProductID = 2), 4, (SELECT Price * 4 FROM Products WHERE ProductID = 2)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(7, 8, (SELECT Price FROM Products WHERE ProductID = 8), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 8)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(8, 1, (SELECT Price FROM Products WHERE ProductID = 1), 1, (SELECT Price FROM Products WHERE ProductID = 1)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(8, 9, (SELECT Price FROM Products WHERE ProductID = 9), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 9)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(8, 10, (SELECT Price FROM Products WHERE ProductID = 10), 5, (SELECT Price * 5 FROM Products WHERE ProductID = 10)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(9, 3, (SELECT Price FROM Products WHERE ProductID = 3), 5, (SELECT Price * 5 FROM Products WHERE ProductID = 3)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(9, 6, (SELECT Price FROM Products WHERE ProductID = 6), 1, (SELECT Price FROM Products WHERE ProductID = 6)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(10, 4, (SELECT Price FROM Products WHERE ProductID = 4), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 4)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(10, 7, (SELECT Price FROM Products WHERE ProductID = 7), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 7)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(11, 5, (SELECT Price FROM Products WHERE ProductID = 5), 1, (SELECT Price FROM Products WHERE ProductID = 5)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(11, 10, (SELECT Price FROM Products WHERE ProductID = 10), 4, (SELECT Price * 4 FROM Products WHERE ProductID = 10)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(12, 1, (SELECT Price FROM Products WHERE ProductID = 1), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 1)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(12, 8, (SELECT Price FROM Products WHERE ProductID = 8), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 8)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(13, 2, (SELECT Price FROM Products WHERE ProductID = 2), 1, (SELECT Price FROM Products WHERE ProductID = 2)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(13, 9, (SELECT Price FROM Products WHERE ProductID = 9), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 9)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(14, 3, (SELECT Price FROM Products WHERE ProductID = 3), 4, (SELECT Price * 4 FROM Products WHERE ProductID = 3)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(14, 6, (SELECT Price FROM Products WHERE ProductID = 6), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 6)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(15, 4, (SELECT Price FROM Products WHERE ProductID = 4), 5, (SELECT Price * 5 FROM Products WHERE ProductID = 4)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(15, 7, (SELECT Price FROM Products WHERE ProductID = 7), 1, (SELECT Price FROM Products WHERE ProductID = 7)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(16, 5, (SELECT Price FROM Products WHERE ProductID = 5), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 5)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(16, 10, (SELECT Price FROM Products WHERE ProductID = 10), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 10)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(17, 1, (SELECT Price FROM Products WHERE ProductID = 1), 4, (SELECT Price * 4 FROM Products WHERE ProductID = 1)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(17, 8, (SELECT Price FROM Products WHERE ProductID = 8), 1, (SELECT Price FROM Products WHERE ProductID = 8)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(18, 2, (SELECT Price FROM Products WHERE ProductID = 2), 5, (SELECT Price * 5 FROM Products WHERE ProductID = 2)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(18, 9, (SELECT Price FROM Products WHERE ProductID = 9), 2, (SELECT Price * 2 FROM Products WHERE ProductID = 9)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(19, 3, (SELECT Price FROM Products WHERE ProductID = 3), 3, (SELECT Price * 3 FROM Products WHERE ProductID = 3)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(19, 6, (SELECT Price FROM Products WHERE ProductID = 6), 4, (SELECT Price * 4 FROM Products WHERE ProductID = 6)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(20, 4, (SELECT Price FROM Products WHERE ProductID = 4), 1, (SELECT Price FROM Products WHERE ProductID = 4)),</span>
<span style="background-color: #d4edda; color: #28a745;">+(20, 7, (SELECT Price FROM Products WHERE ProductID = 7), 5, (SELECT Price * 5 FROM Products WHERE ProductID = 7));</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+-- Update Orders Table's TotalPrice</span>
<span style="background-color: #d4edda; color: #28a745;">+UPDATE Orders o</span>
<span style="background-color: #d4edda; color: #28a745;">+JOIN (</span>
<span style="background-color: #d4edda; color: #28a745;">+    SELECT OrderID, SUM(TotalPrice) as order_total</span>
<span style="background-color: #d4edda; color: #28a745;">+    FROM OrderDetails</span>
<span style="background-color: #d4edda; color: #28a745;">+    GROUP BY OrderID</span>
<span style="background-color: #d4edda; color: #28a745;">+) od ON o.OrderID = od.OrderID</span>
<span style="background-color: #d4edda; color: #28a745;">+SET o.TotalPrice = od.order_total;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+COMMIT;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+### Configure Knowledge Base</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+For RAGFlow’s RAG-based Text2SQL, the following knowledge bases are typically required:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **DDL**: Database table creation statements.</span>
<span style="background-color: #d4edda; color: #28a745;">+- **DB_Description**: Detailed descriptions of tables and columns.</span>
<span style="background-color: #d4edda; color: #28a745;">+- **Q->SQL**: Natural language query descriptions along with corresponding SQL query examples (Question-Answer pairs).</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+However, in specialized query scenarios, user queries might include abbreviations or synonyms for domain-specific terms. If a user references a synonym for a domain-specific term, the system may fail to generate the correct SQL query. Therefore, it is advisable to incorporate a thesaurus for synonyms to assist the Agent in generating more accurate SQL queries.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- **TextSQL_Thesaurus**: A thesaurus covering domain-specific terms and their synonyms.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+#### Configure DDL Knowledge Base</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+1. The content of the DDL text is as follows:</span>
<span style="background-color: #d4edda; color: #28a745;">+```sql</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE Customers (</span>
<span style="background-color: #d4edda; color: #28a745;">+  CustomerID int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  UserName varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Email varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PhoneNumber varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (CustomerID)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE Products (</span>
<span style="background-color: #d4edda; color: #28a745;">+  ProductID int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  ProductName varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Description text COLLATE utf8mb4_unicode_ci,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Price decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  StockQuantity int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (ProductID)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE Orders (</span>
<span style="background-color: #d4edda; color: #28a745;">+  OrderID int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  CustomerID int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  OrderDate date DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  TotalPrice decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (OrderID),</span>
<span style="background-color: #d4edda; color: #28a745;">+  KEY CustomerID (CustomerID)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+CREATE TABLE OrderDetails (</span>
<span style="background-color: #d4edda; color: #28a745;">+  OrderDetailID int NOT NULL AUTO_INCREMENT,</span>
<span style="background-color: #d4edda; color: #28a745;">+  OrderID int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  ProductID int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  UnitPrice decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Quantity int DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  TotalPrice decimal(10,2) DEFAULT NULL,</span>
<span style="background-color: #d4edda; color: #28a745;">+  PRIMARY KEY (OrderDetailID),</span>
<span style="background-color: #d4edda; color: #28a745;">+  KEY OrderID (OrderID),</span>
<span style="background-color: #d4edda; color: #28a745;">+  KEY ProductID (ProductID)</span>
<span style="background-color: #d4edda; color: #28a745;">+) ENGINE=InnoDB AUTO_INCREMENT=40 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+2. Set the chunk data for the DLL knowledge base</span>
<span style="background-color: #d4edda; color: #28a745;">+![DDL knowledge base](https://github.com/user-attachments/assets/2c073e1b-8fdd-443e-98ca-4fd36f9d93e0)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+#### Configure DB_Description Knowledge Base</span>
<span style="background-color: #d4edda; color: #28a745;">+1. the content of the DB_Description text is as follows:</span>
<span style="background-color: #d4edda; color: #28a745;">+```markdown</span>
<span style="background-color: #d4edda; color: #28a745;">+### Customers (Customer Information Table)</span>
<span style="background-color: #d4edda; color: #28a745;">+The Customers table records detailed information about different customers in the online store. Here is the meaning of each field within this table:</span>
<span style="background-color: #d4edda; color: #28a745;">+- CustomerID: A unique identifier for a customer, auto-incremented.</span>
<span style="background-color: #d4edda; color: #28a745;">+- UserName: The name used by the customer for logging into the online store or displayed on the site.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Email: The email address of the customer, which can be used for account verification, password recovery, and order updates.</span>
<span style="background-color: #d4edda; color: #28a745;">+- PhoneNumber: The phone number of the customer, useful for contact purposes such as delivery notifications or customer service.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Products (Product Information Table)</span>
<span style="background-color: #d4edda; color: #28a745;">+The Products table contains information about the products offered by the online store. Each field within this table represents:</span>
<span style="background-color: #d4edda; color: #28a745;">+- ProductID: A unique identifier for a product, auto-incremented.</span>
<span style="background-color: #d4edda; color: #28a745;">+- ProductName: The name of the product, such as laptop, smartphone, nounch, etc.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Description: Detailed information about the product.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Price: The selling price of the product, stored as a decimal value to accommodate currency formatting.</span>
<span style="background-color: #d4edda; color: #28a745;">+- StockQuantity: The quantity of the product available in stock.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Orders (Order Information Table)</span>
<span style="background-color: #d4edda; color: #28a745;">+The Orders table tracks orders placed by customers. This table includes fields that denote:</span>
<span style="background-color: #d4edda; color: #28a745;">+- OrderID: A unique identifier for an order, auto-incremented.</span>
<span style="background-color: #d4edda; color: #28a745;">+- CustomerID: A foreign key that references the CustomerID in the Customers table, indicating which customer placed the order.</span>
<span style="background-color: #d4edda; color: #28a745;">+- OrderDate: The date when the order was placed.</span>
<span style="background-color: #d4edda; color: #28a745;">+- TotalPrice: The total price of all items in the order, calculated at the time of purchase.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### OrderDetails (Order Details Table)</span>
<span style="background-color: #d4edda; color: #28a745;">+The OrderDetails table provides detailed information about each item in an order. Fields within this table include:</span>
<span style="background-color: #d4edda; color: #28a745;">+- OrderDetailID: A unique identifier for each line item in an order, auto-incremented.</span>
<span style="background-color: #d4edda; color: #28a745;">+- OrderID: A foreign key that references the OrderID in the Orders table, linking the detail to a specific order.</span>
<span style="background-color: #d4edda; color: #28a745;">+- ProductID: A foreign key that references the ProductID in the Products table, specifying which product was ordered.</span>
<span style="background-color: #d4edda; color: #28a745;">+- UnitPrice: The price per unit of the product at the time of order.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Quantity: The number of units of the product ordered.</span>
<span style="background-color: #d4edda; color: #28a745;">+- TotalPrice: The total price for this particular item in the order, calculated as UnitPrice * Quantity.</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+2. set the chunk data for the DB_Description knowledge base</span>
<span style="background-color: #d4edda; color: #28a745;">+![DB_Description knowledge base](https://github.com/user-attachments/assets/0e3f1cad-dd67-4d7c-ae2d-b31ca3be664d)</span>
<span style="background-color: #d4edda; color: #28a745;">+#### Configure Q->SQL Knowledge Base</span>
<span style="background-color: #d4edda; color: #28a745;">+1. Q->SQL Excel Document</span>
<span style="background-color: #d4edda; color: #28a745;">+[QA.xlsx](https://github.com/user-attachments/files/18258416/QA.xlsx)</span>
<span style="background-color: #d4edda; color: #28a745;">+2. Upload the Q->SQL Excel document to the Q->SQL knowledge base and set the chunk data as follows via parsing:</span>
<span style="background-color: #d4edda; color: #28a745;">+![Q->SQL knowledge base](https://github.com/user-attachments/assets/391f4395-1458-4f5b-8b55-517ec3a7b1dc)</span>
<span style="background-color: #d4edda; color: #28a745;">+#### Configure TextSQL_Thesaurus Knowledge Base</span>
<span style="background-color: #d4edda; color: #28a745;">+1. the content of the TextSQL_Thesaurus text is as follows:</span>
<span style="background-color: #d4edda; color: #28a745;">+```txt</span>
<span style="background-color: #d4edda; color: #28a745;">+###</span>
<span style="background-color: #d4edda; color: #28a745;">+Standard noun: StockQuantity</span>
<span style="background-color: #d4edda; color: #28a745;">+Synonyms: stock,stockpile,inventory</span>
<span style="background-color: #d4edda; color: #28a745;">+###</span>
<span style="background-color: #d4edda; color: #28a745;">+Standard noun: UserName</span>
<span style="background-color: #d4edda; color: #28a745;">+Synonyms: user name, user's name</span>
<span style="background-color: #d4edda; color: #28a745;">+###</span>
<span style="background-color: #d4edda; color: #28a745;">+Standard noun: Quantity</span>
<span style="background-color: #d4edda; color: #28a745;">+Synonyms: amount,number</span>
<span style="background-color: #d4edda; color: #28a745;">+###</span>
<span style="background-color: #d4edda; color: #28a745;">+Standard noun: Smartphone</span>
<span style="background-color: #d4edda; color: #28a745;">+Synonyms: phone, mobile phone, smart phone, mobilephone</span>
<span style="background-color: #d4edda; color: #28a745;">+###</span>
<span style="background-color: #d4edda; color: #28a745;">+Standard noun: ProductName</span>
<span style="background-color: #d4edda; color: #28a745;">+Synonyms: product name, product's name</span>
<span style="background-color: #d4edda; color: #28a745;">+###</span>
<span style="background-color: #d4edda; color: #28a745;">+Standard noun: tablet</span>
<span style="background-color: #d4edda; color: #28a745;">+Synonyms: pad,Pad</span>
<span style="background-color: #d4edda; color: #28a745;">+###</span>
<span style="background-color: #d4edda; color: #28a745;">+Standard noun: laptop</span>
<span style="background-color: #d4edda; color: #28a745;">+Synonyms: laptop computer,laptop pc</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+2. set the chunk data for the TextSQL_Thesaurus knowledge base</span>
<span style="background-color: #d4edda; color: #28a745;">+![TextSQL_Thesaurus knowledge base](https://github.com/user-attachments/assets/76e6f802-1381-4bbc-951f-50992fbeecd8)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Build the Agent</span>
<span style="background-color: #d4edda; color: #28a745;">+1. Create an Agent using the Text2SQL Agent template.</span>
<span style="background-color: #d4edda; color: #28a745;">+2. Enter the configuration page of the Agent to start the setup process.</span>
<span style="background-color: #d4edda; color: #28a745;">+3. Create a Retrieval node and name it Thesaurus; create an ExeSQL node.</span>
<span style="background-color: #d4edda; color: #28a745;">+4. Configure the Q->SQL, DDL, DB_Description, and TextSQL_Thesaurus knowledge bases. Please refer to the following:</span>
<span style="background-color: #d4edda; color: #28a745;">+   ![Configure Retrieval node](https://github.com/user-attachments/assets/25d67b01-954e-4eb4-87f5-c54262cf9a3e)</span>
<span style="background-color: #d4edda; color: #28a745;">+5. Configure the Generate node, named LLM‘s prompt:</span>
<span style="background-color: #d4edda; color: #28a745;">+   - Add this content to the prompt provided by the template to provide the thesaurus content to the LLM:</span>
<span style="background-color: #d4edda; color: #28a745;">+     ```plaintext</span>
<span style="background-color: #d4edda; color: #28a745;">+     ## You may use the following Thesaurus statements. For example, what I ask is from Synonyms, you must use Standard noun to generate SQL. Use responses to past questions also to guide you: {sql_thesaurus}.</span>
<span style="background-color: #d4edda; color: #28a745;">+     ```</span>
<span style="background-color: #d4edda; color: #28a745;">+   - Ensure the mapping between keys and component IDs is configured correctly.</span>
<span style="background-color: #d4edda; color: #28a745;">+   - The configuration result should look like this:</span>
<span style="background-color: #d4edda; color: #28a745;">+     ![](https://github.com/user-attachments/assets/04e30e2b-2029-4087-9671-f513dbb1f00d)</span>
<span style="background-color: #d4edda; color: #28a745;">+6. Configure the ExecSQL node, filling in the configuration information for the MySQL database.</span>
<span style="background-color: #d4edda; color: #28a745;">+   ![Configure the ExecSQL node](https://github.com/user-attachments/assets/a3173ae7-8a6a-45e1-b9dd-b0311990f48a)</span>
<span style="background-color: #d4edda; color: #28a745;">+7. Set an opener in the Begin component like:</span>
<span style="background-color: #d4edda; color: #28a745;">+   ```plaintext</span>
<span style="background-color: #d4edda; color: #28a745;">+   Hi! I'm your electronic products online store business data analysis assistant. What can I do for you?</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Run and Test the Agent</span>
<span style="background-color: #d4edda; color: #28a745;">+1. click the Run button to start the agent.</span>
<span style="background-color: #d4edda; color: #28a745;">+2. input the question:</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+Help me summarize stock quantities for each product</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+3. click the send button to send the question to the agent.</span>
<span style="background-color: #d4edda; color: #28a745;">+4. The agent will respond with the following:</span>
<span style="background-color: #d4edda; color: #28a745;">+![](https://github.com/user-attachments/assets/6d31cf09-dd1e-4faa-a7eb-5af6e4ff1d50)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Debug the Agent</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+Since version 0.15.0, ragflow has introduced step-by-step execution for Agent components/tools, providing a robust mechanism for debugging and testing. Let's explore how to perform a step run.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+1. To enter Test Run mode, you can either click the triangle icon located above the component or access the component's detail page by clicking on the component itself. Once there, select the Test Run button in the upper right corner of the component details.</span>
<span style="background-color: #d4edda; color: #28a745;">+   ![](https://github.com/user-attachments/assets/9f5d5c3e-396d-418b-9c7a-fcd8ad5af418)</span>
<span style="background-color: #d4edda; color: #28a745;">+   ![](https://github.com/user-attachments/assets/0816a582-1d88-42a1-bcb1-8f76cb702503)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+2. Enter a question that does not exist in the Q->SQL knowledge base but is similar in nature.</span>
<span style="background-color: #d4edda; color: #28a745;">+   Click the Run button to receive the component's output.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+Find all customers who has bought a mobile phone</span>
<span style="background-color: #d4edda; color: #28a745;">+```</span>
<span style="background-color: #d4edda; color: #28a745;">+![](https://github.com/user-attachments/assets/a6270188-72af-4be7-a192-efddb611f3a4)</span>
<span style="background-color: #d4edda; color: #28a745;">+3. As the image shows, no matching information was retrieved from the Q->SQL knowledge base, yet a similar question exists within the database. Adjust the Rerank model, "Similarity threshold," or "Keywords similarity weight" accordingly to return relevant content.</span>
<span style="background-color: #d4edda; color: #28a745;">+![](https://github.com/user-attachments/assets/0592c45b-9276-465d-93d3-2530b2fb81c0)</span>
<span style="background-color: #d4edda; color: #28a745;">+![](https://github.com/user-attachments/assets/9e72be3a-41af-4ef2-863d-03757ddfdde6)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+4. Observe the inputs and outputs of the LLM node and ExeSQL node.</span>
<span style="background-color: #d4edda; color: #28a745;">+![](https://github.com/user-attachments/assets/55a2b2ec-3518-4fb5-abd5-1634cd485eac)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+5. The agent now produces the correct SQL query result.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+6. For a query about "mobile phone," the agent successfully generates the appropriate SQL query using "Smartphone." This showcases how the thesaurus guides the LLM in generating accurate SQL queries.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+With this, you maybe appreciate the capabilities of Step Run. It undoubtedly assists in constructing more effective agents.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Troubleshooting</span>
<span style="background-color: #d4edda; color: #28a745;">+### Total: 0 No record in the database!</span>
<span style="background-color: #d4edda; color: #28a745;">+1. Confirm if the sql is correct. If so, check the connection information of the database.</span>
<span style="background-color: #d4edda; color: #28a745;">+2. If the connection information is correct, maybe there is actually no data matching your query in the database.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Considerations</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+In real production scenarios within vertical domains, several considerations are essential for effective Text2SQL implementation:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+1. **Handling DDL and DB_Description**: Dealing with Data Definition Language (DDL) statements and database descriptions requires substantial debugging experience. It is crucial to discern which information is vital and which may be redundant, depending on the true business context. This includes determining the relevance of table attributes such as primary keys, foreign keys, indexes, and so forth.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+2. **Maintaining Quality QA Data**: Ensuring a high standard for question-and-answer data significantly aids the LLM in generating more accurate SQL queries.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+3. **Managing Domain-Specific Synonyms**: Professional domain synonyms can greatly impact the generation of SQL query conditions. Therefore, maintaining an extensive and up-to-date synonym library is critical to mitigate this challenge.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+4. **Facilitating User Feedback**: Implementing a feedback mechanism within the Agent allows users to provide correct SQL queries. Administrators can then use this feedback to automatically generate corresponding QA data, reducing the need for manual maintenance.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+In summary, achieving high-quality output from Text2SQL remains contingent upon high-quality input. Constructing robust question-and-answer datasets is at the core of optimizing RAGFlow's Text2SQL capabilities.</span>
</code></pre>

<div id="798eb364"></div>
<h2>798eb364</h2>

<p><strong>Message:</strong> Fix chat listing error. (#4270)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 798eb3647c8d9445e2d7d07e1d56e9bc49cbc46b
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Fri Dec 27 16:03:59 2024 +0800

Fix chat listing error. (#4270)

### What problem does this PR solve?

#4220
### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/sdk/chat.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/sdk/chat.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 82320808..6f3a70ab 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/sdk/chat.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/sdk/chat.py</span>
@@ -18,23 +18,22 @@ from api import settings
from api.db import StatusEnum
from api.db.services.dialog_service import DialogService
from api.db.services.knowledgebase_service import KnowledgebaseService
<span style="background-color: #f8d7da; color: #d73a49;">-from api.db.services.llm_service import  TenantLLMService</span>
<span style="background-color: #d4edda; color: #28a745;">+from api.db.services.llm_service import TenantLLMService</span>
from api.db.services.user_service import TenantService
from api.utils import get_uuid
from api.utils.api_utils import get_error_data_result, token_required
from api.utils.api_utils import get_result


<span style="background-color: #f8d7da; color: #d73a49;">-</span>
@manager.route('#39;/chats'#39;, methods=['#39;POST'#39;])  # noqa: F821
@token_required
def create(tenant_id):
<span style="background-color: #f8d7da; color: #d73a49;">-    req=request.json</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    ids= req.get("dataset_ids")</span>
<span style="background-color: #d4edda; color: #28a745;">+    req = request.json</span>
<span style="background-color: #d4edda; color: #28a745;">+    ids = req.get("dataset_ids")</span>
if not ids:
return get_error_data_result(message=&quot;`dataset_ids` is required&quot;)
for kb_id in ids:
<span style="background-color: #f8d7da; color: #d73a49;">-        kbs = KnowledgebaseService.accessible(kb_id=kb_id,user_id=tenant_id)</span>
<span style="background-color: #d4edda; color: #28a745;">+        kbs = KnowledgebaseService.accessible(kb_id=kb_id, user_id=tenant_id)</span>
if not kbs:
return get_error_data_result(f&quot;You don'#39;t own the dataset {kb_id}&quot;)
kbs = KnowledgebaseService.query(id=kb_id)
@@ -44,14 +43,15 @@ def create(tenant_id):
kbs = KnowledgebaseService.get_by_ids(ids)
embd_count = list(set([kb.embd_id for kb in kbs]))
if len(embd_count) != 1:
<span style="background-color: #f8d7da; color: #d73a49;">-        return get_result(message='Datasets use different embedding models."',code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_result(message='Datasets use different embedding models."',</span>
<span style="background-color: #d4edda; color: #28a745;">+                          code=settings.RetCode.AUTHENTICATION_ERROR)</span>
req[&quot;kb_ids&quot;] = ids
# llm
llm = req.get(&quot;llm&quot;)
if llm:
if &quot;model_name&quot; in llm:
req[&quot;llm_id&quot;] = llm.pop(&quot;model_name&quot;)
<span style="background-color: #f8d7da; color: #d73a49;">-            if not TenantLLMService.query(tenant_id=tenant_id,llm_name=req["llm_id"],model_type="chat"):</span>
<span style="background-color: #d4edda; color: #28a745;">+            if not TenantLLMService.query(tenant_id=tenant_id, llm_name=req["llm_id"], model_type="chat"):</span>
return get_error_data_result(f&quot;`model_name` {req.get('#39;llm_id'#39;)} doesn'#39;t exist&quot;)
req[&quot;llm_setting&quot;] = req.pop(&quot;llm&quot;)
e, tenant = TenantService.get_by_id(tenant_id)
@@ -82,8 +82,10 @@ def create(tenant_id):
req[&quot;top_k&quot;] = req.get(&quot;top_k&quot;, 1024)
req[&quot;rerank_id&quot;] = req.get(&quot;rerank_id&quot;, &quot;&quot;)
if req.get(&quot;rerank_id&quot;):
<span style="background-color: #f8d7da; color: #d73a49;">-        value_rerank_model = ["BAAI/bge-reranker-v2-m3","maidalun1020/bce-reranker-base_v1"]</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        if req["rerank_id"] not in value_rerank_model and not TenantLLMService.query(tenant_id=tenant_id,llm_name=req.get("rerank_id"),model_type="rerank"):</span>
<span style="background-color: #d4edda; color: #28a745;">+        value_rerank_model = ["BAAI/bge-reranker-v2-m3", "maidalun1020/bce-reranker-base_v1"]</span>
<span style="background-color: #d4edda; color: #28a745;">+        if req["rerank_id"] not in value_rerank_model and not TenantLLMService.query(tenant_id=tenant_id,</span>
<span style="background-color: #d4edda; color: #28a745;">+                                                                                     llm_name=req.get("rerank_id"),</span>
<span style="background-color: #d4edda; color: #28a745;">+                                                                                     model_type="rerank"):</span>
return get_error_data_result(f&quot;`rerank_model` {req.get('#39;rerank_id'#39;)} doesn'#39;t exist&quot;)
if not req.get(&quot;llm_id&quot;):
req[&quot;llm_id&quot;] = tenant.llm_id
@@ -106,11 +108,11 @@ def create(tenant_id):
{&quot;key&quot;: &quot;knowledge&quot;, &quot;optional&quot;: False}
],
&quot;empty_response&quot;: &quot;Sorry! No relevant content was found in the knowledge base!&quot;,
<span style="background-color: #f8d7da; color: #d73a49;">-        "quote":True,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        "tts":False,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        "refine_multiturn":True</span>
<span style="background-color: #d4edda; color: #28a745;">+        "quote": True,</span>
<span style="background-color: #d4edda; color: #28a745;">+        "tts": False,</span>
<span style="background-color: #d4edda; color: #28a745;">+        "refine_multiturn": True</span>
}
<span style="background-color: #f8d7da; color: #d73a49;">-    key_list_2 = ["system", "prologue", "parameters", "empty_response","quote","tts","refine_multiturn"]</span>
<span style="background-color: #d4edda; color: #28a745;">+    key_list_2 = ["system", "prologue", "parameters", "empty_response", "quote", "tts", "refine_multiturn"]</span>
if &quot;prompt_config&quot; not in req:
req['#39;prompt_config'#39;] = {}
for key in key_list_2:
@@ -151,15 +153,16 @@ def create(tenant_id):
res[&quot;avatar&quot;] = res.pop(&quot;icon&quot;)
return get_result(data=res)

<span style="background-color: #d4edda; color: #28a745;">+</span>
@manager.route('#39;/chats/&lt;chat_id&gt;'#39;, methods=['#39;PUT'#39;])  # noqa: F821
@token_required
<span style="background-color: #f8d7da; color: #d73a49;">-def update(tenant_id,chat_id):</span>
<span style="background-color: #d4edda; color: #28a745;">+def update(tenant_id, chat_id):</span>
if not DialogService.query(tenant_id=tenant_id, id=chat_id, status=StatusEnum.VALID.value):
return get_error_data_result(message='#39;You do not own the chat'#39;)
<span style="background-color: #f8d7da; color: #d73a49;">-    req =request.json</span>
<span style="background-color: #d4edda; color: #28a745;">+    req = request.json</span>
ids = req.get(&quot;dataset_ids&quot;)
if &quot;show_quotation&quot; in req:
<span style="background-color: #f8d7da; color: #d73a49;">-        req["do_refer"]=req.pop("show_quotation")</span>
<span style="background-color: #d4edda; color: #28a745;">+        req["do_refer"] = req.pop("show_quotation")</span>
if &quot;dataset_ids&quot; in req:
if not ids:
return get_error_data_result(&quot;`dataset_ids` can'#39;t be empty&quot;)
@@ -173,8 +176,8 @@ def update(tenant_id,chat_id):
if kb.chunk_num == 0:
return get_error_data_result(f&quot;The dataset {kb_id} doesn'#39;t own parsed file&quot;)
kbs = KnowledgebaseService.get_by_ids(ids)
<span style="background-color: #f8d7da; color: #d73a49;">-            embd_count=list(set([kb.embd_id for kb in kbs]))</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            if len(embd_count) != 1 :</span>
<span style="background-color: #d4edda; color: #28a745;">+            embd_count = list(set([kb.embd_id for kb in kbs]))</span>
<span style="background-color: #d4edda; color: #28a745;">+            if len(embd_count) != 1:</span>
return get_result(
message='#39;Datasets use different embedding models.&quot;'#39;,
code=settings.RetCode.AUTHENTICATION_ERROR)
@@ -183,7 +186,7 @@ def update(tenant_id,chat_id):
if llm:
if &quot;model_name&quot; in llm:
req[&quot;llm_id&quot;] = llm.pop(&quot;model_name&quot;)
<span style="background-color: #f8d7da; color: #d73a49;">-            if not TenantLLMService.query(tenant_id=tenant_id,llm_name=req["llm_id"],model_type="chat"):</span>
<span style="background-color: #d4edda; color: #28a745;">+            if not TenantLLMService.query(tenant_id=tenant_id, llm_name=req["llm_id"], model_type="chat"):</span>
return get_error_data_result(f&quot;`model_name` {req.get('#39;llm_id'#39;)} doesn'#39;t exist&quot;)
req[&quot;llm_setting&quot;] = req.pop(&quot;llm&quot;)
e, tenant = TenantService.get_by_id(tenant_id)
@@ -209,8 +212,10 @@ def update(tenant_id,chat_id):
e, res = DialogService.get_by_id(chat_id)
res = res.to_json()
if req.get(&quot;rerank_id&quot;):
<span style="background-color: #f8d7da; color: #d73a49;">-        value_rerank_model = ["BAAI/bge-reranker-v2-m3","maidalun1020/bce-reranker-base_v1"]</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        if req["rerank_id"] not in value_rerank_model and not TenantLLMService.query(tenant_id=tenant_id,llm_name=req.get("rerank_id"),model_type="rerank"):</span>
<span style="background-color: #d4edda; color: #28a745;">+        value_rerank_model = ["BAAI/bge-reranker-v2-m3", "maidalun1020/bce-reranker-base_v1"]</span>
<span style="background-color: #d4edda; color: #28a745;">+        if req["rerank_id"] not in value_rerank_model and not TenantLLMService.query(tenant_id=tenant_id,</span>
<span style="background-color: #d4edda; color: #28a745;">+                                                                                     llm_name=req.get("rerank_id"),</span>
<span style="background-color: #d4edda; color: #28a745;">+                                                                                     model_type="rerank"):</span>
return get_error_data_result(f&quot;`rerank_model` {req.get('#39;rerank_id'#39;)} doesn'#39;t exist&quot;)
if &quot;name&quot; in req:
if not req.get(&quot;name&quot;):
@@ -245,16 +250,16 @@ def update(tenant_id,chat_id):
def delete(tenant_id):
req = request.json
if not req:
<span style="background-color: #f8d7da; color: #d73a49;">-        ids=None</span>
<span style="background-color: #d4edda; color: #28a745;">+        ids = None</span>
else:
<span style="background-color: #f8d7da; color: #d73a49;">-        ids=req.get("ids")</span>
<span style="background-color: #d4edda; color: #28a745;">+        ids = req.get("ids")</span>
if not ids:
id_list = []
<span style="background-color: #f8d7da; color: #d73a49;">-        dias=DialogService.query(tenant_id=tenant_id,status=StatusEnum.VALID.value)</span>
<span style="background-color: #d4edda; color: #28a745;">+        dias = DialogService.query(tenant_id=tenant_id, status=StatusEnum.VALID.value)</span>
for dia in dias:
id_list.append(dia.id)
else:
<span style="background-color: #f8d7da; color: #d73a49;">-        id_list=ids</span>
<span style="background-color: #d4edda; color: #28a745;">+        id_list = ids</span>
for id in id_list:
if not DialogService.query(tenant_id=tenant_id, id=id, status=StatusEnum.VALID.value):
return get_error_data_result(message=f&quot;You don'#39;t own the chat {id}&quot;)
@@ -262,6 +267,7 @@ def delete(tenant_id):
DialogService.update_by_id(id, temp_dict)
return get_result()

<span style="background-color: #d4edda; color: #28a745;">+</span>
@manager.route('#39;/chats'#39;, methods=['#39;GET'#39;])  # noqa: F821
@token_required
def list_chat(tenant_id):
@@ -278,20 +284,20 @@ def list_chat(tenant_id):
desc = False
else:
desc = True
<span style="background-color: #f8d7da; color: #d73a49;">-    chats = DialogService.get_list(tenant_id,page_number,items_per_page,orderby,desc,id,name)</span>
<span style="background-color: #d4edda; color: #28a745;">+    chats = DialogService.get_list(tenant_id, page_number, items_per_page, orderby, desc, id, name)</span>
if not chats:
return get_result(data=[])
list_assts = []
<span style="background-color: #f8d7da; color: #d73a49;">-    renamed_dict = {}</span>
key_mapping = {&quot;parameters&quot;: &quot;variables&quot;,
&quot;prologue&quot;: &quot;opener&quot;,
&quot;quote&quot;: &quot;show_quote&quot;,
&quot;system&quot;: &quot;prompt&quot;,
&quot;rerank_id&quot;: &quot;rerank_model&quot;,
&quot;vector_similarity_weight&quot;: &quot;keywords_similarity_weight&quot;,
<span style="background-color: #f8d7da; color: #d73a49;">-                   "do_refer":"show_quotation"}</span>
<span style="background-color: #d4edda; color: #28a745;">+                   "do_refer": "show_quotation"}</span>
key_list = [&quot;similarity_threshold&quot;, &quot;vector_similarity_weight&quot;, &quot;top_n&quot;, &quot;rerank_id&quot;]
for res in chats:
<span style="background-color: #d4edda; color: #28a745;">+        renamed_dict = {}</span>
for key, value in res[&quot;prompt_config&quot;].items():
new_key = key_mapping.get(key, key)
renamed_dict[new_key] = value
@@ -309,11 +315,11 @@ def list_chat(tenant_id):
kb_list = []
for kb_id in res[&quot;kb_ids&quot;]:
kb = KnowledgebaseService.query(id=kb_id)
<span style="background-color: #f8d7da; color: #d73a49;">-            if not kb :</span>
<span style="background-color: #d4edda; color: #28a745;">+            if not kb:</span>
return get_error_data_result(message=f&quot;Don'#39;t exist the kb {kb_id}&quot;)
kb_list.append(kb[0].to_json())
del res[&quot;kb_ids&quot;]
res[&quot;datasets&quot;] = kb_list
res[&quot;avatar&quot;] = res.pop(&quot;icon&quot;)
list_assts.append(res)
<span style="background-color: #f8d7da; color: #d73a49;">-    return get_result(data=list_assts)</span>
\ No newline at end of file
<span style="background-color: #d4edda; color: #28a745;">+    return get_result(data=list_assts)</span>
</code></pre>

<div id="2d17e5aa"></div>
<h2>2d17e5aa</h2>

<p><strong>Message:</strong> Feat: Delete useless code #4242 (#4267)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 2d17e5aa040f032559434a71db261d2a2a58ce31
Author: balibabu &lt;cike8899@users.noreply.github.com&gt;
Date:   Fri Dec 27 15:09:03 2024 +0800

Feat: Delete useless code #4242 (#4267)

### What problem does this PR solve?

Feat: Delete useless code #4242

### Type of change


<span style="background-color: #f8d7da; color: #d73a49;">- [x] New Feature (non-breaking change which adds functionality)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/workflow.less</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/workflow.less</div>
deleted file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 975ebb49..00000000</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/workflow.less</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ /dev/null</span>
@@ -1,5 +0,0 @@
<span style="background-color: #f8d7da; color: #d73a49;">-.react-flow-subflows-example {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  .react-flow__node-group {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    padding: 0;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-}</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/workflow.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/workflow.tsx</div>
deleted file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f6b609e3..00000000</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/workflow.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ /dev/null</span>
@@ -1,151 +0,0 @@
<span style="background-color: #f8d7da; color: #d73a49;">-import { useCallback } from 'react';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import ReactFlow, {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Background,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Controls,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Handle,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  MiniMap,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  NodeProps,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Position,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  addEdge,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useEdgesState,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useNodesState,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-} from 'reactflow';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import 'reactflow/dist/style.css';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import './workflow.less';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-const initialNodes = [</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '1',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    type: 'input',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Node 0' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 250, y: 5 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '2',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Group A' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 100, y: 100 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    style: { backgroundColor: 'rgba(255, 0, 0, 0.2)', width: 200, height: 200 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '2a',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Node A.1' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 10, y: 50 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    parentId: '2',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '3',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Node 1' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 320, y: 100 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '4',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Group B' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 320, y: 200 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    style: { backgroundColor: 'rgba(255, 0, 0, 0.2)', width: 300, height: 300 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    type: 'group',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '4a',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Node B.1' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 15, y: 65 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    parentId: '4',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    extent: 'parent',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    draggable: false,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '4b',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Group B.A' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 15, y: 120 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    style: {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      backgroundColor: 'rgba(255, 0, 255, 0.2)',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      height: 150,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      width: 270,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    parentId: '4',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '4b1',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Node B.A.1' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 20, y: 40 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    parentId: '4b',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    id: '4b2',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    data: { label: 'Node B.A.2' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    position: { x: 100, y: 100 },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    className: 'light',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    parentId: '4b',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-];</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-const initialEdges = [</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  { id: 'e1-2', source: '1', target: '2', animated: true },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  { id: 'e1-3', source: '1', target: '3' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  { id: 'e2a-4a', source: '2a', target: '4a' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  { id: 'e3-4b', source: '3', target: '4b' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  { id: 'e4a-4b1', source: '4a', target: '4b1' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  { id: 'e4a-4b2', source: '4a', target: '4b2' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  { id: 'e4b1-4b2', source: '4b1', target: '4b2' },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-];</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export function RagNode({ id, data, isConnectable = true }: NodeProps<any>) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return (</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    <section className="ragflow-group w-full h-full"></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      <div className="h-10 bg-slate-200 text-orange-400">header</div></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      <Handle</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        id="c"</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        type="source"</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        position={Position.Left}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        isConnectable={isConnectable}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      ></Handle></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      <Handle</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        type="source"</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        position={Position.Right}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        isConnectable={isConnectable}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        id="b"</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      ></Handle></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      <div className="w-full h-10">xxx</div></span>
<span style="background-color: #f8d7da; color: #d73a49;">-    </section></span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-const nodeTypes = { group: RagNode };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-const NestedFlow = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const onConnect = useCallback((connection) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    setEdges((eds) => addEdge(connection, eds));</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, []);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return (</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    <ReactFlow</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      nodes={nodes}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      edges={edges}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      onNodesChange={onNodesChange}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      onEdgesChange={onEdgesChange}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      onConnect={onConnect}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      className="react-flow-subflows-example"</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      fitView</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      onNodeClick={(node) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        console.log(node);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      nodeTypes={nodeTypes}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    ></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      <MiniMap /></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      <Controls /></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      <Background /></span>
<span style="background-color: #f8d7da; color: #d73a49;">-    </ReactFlow></span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export default NestedFlow;</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/routes.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/routes.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 801d77a9..456fa084 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/routes.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/routes.ts</span>
@@ -246,11 +246,6 @@ const routes = [
},
],
},
<span style="background-color: #f8d7da; color: #d73a49;">-  {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    path: '/workflow',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    component: '@/pages/workflow',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    layout: false,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  },</span>
];

export default routes;
</code></pre>

<div id="c75aa11a"></div>
<h2>c75aa11a</h2>

<p><strong>Message:</strong> Fix: The edit box for the headers parameter of the invoke operator is always loading. #4265 (#4266)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit c75aa11ae6b5c71d0072f0f51ac61b9f5c6b150f
Author: balibabu &lt;cike8899@users.noreply.github.com&gt;
Date:   Fri Dec 27 15:03:42 2024 +0800

Fix: The edit box for the headers parameter of the invoke operator is always loading. #4265 (#4266)

### What problem does this PR solve?

Fix: The edit box for the headers parameter of the invoke operator is
always loading. #4265

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/.umirc.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/.umirc.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index b96d84c1..75a8bb50 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/.umirc.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/.umirc.ts</span>
@@ -30,7 +30,10 @@ export default defineConfig({
},
},
devtool: '#39;source-map'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-  copy: ['src/conf.json'],</span>
<span style="background-color: #d4edda; color: #28a745;">+  copy: [</span>
<span style="background-color: #d4edda; color: #28a745;">+    { from: 'src/conf.json', to: 'dist/conf.json' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    { from: 'node_modules/monaco-editor/min/vs/', to: 'dist/vs/' },</span>
<span style="background-color: #d4edda; color: #28a745;">+  ],</span>
proxy: [
{
context: ['#39;/api'#39;, '#39;/v1'#39;],
</code></pre>

<div id="c7818770"></div>
<h2>c7818770</h2>

<p><strong>Message:</strong> Fix Python SDK example error. (#4263)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit c7818770f46a5873107a0e1353dd60d67d4c7fde
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Fri Dec 27 14:49:43 2024 +0800

Fix Python SDK example error. (#4263)

### What problem does this PR solve?

#4253
### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Documentation Update</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/python_api_reference.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/python_api_reference.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 075cd1a6..281c7bcc 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/python_api_reference.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/python_api_reference.md</span>
@@ -894,17 +894,12 @@ dataset = rag_object.list_datasets(name=&quot;ragflow&quot;)
dataset = dataset[0]
name = '#39;ragflow_test.txt'#39;
path = '#39;./test_data/ragflow_test.txt'#39;
<span style="background-color: #f8d7da; color: #d73a49;">-rag_object.create_document(dataset, name=name, blob=open(path, "rb").read())</span>
<span style="background-color: #f8d7da; color: #d73a49;">-doc = dataset.list_documents(name=name)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-doc = doc[0]</span>
<span style="background-color: #f8d7da; color: #d73a49;">-dataset.async_parse_documents([doc.id])</span>
<span style="background-color: #f8d7da; color: #d73a49;">-for c in rag_object.retrieve(question="What's ragflow?",</span>
<span style="background-color: #f8d7da; color: #d73a49;">-             dataset_ids=[dataset.id], document_ids=[doc.id],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-             page=1, page_size=30, similarity_threshold=0.2,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-             vector_similarity_weight=0.3,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-             top_k=1024</span>
<span style="background-color: #f8d7da; color: #d73a49;">-             ):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    print(c)</span>
<span style="background-color: #d4edda; color: #28a745;">+documents =[{"displayed_name":"test_retrieve_chunks.txt","blob":open(path, "rb").read()}]</span>
<span style="background-color: #d4edda; color: #28a745;">+docs = dataset.upload_documents(documents)</span>
<span style="background-color: #d4edda; color: #28a745;">+doc = docs[0]</span>
<span style="background-color: #d4edda; color: #28a745;">+doc.add_chunk(content="This is a chunk addition test")</span>
<span style="background-color: #d4edda; color: #28a745;">+for c in rag_object.retrieve(dataset_ids=[dataset.id],document_ids=[doc.id]):</span>
<span style="background-color: #d4edda; color: #28a745;">+  print(c)</span>
```

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/sdk/python/ragflow_sdk/dataset.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/sdk/python/ragflow_sdk/dataset.py</div>
deleted file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 5984aa62..00000000</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/sdk/python/ragflow_sdk/dataset.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ /dev/null</span>
@@ -1,21 +0,0 @@
<span style="background-color: #f8d7da; color: #d73a49;">-#</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  Copyright 2024 The InfiniFlow Authors. All Rights Reserved.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  Licensed under the Apache License, Version 2.0 (the "License");</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  you may not use this file except in compliance with the License.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  You may obtain a copy of the License at</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  distributed under the License is distributed on an "AS IS" BASIS,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  See the License for the specific language governing permissions and</span>
<span style="background-color: #f8d7da; color: #d73a49;">-#  limitations under the License.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-class DataSet:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    def __init__(self, user_key, dataset_url, uuid, name):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        self.user_key = user_key</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        self.dataset_url = dataset_url</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        self.uuid = uuid</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        self.name = name</span>
</code></pre>

<div id="6f6303d0"></div>
<h2>6f6303d0</h2>

<p><strong>Message:</strong> Fix Python SDK example error. (#4262)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 6f6303d0176c9ea28542c29b96a18be4a183f0ad
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Fri Dec 27 14:40:00 2024 +0800

Fix Python SDK example error. (#4262)

### What problem does this PR solve?

#4252

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Documentation Update</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/python_api_reference.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/python_api_reference.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index e19fbc7e..075cd1a6 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/python_api_reference.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/python_api_reference.md</span>
@@ -736,8 +736,8 @@ from ragflow_sdk import RAGFlow
rag_object = RAGFlow(api_key=&quot;&lt;YOUR_API_KEY&gt;&quot;, base_url=&quot;http://&lt;YOUR_BASE_URL&gt;:9380&quot;)
dataset = rag_object.list_datasets(&quot;123&quot;)
dataset = dataset[0]
<span style="background-color: #f8d7da; color: #d73a49;">-dataset.async_parse_documents(["wdfxb5t547d"])</span>
<span style="background-color: #f8d7da; color: #d73a49;">-for chunk in doc.list_chunks(keywords="rag", page=0, page_size=12):</span>
<span style="background-color: #d4edda; color: #28a745;">+docs = dataset.list_documents(keywords="test", page=1, page_size=12)</span>
<span style="background-color: #d4edda; color: #28a745;">+for chunk in docs[0].list_chunks(keywords="rag", page=0, page_size=12):</span>
print(chunk)
```

</code></pre>

<div id="146e8bb7"></div>
<h2>146e8bb7</h2>

<p><strong>Message:</strong> Feat: Limit the iteration start node to only be the source node #4242 (#4260)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 146e8bb79313e9fad3fdaef0617ebb494bd30ba3
Author: balibabu &lt;cike8899@users.noreply.github.com&gt;
Date:   Fri Dec 27 14:25:15 2024 +0800

Feat: Limit the iteration start node to only be the source node #4242 (#4260)

### What problem does this PR solve?

Feat: Limit the iteration start node to only be the source node #4242

### Type of change


<span style="background-color: #f8d7da; color: #d73a49;">- [x] New Feature (non-breaking change which adds functionality)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/en.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/en.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index d6ccbdcf..040bcbd5 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/en.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/en.ts</span>
@@ -1093,6 +1093,9 @@ This delimiter is used to split the input text into several text pieces echo of
minus: '#39;Minus'#39;,
semicolon: '#39;Semicolon'#39;,
},
<span style="background-color: #d4edda; color: #28a745;">+      addVariable: 'Add variable',</span>
<span style="background-color: #d4edda; color: #28a745;">+      variableSettings: 'Variable settings',</span>
<span style="background-color: #d4edda; color: #28a745;">+      globalVariables: 'Global variables',</span>
},
footer: {
profile: '#39;All rights reserved @ React'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/zh-traditional.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/zh-traditional.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 77af023e..f47e102f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/zh-traditional.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/zh-traditional.ts</span>
@@ -1030,6 +1030,8 @@ export default {
minus: '#39;減號'#39;,
semicolon: '#39;分號'#39;,
},
<span style="background-color: #d4edda; color: #28a745;">+      addVariable: '新增變數',</span>
<span style="background-color: #d4edda; color: #28a745;">+      variableSettings: '變數設定',</span>
},
footer: {
profile: '#39;“保留所有權利 @ react”'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/zh.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/zh.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 116654d1..2d12f43d 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/zh.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/zh.ts</span>
@@ -1074,6 +1074,8 @@ export default {
minus: '#39;减号'#39;,
semicolon: '#39;分号'#39;,
},
<span style="background-color: #d4edda; color: #28a745;">+      addVariable: '新增变量',</span>
<span style="background-color: #d4edda; color: #28a745;">+      variableSettings: '变量设置',</span>
},
footer: {
profile: '#39;All rights reserved @ React'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/edge/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/edge/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index a1e5fbca..112ff1b3 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/edge/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/edge/index.tsx</span>
@@ -44,8 +44,6 @@ export function ButtonEdge({
};

// highlight the nodes that the workflow passes through
<span style="background-color: #f8d7da; color: #d73a49;">-  // const queryClient = useQueryClient();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  // const flowDetail = queryClient.getQueryData<IFlow>(['flowDetail']);</span>
const { data: flowDetail } = useFetchFlow();

const graphPath = useMemo(() =&gt; {
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/iteration-node.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/iteration-node.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 4a81d794..7524c674 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/iteration-node.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/iteration-node.tsx</span>
@@ -109,6 +109,7 @@ export function IterationStartNode({
isConnectable={isConnectable}
className={styles.handle}
style={RightHandleStyle}
<span style="background-color: #d4edda; color: #28a745;">+        isConnectableEnd={false}</span>
&gt;&lt;/Handle&gt;
&lt;div&gt;
&lt;ListRestart className=&quot;size-7&quot; /&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/begin-form/paramater-modal.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/begin-form/paramater-modal.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 5f07d252..7d689601 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/begin-form/paramater-modal.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/begin-form/paramater-modal.tsx</span>
@@ -3,6 +3,7 @@ import { IModalProps } from '#39;@/interfaces/common'#39;;
import { Form, Input, Modal, Select, Switch } from '#39;antd'#39;;
import { DefaultOptionType } from '#39;antd/es/select'#39;;
import { useEffect, useMemo } from '#39;react'#39;;
<span style="background-color: #d4edda; color: #28a745;">+import { useTranslation } from 'react-i18next';</span>
import { BeginQueryType, BeginQueryTypeIconMap } from '#39;../../constant'#39;;
import { BeginQuery } from '#39;../../interface'#39;;
import BeginDynamicOptions from '#39;./begin-dynamic-options'#39;;
@@ -16,6 +17,7 @@ export const ModalForm = ({
initialValue: BeginQuery;
otherThanCurrentQuery: BeginQuery[];
}) =&gt; {
<span style="background-color: #d4edda; color: #28a745;">+  const { t } = useTranslation();</span>
const [form] = Form.useForm();
const options = useMemo(() =&gt; {
return Object.values(BeginQueryType).reduce&lt;DefaultOptionType[]&gt;(
@@ -56,7 +58,7 @@ export const ModalForm = ({

return (
&lt;Modal
<span style="background-color: #f8d7da; color: #d73a49;">-      title="Begin query"</span>
<span style="background-color: #d4edda; color: #28a745;">+      title={t('flow.variableSettings')}</span>
open={visible}
onOk={onOk}
onCancel={hideModal}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/components/dynamic-input-variable.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/components/dynamic-input-variable.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 8cc8cc3d..9ad47b77 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/components/dynamic-input-variable.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/components/dynamic-input-variable.tsx</span>
@@ -91,7 +91,7 @@ const DynamicVariableForm = ({ node }: IProps) =&gt; {
icon={&lt;PlusOutlined /&gt;}
className={styles.addButton}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-              {t('flow.addItem')}</span>
<span style="background-color: #d4edda; color: #28a745;">+              {t('flow.addVariable')}</span>
&lt;/Button&gt;
&lt;/Form.Item&gt;
&lt;/&gt;
</code></pre>

<div id="f948c0d9"></div>
<h2>f948c0d9</h2>

<p><strong>Message:</strong> Clean query. (#4259)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit f948c0d9f1fa2342583c051e2150839df851de20
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Fri Dec 27 14:25:03 2024 +0800

Clean query. (#4259)

### What problem does this PR solve?

#4239

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/__init__.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/__init__.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index c124136b..0d414fca 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/__init__.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/__init__.py</span>
@@ -36,12 +36,12 @@ from .iteration import Iteration, IterationParam
from .iterationitem import IterationItem, IterationItemParam


<span style="background-color: #f8d7da; color: #d73a49;">-</span>
def component_class(class_name):
m = importlib.import_module(&quot;agent.component&quot;)
c = getattr(m, class_name)
return c

<span style="background-color: #d4edda; color: #28a745;">+</span>
__all__ = [
&quot;Begin&quot;,
&quot;BeginParam&quot;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/rag/nlp/query.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/rag/nlp/query.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 2d94a96c..ab5c22e3 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/rag/nlp/query.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/rag/nlp/query.py</span>
@@ -59,7 +59,7 @@ class FulltextQueryer:
&quot;&quot;,
),
(r&quot;(^| )(what|who|how|which|where|why)('#39;re|'#39;s)? &quot;, &quot; &quot;),
<span style="background-color: #f8d7da; color: #d73a49;">-            (r"(^| )('s|'re|is|are|were|was|do|does|did|don't|doesn't|didn't|has|have|be|there|you|me|your|my|mine|just|please|may|i|should|would|wouldn't|will|won't|done|go|for|with|so|the|a|an|by|i'm|it's|he's|she's|they|they're|you're|as|by|on|in|at|up|out|down|of) ", " ")</span>
<span style="background-color: #d4edda; color: #28a745;">+            (r"(^| )('s|'re|is|are|were|was|do|does|did|don't|doesn't|didn't|has|have|be|there|you|me|your|my|mine|just|please|may|i|should|would|wouldn't|will|won't|done|go|for|with|so|the|a|an|by|i'm|it's|he's|she's|they|they're|you're|as|by|on|in|at|up|out|down|of|to|or|and|if) ", " ")</span>
]
for r, p in patts:
txt = re.sub(r, p, txt, flags=re.IGNORECASE)
@@ -67,7 +67,7 @@ class FulltextQueryer:

def question(self, txt, tbl=&quot;qa&quot;, min_match:float=0.6):
txt = re.sub(
<span style="background-color: #f8d7da; color: #d73a49;">-            r"[ :\r\n\t,，。？?/`!！&\^%%()^\[\]]+",</span>
<span style="background-color: #d4edda; color: #28a745;">+            r"[ :|\r\n\t,，。？?/`!！&^%%()\[\]{}<>]+",</span>
&quot; &quot;,
rag_tokenizer.tradi2simp(rag_tokenizer.strQ2B(txt.lower())),
).strip()
@@ -81,16 +81,20 @@ class FulltextQueryer:
tks_w = [(re.sub(r&quot;[ \\\&quot;'#39;^]&quot;, &quot;&quot;, tk), w) for tk, w in tks_w]
tks_w = [(re.sub(r&quot;^[a-z0-9]$&quot;, &quot;&quot;, tk), w) for tk, w in tks_w if tk]
tks_w = [(re.sub(r&quot;^[\+-]&quot;, &quot;&quot;, tk), w) for tk, w in tks_w if tk]
<span style="background-color: #d4edda; color: #28a745;">+            tks_w = [(tk.strip(), w) for tk, w in tks_w if tk.strip()]</span>
syns = []
for tk, w in tks_w:
syn = self.syn.lookup(tk)
syn = rag_tokenizer.tokenize(&quot; &quot;.join(syn)).split()
keywords.extend(syn)
<span style="background-color: #f8d7da; color: #d73a49;">-                syn = ["\"{}\"^{:.4f}".format(s, w / 4.) for s in syn if s]</span>
<span style="background-color: #d4edda; color: #28a745;">+                syn = ["\"{}\"^{:.4f}".format(s, w / 4.) for s in syn if s.strip()]</span>
syns.append(&quot; &quot;.join(syn))

q = [&quot;({}^{:.4f}&quot;.format(tk, w) + &quot; {})&quot;.format(syn) for (tk, w), syn in zip(tks_w, syns) if tk and not re.match(r&quot;[.^+\(\)-]&quot;, tk)]
for i in range(1, len(tks_w)):
<span style="background-color: #d4edda; color: #28a745;">+                left, right = tks_w[i - 1][0].strip(), tks_w[i][0].strip()</span>
<span style="background-color: #d4edda; color: #28a745;">+                if not left or not right:</span>
<span style="background-color: #d4edda; color: #28a745;">+                    continue</span>
q.append(
'#39;&quot;%s %s&quot;^%.4f'#39;
% (
</code></pre>

<div id="c3e3f0fb"></div>
<h2>c3e3f0fb</h2>

<p><strong>Message:</strong> Add iteration for agent. (#4258)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit c3e3f0fbb451ecb1b4c6b5419999602dd0cd9742
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Fri Dec 27 11:38:33 2024 +0800

Add iteration for agent. (#4258)

### What problem does this PR solve?

#4242
### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] New Feature (non-breaking change which adds functionality)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/canvas.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/canvas.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 3d66cc43..99ea9730 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/canvas.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/canvas.py</span>
@@ -18,6 +18,9 @@ import json
from abc import ABC
from copy import deepcopy
from functools import partial
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+import pandas as pd</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
from agent.component import component_class
from agent.component.base import ComponentBase

@@ -83,7 +86,8 @@ class Canvas(ABC):
}
},
&quot;downstream&quot;: [],
<span style="background-color: #f8d7da; color: #d73a49;">-                    "upstream": []</span>
<span style="background-color: #d4edda; color: #28a745;">+                    "upstream": [],</span>
<span style="background-color: #d4edda; color: #28a745;">+                    "parent_id": ""</span>
}
},
&quot;history&quot;: [],
@@ -207,6 +211,14 @@ class Canvas(ABC):
waiting.append(c)
continue
yield &quot;*'#39;{}'#39;* is running...🕞&quot;.format(self.get_compnent_name(c))
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+                    if cpn.component_name.lower() == "iteration":</span>
<span style="background-color: #d4edda; color: #28a745;">+                        st_cpn = cpn.get_start()</span>
<span style="background-color: #d4edda; color: #28a745;">+                        assert st_cpn, "Start component not found for Iteration."</span>
<span style="background-color: #d4edda; color: #28a745;">+                        if not st_cpn["obj"].end():</span>
<span style="background-color: #d4edda; color: #28a745;">+                            cpn = st_cpn["obj"]</span>
<span style="background-color: #d4edda; color: #28a745;">+                            c = cpn._id</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
try:
ans = cpn.run(self.history, **kwargs)
except Exception as e:
@@ -215,16 +227,26 @@ class Canvas(ABC):
ran += 1
raise e
self.path[-1].append(c)
<span style="background-color: #d4edda; color: #28a745;">+</span>
ran += 1

<span style="background-color: #f8d7da; color: #d73a49;">-        for m in prepare2run(self.components[self.path[-2][-1]]["downstream"]):</span>
<span style="background-color: #d4edda; color: #28a745;">+        downstream = self.components[self.path[-2][-1]]["downstream"]</span>
<span style="background-color: #d4edda; color: #28a745;">+        if not downstream and self.components[self.path[-2][-1]].get("parent_id"):</span>
<span style="background-color: #d4edda; color: #28a745;">+            cid = self.path[-2][-1]</span>
<span style="background-color: #d4edda; color: #28a745;">+            pid = self.components[cid]["parent_id"]</span>
<span style="background-color: #d4edda; color: #28a745;">+            o, _ = self.components[cid]["obj"].output(allow_partial=False)</span>
<span style="background-color: #d4edda; color: #28a745;">+            oo, _ = self.components[pid]["obj"].output(allow_partial=False)</span>
<span style="background-color: #d4edda; color: #28a745;">+            self.components[pid]["obj"].set(pd.concat([oo, o], ignore_index=True))</span>
<span style="background-color: #d4edda; color: #28a745;">+            downstream = [pid]</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        for m in prepare2run(downstream):</span>
yield {&quot;content&quot;: m, &quot;running_status&quot;: True}

while 0 &lt;= ran &lt; len(self.path[-1]):
logging.debug(f&quot;Canvas.run: {ran} {self.path}&quot;)
cpn_id = self.path[-1][ran]
cpn = self.get_component(cpn_id)
<span style="background-color: #f8d7da; color: #d73a49;">-            if not cpn["downstream"]:</span>
<span style="background-color: #d4edda; color: #28a745;">+            if not any([cpn["downstream"], cpn.get("parent_id"), waiting]):</span>
break

loop = self._find_loop()
@@ -239,7 +261,15 @@ class Canvas(ABC):
yield {&quot;content&quot;: m, &quot;running_status&quot;: True}
continue

<span style="background-color: #f8d7da; color: #d73a49;">-            for m in prepare2run(cpn["downstream"]):</span>
<span style="background-color: #d4edda; color: #28a745;">+            downstream = cpn["downstream"]</span>
<span style="background-color: #d4edda; color: #28a745;">+            if not downstream and cpn.get("parent_id"):</span>
<span style="background-color: #d4edda; color: #28a745;">+                pid = cpn["parent_id"]</span>
<span style="background-color: #d4edda; color: #28a745;">+                _, o = cpn["obj"].output(allow_partial=False)</span>
<span style="background-color: #d4edda; color: #28a745;">+                _, oo = self.components[pid]["obj"].output(allow_partial=False)</span>
<span style="background-color: #d4edda; color: #28a745;">+                self.components[pid]["obj"].set_output(pd.concat([oo.dropna(axis=1), o.dropna(axis=1)], ignore_index=True))</span>
<span style="background-color: #d4edda; color: #28a745;">+                downstream = [pid]</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+            for m in prepare2run(downstream):</span>
yield {&quot;content&quot;: m, &quot;running_status&quot;: True}

if ran &gt;= len(self.path[-1]) and waiting:
@@ -247,6 +277,7 @@ class Canvas(ABC):
waiting = []
for m in prepare2run(without_dependent_checking):
yield {&quot;content&quot;: m, &quot;running_status&quot;: True}
<span style="background-color: #d4edda; color: #28a745;">+                without_dependent_checking = []</span>
ran -= 1

if self.answer:
@@ -294,7 +325,7 @@ class Canvas(ABC):
return False

for i in range(len(path)):
<span style="background-color: #f8d7da; color: #d73a49;">-            if path[i].lower().find("answer") >= 0:</span>
<span style="background-color: #d4edda; color: #28a745;">+            if path[i].lower().find("answer") == 0 or path[i].lower().find("iterationitem") == 0:</span>
path = path[:i]
break

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/__init__.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/__init__.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 2bb8669f..c124136b 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/__init__.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/__init__.py</span>
@@ -32,6 +32,8 @@ from .crawler import Crawler, CrawlerParam
from .invoke import Invoke, InvokeParam
from .template import Template, TemplateParam
from .email import Email, EmailParam
<span style="background-color: #d4edda; color: #28a745;">+from .iteration import Iteration, IterationParam</span>
<span style="background-color: #d4edda; color: #28a745;">+from .iterationitem import IterationItem, IterationItemParam</span>



@@ -103,6 +105,10 @@ __all__ = [
&quot;CrawlerParam&quot;,
&quot;Invoke&quot;,
&quot;InvokeParam&quot;,
<span style="background-color: #d4edda; color: #28a745;">+    "Iteration",</span>
<span style="background-color: #d4edda; color: #28a745;">+    "IterationParam",</span>
<span style="background-color: #d4edda; color: #28a745;">+    "IterationItem",</span>
<span style="background-color: #d4edda; color: #28a745;">+    "IterationItemParam",</span>
&quot;Template&quot;,
&quot;TemplateParam&quot;,
&quot;Email&quot;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/baidu.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/baidu.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 7311b43c..daec9f05 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/baidu.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/baidu.py</span>
@@ -44,7 +44,7 @@ class Baidu(ComponentBase, ABC):
return Baidu.be_output(&quot;&quot;)

try:
<span style="background-color: #f8d7da; color: #d73a49;">-            url = 'https://www.baidu.com/s?wd=' + ans + '&rn=' + str(self._param.top_n)</span>
<span style="background-color: #d4edda; color: #28a745;">+            url = 'http://www.baidu.com/s?wd=' + ans + '&rn=' + str(self._param.top_n)</span>
headers = {
'#39;User-Agent'#39;: '#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36'#39;}
response = requests.get(url=url, headers=headers)
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/base.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/base.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index cb4e1ad8..8ee7b818 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/base.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/base.py</span>
@@ -426,10 +426,14 @@ class ComponentBase(ABC):

def output(self, allow_partial=True) -&gt; Tuple[str, Union[pd.DataFrame, partial]]:
o = getattr(self._param, self._param.output_var_name)
<span style="background-color: #f8d7da; color: #d73a49;">-        if not isinstance(o, partial) and not isinstance(o, pd.DataFrame):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            if not isinstance(o, list):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                o = [o]</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            o = pd.DataFrame(o)</span>
<span style="background-color: #d4edda; color: #28a745;">+        if not isinstance(o, partial):</span>
<span style="background-color: #d4edda; color: #28a745;">+            if not isinstance(o, pd.DataFrame):</span>
<span style="background-color: #d4edda; color: #28a745;">+                if isinstance(o, list):</span>
<span style="background-color: #d4edda; color: #28a745;">+                    return self._param.output_var_name, pd.DataFrame(o)</span>
<span style="background-color: #d4edda; color: #28a745;">+                if o is None:</span>
<span style="background-color: #d4edda; color: #28a745;">+                    return self._param.output_var_name, pd.DataFrame()</span>
<span style="background-color: #d4edda; color: #28a745;">+                return self._param.output_var_name, pd.DataFrame([{"content": str(o)}])</span>
<span style="background-color: #d4edda; color: #28a745;">+            return self._param.output_var_name, o</span>

if allow_partial or not isinstance(o, partial):
if not isinstance(o, partial) and not isinstance(o, pd.DataFrame):
@@ -574,4 +578,8 @@ class ComponentBase(ABC):
return self._canvas.get_component(cpn_id)[&quot;obj&quot;].component_name.lower()

def debug(self, **kwargs):
<span style="background-color: #f8d7da; color: #d73a49;">-        return self._run([], **kwargs)</span>
\ No newline at end of file
<span style="background-color: #d4edda; color: #28a745;">+        return self._run([], **kwargs)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def get_parent(self):</span>
<span style="background-color: #d4edda; color: #28a745;">+        pid = self._canvas.get_component(self._id)["parent_id"]</span>
<span style="background-color: #d4edda; color: #28a745;">+        return self._canvas.get_component(pid)["obj"]</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/iteration.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/iteration.py</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..3f554ae8</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/iteration.py</span>
@@ -0,0 +1,45 @@
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#  Copyright 2024 The InfiniFlow Authors. All Rights Reserved.</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#  Licensed under the Apache License, Version 2.0 (the "License");</span>
<span style="background-color: #d4edda; color: #28a745;">+#  you may not use this file except in compliance with the License.</span>
<span style="background-color: #d4edda; color: #28a745;">+#  You may obtain a copy of the License at</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#  Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: #d4edda; color: #28a745;">+#  distributed under the License is distributed on an "AS IS" BASIS,</span>
<span style="background-color: #d4edda; color: #28a745;">+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: #d4edda; color: #28a745;">+#  See the License for the specific language governing permissions and</span>
<span style="background-color: #d4edda; color: #28a745;">+#  limitations under the License.</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+from abc import ABC</span>
<span style="background-color: #d4edda; color: #28a745;">+from agent.component.base import ComponentBase, ComponentParamBase</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+class IterationParam(ComponentParamBase):</span>
<span style="background-color: #d4edda; color: #28a745;">+    """</span>
<span style="background-color: #d4edda; color: #28a745;">+    Define the Iteration component parameters.</span>
<span style="background-color: #d4edda; color: #28a745;">+    """</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def __init__(self):</span>
<span style="background-color: #d4edda; color: #28a745;">+        super().__init__()</span>
<span style="background-color: #d4edda; color: #28a745;">+        self.delimiter = ","</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def check(self):</span>
<span style="background-color: #d4edda; color: #28a745;">+        self.check_empty(self.delimiter, "Delimiter")</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+class Iteration(ComponentBase, ABC):</span>
<span style="background-color: #d4edda; color: #28a745;">+    component_name = "Iteration"</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def get_start(self):</span>
<span style="background-color: #d4edda; color: #28a745;">+        for cid in self._canvas.components.keys():</span>
<span style="background-color: #d4edda; color: #28a745;">+            if self._canvas.get_component(cid)["obj"].component_name.lower() != "iterationitem":</span>
<span style="background-color: #d4edda; color: #28a745;">+                continue</span>
<span style="background-color: #d4edda; color: #28a745;">+            if self._canvas.get_component(cid)["parent_id"] == self._id:</span>
<span style="background-color: #d4edda; color: #28a745;">+                return self._canvas.get_component(cid)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def _run(self, history, **kwargs):</span>
<span style="background-color: #d4edda; color: #28a745;">+        return self.output(allow_partial=False)[1]</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/iterationitem.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/iterationitem.py</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..71d032b5</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/iterationitem.py</span>
@@ -0,0 +1,49 @@
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#  Copyright 2024 The InfiniFlow Authors. All Rights Reserved.</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#  Licensed under the Apache License, Version 2.0 (the "License");</span>
<span style="background-color: #d4edda; color: #28a745;">+#  you may not use this file except in compliance with the License.</span>
<span style="background-color: #d4edda; color: #28a745;">+#  You may obtain a copy of the License at</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+#  Unless required by applicable law or agreed to in writing, software</span>
<span style="background-color: #d4edda; color: #28a745;">+#  distributed under the License is distributed on an "AS IS" BASIS,</span>
<span style="background-color: #d4edda; color: #28a745;">+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span style="background-color: #d4edda; color: #28a745;">+#  See the License for the specific language governing permissions and</span>
<span style="background-color: #d4edda; color: #28a745;">+#  limitations under the License.</span>
<span style="background-color: #d4edda; color: #28a745;">+#</span>
<span style="background-color: #d4edda; color: #28a745;">+from abc import ABC</span>
<span style="background-color: #d4edda; color: #28a745;">+import pandas as pd</span>
<span style="background-color: #d4edda; color: #28a745;">+from agent.component.base import ComponentBase, ComponentParamBase</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+class IterationItemParam(ComponentParamBase):</span>
<span style="background-color: #d4edda; color: #28a745;">+    """</span>
<span style="background-color: #d4edda; color: #28a745;">+    Define the IterationItem component parameters.</span>
<span style="background-color: #d4edda; color: #28a745;">+    """</span>
<span style="background-color: #d4edda; color: #28a745;">+    def check(self):</span>
<span style="background-color: #d4edda; color: #28a745;">+        return True</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+class IterationItem(ComponentBase, ABC):</span>
<span style="background-color: #d4edda; color: #28a745;">+    component_name = "IterationItem"</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def __init__(self, canvas, id, param: ComponentParamBase):</span>
<span style="background-color: #d4edda; color: #28a745;">+        super().__init__(canvas, id, param)</span>
<span style="background-color: #d4edda; color: #28a745;">+        self._idx = 0</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def _run(self, history, **kwargs):</span>
<span style="background-color: #d4edda; color: #28a745;">+        parent = self.get_parent()</span>
<span style="background-color: #d4edda; color: #28a745;">+        ans = parent.get_input()</span>
<span style="background-color: #d4edda; color: #28a745;">+        ans = parent._param.delimiter.join(ans["content"]) if "content" in ans else ""</span>
<span style="background-color: #d4edda; color: #28a745;">+        ans = [a.strip() for a in ans.split(parent._param.delimiter)]</span>
<span style="background-color: #d4edda; color: #28a745;">+        df = pd.DataFrame([{"content": ans[self._idx]}])</span>
<span style="background-color: #d4edda; color: #28a745;">+        self._idx += 1</span>
<span style="background-color: #d4edda; color: #28a745;">+        if self._idx >= len(ans):</span>
<span style="background-color: #d4edda; color: #28a745;">+            self._idx = -1</span>
<span style="background-color: #d4edda; color: #28a745;">+        return df</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+    def end(self):</span>
<span style="background-color: #d4edda; color: #28a745;">+        return self._idx == -1</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/db/services/api_service.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/db/services/api_service.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index ee53fa27..246a0469 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/db/services/api_service.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/db/services/api_service.py</span>
@@ -53,7 +53,6 @@ class API4ConversationService(CommonService):
sessions = sessions.order_by(cls.model.getter_by(orderby).desc())
else:
sessions = sessions.order_by(cls.model.getter_by(orderby).asc())
<span style="background-color: #f8d7da; color: #d73a49;">-        sessions = sessions.where(cls.model.user_id == tenant_id)</span>
sessions = sessions.paginate(page_number, items_per_page)

return list(sessions.dicts())
</code></pre>

<div id="a1a825c8"></div>
<h2>a1a825c8</h2>

<p><strong>Message:</strong> Feat: Add the iteration Node #4242 (#4247)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit a1a825c830cf143ecdadd3e74775ae1ff175bbc1
Author: balibabu &lt;cike8899@users.noreply.github.com&gt;
Date:   Fri Dec 27 11:24:17 2024 +0800

Feat: Add the iteration Node #4242 (#4247)

### What problem does this PR solve?

Feat: Add the iteration Node #4242

### Type of change


<span style="background-color: #f8d7da; color: #d73a49;">- [x] New Feature (non-breaking change which adds functionality)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/assets/icon/Icon.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/assets/icon/Icon.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 1d20e3a8..e363af97 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/assets/icon/Icon.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/assets/icon/Icon.tsx</span>
@@ -205,6 +205,36 @@ const QWeatherSvg = () =&gt; (
&lt;/svg&gt;
);

<span style="background-color: #d4edda; color: #28a745;">+const SemicolonSvg = () => (</span>
<span style="background-color: #d4edda; color: #28a745;">+  <svg</span>
<span style="background-color: #d4edda; color: #28a745;">+    viewBox="0 0 1024 1024"</span>
<span style="background-color: #d4edda; color: #28a745;">+    version="1.1"</span>
<span style="background-color: #d4edda; color: #28a745;">+    xmlns="http://www.w3.org/2000/svg"</span>
<span style="background-color: #d4edda; color: #28a745;">+    width="200"</span>
<span style="background-color: #d4edda; color: #28a745;">+    height="200"</span>
<span style="background-color: #d4edda; color: #28a745;">+  ></span>
<span style="background-color: #d4edda; color: #28a745;">+    <path</span>
<span style="background-color: #d4edda; color: #28a745;">+      d="M506.88 249.059556a89.884444 89.884444 0 0 0 60.074667-21.845334 87.950222 87.950222 0 0 0 23.210666-61.44 79.189333 79.189333 0 0 0-83.285333-83.285333c-24.576 0-45.056 6.826667-60.074667 23.210667-16.384 15.018667-23.210667 35.498667-23.210666 60.074666 0 24.576 6.826667 45.056 23.210666 61.44 15.018667 13.653333 35.498667 21.845333 60.074667 21.845334zM414.037333 967.224889a262.030222 262.030222 0 0 0 141.994667-88.746667c35.498667-46.421333 53.248-99.669333 53.248-159.744 0-39.594667-9.557333-70.997333-27.306667-95.573333a89.543111 89.543111 0 0 0-75.093333-38.229333c-27.306667 0-47.786667 6.826667-62.805333 23.210666-17.749333 15.018667-25.941333 35.498667-25.941334 61.44 0 23.210667 8.192 43.690667 24.576 60.074667a79.416889 79.416889 0 0 0 58.709334 24.576 78.506667 78.506667 0 0 0 30.037333-5.461333c0 32.768-9.557333 62.805333-30.037333 91.477333a190.008889 190.008889 0 0 1-87.381334 60.074667v66.901333z"</span>
<span style="background-color: #d4edda; color: #28a745;">+      fill={currentColor}</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></path></span>
<span style="background-color: #d4edda; color: #28a745;">+  </svg></span>
<span style="background-color: #d4edda; color: #28a745;">+);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const CommaSvg = () => (</span>
<span style="background-color: #d4edda; color: #28a745;">+  <svg</span>
<span style="background-color: #d4edda; color: #28a745;">+    viewBox="0 0 1024 1024"</span>
<span style="background-color: #d4edda; color: #28a745;">+    version="1.1"</span>
<span style="background-color: #d4edda; color: #28a745;">+    xmlns="http://www.w3.org/2000/svg"</span>
<span style="background-color: #d4edda; color: #28a745;">+    width="200"</span>
<span style="background-color: #d4edda; color: #28a745;">+    height="200"</span>
<span style="background-color: #d4edda; color: #28a745;">+  ></span>
<span style="background-color: #d4edda; color: #28a745;">+    <path</span>
<span style="background-color: #d4edda; color: #28a745;">+      fill={currentColor}</span>
<span style="background-color: #d4edda; color: #28a745;">+      d="M701.312 416.064C701.312 327.68 629.76 256 541.312 256c-88.32 0-160 71.68-160 160.064s71.68 160.064 160 160.064c10.368 0 20.352-1.216 30.144-3.072-27.136 78.592-88.32 99.392-166.4 120.32L434.688 736c228.288-40.576 269.184-268.48 266.688-266.496C707.328 452.672 701.312 434.88 701.312 416.064z"</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></path></span>
<span style="background-color: #d4edda; color: #28a745;">+  </svg></span>
<span style="background-color: #d4edda; color: #28a745;">+);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
export const ApiIcon = (props: Partial&lt;IconComponentProps&gt;) =&gt; (
&lt;Icon component={ApiSvg} {...props} /&gt;
);
@@ -238,3 +268,11 @@ export const GitHubIcon = (props: Partial&lt;IconComponentProps&gt;) =&gt; (
export const QWeatherIcon = (props: Partial&lt;IconComponentProps&gt;) =&gt; (
&lt;Icon component={QWeatherSvg} {...props} /&gt;
);
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const SemicolonIcon = (props: Partial<IconComponentProps>) => (</span>
<span style="background-color: #d4edda; color: #28a745;">+  <Icon component={SemicolonSvg} {...props} /></span>
<span style="background-color: #d4edda; color: #28a745;">+);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const CommaIcon = (props: Partial<IconComponentProps>) => (</span>
<span style="background-color: #d4edda; color: #28a745;">+  <Icon component={CommaSvg} {...props} /></span>
<span style="background-color: #d4edda; color: #28a745;">+);</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/components/delimiter.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/components/delimiter.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 25e3128b..a7944087 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/components/delimiter.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/components/delimiter.tsx</span>
@@ -4,16 +4,23 @@ import { useTranslation } from '#39;react-i18next'#39;;
interface IProps {
value?: string | undefined;
onChange?: (val: string | undefined) =&gt; void;
<span style="background-color: #d4edda; color: #28a745;">+  maxLength?: number;</span>
}

<span style="background-color: #f8d7da; color: #d73a49;">-const DelimiterInput = ({ value, onChange }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+export const DelimiterInput = ({ value, onChange, maxLength }: IProps) => {</span>
const nextValue = value?.replaceAll('#39;\n'#39;, '#39;\\n'#39;);
const handleInputChange = (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {
const val = e.target.value;
const nextValue = val.replaceAll('#39;\\n'#39;, '#39;\n'#39;);
onChange?.(nextValue);
};
<span style="background-color: #f8d7da; color: #d73a49;">-  return <Input value={nextValue} onChange={handleInputChange}></Input>;</span>
<span style="background-color: #d4edda; color: #28a745;">+  return (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <Input</span>
<span style="background-color: #d4edda; color: #28a745;">+      value={nextValue}</span>
<span style="background-color: #d4edda; color: #28a745;">+      onChange={handleInputChange}</span>
<span style="background-color: #d4edda; color: #28a745;">+      maxLength={maxLength}</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></Input></span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
};

const Delimiter = () =&gt; {
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/interfaces/database/flow.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/interfaces/database/flow.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f49bda09..2a81f92f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/interfaces/database/flow.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/interfaces/database/flow.ts</span>
@@ -17,6 +17,7 @@ export interface IOperator {
obj: IOperatorNode;
downstream: string[];
upstream: string[];
<span style="background-color: #d4edda; color: #28a745;">+  parent_id?: string;</span>
}

export interface IOperatorNode {
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/less/mixins.less</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/less/mixins.less</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 078be918..119c1a08 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/less/mixins.less</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/less/mixins.less</span>
@@ -75,3 +75,23 @@
background-color: #eff8ff;
border: 1px;
}
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+.commonNodeShadow() {</span>
<span style="background-color: #d4edda; color: #28a745;">+  box-shadow:</span>
<span style="background-color: #d4edda; color: #28a745;">+    -6px 0 12px 0 rgba(179, 177, 177, 0.08),</span>
<span style="background-color: #d4edda; color: #28a745;">+    -3px 0 6px -4px rgba(0, 0, 0, 0.12),</span>
<span style="background-color: #d4edda; color: #28a745;">+    -6px 0 16px 6px rgba(0, 0, 0, 0.05);</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+.commonNodeRadius() {</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-radius: 10px;</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+.commonNode() {</span>
<span style="background-color: #d4edda; color: #28a745;">+  .commonNodeShadow();</span>
<span style="background-color: #d4edda; color: #28a745;">+  .commonNodeRadius();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  padding: 10px;</span>
<span style="background-color: #d4edda; color: #28a745;">+  background: white;</span>
<span style="background-color: #d4edda; color: #28a745;">+  width: 200px;</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/en.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/en.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f37fe951..d6ccbdcf 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/en.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/en.ts</span>
@@ -1077,6 +1077,22 @@ The above is the content you need to summarize.`,
contentTip: '#39;content: Email content (Optional)'#39;,
jsonUploadTypeErrorMessage: '#39;Please upload json file'#39;,
jsonUploadContentErrorMessage: '#39;json file error'#39;,
<span style="background-color: #d4edda; color: #28a745;">+      iteration: 'Iteration',</span>
<span style="background-color: #d4edda; color: #28a745;">+      iterationDescription: `This component firstly split the input into array by "delimiter".</span>
<span style="background-color: #d4edda; color: #28a745;">+Perform the same operation steps on the elements in the array in sequence until all results are output, which can be understood as a task batch processor.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+For example, within the long text translation iteration node, if all content is input to the LLM node, the single conversation limit may be reached. The upstream node can first split the long text into multiple fragments, and cooperate with the iterative node to perform batch translation on each fragment to avoid reaching the LLM message limit for a single conversation.`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      delimiterTip: `</span>
<span style="background-color: #d4edda; color: #28a745;">+This delimiter is used to split the input text into several text pieces echo of which will be performed as input item of each iteration.`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      delimiterOptions: {</span>
<span style="background-color: #d4edda; color: #28a745;">+        comma: 'Comma',</span>
<span style="background-color: #d4edda; color: #28a745;">+        lineBreak: 'Line break',</span>
<span style="background-color: #d4edda; color: #28a745;">+        tab: 'Tab',</span>
<span style="background-color: #d4edda; color: #28a745;">+        underline: 'Underline',</span>
<span style="background-color: #d4edda; color: #28a745;">+        diagonal: 'Diagonal',</span>
<span style="background-color: #d4edda; color: #28a745;">+        minus: 'Minus',</span>
<span style="background-color: #d4edda; color: #28a745;">+        semicolon: 'Semicolon',</span>
<span style="background-color: #d4edda; color: #28a745;">+      },</span>
},
footer: {
profile: '#39;All rights reserved @ React'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/zh-traditional.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/zh-traditional.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index d05bf838..77af023e 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/zh-traditional.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/zh-traditional.ts</span>
@@ -1016,6 +1016,20 @@ export default {
templateDescription: '#39;此元件用於排版各種元件的輸出。 '#39;,
jsonUploadTypeErrorMessage: '#39;請上傳json檔'#39;,
jsonUploadContentErrorMessage: '#39;json 檔案錯誤'#39;,
<span style="background-color: #d4edda; color: #28a745;">+      iterationDescription: `此元件首先透過「分隔符號」將輸入拆分為陣列。</span>
<span style="background-color: #d4edda; color: #28a745;">+對數組中的元素依序執行相同的操作步驟，直到輸出所有結果，可以理解為任務批次處理器。</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+例如，在長文本翻譯迭代節點內，如果所有內容都輸入到LLM節點，則可能會達到單次對話限制。上游節點可以先將長文本拆分為多個分片，並配合迭代節點對每個分片進行批次翻譯，避免達到單次對話的LLM訊息限制。`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      delimiterTip: `此分隔符號用於將輸入文字分割成多個文字片段，其中的回顯將作為每次迭代的輸入項執行。`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      delimiterOptions: {</span>
<span style="background-color: #d4edda; color: #28a745;">+        comma: '逗號',</span>
<span style="background-color: #d4edda; color: #28a745;">+        lineBreak: '換行',</span>
<span style="background-color: #d4edda; color: #28a745;">+        tab: '製表符',</span>
<span style="background-color: #d4edda; color: #28a745;">+        underline: '底線',</span>
<span style="background-color: #d4edda; color: #28a745;">+        diagonal: '斜線',</span>
<span style="background-color: #d4edda; color: #28a745;">+        minus: '減號',</span>
<span style="background-color: #d4edda; color: #28a745;">+        semicolon: '分號',</span>
<span style="background-color: #d4edda; color: #28a745;">+      },</span>
},
footer: {
profile: '#39;“保留所有權利 @ react”'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/zh.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/zh.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index ca4e46cd..116654d1 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/zh.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/zh.ts</span>
@@ -1060,6 +1060,20 @@ export default {
contentTip: '#39;content: 邮件内容(可选)'#39;,
jsonUploadTypeErrorMessage: '#39;请上传json文件'#39;,
jsonUploadContentErrorMessage: '#39;json 文件错误'#39;,
<span style="background-color: #d4edda; color: #28a745;">+      iteration: '循环',</span>
<span style="background-color: #d4edda; color: #28a745;">+      iterationDescription: `该组件首先将输入以“分隔符”分割成数组，然后依次对数组中的元素执行相同的操作步骤，直到输出所有结果，可以理解为一个任务批处理器。</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+例如在长文本翻译迭代节点中，如果所有内容都输入到LLM节点，可能会达到单次对话的限制，上游节点可以先将长文本分割成多个片段，配合迭代节点对每个片段进行批量翻译，避免达到单次对话的LLM消息限制。`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      delimiterTip: `该分隔符用于将输入文本分割成几个文本片段，每个文本片段的回显将作为每次迭代的输入项。`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      delimiterOptions: {</span>
<span style="background-color: #d4edda; color: #28a745;">+        comma: '逗号',</span>
<span style="background-color: #d4edda; color: #28a745;">+        lineBreak: '换行',</span>
<span style="background-color: #d4edda; color: #28a745;">+        tab: '制表符',</span>
<span style="background-color: #d4edda; color: #28a745;">+        underline: '下划线',</span>
<span style="background-color: #d4edda; color: #28a745;">+        diagonal: '斜线',</span>
<span style="background-color: #d4edda; color: #28a745;">+        minus: '减号',</span>
<span style="background-color: #d4edda; color: #28a745;">+        semicolon: '分号',</span>
<span style="background-color: #d4edda; color: #28a745;">+      },</span>
},
footer: {
profile: '#39;All rights reserved @ React'#39;,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/edge/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/edge/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 62dc4db9..a1e5fbca 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/edge/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/edge/index.tsx</span>
@@ -90,6 +90,7 @@ export function ButtonEdge({
// everything inside EdgeLabelRenderer has no pointer events by default
// if you have an interactive element, set pointer-events: all
pointerEvents: '#39;all'#39;,
<span style="background-color: #d4edda; color: #28a745;">+            zIndex: 1001, // https://github.com/xyflow/xyflow/discussions/3498</span>
}}
className=&quot;nodrag nopan&quot;
&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/index.less</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/index.less</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 3f3245a1..d824d88f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/index.less</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/index.less</span>
@@ -1,4 +1,10 @@
.canvasWrapper {
position: relative;
height: 100%;
<span style="background-color: #d4edda; color: #28a745;">+  :global(.react-flow__node-group) {</span>
<span style="background-color: #d4edda; color: #28a745;">+    .commonNode();</span>
<span style="background-color: #d4edda; color: #28a745;">+    padding: 0;</span>
<span style="background-color: #d4edda; color: #28a745;">+    border: 0;</span>
<span style="background-color: #d4edda; color: #28a745;">+    background-color: transparent;</span>
<span style="background-color: #d4edda; color: #28a745;">+  }</span>
}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 4c23a783..6aa742c3 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/index.tsx</span>
@@ -4,32 +4,24 @@ import {
TooltipProvider,
TooltipTrigger,
} from '#39;@/components/ui/tooltip'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useSetModalState } from '@/hooks/common-hooks';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { get } from 'lodash';</span>
import { FolderInput, FolderOutput } from '#39;lucide-react'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useCallback, useEffect } from 'react';</span>
import ReactFlow, {
Background,
ConnectionMode,
ControlButton,
Controls,
<span style="background-color: #f8d7da; color: #d73a49;">-  NodeMouseHandler,</span>
} from '#39;reactflow'#39;;
import '#39;reactflow/dist/style.css'#39;;
import ChatDrawer from '#39;../chat/drawer'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { Operator } from '../constant';</span>
import FormDrawer from '#39;../flow-drawer'#39;;
import {
<span style="background-color: #f8d7da; color: #d73a49;">-  useGetBeginNodeDataQuery,</span>
useHandleDrop,
<span style="background-color: #f8d7da; color: #d73a49;">-  useHandleExportOrImportJsonFile,</span>
useSelectCanvasData,
<span style="background-color: #f8d7da; color: #d73a49;">-  useShowFormDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useShowSingleDebugDrawer,</span>
useValidateConnection,
useWatchNodeFormDataChange,
} from '#39;../hooks'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { BeginQuery } from '../interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useHandleExportOrImportJsonFile } from '../hooks/use-export-json';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useShowDrawer } from '../hooks/use-show-drawer';</span>
import JsonUploadModal from '#39;../json-upload-modal'#39;;
import RunDrawer from '#39;../run-drawer'#39;;
import { ButtonEdge } from '#39;./edge'#39;;
@@ -40,6 +32,7 @@ import { CategorizeNode } from '#39;./node/categorize-node'#39;;
import { EmailNode } from '#39;./node/email-node'#39;;
import { GenerateNode } from '#39;./node/generate-node'#39;;
import { InvokeNode } from '#39;./node/invoke-node'#39;;
<span style="background-color: #d4edda; color: #28a745;">+import { IterationNode, IterationStartNode } from './node/iteration-node';</span>
import { KeywordNode } from '#39;./node/keyword-node'#39;;
import { LogicNode } from '#39;./node/logic-node'#39;;
import { MessageNode } from '#39;./node/message-node'#39;;
@@ -66,6 +59,8 @@ const nodeTypes = {
invokeNode: InvokeNode,
templateNode: TemplateNode,
emailNode: EmailNode,
<span style="background-color: #d4edda; color: #28a745;">+  group: IterationNode,</span>
<span style="background-color: #d4edda; color: #28a745;">+  iterationStartNode: IterationStartNode,</span>
};

const edgeTypes = {
@@ -87,66 +82,11 @@ function FlowCanvas({ drawerVisible, hideDrawer }: IProps) {
onSelectionChange,
} = useSelectCanvasData();
const isValidConnection = useValidateConnection();
<span style="background-color: #f8d7da; color: #d73a49;">-  const {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    visible: runVisible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    showModal: showRunModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideModal: hideRunModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  } = useSetModalState();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    visible: chatVisible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    showModal: showChatModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideModal: hideChatModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  } = useSetModalState();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    singleDebugDrawerVisible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    showSingleDebugDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideSingleDebugDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  } = useShowSingleDebugDrawer();</span>

const controlIconClassname = '#39;text-black'#39;;

<span style="background-color: #f8d7da; color: #d73a49;">-  const { formDrawerVisible, hideFormDrawer, showFormDrawer, clickedNode } =</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    useShowFormDrawer();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const onPaneClick = useCallback(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideFormDrawer();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [hideFormDrawer]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
const { onDrop, onDragOver, setReactFlowInstance } = useHandleDrop();

<span style="background-color: #f8d7da; color: #d73a49;">-  useWatchNodeFormDataChange();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const hideRunOrChatDrawer = useCallback(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideChatModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideRunModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideDrawer();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [hideChatModal, hideDrawer, hideRunModal]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const onNodeClick: NodeMouseHandler = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    (e, node) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      if (node.data.label !== Operator.Note) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        hideSingleDebugDrawer();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        hideRunOrChatDrawer();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        showFormDrawer(node);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      // handle single debug icon click</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      if (</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        get(e.target, 'dataset.play') === 'true' ||</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        get(e.target, 'parentNode.dataset.play') === 'true'</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      ) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        showSingleDebugDrawer();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      hideRunOrChatDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      hideSingleDebugDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      showFormDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      showSingleDebugDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    ],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const getBeginNodeDataQuery = useGetBeginNodeDataQuery();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
const {
handleExportJson,
handleImportJson,
@@ -155,25 +95,25 @@ function FlowCanvas({ drawerVisible, hideDrawer }: IProps) {
hideFileUploadModal,
} = useHandleExportOrImportJsonFile();

<span style="background-color: #f8d7da; color: #d73a49;">-  useEffect(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    if (drawerVisible) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      const query: BeginQuery[] = getBeginNodeDataQuery();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      if (query.length > 0) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        showRunModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        hideChatModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      } else {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        showChatModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        hideRunModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideChatModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideRunModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+  const {</span>
<span style="background-color: #d4edda; color: #28a745;">+    onNodeClick,</span>
<span style="background-color: #d4edda; color: #28a745;">+    onPaneClick,</span>
<span style="background-color: #d4edda; color: #28a745;">+    clickedNode,</span>
<span style="background-color: #d4edda; color: #28a745;">+    formDrawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideFormDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    singleDebugDrawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    chatVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    runVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideRunOrChatDrawer,</span>
showChatModal,
<span style="background-color: #f8d7da; color: #d73a49;">-    showRunModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+  } = useShowDrawer({</span>
drawerVisible,
<span style="background-color: #f8d7da; color: #d73a49;">-    getBeginNodeDataQuery,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  ]);</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+  });</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  useWatchNodeFormDataChange();</span>

return (
&lt;div className={styles.canvasWrapper}&gt;
@@ -222,6 +162,7 @@ function FlowCanvas({ drawerVisible, hideDrawer }: IProps) {
strokeWidth: 2,
stroke: '#39;rgb(202 197 245)'#39;,
},
<span style="background-color: #d4edda; color: #28a745;">+          zIndex: 1001, // https://github.com/xyflow/xyflow/discussions/3498</span>
}}
deleteKeyCode={['#39;Delete'#39;, '#39;Backspace'#39;]}
&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/begin-node.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/begin-node.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 9f0ba05e..35a9560e 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/begin-node.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/begin-node.tsx</span>
@@ -44,7 +44,9 @@ export function BeginNode({ selected, data }: NodeProps&lt;NodeData&gt;) {
fontSize={24}
color={operatorMap[data.label as Operator].color}
&gt;&lt;/OperatorIcon&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <div className={styles.nodeTitle}>{t(`flow.begin`)}</div></span>
<span style="background-color: #d4edda; color: #28a745;">+        <div className="truncate text-center font-semibold text-sm"></span>
<span style="background-color: #d4edda; color: #28a745;">+          {t(`flow.begin`)}</span>
<span style="background-color: #d4edda; color: #28a745;">+        </div></span>
&lt;/Flex&gt;
&lt;Flex gap={8} vertical className={styles.generateParameters}&gt;
{query.map((x, idx) =&gt; {
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/dropdown.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/dropdown.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 7e6fb1e9..dd5263ab 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/dropdown.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/dropdown.tsx</span>
@@ -3,6 +3,7 @@ import { CopyOutlined } from '#39;@ant-design/icons'#39;;
import { Flex, MenuProps } from '#39;antd'#39;;
import { useCallback } from '#39;react'#39;;
import { useTranslation } from '#39;react-i18next'#39;;
<span style="background-color: #d4edda; color: #28a745;">+import { Operator } from '../../constant';</span>
import { useDuplicateNode } from '#39;../../hooks'#39;;
import useGraphStore from '#39;../../store'#39;;

@@ -15,10 +16,17 @@ interface IProps {
const NodeDropdown = ({ id, iconFontColor, label }: IProps) =&gt; {
const { t } = useTranslation();
const deleteNodeById = useGraphStore((store) =&gt; store.deleteNodeById);
<span style="background-color: #d4edda; color: #28a745;">+  const deleteIterationNodeById = useGraphStore(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (store) => store.deleteIterationNodeById,</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>

const deleteNode = useCallback(() =&gt; {
<span style="background-color: #f8d7da; color: #d73a49;">-    deleteNodeById(id);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [id, deleteNodeById]);</span>
<span style="background-color: #d4edda; color: #28a745;">+    if (label === Operator.Iteration) {</span>
<span style="background-color: #d4edda; color: #28a745;">+      deleteIterationNodeById(id);</span>
<span style="background-color: #d4edda; color: #28a745;">+    } else {</span>
<span style="background-color: #d4edda; color: #28a745;">+      deleteNodeById(id);</span>
<span style="background-color: #d4edda; color: #28a745;">+    }</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [label, deleteIterationNodeById, id, deleteNodeById]);</span>

const duplicateNode = useDuplicateNode();

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/generate-node.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/generate-node.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 4d39821e..d79d1dc6 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/generate-node.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/generate-node.tsx</span>
@@ -4,7 +4,7 @@ import { Flex } from '#39;antd'#39;;
import classNames from '#39;classnames'#39;;
import { get } from '#39;lodash'#39;;
import { Handle, NodeProps, Position } from '#39;reactflow'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useGetComponentLabelByValue } from '../../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useGetComponentLabelByValue } from '../../hooks/use-get-begin-query';</span>
import { IGenerateParameter, NodeData } from '#39;../../interface'#39;;
import { LeftHandleStyle, RightHandleStyle } from '#39;./handle-icon'#39;;
import styles from '#39;./index.less'#39;;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/index.less</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/index.less</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index e6eb6cc4..14d7e607 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/index.less</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/index.less</span>
@@ -1,15 +1,3 @@
<span style="background-color: #f8d7da; color: #d73a49;">-.commonNode() {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  box-shadow:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    -6px 0 12px 0 rgba(179, 177, 177, 0.08),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    -3px 0 6px -4px rgba(0, 0, 0, 0.12),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    -6px 0 16px 6px rgba(0, 0, 0, 0.05);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  padding: 10px;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  border-radius: 10px;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  background: white;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  width: 200px;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
.dark {
background: rgb(63, 63, 63) !important;
}
@@ -43,6 +31,22 @@
border: 1.5px solid rgb(59, 118, 244);
}

<span style="background-color: #d4edda; color: #28a745;">+.selectedIterationNode {</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-bottom: 1.5px solid rgb(59, 118, 244);</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-left: 1.5px solid rgb(59, 118, 244);</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-right: 1.5px solid rgb(59, 118, 244);</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+.iterationHeader {</span>
<span style="background-color: #d4edda; color: #28a745;">+  .commonNodeShadow();</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+.selectedHeader {</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-top: 1.9px solid rgb(59, 118, 244);</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-left: 1.9px solid rgb(59, 118, 244);</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-right: 1.9px solid rgb(59, 118, 244);</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
.handle {
display: inline-flex;
align-items: center;
@@ -133,6 +137,12 @@
}
}

<span style="background-color: #d4edda; color: #28a745;">+.iterationNode {</span>
<span style="background-color: #d4edda; color: #28a745;">+  .commonNodeShadow();</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-bottom-left-radius: 10px;</span>
<span style="background-color: #d4edda; color: #28a745;">+  border-bottom-right-radius: 10px;</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
.nodeText {
padding-inline: 0.4em;
padding-block: 0.2em 0.1em;
@@ -142,12 +152,6 @@
.textEllipsis();
}

<span style="background-color: #f8d7da; color: #d73a49;">-.nodeTitle {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  font-weight: 600;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  text-align: center;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  .textEllipsis();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
.nodeHeader {
padding-bottom: 12px;
}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/iteration-node.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/iteration-node.tsx</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..4a81d794</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/iteration-node.tsx</span>
@@ -0,0 +1,118 @@
<span style="background-color: #d4edda; color: #28a745;">+import { useTheme } from '@/components/theme-provider';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { cn } from '@/lib/utils';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { ListRestart } from 'lucide-react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Handle, NodeProps, NodeResizeControl, Position } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { NodeData } from '../../interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { LeftHandleStyle, RightHandleStyle } from './handle-icon';</span>
<span style="background-color: #d4edda; color: #28a745;">+import styles from './index.less';</span>
<span style="background-color: #d4edda; color: #28a745;">+import NodeHeader from './node-header';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+function ResizeIcon() {</span>
<span style="background-color: #d4edda; color: #28a745;">+  return (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <svg</span>
<span style="background-color: #d4edda; color: #28a745;">+      xmlns="http://www.w3.org/2000/svg"</span>
<span style="background-color: #d4edda; color: #28a745;">+      width="20"</span>
<span style="background-color: #d4edda; color: #28a745;">+      height="20"</span>
<span style="background-color: #d4edda; color: #28a745;">+      viewBox="0 0 24 24"</span>
<span style="background-color: #d4edda; color: #28a745;">+      strokeWidth="2"</span>
<span style="background-color: #d4edda; color: #28a745;">+      stroke="#5025f9"</span>
<span style="background-color: #d4edda; color: #28a745;">+      fill="none"</span>
<span style="background-color: #d4edda; color: #28a745;">+      strokeLinecap="round"</span>
<span style="background-color: #d4edda; color: #28a745;">+      strokeLinejoin="round"</span>
<span style="background-color: #d4edda; color: #28a745;">+      style={{ position: 'absolute', right: 5, bottom: 5 }}</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></span>
<span style="background-color: #d4edda; color: #28a745;">+      <path stroke="none" d="M0 0h24v24H0z" fill="none" /></span>
<span style="background-color: #d4edda; color: #28a745;">+      <polyline points="16 20 20 20 20 16" /></span>
<span style="background-color: #d4edda; color: #28a745;">+      <line x1="14" y1="14" x2="20" y2="20" /></span>
<span style="background-color: #d4edda; color: #28a745;">+      <polyline points="8 4 4 4 4 8" /></span>
<span style="background-color: #d4edda; color: #28a745;">+      <line x1="4" y1="4" x2="10" y2="10" /></span>
<span style="background-color: #d4edda; color: #28a745;">+    </svg></span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const controlStyle = {</span>
<span style="background-color: #d4edda; color: #28a745;">+  background: 'transparent',</span>
<span style="background-color: #d4edda; color: #28a745;">+  border: 'none',</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export function IterationNode({</span>
<span style="background-color: #d4edda; color: #28a745;">+  id,</span>
<span style="background-color: #d4edda; color: #28a745;">+  data,</span>
<span style="background-color: #d4edda; color: #28a745;">+  isConnectable = true,</span>
<span style="background-color: #d4edda; color: #28a745;">+  selected,</span>
<span style="background-color: #d4edda; color: #28a745;">+}: NodeProps<NodeData>) {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { theme } = useTheme();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <section</span>
<span style="background-color: #d4edda; color: #28a745;">+      className={cn(</span>
<span style="background-color: #d4edda; color: #28a745;">+        'w-full h-full bg-zinc-200 opacity-70',</span>
<span style="background-color: #d4edda; color: #28a745;">+        styles.iterationNode,</span>
<span style="background-color: #d4edda; color: #28a745;">+        {</span>
<span style="background-color: #d4edda; color: #28a745;">+          ['bg-gray-800']: theme === 'dark',</span>
<span style="background-color: #d4edda; color: #28a745;">+          [styles.selectedIterationNode]: selected,</span>
<span style="background-color: #d4edda; color: #28a745;">+        },</span>
<span style="background-color: #d4edda; color: #28a745;">+      )}</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></span>
<span style="background-color: #d4edda; color: #28a745;">+      <NodeResizeControl style={controlStyle} minWidth={100} minHeight={50}></span>
<span style="background-color: #d4edda; color: #28a745;">+        <ResizeIcon /></span>
<span style="background-color: #d4edda; color: #28a745;">+      </NodeResizeControl></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Handle</span>
<span style="background-color: #d4edda; color: #28a745;">+        id="c"</span>
<span style="background-color: #d4edda; color: #28a745;">+        type="source"</span>
<span style="background-color: #d4edda; color: #28a745;">+        position={Position.Left}</span>
<span style="background-color: #d4edda; color: #28a745;">+        isConnectable={isConnectable}</span>
<span style="background-color: #d4edda; color: #28a745;">+        className={styles.handle}</span>
<span style="background-color: #d4edda; color: #28a745;">+        style={LeftHandleStyle}</span>
<span style="background-color: #d4edda; color: #28a745;">+      ></Handle></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Handle</span>
<span style="background-color: #d4edda; color: #28a745;">+        type="source"</span>
<span style="background-color: #d4edda; color: #28a745;">+        position={Position.Right}</span>
<span style="background-color: #d4edda; color: #28a745;">+        isConnectable={isConnectable}</span>
<span style="background-color: #d4edda; color: #28a745;">+        className={styles.handle}</span>
<span style="background-color: #d4edda; color: #28a745;">+        id="b"</span>
<span style="background-color: #d4edda; color: #28a745;">+        style={RightHandleStyle}</span>
<span style="background-color: #d4edda; color: #28a745;">+      ></Handle></span>
<span style="background-color: #d4edda; color: #28a745;">+      <NodeHeader</span>
<span style="background-color: #d4edda; color: #28a745;">+        id={id}</span>
<span style="background-color: #d4edda; color: #28a745;">+        name={data.name}</span>
<span style="background-color: #d4edda; color: #28a745;">+        label={data.label}</span>
<span style="background-color: #d4edda; color: #28a745;">+        wrapperClassName={cn(</span>
<span style="background-color: #d4edda; color: #28a745;">+          'p-2 bg-white rounded-t-[10px] absolute w-full top-[-60px] left-[-0.3px]',</span>
<span style="background-color: #d4edda; color: #28a745;">+          styles.iterationHeader,</span>
<span style="background-color: #d4edda; color: #28a745;">+          {</span>
<span style="background-color: #d4edda; color: #28a745;">+            [`${styles.dark} text-white`]: theme === 'dark',</span>
<span style="background-color: #d4edda; color: #28a745;">+            [styles.selectedHeader]: selected,</span>
<span style="background-color: #d4edda; color: #28a745;">+          },</span>
<span style="background-color: #d4edda; color: #28a745;">+        )}</span>
<span style="background-color: #d4edda; color: #28a745;">+      ></NodeHeader></span>
<span style="background-color: #d4edda; color: #28a745;">+    </section></span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export function IterationStartNode({</span>
<span style="background-color: #d4edda; color: #28a745;">+  isConnectable = true,</span>
<span style="background-color: #d4edda; color: #28a745;">+  selected,</span>
<span style="background-color: #d4edda; color: #28a745;">+}: NodeProps<NodeData>) {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { theme } = useTheme();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <section</span>
<span style="background-color: #d4edda; color: #28a745;">+      className={cn('bg-white p-2 rounded-xl', {</span>
<span style="background-color: #d4edda; color: #28a745;">+        [styles.dark]: theme === 'dark',</span>
<span style="background-color: #d4edda; color: #28a745;">+        [styles.selectedNode]: selected,</span>
<span style="background-color: #d4edda; color: #28a745;">+      })}</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Handle</span>
<span style="background-color: #d4edda; color: #28a745;">+        type="source"</span>
<span style="background-color: #d4edda; color: #28a745;">+        position={Position.Right}</span>
<span style="background-color: #d4edda; color: #28a745;">+        isConnectable={isConnectable}</span>
<span style="background-color: #d4edda; color: #28a745;">+        className={styles.handle}</span>
<span style="background-color: #d4edda; color: #28a745;">+        style={RightHandleStyle}</span>
<span style="background-color: #d4edda; color: #28a745;">+      ></Handle></span>
<span style="background-color: #d4edda; color: #28a745;">+      <div></span>
<span style="background-color: #d4edda; color: #28a745;">+        <ListRestart className="size-7" /></span>
<span style="background-color: #d4edda; color: #28a745;">+      </div></span>
<span style="background-color: #d4edda; color: #28a745;">+    </section></span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/node-header.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/node-header.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f9bb2870..4c7ad21f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/node-header.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/node-header.tsx</span>
@@ -8,15 +8,17 @@ import NodeDropdown from '#39;./dropdown'#39;;
import { NextNodePopover } from '#39;./popover'#39;;

import { RunTooltip } from '#39;../../flow-tooltip'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import styles from './index.less';</span>
interface IProps {
id: string;
label: string;
name: string;
gap?: number;
className?: string;
<span style="background-color: #d4edda; color: #28a745;">+  wrapperClassName?: string;</span>
}

<span style="background-color: #d4edda; color: #28a745;">+const ExcludedRunStateOperators = [Operator.Answer];</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
export function RunStatus({ id, name, label }: IProps) {
const { t } = useTranslate('#39;flow'#39;);
return (
@@ -35,10 +37,17 @@ export function RunStatus({ id, name, label }: IProps) {
);
}

<span style="background-color: #f8d7da; color: #d73a49;">-const NodeHeader = ({ label, id, name, gap = 4, className }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+const NodeHeader = ({</span>
<span style="background-color: #d4edda; color: #28a745;">+  label,</span>
<span style="background-color: #d4edda; color: #28a745;">+  id,</span>
<span style="background-color: #d4edda; color: #28a745;">+  name,</span>
<span style="background-color: #d4edda; color: #28a745;">+  gap = 4,</span>
<span style="background-color: #d4edda; color: #28a745;">+  className,</span>
<span style="background-color: #d4edda; color: #28a745;">+  wrapperClassName,</span>
<span style="background-color: #d4edda; color: #28a745;">+}: IProps) => {</span>
return (
<span style="background-color: #f8d7da; color: #d73a49;">-    <section></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      {label !== Operator.Answer && (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <section className={wrapperClassName}></span>
<span style="background-color: #d4edda; color: #28a745;">+      {!ExcludedRunStateOperators.includes(label as Operator) && (</span>
&lt;RunStatus id={id} name={name} label={label}&gt;&lt;/RunStatus&gt;
)}
&lt;Flex
@@ -52,7 +61,9 @@ const NodeHeader = ({ label, id, name, gap = 4, className }: IProps) =&gt; {
name={label as Operator}
color={operatorMap[label as Operator].color}
&gt;&lt;/OperatorIcon&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <span className={styles.nodeTitle}>{name}</span></span>
<span style="background-color: #d4edda; color: #28a745;">+        <span className="truncate text-center font-semibold text-sm"></span>
<span style="background-color: #d4edda; color: #28a745;">+          {name}</span>
<span style="background-color: #d4edda; color: #28a745;">+        </span></span>
&lt;NodeDropdown id={id} label={label}&gt;&lt;/NodeDropdown&gt;
&lt;/Flex&gt;
&lt;/section&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/popover.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/popover.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 042c6f30..342ce40e 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/popover.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/popover.tsx</span>
@@ -3,7 +3,7 @@ import get from '#39;lodash/get'#39;;
import React, { MouseEventHandler, useCallback, useMemo } from '#39;react'#39;;
import JsonView from '#39;react18-json-view'#39;;
import '#39;react18-json-view/src/style.css'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useGetComponentLabelByValue, useReplaceIdWithText } from '../../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useReplaceIdWithText } from '../../hooks';</span>

import { useTheme } from '#39;@/components/theme-provider'#39;;
import {
@@ -20,6 +20,7 @@ import {
TableRow,
} from '#39;@/components/ui/table'#39;;
import { useTranslate } from '#39;@/hooks/common-hooks'#39;;
<span style="background-color: #d4edda; color: #28a745;">+import { useGetComponentLabelByValue } from '../../hooks/use-get-begin-query';</span>

interface IProps extends React.PropsWithChildren {
nodeId: string;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/switch-node.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/switch-node.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 5a1bd514..e55b7ac2 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/switch-node.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/switch-node.tsx</span>
@@ -2,7 +2,7 @@ import { useTheme } from '#39;@/components/theme-provider'#39;;
import { Divider, Flex } from '#39;antd'#39;;
import classNames from '#39;classnames'#39;;
import { Handle, NodeProps, Position } from '#39;reactflow'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useGetComponentLabelByValue } from '../../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useGetComponentLabelByValue } from '../../hooks/use-get-begin-query';</span>
import { ISwitchCondition, NodeData } from '#39;../../interface'#39;;
import { RightHandleStyle } from '#39;./handle-icon'#39;;
import { useBuildSwitchHandlePositions } from '#39;./hooks'#39;;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/canvas/node/template-node.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/canvas/node/template-node.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 8a6d1ff6..c16286df 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/canvas/node/template-node.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/canvas/node/template-node.tsx</span>
@@ -1,13 +1,13 @@
<span style="background-color: #d4edda; color: #28a745;">+import { useTheme } from '@/components/theme-provider';</span>
import { Flex } from '#39;antd'#39;;
import classNames from '#39;classnames'#39;;
import { get } from '#39;lodash'#39;;
import { Handle, NodeProps, Position } from '#39;reactflow'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useGetComponentLabelByValue } from '../../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useGetComponentLabelByValue } from '../../hooks/use-get-begin-query';</span>
import { IGenerateParameter, NodeData } from '#39;../../interface'#39;;
import { LeftHandleStyle, RightHandleStyle } from '#39;./handle-icon'#39;;
import NodeHeader from '#39;./node-header'#39;;

<span style="background-color: #f8d7da; color: #d73a49;">-import { useTheme } from '@/components/theme-provider';</span>
import styles from '#39;./index.less'#39;;

export function TemplateNode({
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/constant.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/constant.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 6ea265f2..9b3d76cc 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/constant.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/constant.tsx</span>
@@ -50,7 +50,9 @@ import {
} from '#39;@ant-design/icons'#39;;
import upperFirst from '#39;lodash/upperFirst'#39;;
import {
<span style="background-color: #d4edda; color: #28a745;">+  CirclePower,</span>
CloudUpload,
<span style="background-color: #d4edda; color: #28a745;">+  IterationCcw,</span>
ListOrdered,
OptionIcon,
TextCursorInput,
@@ -58,6 +60,8 @@ import {
WrapText,
} from '#39;lucide-react'#39;;

<span style="background-color: #d4edda; color: #28a745;">+export const BeginId = 'begin';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
export enum Operator {
Begin = '#39;Begin'#39;,
Retrieval = '#39;Retrieval'#39;,
@@ -93,6 +97,8 @@ export enum Operator {
Invoke = '#39;Invoke'#39;,
Template = '#39;Template'#39;,
Email = '#39;Email'#39;,
<span style="background-color: #d4edda; color: #28a745;">+  Iteration = 'Iteration',</span>
<span style="background-color: #d4edda; color: #28a745;">+  IterationStart = 'IterationItem',</span>
}

export const CommonOperatorList = Object.values(Operator).filter(
@@ -134,6 +140,8 @@ export const operatorIconMap = {
[Operator.Invoke]: InvokeIcon,
[Operator.Template]: TemplateIcon,
[Operator.Email]: EmailIcon,
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.Iteration]: IterationCcw,</span>
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.IterationStart]: CirclePower,</span>
};

export const operatorMap: Record&lt;
@@ -270,6 +278,8 @@ export const operatorMap: Record&lt;
backgroundColor: '#39;#dee0e2'#39;,
},
[Operator.Email]: { backgroundColor: '#39;#e6f7ff'#39; },
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.Iteration]: { backgroundColor: '#e6f7ff' },</span>
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.IterationStart]: { backgroundColor: '#e6f7ff' },</span>
};

export const componentMenuList = [
@@ -306,6 +316,9 @@ export const componentMenuList = [
{
name: Operator.Template,
},
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    name: Operator.Iteration,</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
{
name: Operator.Note,
},
@@ -606,6 +619,11 @@ export const initialEmailValues = {
content: '#39;'#39;,
};

<span style="background-color: #d4edda; color: #28a745;">+export const initialIterationValues = {</span>
<span style="background-color: #d4edda; color: #28a745;">+  delimiter: ',',</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+export const initialIterationStartValues = {};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
export const CategorizeAnchorPointPositions = [
{ top: 1, right: 34 },
{ top: 8, right: 18 },
@@ -687,6 +705,8 @@ export const RestrictedUpstreamMap = {
[Operator.Invoke]: [Operator.Begin],
[Operator.Template]: [Operator.Begin, Operator.Relevant],
[Operator.Email]: [Operator.Begin],
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.Iteration]: [Operator.Begin],</span>
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.IterationStart]: [Operator.Begin],</span>
};

export const NodeMap = {
@@ -724,6 +744,8 @@ export const NodeMap = {
[Operator.Invoke]: '#39;invokeNode'#39;,
[Operator.Template]: '#39;templateNode'#39;,
[Operator.Email]: '#39;emailNode'#39;,
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.Iteration]: 'group',</span>
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.IterationStart]: 'iterationStartNode',</span>
};

export const LanguageOptions = [
@@ -2940,4 +2962,5 @@ export const NoDebugOperatorsList = [
Operator.Message,
Operator.RewriteQuestion,
Operator.Switch,
<span style="background-color: #d4edda; color: #28a745;">+  Operator.Iteration,</span>
];
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/flow-drawer/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/flow-drawer/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 31ef22ac..3014d9df 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/flow-drawer/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/flow-drawer/index.tsx</span>
@@ -6,7 +6,7 @@ import { lowerFirst } from '#39;lodash'#39;;
import { Play } from '#39;lucide-react'#39;;
import { useEffect, useRef } from '#39;react'#39;;
import { Node } from '#39;reactflow'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { Operator, operatorMap } from '../constant';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { BeginId, Operator, operatorMap } from '../constant';</span>
import AkShareForm from '#39;../form/akshare-form'#39;;
import AnswerForm from '#39;../form/answer-form'#39;;
import ArXivForm from '#39;../form/arxiv-form'#39;;
@@ -45,6 +45,7 @@ import { getDrawerWidth, needsSingleStepDebugging } from '#39;../utils'#39;;
import SingleDebugDrawer from '#39;./single-debug-drawer'#39;;

import { RunTooltip } from '#39;../flow-tooltip'#39;;
<span style="background-color: #d4edda; color: #28a745;">+import IterationForm from '../form/iteration-from';</span>
import styles from '#39;./index.less'#39;;

interface IProps {
@@ -89,6 +90,8 @@ const FormMap = {
[Operator.Note]: () =&gt; &lt;&gt;&lt;/&gt;,
[Operator.Template]: TemplateForm,
[Operator.Email]: EmailForm,
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.Iteration]: IterationForm,</span>
<span style="background-color: #d4edda; color: #28a745;">+  [Operator.IterationStart]: () => <></>,</span>
};

const EmptyContent = () =&gt; &lt;div&gt;&lt;/div&gt;;
@@ -137,11 +140,15 @@ const FormDrawer = ({
&lt;label htmlFor=&quot;&quot; className={styles.title}&gt;
{t('#39;title'#39;)}
&lt;/label&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-              <Input</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                value={name}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                onBlur={handleNameBlur}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                onChange={handleNameChange}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-              ></Input></span>
<span style="background-color: #d4edda; color: #28a745;">+              {node?.id === BeginId ? (</span>
<span style="background-color: #d4edda; color: #28a745;">+                <span>{t(BeginId)}</span></span>
<span style="background-color: #d4edda; color: #28a745;">+              ) : (</span>
<span style="background-color: #d4edda; color: #28a745;">+                <Input</span>
<span style="background-color: #d4edda; color: #28a745;">+                  value={name}</span>
<span style="background-color: #d4edda; color: #28a745;">+                  onBlur={handleNameBlur}</span>
<span style="background-color: #d4edda; color: #28a745;">+                  onChange={handleNameChange}</span>
<span style="background-color: #d4edda; color: #28a745;">+                ></Input></span>
<span style="background-color: #d4edda; color: #28a745;">+              )}</span>
&lt;/Flex&gt;
{needsSingleStepDebugging(operatorName) &amp;&amp; (
&lt;RunTooltip&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/akshare-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/akshare-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 1e38fd93..1f7ce99f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/akshare-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/akshare-form/index.tsx</span>
@@ -12,7 +12,7 @@ const AkShareForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={10} max={99}&gt;&lt;/TopNItem&gt;
&lt;/Form&gt;
);
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/arxiv-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/arxiv-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index acae1b85..a4459214 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/arxiv-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/arxiv-form/index.tsx</span>
@@ -23,7 +23,7 @@ const ArXivForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>

&lt;TopNItem initialValue={10}&gt;&lt;/TopNItem&gt;
&lt;Form.Item label={t('#39;sortBy'#39;)} name={'#39;sort_by'#39;}&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/baidu-fanyi-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/baidu-fanyi-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 37cd376c..c4b39902 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/baidu-fanyi-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/baidu-fanyi-form/index.tsx</span>
@@ -39,7 +39,7 @@ const BaiduFanyiForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item label={t('#39;appid'#39;)} name={'#39;appid'#39;}&gt;
&lt;Input&gt;&lt;/Input&gt;
&lt;/Form.Item&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/baidu-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/baidu-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index bc810c06..0c866e48 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/baidu-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/baidu-form/index.tsx</span>
@@ -12,7 +12,7 @@ const BaiduForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={10}&gt;&lt;/TopNItem&gt;
&lt;/Form&gt;
);
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/bing-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/bing-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 02645313..b640f08d 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/bing-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/bing-form/index.tsx</span>
@@ -21,7 +21,7 @@ const BingForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={10}&gt;&lt;/TopNItem&gt;
&lt;Form.Item label={t('#39;channel'#39;)} name={'#39;channel'#39;}&gt;
&lt;Select options={options}&gt;&lt;/Select&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/categorize-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/categorize-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00debf47..cb6651a2 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/categorize-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/categorize-form/index.tsx</span>
@@ -24,7 +24,7 @@ const CategorizeForm = ({ form, onValuesChange, node }: IOperatorForm) =&gt; {
initialValues={{ items: [{}] }}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item
name={'#39;llm_id'#39;}
label={t('#39;model'#39;, { keyPrefix: '#39;chat'#39; })}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/components/dynamic-input-variable.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/components/dynamic-input-variable.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index ec574173..8cc8cc3d 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/components/dynamic-input-variable.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/components/dynamic-input-variable.tsx</span>
@@ -1,13 +1,15 @@
import { MinusCircleOutlined, PlusOutlined } from '#39;@ant-design/icons'#39;;
import { Button, Collapse, Flex, Form, Input, Select } from '#39;antd'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
import { PropsWithChildren, useCallback } from '#39;react'#39;;
import { useTranslation } from '#39;react-i18next'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useBuildComponentIdSelectOptions } from '../../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Node } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useBuildComponentIdSelectOptions } from '../../hooks/use-get-begin-query';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { NodeData } from '../../interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
import styles from '#39;./index.less'#39;;

interface IProps {
<span style="background-color: #f8d7da; color: #d73a49;">-  nodeId?: string;</span>
<span style="background-color: #d4edda; color: #28a745;">+  node?: Node<NodeData>;</span>
}

enum VariableType {
@@ -18,9 +20,12 @@ enum VariableType {
const getVariableName = (type: string) =&gt;
type === VariableType.Reference ? '#39;component_id'#39; : '#39;value'#39;;

<span style="background-color: #f8d7da; color: #d73a49;">-const DynamicVariableForm = ({ nodeId }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+const DynamicVariableForm = ({ node }: IProps) => {</span>
const { t } = useTranslation();
<span style="background-color: #f8d7da; color: #d73a49;">-  const valueOptions = useBuildComponentIdSelectOptions(nodeId);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const valueOptions = useBuildComponentIdSelectOptions(</span>
<span style="background-color: #d4edda; color: #28a745;">+    node?.id,</span>
<span style="background-color: #d4edda; color: #28a745;">+    node?.parentId,</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
const form = Form.useFormInstance();

const options = [
@@ -114,11 +119,11 @@ export function FormCollapse({
);
}

<span style="background-color: #f8d7da; color: #d73a49;">-const DynamicInputVariable = ({ nodeId }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+const DynamicInputVariable = ({ node }: IProps) => {</span>
const { t } = useTranslation();
return (
&lt;FormCollapse title={t('#39;flow.input'#39;)}&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicVariableForm nodeId={nodeId}></DynamicVariableForm></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicVariableForm node={node}></DynamicVariableForm></span>
&lt;/FormCollapse&gt;
);
};
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/crawler-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/crawler-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 52e84567..8ef5f14d 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/crawler-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/crawler-form/index.tsx</span>
@@ -20,7 +20,7 @@ const CrawlerForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item label={t('#39;proxy'#39;)} name={'#39;proxy'#39;}&gt;
&lt;Input placeholder=&quot;like: http://127.0.0.1:8888&quot;&gt;&lt;/Input&gt;
&lt;/Form.Item&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/deepl-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/deepl-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f532430a..1fc8cfc2 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/deepl-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/deepl-form/index.tsx</span>
@@ -18,7 +18,7 @@ const DeepLForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={5}&gt;&lt;/TopNItem&gt;
&lt;Form.Item label={t('#39;authKey'#39;)} name={'#39;auth_key'#39;}&gt;
&lt;Select options={options}&gt;&lt;/Select&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/duckduckgo-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/duckduckgo-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 68b61141..53462da3 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/duckduckgo-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/duckduckgo-form/index.tsx</span>
@@ -21,7 +21,7 @@ const DuckDuckGoForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={10}&gt;&lt;/TopNItem&gt;
&lt;Form.Item
label={t('#39;channel'#39;)}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/email-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/email-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index e01f2f85..9bee7997 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/email-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/email-form/index.tsx</span>
@@ -14,7 +14,7 @@ const EmailForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>

{/* SMTP服务器配置 */}
&lt;Form.Item label={t('#39;smtpServer'#39;)} name={'#39;smtp_server'#39;}&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/exesql-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/exesql-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index d8541e53..010d5518 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/exesql-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/exesql-form/index.tsx</span>
@@ -24,7 +24,7 @@ const ExeSQLForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item
label={t('#39;dbType'#39;)}
name={'#39;db_type'#39;}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/generate-form/dynamic-parameters.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/generate-form/dynamic-parameters.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index c5220ebf..8326376f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/generate-form/dynamic-parameters.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/generate-form/dynamic-parameters.tsx</span>
@@ -2,14 +2,14 @@ import { EditableCell, EditableRow } from '#39;@/components/editable-cell'#39;;
import { useTranslate } from '#39;@/hooks/common-hooks'#39;;
import { DeleteOutlined } from '#39;@ant-design/icons'#39;;
import { Button, Flex, Select, Table, TableProps } from '#39;antd'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { IGenerateParameter } from '../../interface';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { useBuildComponentIdSelectOptions } from '../../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Node } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useBuildComponentIdSelectOptions } from '../../hooks/use-get-begin-query';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { IGenerateParameter, NodeData } from '../../interface';</span>
import { useHandleOperateParameters } from '#39;./hooks'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import styles from './index.less';</span>

<span style="background-color: #d4edda; color: #28a745;">+import styles from './index.less';</span>
interface IProps {
<span style="background-color: #f8d7da; color: #d73a49;">-  nodeId?: string;</span>
<span style="background-color: #d4edda; color: #28a745;">+  node?: Node<NodeData>;</span>
}

const components = {
@@ -19,10 +19,11 @@ const components = {
},
};

<span style="background-color: #f8d7da; color: #d73a49;">-const DynamicParameters = ({ nodeId }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+const DynamicParameters = ({ node }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const nodeId = node?.id;</span>
const { t } = useTranslate('#39;flow'#39;);

<span style="background-color: #f8d7da; color: #d73a49;">-  const options = useBuildComponentIdSelectOptions(nodeId);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const options = useBuildComponentIdSelectOptions(nodeId, node?.parentId);</span>
const {
dataSource,
handleAdd,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/generate-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/generate-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 0b5a77b1..500d42fb 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/generate-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/generate-form/index.tsx</span>
@@ -49,7 +49,7 @@ const GenerateForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
&lt;MessageHistoryWindowSizeItem
initialValue={12}
&gt;&lt;/MessageHistoryWindowSizeItem&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicParameters nodeId={node?.id}></DynamicParameters></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicParameters node={node}></DynamicParameters></span>
&lt;/Form&gt;
);
};
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/github-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/github-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index e81c79fa..691dd5d3 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/github-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/github-form/index.tsx</span>
@@ -12,7 +12,7 @@ const GithubForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={5}&gt;&lt;/TopNItem&gt;
&lt;/Form&gt;
);
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/google-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/google-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 310cde28..75bd3fb5 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/google-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/google-form/index.tsx</span>
@@ -16,7 +16,7 @@ const GoogleForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={10}&gt;&lt;/TopNItem&gt;
&lt;Form.Item label={t('#39;apiKey'#39;)} name={'#39;api_key'#39;}&gt;
&lt;Input&gt;&lt;/Input&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/google-scholar-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/google-scholar-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index ce320b30..4e87fac2 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/google-scholar-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/google-scholar-form/index.tsx</span>
@@ -45,7 +45,7 @@ const GoogleScholarForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={5}&gt;&lt;/TopNItem&gt;
&lt;Form.Item
label={t('#39;sortBy'#39;)}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/invoke-form/dynamic-variables.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/invoke-form/dynamic-variables.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index dff21438..ad3e07ac 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/invoke-form/dynamic-variables.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/invoke-form/dynamic-variables.tsx</span>
@@ -2,15 +2,16 @@ import { EditableCell, EditableRow } from '#39;@/components/editable-cell'#39;;
import { useTranslate } from '#39;@/hooks/common-hooks'#39;;
import { DeleteOutlined } from '#39;@ant-design/icons'#39;;
import { Button, Collapse, Flex, Input, Select, Table, TableProps } from '#39;antd'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useBuildComponentIdSelectOptions } from '../../hooks';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { IInvokeVariable } from '../../interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { trim } from 'lodash';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useBuildComponentIdSelectOptions } from '../../hooks/use-get-begin-query';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { IInvokeVariable, NodeData } from '../../interface';</span>
import { useHandleOperateParameters } from '#39;./hooks'#39;;

<span style="background-color: #f8d7da; color: #d73a49;">-import { trim } from 'lodash';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Node } from 'reactflow';</span>
import styles from '#39;./index.less'#39;;

interface IProps {
<span style="background-color: #f8d7da; color: #d73a49;">-  nodeId?: string;</span>
<span style="background-color: #d4edda; color: #28a745;">+  node?: Node<NodeData>;</span>
}

const components = {
@@ -20,10 +21,11 @@ const components = {
},
};

<span style="background-color: #f8d7da; color: #d73a49;">-const DynamicVariablesForm = ({ nodeId }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+const DynamicVariablesForm = ({ node }: IProps) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const nodeId = node?.id;</span>
const { t } = useTranslate('#39;flow'#39;);

<span style="background-color: #f8d7da; color: #d73a49;">-  const options = useBuildComponentIdSelectOptions(nodeId);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const options = useBuildComponentIdSelectOptions(nodeId, node?.parentId);</span>
const {
dataSource,
handleAdd,
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/invoke-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/invoke-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f3f2db5e..521f1c95 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/invoke-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/invoke-form/index.tsx</span>
@@ -69,7 +69,7 @@ const InvokeForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
&gt;
&lt;Switch /&gt;
&lt;/Form.Item&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <DynamicVariablesForm nodeId={node?.id}></DynamicVariablesForm></span>
<span style="background-color: #d4edda; color: #28a745;">+        <DynamicVariablesForm node={node}></DynamicVariablesForm></span>
&lt;/Form&gt;
&lt;/&gt;
);
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/iteration-from/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/iteration-from/index.tsx</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..f0f23918</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/iteration-from/index.tsx</span>
@@ -0,0 +1,94 @@
<span style="background-color: #d4edda; color: #28a745;">+import { CommaIcon, SemicolonIcon } from '@/assets/icon/Icon';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Form, Select } from 'antd';</span>
<span style="background-color: #d4edda; color: #28a745;">+import {</span>
<span style="background-color: #d4edda; color: #28a745;">+  CornerDownLeft,</span>
<span style="background-color: #d4edda; color: #28a745;">+  IndentIncrease,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Minus,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Slash,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Underline,</span>
<span style="background-color: #d4edda; color: #28a745;">+} from 'lucide-react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useMemo } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useTranslation } from 'react-i18next';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { IOperatorForm } from '../../interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+import DynamicInputVariable from '../components/dynamic-input-variable';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const optionList = [</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    value: ',',</span>
<span style="background-color: #d4edda; color: #28a745;">+    icon: CommaIcon,</span>
<span style="background-color: #d4edda; color: #28a745;">+    text: 'comma',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    value: '\n',</span>
<span style="background-color: #d4edda; color: #28a745;">+    icon: CornerDownLeft,</span>
<span style="background-color: #d4edda; color: #28a745;">+    text: 'lineBreak',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    value: 'tab',</span>
<span style="background-color: #d4edda; color: #28a745;">+    icon: IndentIncrease,</span>
<span style="background-color: #d4edda; color: #28a745;">+    text: 'tab',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    value: '_',</span>
<span style="background-color: #d4edda; color: #28a745;">+    icon: Underline,</span>
<span style="background-color: #d4edda; color: #28a745;">+    text: 'underline',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    value: '/',</span>
<span style="background-color: #d4edda; color: #28a745;">+    icon: Slash,</span>
<span style="background-color: #d4edda; color: #28a745;">+    text: 'diagonal',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    value: '-',</span>
<span style="background-color: #d4edda; color: #28a745;">+    icon: Minus,</span>
<span style="background-color: #d4edda; color: #28a745;">+    text: 'minus',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    value: ';',</span>
<span style="background-color: #d4edda; color: #28a745;">+    icon: SemicolonIcon,</span>
<span style="background-color: #d4edda; color: #28a745;">+    text: 'semicolon',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+];</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const IterationForm = ({ onValuesChange, form, node }: IOperatorForm) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { t } = useTranslation();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const options = useMemo(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    return optionList.map((x) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      let Icon = x.icon;</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+      return {</span>
<span style="background-color: #d4edda; color: #28a745;">+        value: x.value,</span>
<span style="background-color: #d4edda; color: #28a745;">+        label: (</span>
<span style="background-color: #d4edda; color: #28a745;">+          <div className="flex items-center gap-2"></span>
<span style="background-color: #d4edda; color: #28a745;">+            <Icon className={'size-4'}></Icon></span>
<span style="background-color: #d4edda; color: #28a745;">+            {t(`flow.delimiterOptions.${x.text}`)}</span>
<span style="background-color: #d4edda; color: #28a745;">+          </div></span>
<span style="background-color: #d4edda; color: #28a745;">+        ),</span>
<span style="background-color: #d4edda; color: #28a745;">+      };</span>
<span style="background-color: #d4edda; color: #28a745;">+    });</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [t]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <Form</span>
<span style="background-color: #d4edda; color: #28a745;">+      name="basic"</span>
<span style="background-color: #d4edda; color: #28a745;">+      autoComplete="off"</span>
<span style="background-color: #d4edda; color: #28a745;">+      form={form}</span>
<span style="background-color: #d4edda; color: #28a745;">+      onValuesChange={onValuesChange}</span>
<span style="background-color: #d4edda; color: #28a745;">+      layout={'vertical'}</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Form.Item</span>
<span style="background-color: #d4edda; color: #28a745;">+        name={['delimiter']}</span>
<span style="background-color: #d4edda; color: #28a745;">+        label={t('knowledgeDetails.delimiter')}</span>
<span style="background-color: #d4edda; color: #28a745;">+        initialValue={`\\n!?;。；！？`}</span>
<span style="background-color: #d4edda; color: #28a745;">+        rules={[{ required: true }]}</span>
<span style="background-color: #d4edda; color: #28a745;">+        tooltip={t('flow.delimiterTip')}</span>
<span style="background-color: #d4edda; color: #28a745;">+      ></span>
<span style="background-color: #d4edda; color: #28a745;">+        <Select options={options}></Select></span>
<span style="background-color: #d4edda; color: #28a745;">+      </Form.Item></span>
<span style="background-color: #d4edda; color: #28a745;">+    </Form></span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export default IterationForm;</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/jin10-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/jin10-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 94ac5f17..aa9bb169 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/jin10-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/jin10-form/index.tsx</span>
@@ -65,7 +65,7 @@ const Jin10Form = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item label={t('#39;type'#39;)} name={'#39;type'#39;} initialValue={'#39;flash'#39;}&gt;
&lt;Select options={jin10TypeOptions}&gt;&lt;/Select&gt;
&lt;/Form.Item&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/keyword-extract-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/keyword-extract-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index fa969724..c4c448c7 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/keyword-extract-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/keyword-extract-form/index.tsx</span>
@@ -16,7 +16,7 @@ const KeywordExtractForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item
name={'#39;llm_id'#39;}
label={t('#39;model'#39;, { keyPrefix: '#39;chat'#39; })}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/pubmed-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/pubmed-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 17adcb5f..a10962b6 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/pubmed-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/pubmed-form/index.tsx</span>
@@ -15,7 +15,7 @@ const PubMedForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={10}&gt;&lt;/TopNItem&gt;
&lt;Form.Item
label={t('#39;email'#39;)}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/qweather-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/qweather-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 610b1b4c..b6993982 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/qweather-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/qweather-form/index.tsx</span>
@@ -55,7 +55,7 @@ const QWeatherForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item label={t('#39;webApiKey'#39;)} name={'#39;web_apikey'#39;}&gt;
&lt;Input&gt;&lt;/Input&gt;
&lt;/Form.Item&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/retrieval-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/retrieval-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index df4b7083..4a92a7f9 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/retrieval-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/retrieval-form/index.tsx</span>
@@ -32,7 +32,7 @@ const RetrievalForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
form={form}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;SimilaritySlider
isTooltipShown
vectorSimilarityWeightName=&quot;keywords_similarity_weight&quot;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/switch-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/switch-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index c548277f..12fa90ae 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/switch-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/switch-form/index.tsx</span>
@@ -9,7 +9,7 @@ import {
SwitchOperatorOptions,
} from '#39;../../constant'#39;;
import { useBuildFormSelectOptions } from '#39;../../form-hooks'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useBuildComponentIdSelectOptions } from '../../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useBuildComponentIdSelectOptions } from '../../hooks/use-get-begin-query';</span>
import { IOperatorForm, ISwitchForm } from '#39;../../interface'#39;;
import { getOtherFieldValues } from '#39;../../utils'#39;;

@@ -43,7 +43,10 @@ const SwitchForm = ({ onValuesChange, node, form }: IOperatorForm) =&gt; {
}));
}, [t]);

<span style="background-color: #f8d7da; color: #d73a49;">-  const componentIdOptions = useBuildComponentIdSelectOptions(node?.id);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const componentIdOptions = useBuildComponentIdSelectOptions(</span>
<span style="background-color: #d4edda; color: #28a745;">+    node?.id,</span>
<span style="background-color: #d4edda; color: #28a745;">+    node?.parentId,</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>

return (
&lt;Form
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/template-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/template-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 98b65bd1..afe75558 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/template-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/template-form/index.tsx</span>
@@ -18,7 +18,7 @@ const TemplateForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
&lt;Input.TextArea rows={8} placeholder={t('#39;flow.blank'#39;)} /&gt;
&lt;/Form.Item&gt;

<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicParameters nodeId={node?.id}></DynamicParameters></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicParameters node={node}></DynamicParameters></span>
&lt;/Form&gt;
);
};
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/tushare-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/tushare-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index fea408df..01b11c22 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/tushare-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/tushare-form/index.tsx</span>
@@ -56,7 +56,7 @@ const TuShareForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item
label={t('#39;token'#39;)}
name={'#39;token'#39;}
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/wencai-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/wencai-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index dce01957..7c44c182 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/wencai-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/wencai-form/index.tsx</span>
@@ -24,7 +24,7 @@ const WenCaiForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={20} max={99}&gt;&lt;/TopNItem&gt;
&lt;Form.Item label={t('#39;queryType'#39;)} name={'#39;query_type'#39;}&gt;
&lt;Select options={wenCaiQueryTypeOptions}&gt;&lt;/Select&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/wikipedia-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/wikipedia-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index df5595a8..9e28bf21 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/wikipedia-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/wikipedia-form/index.tsx</span>
@@ -16,7 +16,7 @@ const WikipediaForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;TopNItem initialValue={10}&gt;&lt;/TopNItem&gt;
&lt;Form.Item label={t('#39;language'#39;)} name={'#39;language'#39;}&gt;
&lt;Select options={LanguageOptions}&gt;&lt;/Select&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/form/yahoo-finance-form/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/form/yahoo-finance-form/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 44598298..ce7a3e7d 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/form/yahoo-finance-form/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/form/yahoo-finance-form/index.tsx</span>
@@ -14,7 +14,7 @@ const YahooFinanceForm = ({ onValuesChange, form, node }: IOperatorForm) =&gt; {
onValuesChange={onValuesChange}
layout={'#39;vertical'#39;}
&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-      <DynamicInputVariable nodeId={node?.id}></DynamicInputVariable></span>
<span style="background-color: #d4edda; color: #28a745;">+      <DynamicInputVariable node={node}></DynamicInputVariable></span>
&lt;Form.Item label={t('#39;info'#39;)} name={'#39;info'#39;}&gt;
&lt;Switch&gt;&lt;/Switch&gt;
&lt;/Form.Item&gt;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/header/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/header/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index a517727b..245e3310 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/header/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/header/index.tsx</span>
@@ -10,11 +10,14 @@ import { Link, useParams } from '#39;umi'#39;;
import {
useGetBeginNodeDataQuery,
useGetBeginNodeDataQueryIsEmpty,
<span style="background-color: #d4edda; color: #28a745;">+} from '../hooks/use-get-begin-query';</span>
<span style="background-color: #d4edda; color: #28a745;">+import {</span>
useSaveGraph,
useSaveGraphBeforeOpeningDebugDrawer,
useWatchAgentChange,
<span style="background-color: #f8d7da; color: #d73a49;">-} from '../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+} from '../hooks/use-save-graph';</span>
import { BeginQuery } from '#39;../interface'#39;;
<span style="background-color: #d4edda; color: #28a745;">+</span>
import styles from '#39;./index.less'#39;;

interface IProps {
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 9608e3b1..aff2ef38 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/hooks.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks.tsx</span>
@@ -1,7 +1,3 @@
<span style="background-color: #f8d7da; color: #d73a49;">-import { useSetModalState } from '@/hooks/common-hooks';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { useFetchFlow, useResetFlow, useSetFlow } from '@/hooks/flow-hooks';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { IGraph } from '@/interfaces/database/flow';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { useIsFetching } from '@tanstack/react-query';</span>
import React, {
ChangeEvent,
useCallback,
@@ -12,23 +8,17 @@ import React, {
import { Connection, Edge, Node, Position, ReactFlowInstance } from '#39;reactflow'#39;;
// import { shallow } from '#39;zustand/shallow'#39;;
import { variableEnabledFieldMap } from '#39;@/constants/chat'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { FileMimeType } from '@/constants/common';</span>
import {
ModelVariableType,
settledModelVariableMap,
} from '#39;@/constants/knowledge'#39;;
import { useFetchModelId } from '#39;@/hooks/logic-hooks'#39;;
import { Variable } from '#39;@/interfaces/database/chat'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { downloadJsonFile } from '@/utils/file-util';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { useDebounceEffect } from 'ahooks';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { FormInstance, UploadFile, message } from 'antd';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import { DefaultOptionType } from 'antd/es/select';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-import dayjs from 'dayjs';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { FormInstance, message } from 'antd';</span>
import { humanId } from '#39;human-id'#39;;
import { get, isEmpty, lowerFirst, pick } from '#39;lodash'#39;;
import trim from '#39;lodash/trim'#39;;
import { useTranslation } from '#39;react-i18next'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useParams } from 'umi';</span>
import { v4 as uuid } from '#39;uuid'#39;;
import {
NodeMap,
@@ -53,6 +43,7 @@ import {
initialGoogleScholarValues,
initialGoogleValues,
initialInvokeValues,
<span style="background-color: #d4edda; color: #28a745;">+  initialIterationValues,</span>
initialJin10Values,
initialKeywordExtractValues,
initialMessageValues,
@@ -69,18 +60,13 @@ import {
initialWikipediaValues,
initialYahooFinanceValues,
} from '#39;./constant'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  BeginQuery,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  ICategorizeForm,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  IRelevantForm,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  ISwitchForm,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-} from './interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { ICategorizeForm, IRelevantForm, ISwitchForm } from './interface';</span>
import useGraphStore, { RFState } from '#39;./store'#39;;
import {
<span style="background-color: #f8d7da; color: #d73a49;">-  buildDslComponentsByGraph,</span>
generateNodeNamesWithIncreasingIndex,
generateSwitchHandleText,
getNodeDragHandle,
<span style="background-color: #d4edda; color: #28a745;">+  getRelativePositionToIterationNode,</span>
replaceIdWithText,
} from '#39;./utils'#39;;

@@ -145,6 +131,8 @@ export const useInitializeOperatorParams = () =&gt; {
[Operator.Invoke]: initialInvokeValues,
[Operator.Template]: initialTemplateValues,
[Operator.Email]: initialEmailValues,
<span style="background-color: #d4edda; color: #28a745;">+      [Operator.Iteration]: initialIterationValues,</span>
<span style="background-color: #d4edda; color: #28a745;">+      [Operator.IterationStart]: initialIterationValues,</span>
};
}, [llmId]);

@@ -210,7 +198,7 @@ export const useHandleDrop = () =&gt; {
x: event.clientX,
y: event.clientY,
});
<span style="background-color: #f8d7da; color: #d73a49;">-      const newNode = {</span>
<span style="background-color: #d4edda; color: #28a745;">+      const newNode: Node<any> = {</span>
id: `${type}:${humanId()}`,
type: NodeMap[type as Operator] || '#39;ragNode'#39;,
position: position || {
@@ -227,7 +215,38 @@ export const useHandleDrop = () =&gt; {
dragHandle: getNodeDragHandle(type),
};

<span style="background-color: #f8d7da; color: #d73a49;">-      addNode(newNode);</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (type === Operator.Iteration) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        newNode.style = {</span>
<span style="background-color: #d4edda; color: #28a745;">+          width: 500,</span>
<span style="background-color: #d4edda; color: #28a745;">+          height: 250,</span>
<span style="background-color: #d4edda; color: #28a745;">+        };</span>
<span style="background-color: #d4edda; color: #28a745;">+        const iterationStartNode: Node<any> = {</span>
<span style="background-color: #d4edda; color: #28a745;">+          id: `${Operator.IterationStart}:${humanId()}`,</span>
<span style="background-color: #d4edda; color: #28a745;">+          type: 'iterationStartNode',</span>
<span style="background-color: #d4edda; color: #28a745;">+          position: { x: 50, y: 100 },</span>
<span style="background-color: #d4edda; color: #28a745;">+          // draggable: false,</span>
<span style="background-color: #d4edda; color: #28a745;">+          data: {</span>
<span style="background-color: #d4edda; color: #28a745;">+            label: Operator.IterationStart,</span>
<span style="background-color: #d4edda; color: #28a745;">+            name: Operator.IterationStart,</span>
<span style="background-color: #d4edda; color: #28a745;">+            form: {},</span>
<span style="background-color: #d4edda; color: #28a745;">+          },</span>
<span style="background-color: #d4edda; color: #28a745;">+          parentId: newNode.id,</span>
<span style="background-color: #d4edda; color: #28a745;">+          extent: 'parent',</span>
<span style="background-color: #d4edda; color: #28a745;">+        };</span>
<span style="background-color: #d4edda; color: #28a745;">+        addNode(newNode);</span>
<span style="background-color: #d4edda; color: #28a745;">+        addNode(iterationStartNode);</span>
<span style="background-color: #d4edda; color: #28a745;">+      } else {</span>
<span style="background-color: #d4edda; color: #28a745;">+        const subNodeOfIteration = getRelativePositionToIterationNode(</span>
<span style="background-color: #d4edda; color: #28a745;">+          nodes,</span>
<span style="background-color: #d4edda; color: #28a745;">+          position,</span>
<span style="background-color: #d4edda; color: #28a745;">+        );</span>
<span style="background-color: #d4edda; color: #28a745;">+        if (subNodeOfIteration) {</span>
<span style="background-color: #d4edda; color: #28a745;">+          newNode.parentId = subNodeOfIteration.parentId;</span>
<span style="background-color: #d4edda; color: #28a745;">+          newNode.position = subNodeOfIteration.position;</span>
<span style="background-color: #d4edda; color: #28a745;">+          newNode.extent = 'parent';</span>
<span style="background-color: #d4edda; color: #28a745;">+        }</span>
<span style="background-color: #d4edda; color: #28a745;">+        addNode(newNode);</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
},
[reactFlowInstance, getNodeName, nodes, initializeOperatorParams, addNode],
);
@@ -235,78 +254,6 @@ export const useHandleDrop = () =&gt; {
return { onDrop, onDragOver, setReactFlowInstance };
};

<span style="background-color: #f8d7da; color: #d73a49;">-export const useShowFormDrawer = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    clickedNodeId: clickNodeId,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    setClickedNodeId,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    getNode,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  } = useGraphStore((state) => state);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    visible: formDrawerVisible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideModal: hideFormDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    showModal: showFormDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  } = useSetModalState();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const handleShow = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    (node: Node) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      setClickedNodeId(node.id);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      showFormDrawer();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [showFormDrawer, setClickedNodeId],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    formDrawerVisible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideFormDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    showFormDrawer: handleShow,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    clickedNode: getNode(clickNodeId),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useBuildDslData = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { data } = useFetchFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { nodes, edges } = useGraphStore((state) => state);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const buildDslData = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    (currentNodes?: Node[]) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      const dslComponents = buildDslComponentsByGraph(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        currentNodes ?? nodes,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        edges,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        data.dsl.components,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      return {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        ...data.dsl,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        graph: { nodes: currentNodes ?? nodes, edges },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        components: dslComponents,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [data.dsl, edges, nodes],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return { buildDslData };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useSaveGraph = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { data } = useFetchFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { setFlow, loading } = useSetFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { id } = useParams();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { buildDslData } = useBuildDslData();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const saveGraph = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    async (currentNodes?: Node[]) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      return setFlow({</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        id,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        title: data.title,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        dsl: buildDslData(currentNodes),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      });</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [setFlow, id, data.title, buildDslData],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return { saveGraph, loading };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
export const useHandleFormValuesChange = (id?: string) =&gt; {
const updateNodeForm = useGraphStore((state) =&gt; state.updateNodeForm);
const handleValuesChange = useCallback(
@@ -335,39 +282,6 @@ export const useHandleFormValuesChange = (id?: string) =&gt; {
return { handleValuesChange };
};

<span style="background-color: #f8d7da; color: #d73a49;">-const useSetGraphInfo = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { setEdges, setNodes } = useGraphStore((state) => state);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const setGraphInfo = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    ({ nodes = [], edges = [] }: IGraph) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      if (nodes.length || edges.length) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        setNodes(nodes);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        setEdges(edges);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [setEdges, setNodes],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return setGraphInfo;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useFetchDataOnMount = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { loading, data, refetch } = useFetchFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const setGraphInfo = useSetGraphInfo();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useEffect(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    setGraphInfo(data?.dsl?.graph ?? ({} as IGraph));</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [setGraphInfo, data]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useEffect(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    refetch();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [refetch]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return { loading, flowDetail: data };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useFlowIsFetching = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return useIsFetching({ queryKey: ['flowDetail'] }) > 0;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
export const useSetLlmSetting = (
form?: FormInstance,
formData?: Record&lt;string, any&gt;,
@@ -401,7 +315,22 @@ export const useSetLlmSetting = (
};

export const useValidateConnection = () =&gt; {
<span style="background-color: #f8d7da; color: #d73a49;">-  const { edges, getOperatorTypeFromId } = useGraphStore((state) => state);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { edges, getOperatorTypeFromId, getParentIdById } = useGraphStore(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (state) => state,</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const isSameNodeChild = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (connection: Connection) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      const sourceParentId = getParentIdById(connection.source);</span>
<span style="background-color: #d4edda; color: #28a745;">+      const targetParentId = getParentIdById(connection.target);</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (sourceParentId || targetParentId) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        return sourceParentId === targetParentId;</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+      return true;</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [getParentIdById],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
// restricted lines cannot be connected successfully.
const isValidConnection = useCallback(
(connection: Connection) =&gt; {
@@ -418,10 +347,11 @@ export const useValidateConnection = () =&gt; {
!hasLine &amp;&amp;
RestrictedUpstreamMap[
getOperatorTypeFromId(connection.source) as Operator
<span style="background-color: #f8d7da; color: #d73a49;">-        ]?.every((x) => x !== getOperatorTypeFromId(connection.target));</span>
<span style="background-color: #d4edda; color: #28a745;">+        ]?.every((x) => x !== getOperatorTypeFromId(connection.target)) &&</span>
<span style="background-color: #d4edda; color: #28a745;">+        isSameNodeChild(connection);</span>
return ret;
},
<span style="background-color: #f8d7da; color: #d73a49;">-    [edges, getOperatorTypeFromId],</span>
<span style="background-color: #d4edda; color: #28a745;">+    [edges, getOperatorTypeFromId, isSameNodeChild],</span>
);

return isValidConnection;
@@ -464,52 +394,6 @@ export const useHandleNodeNameChange = ({
return { name, handleNameBlur, handleNameChange };
};

<span style="background-color: #f8d7da; color: #d73a49;">-export const useGetBeginNodeDataQuery = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const getNode = useGraphStore((state) => state.getNode);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const getBeginNodeDataQuery = useCallback(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    return get(getNode('begin'), 'data.form.query', []);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [getNode]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return getBeginNodeDataQuery;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useGetBeginNodeDataQueryIsEmpty = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const [isBeginNodeDataQueryEmpty, setIsBeginNodeDataQueryEmpty] =</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    useState(false);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const getBeginNodeDataQuery = useGetBeginNodeDataQuery();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const nodes = useGraphStore((state) => state.nodes);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useEffect(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    const query: BeginQuery[] = getBeginNodeDataQuery();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    setIsBeginNodeDataQueryEmpty(query.length === 0);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [getBeginNodeDataQuery, nodes]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return isBeginNodeDataQueryEmpty;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useSaveGraphBeforeOpeningDebugDrawer = (show: () => void) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { saveGraph, loading } = useSaveGraph();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { resetFlow } = useResetFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const handleRun = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    async (nextNodes?: Node[]) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      const saveRet = await saveGraph(nextNodes);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      if (saveRet?.code === 0) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        // Call the reset api before opening the run drawer each time</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        const resetRet = await resetFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        // After resetting, all previous messages will be cleared.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        if (resetRet?.code === 0) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          show();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [saveGraph, resetFlow, show],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return { handleRun, loading };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
export const useReplaceIdWithName = () =&gt; {
const getNode = useGraphStore((state) =&gt; state.getNode);

@@ -647,66 +531,6 @@ export const useWatchNodeFormDataChange = () =&gt; {
]);
};

<span style="background-color: #f8d7da; color: #d73a49;">-// exclude nodes with branches</span>
<span style="background-color: #f8d7da; color: #d73a49;">-const ExcludedNodes = [</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Operator.Categorize,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Operator.Relevant,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Operator.Begin,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  Operator.Note,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-];</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useBuildComponentIdSelectOptions = (nodeId?: string) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const nodes = useGraphStore((state) => state.nodes);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const getBeginNodeDataQuery = useGetBeginNodeDataQuery();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const query: BeginQuery[] = getBeginNodeDataQuery();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const componentIdOptions = useMemo(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    return nodes</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      .filter(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        (x) =></span>
<span style="background-color: #f8d7da; color: #d73a49;">-          x.id !== nodeId && !ExcludedNodes.some((y) => y === x.data.label),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      )</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      .map((x) => ({ label: x.data.name, value: x.id }));</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [nodes, nodeId]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const groupedOptions = [</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      label: <span>Component Output</span>,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      title: 'Component Output',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      options: componentIdOptions,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      label: <span>Begin Input</span>,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      title: 'Begin Input',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      options: query.map((x) => ({</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        label: x.name,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        value: `begin@${x.key}`,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      })),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  ];</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return groupedOptions;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useGetComponentLabelByValue = (nodeId: string) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const options = useBuildComponentIdSelectOptions(nodeId);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const flattenOptions = useMemo(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    () =></span>
<span style="background-color: #f8d7da; color: #d73a49;">-      options.reduce<DefaultOptionType[]>((pre, cur) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        return [...pre, ...cur.options];</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }, []),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [options],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const getLabel = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    (val?: string) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      return flattenOptions.find((x) => x.value === val)?.label;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [flattenOptions],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return getLabel;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
export const useDuplicateNode = () =&gt; {
const duplicateNodeById = useGraphStore((store) =&gt; store.duplicateNode);
const getNodeName = useGetNodeName();
@@ -769,107 +593,3 @@ export const useCopyPaste = () =&gt; {
};
}, [onPasteCapture]);
};
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useWatchAgentChange = (chatDrawerVisible: boolean) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const [time, setTime] = useState<string>();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const nodes = useGraphStore((state) => state.nodes);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const edges = useGraphStore((state) => state.edges);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { saveGraph } = useSaveGraph();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { data: flowDetail } = useFetchFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const setSaveTime = useCallback((updateTime: number) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    setTime(dayjs(updateTime).format('YYYY-MM-DD HH:mm:ss'));</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, []);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useEffect(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    setSaveTime(flowDetail?.update_time);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [flowDetail, setSaveTime]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const saveAgent = useCallback(async () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    if (!chatDrawerVisible) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      const ret = await saveGraph();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      setSaveTime(ret.data.update_time);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [chatDrawerVisible, saveGraph, setSaveTime]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useDebounceEffect(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      saveAgent();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [nodes, edges],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      wait: 1000 * 20,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return time;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useHandleExportOrImportJsonFile = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { buildDslData } = useBuildDslData();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    visible: fileUploadVisible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideModal: hideFileUploadModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    showModal: showFileUploadModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  } = useSetModalState();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const setGraphInfo = useSetGraphInfo();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { data } = useFetchFlow();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { t } = useTranslation();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const onFileUploadOk = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    async (fileList: UploadFile[]) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      if (fileList.length > 0) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        const file: File = fileList[0] as unknown as File;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        if (file.type !== FileMimeType.Json) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          message.error(t('flow.jsonUploadTypeErrorMessage'));</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          return;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        const graphStr = await file.text();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        const errorMessage = t('flow.jsonUploadContentErrorMessage');</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        try {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          const graph = JSON.parse(graphStr);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          if (graphStr && !isEmpty(graph) && Array.isArray(graph?.nodes)) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            setGraphInfo(graph ?? ({} as IGraph));</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            hideFileUploadModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          } else {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            message.error(errorMessage);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        } catch (error) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          message.error(errorMessage);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [hideFileUploadModal, setGraphInfo, t],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const handleExportJson = useCallback(() => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    downloadJsonFile(buildDslData().graph, `${data.title}.json`);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [buildDslData, data.title]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    fileUploadVisible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    handleExportJson,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    handleImportJson: showFileUploadModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideFileUploadModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    onFileUploadOk,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-export const useShowSingleDebugDrawer = () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { visible, showModal, hideModal } = useSetModalState();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const { saveGraph } = useSaveGraph();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  const showSingleDebugDrawer = useCallback(async () => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    const saveRet = await saveGraph();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    if (saveRet?.code === 0) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      showModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    }</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  }, [saveGraph, showModal]);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  return {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    singleDebugDrawerVisible: visible,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    hideSingleDebugDrawer: hideModal,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    showSingleDebugDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  };</span>
<span style="background-color: #f8d7da; color: #d73a49;">-};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-build-dsl.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-build-dsl.ts</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..a6e5c015</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks/use-build-dsl.ts</span>
@@ -0,0 +1,29 @@
<span style="background-color: #d4edda; color: #28a745;">+import { useFetchFlow } from '@/hooks/flow-hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Node } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import useGraphStore from '../store';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { buildDslComponentsByGraph } from '../utils';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useBuildDslData = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { data } = useFetchFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { nodes, edges } = useGraphStore((state) => state);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const buildDslData = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (currentNodes?: Node[]) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      const dslComponents = buildDslComponentsByGraph(</span>
<span style="background-color: #d4edda; color: #28a745;">+        currentNodes ?? nodes,</span>
<span style="background-color: #d4edda; color: #28a745;">+        edges,</span>
<span style="background-color: #d4edda; color: #28a745;">+        data.dsl.components,</span>
<span style="background-color: #d4edda; color: #28a745;">+      );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+      return {</span>
<span style="background-color: #d4edda; color: #28a745;">+        ...data.dsl,</span>
<span style="background-color: #d4edda; color: #28a745;">+        graph: { nodes: currentNodes ?? nodes, edges },</span>
<span style="background-color: #d4edda; color: #28a745;">+        components: dslComponents,</span>
<span style="background-color: #d4edda; color: #28a745;">+      };</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [data.dsl, edges, nodes],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return { buildDslData };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-export-json.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-export-json.ts</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..5b8618de</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks/use-export-json.ts</span>
@@ -0,0 +1,62 @@
<span style="background-color: #d4edda; color: #28a745;">+import { FileMimeType } from '@/constants/common';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useSetModalState } from '@/hooks/common-hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useFetchFlow } from '@/hooks/flow-hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { IGraph } from '@/interfaces/database/flow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { downloadJsonFile } from '@/utils/file-util';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { message, UploadFile } from 'antd';</span>
<span style="background-color: #d4edda; color: #28a745;">+import isEmpty from 'lodash/isEmpty';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useTranslation } from 'react-i18next';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useBuildDslData } from './use-build-dsl';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useSetGraphInfo } from './use-set-graph';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useHandleExportOrImportJsonFile = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { buildDslData } = useBuildDslData();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const {</span>
<span style="background-color: #d4edda; color: #28a745;">+    visible: fileUploadVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideModal: hideFileUploadModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showModal: showFileUploadModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+  } = useSetModalState();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const setGraphInfo = useSetGraphInfo();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { data } = useFetchFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { t } = useTranslation();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const onFileUploadOk = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    async (fileList: UploadFile[]) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (fileList.length > 0) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        const file: File = fileList[0] as unknown as File;</span>
<span style="background-color: #d4edda; color: #28a745;">+        if (file.type !== FileMimeType.Json) {</span>
<span style="background-color: #d4edda; color: #28a745;">+          message.error(t('flow.jsonUploadTypeErrorMessage'));</span>
<span style="background-color: #d4edda; color: #28a745;">+          return;</span>
<span style="background-color: #d4edda; color: #28a745;">+        }</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        const graphStr = await file.text();</span>
<span style="background-color: #d4edda; color: #28a745;">+        const errorMessage = t('flow.jsonUploadContentErrorMessage');</span>
<span style="background-color: #d4edda; color: #28a745;">+        try {</span>
<span style="background-color: #d4edda; color: #28a745;">+          const graph = JSON.parse(graphStr);</span>
<span style="background-color: #d4edda; color: #28a745;">+          if (graphStr && !isEmpty(graph) && Array.isArray(graph?.nodes)) {</span>
<span style="background-color: #d4edda; color: #28a745;">+            setGraphInfo(graph ?? ({} as IGraph));</span>
<span style="background-color: #d4edda; color: #28a745;">+            hideFileUploadModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+          } else {</span>
<span style="background-color: #d4edda; color: #28a745;">+            message.error(errorMessage);</span>
<span style="background-color: #d4edda; color: #28a745;">+          }</span>
<span style="background-color: #d4edda; color: #28a745;">+        } catch (error) {</span>
<span style="background-color: #d4edda; color: #28a745;">+          message.error(errorMessage);</span>
<span style="background-color: #d4edda; color: #28a745;">+        }</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [hideFileUploadModal, setGraphInfo, t],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const handleExportJson = useCallback(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    downloadJsonFile(buildDslData().graph, `${data.title}.json`);</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [buildDslData, data.title]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return {</span>
<span style="background-color: #d4edda; color: #28a745;">+    fileUploadVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    handleExportJson,</span>
<span style="background-color: #d4edda; color: #28a745;">+    handleImportJson: showFileUploadModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideFileUploadModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    onFileUploadOk,</span>
<span style="background-color: #d4edda; color: #28a745;">+  };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-fetch-data.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-fetch-data.ts</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..245ea6ab</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks/use-fetch-data.ts</span>
@@ -0,0 +1,19 @@
<span style="background-color: #d4edda; color: #28a745;">+import { useFetchFlow } from '@/hooks/flow-hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { IGraph } from '@/interfaces/database/flow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useEffect } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useSetGraphInfo } from './use-set-graph';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useFetchDataOnMount = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { loading, data, refetch } = useFetchFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const setGraphInfo = useSetGraphInfo();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  useEffect(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    setGraphInfo(data?.dsl?.graph ?? ({} as IGraph));</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [setGraphInfo, data]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  useEffect(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    refetch();</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [refetch]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return { loading, flowDetail: data };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-get-begin-query.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-get-begin-query.tsx</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..0a86affa</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks/use-get-begin-query.tsx</span>
@@ -0,0 +1,112 @@
<span style="background-color: #d4edda; color: #28a745;">+import { DefaultOptionType } from 'antd/es/select';</span>
<span style="background-color: #d4edda; color: #28a745;">+import get from 'lodash/get';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback, useEffect, useMemo, useState } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Node } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { BeginId, Operator } from '../constant';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { BeginQuery, NodeData } from '../interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+import useGraphStore from '../store';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useGetBeginNodeDataQuery = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const getNode = useGraphStore((state) => state.getNode);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const getBeginNodeDataQuery = useCallback(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    return get(getNode(BeginId), 'data.form.query', []);</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [getNode]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return getBeginNodeDataQuery;</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useGetBeginNodeDataQueryIsEmpty = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const [isBeginNodeDataQueryEmpty, setIsBeginNodeDataQueryEmpty] =</span>
<span style="background-color: #d4edda; color: #28a745;">+    useState(false);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const getBeginNodeDataQuery = useGetBeginNodeDataQuery();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const nodes = useGraphStore((state) => state.nodes);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  useEffect(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    const query: BeginQuery[] = getBeginNodeDataQuery();</span>
<span style="background-color: #d4edda; color: #28a745;">+    setIsBeginNodeDataQueryEmpty(query.length === 0);</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [getBeginNodeDataQuery, nodes]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return isBeginNodeDataQueryEmpty;</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+// exclude nodes with branches</span>
<span style="background-color: #d4edda; color: #28a745;">+const ExcludedNodes = [</span>
<span style="background-color: #d4edda; color: #28a745;">+  Operator.Categorize,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Operator.Relevant,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Operator.Begin,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Operator.Note,</span>
<span style="background-color: #d4edda; color: #28a745;">+];</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useBuildComponentIdSelectOptions = (</span>
<span style="background-color: #d4edda; color: #28a745;">+  nodeId?: string,</span>
<span style="background-color: #d4edda; color: #28a745;">+  parentId?: string,</span>
<span style="background-color: #d4edda; color: #28a745;">+) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const nodes = useGraphStore((state) => state.nodes);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const getBeginNodeDataQuery = useGetBeginNodeDataQuery();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const query: BeginQuery[] = getBeginNodeDataQuery();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  // Limit the nodes inside iteration to only reference peer nodes with the same parentId and other external nodes other than their parent nodes</span>
<span style="background-color: #d4edda; color: #28a745;">+  const filterChildNodesToSameParentOrExternal = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (node: Node<NodeData>) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      // Node inside iteration</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (parentId) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        return (</span>
<span style="background-color: #d4edda; color: #28a745;">+          (node.parentId === parentId || node.parentId === undefined) &&</span>
<span style="background-color: #d4edda; color: #28a745;">+          node.id !== parentId</span>
<span style="background-color: #d4edda; color: #28a745;">+        );</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+      return node.parentId === undefined; // The outermost node</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [parentId],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const componentIdOptions = useMemo(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    return nodes</span>
<span style="background-color: #d4edda; color: #28a745;">+      .filter(</span>
<span style="background-color: #d4edda; color: #28a745;">+        (x) =></span>
<span style="background-color: #d4edda; color: #28a745;">+          x.id !== nodeId &&</span>
<span style="background-color: #d4edda; color: #28a745;">+          !ExcludedNodes.some((y) => y === x.data.label) &&</span>
<span style="background-color: #d4edda; color: #28a745;">+          filterChildNodesToSameParentOrExternal(x),</span>
<span style="background-color: #d4edda; color: #28a745;">+      )</span>
<span style="background-color: #d4edda; color: #28a745;">+      .map((x) => ({ label: x.data.name, value: x.id }));</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [nodes, nodeId, filterChildNodesToSameParentOrExternal]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const groupedOptions = [</span>
<span style="background-color: #d4edda; color: #28a745;">+    {</span>
<span style="background-color: #d4edda; color: #28a745;">+      label: <span>Component Output</span>,</span>
<span style="background-color: #d4edda; color: #28a745;">+      title: 'Component Output',</span>
<span style="background-color: #d4edda; color: #28a745;">+      options: componentIdOptions,</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    {</span>
<span style="background-color: #d4edda; color: #28a745;">+      label: <span>Begin Input</span>,</span>
<span style="background-color: #d4edda; color: #28a745;">+      title: 'Begin Input',</span>
<span style="background-color: #d4edda; color: #28a745;">+      options: query.map((x) => ({</span>
<span style="background-color: #d4edda; color: #28a745;">+        label: x.name,</span>
<span style="background-color: #d4edda; color: #28a745;">+        value: `begin@${x.key}`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      })),</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+  ];</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return groupedOptions;</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useGetComponentLabelByValue = (nodeId: string) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const options = useBuildComponentIdSelectOptions(nodeId);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const flattenOptions = useMemo(</span>
<span style="background-color: #d4edda; color: #28a745;">+    () =></span>
<span style="background-color: #d4edda; color: #28a745;">+      options.reduce<DefaultOptionType[]>((pre, cur) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+        return [...pre, ...cur.options];</span>
<span style="background-color: #d4edda; color: #28a745;">+      }, []),</span>
<span style="background-color: #d4edda; color: #28a745;">+    [options],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const getLabel = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (val?: string) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      return flattenOptions.find((x) => x.value === val)?.label;</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [flattenOptions],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+  return getLabel;</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-iteration.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-iteration.ts</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..e69de29b</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-save-graph.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-save-graph.ts</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..e042aca6</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks/use-save-graph.ts</span>
@@ -0,0 +1,85 @@
<span style="background-color: #d4edda; color: #28a745;">+import { useFetchFlow, useResetFlow, useSetFlow } from '@/hooks/flow-hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useDebounceEffect } from 'ahooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import dayjs from 'dayjs';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback, useEffect, useState } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Node } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useParams } from 'umi';</span>
<span style="background-color: #d4edda; color: #28a745;">+import useGraphStore from '../store';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useBuildDslData } from './use-build-dsl';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useSaveGraph = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { data } = useFetchFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { setFlow, loading } = useSetFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { id } = useParams();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { buildDslData } = useBuildDslData();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const saveGraph = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    async (currentNodes?: Node[]) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      return setFlow({</span>
<span style="background-color: #d4edda; color: #28a745;">+        id,</span>
<span style="background-color: #d4edda; color: #28a745;">+        title: data.title,</span>
<span style="background-color: #d4edda; color: #28a745;">+        dsl: buildDslData(currentNodes),</span>
<span style="background-color: #d4edda; color: #28a745;">+      });</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [setFlow, id, data.title, buildDslData],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return { saveGraph, loading };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useSaveGraphBeforeOpeningDebugDrawer = (show: () => void) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { saveGraph, loading } = useSaveGraph();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { resetFlow } = useResetFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const handleRun = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    async (nextNodes?: Node[]) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      const saveRet = await saveGraph(nextNodes);</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (saveRet?.code === 0) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        // Call the reset api before opening the run drawer each time</span>
<span style="background-color: #d4edda; color: #28a745;">+        const resetRet = await resetFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+        // After resetting, all previous messages will be cleared.</span>
<span style="background-color: #d4edda; color: #28a745;">+        if (resetRet?.code === 0) {</span>
<span style="background-color: #d4edda; color: #28a745;">+          show();</span>
<span style="background-color: #d4edda; color: #28a745;">+        }</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [saveGraph, resetFlow, show],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return { handleRun, loading };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useWatchAgentChange = (chatDrawerVisible: boolean) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const [time, setTime] = useState<string>();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const nodes = useGraphStore((state) => state.nodes);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const edges = useGraphStore((state) => state.edges);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { saveGraph } = useSaveGraph();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { data: flowDetail } = useFetchFlow();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const setSaveTime = useCallback((updateTime: number) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    setTime(dayjs(updateTime).format('YYYY-MM-DD HH:mm:ss'));</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, []);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  useEffect(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    setSaveTime(flowDetail?.update_time);</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [flowDetail, setSaveTime]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const saveAgent = useCallback(async () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    if (!chatDrawerVisible) {</span>
<span style="background-color: #d4edda; color: #28a745;">+      const ret = await saveGraph();</span>
<span style="background-color: #d4edda; color: #28a745;">+      setSaveTime(ret.data.update_time);</span>
<span style="background-color: #d4edda; color: #28a745;">+    }</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [chatDrawerVisible, saveGraph, setSaveTime]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  useDebounceEffect(</span>
<span style="background-color: #d4edda; color: #28a745;">+    () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      saveAgent();</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [nodes, edges],</span>
<span style="background-color: #d4edda; color: #28a745;">+    {</span>
<span style="background-color: #d4edda; color: #28a745;">+      wait: 1000 * 20,</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return time;</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-set-graph.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-set-graph.ts</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..6dd68a33</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks/use-set-graph.ts</span>
@@ -0,0 +1,17 @@
<span style="background-color: #d4edda; color: #28a745;">+import { IGraph } from '@/interfaces/database/flow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import useGraphStore from '../store';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useSetGraphInfo = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { setEdges, setNodes } = useGraphStore((state) => state);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const setGraphInfo = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    ({ nodes = [], edges = [] }: IGraph) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (nodes.length || edges.length) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        setNodes(nodes);</span>
<span style="background-color: #d4edda; color: #28a745;">+        setEdges(edges);</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [setEdges, setNodes],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+  return setGraphInfo;</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/hooks/use-show-drawer.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/hooks/use-show-drawer.tsx</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..8146db4b</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/hooks/use-show-drawer.tsx</span>
@@ -0,0 +1,153 @@
<span style="background-color: #d4edda; color: #28a745;">+import { useSetModalState } from '@/hooks/common-hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import get from 'lodash/get';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback, useEffect } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Node, NodeMouseHandler } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Operator } from '../constant';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { BeginQuery } from '../interface';</span>
<span style="background-color: #d4edda; color: #28a745;">+import useGraphStore from '../store';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useGetBeginNodeDataQuery } from './use-get-begin-query';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useSaveGraph } from './use-save-graph';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useShowFormDrawer = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const {</span>
<span style="background-color: #d4edda; color: #28a745;">+    clickedNodeId: clickNodeId,</span>
<span style="background-color: #d4edda; color: #28a745;">+    setClickedNodeId,</span>
<span style="background-color: #d4edda; color: #28a745;">+    getNode,</span>
<span style="background-color: #d4edda; color: #28a745;">+  } = useGraphStore((state) => state);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const {</span>
<span style="background-color: #d4edda; color: #28a745;">+    visible: formDrawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideModal: hideFormDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showModal: showFormDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+  } = useSetModalState();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const handleShow = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (node: Node) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      setClickedNodeId(node.id);</span>
<span style="background-color: #d4edda; color: #28a745;">+      showFormDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [showFormDrawer, setClickedNodeId],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return {</span>
<span style="background-color: #d4edda; color: #28a745;">+    formDrawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideFormDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showFormDrawer: handleShow,</span>
<span style="background-color: #d4edda; color: #28a745;">+    clickedNode: getNode(clickNodeId),</span>
<span style="background-color: #d4edda; color: #28a745;">+  };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const useShowSingleDebugDrawer = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { visible, showModal, hideModal } = useSetModalState();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { saveGraph } = useSaveGraph();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const showSingleDebugDrawer = useCallback(async () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    const saveRet = await saveGraph();</span>
<span style="background-color: #d4edda; color: #28a745;">+    if (saveRet?.code === 0) {</span>
<span style="background-color: #d4edda; color: #28a745;">+      showModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+    }</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [saveGraph, showModal]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return {</span>
<span style="background-color: #d4edda; color: #28a745;">+    singleDebugDrawerVisible: visible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideSingleDebugDrawer: hideModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+  };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const ExcludedNodes = [Operator.IterationStart, Operator.Note];</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export function useShowDrawer({</span>
<span style="background-color: #d4edda; color: #28a745;">+  drawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+  hideDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+}: {</span>
<span style="background-color: #d4edda; color: #28a745;">+  drawerVisible: boolean;</span>
<span style="background-color: #d4edda; color: #28a745;">+  hideDrawer(): void;</span>
<span style="background-color: #d4edda; color: #28a745;">+}) {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const {</span>
<span style="background-color: #d4edda; color: #28a745;">+    visible: runVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showModal: showRunModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideModal: hideRunModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+  } = useSetModalState();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const {</span>
<span style="background-color: #d4edda; color: #28a745;">+    visible: chatVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showModal: showChatModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideModal: hideChatModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+  } = useSetModalState();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const {</span>
<span style="background-color: #d4edda; color: #28a745;">+    singleDebugDrawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+  } = useShowSingleDebugDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const { formDrawerVisible, hideFormDrawer, showFormDrawer, clickedNode } =</span>
<span style="background-color: #d4edda; color: #28a745;">+    useShowFormDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+  const getBeginNodeDataQuery = useGetBeginNodeDataQuery();</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  useEffect(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    if (drawerVisible) {</span>
<span style="background-color: #d4edda; color: #28a745;">+      const query: BeginQuery[] = getBeginNodeDataQuery();</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (query.length > 0) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        showRunModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+        hideChatModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+      } else {</span>
<span style="background-color: #d4edda; color: #28a745;">+        showChatModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+        hideRunModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+    }</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideChatModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideRunModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showChatModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showRunModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    drawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    getBeginNodeDataQuery,</span>
<span style="background-color: #d4edda; color: #28a745;">+  ]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const hideRunOrChatDrawer = useCallback(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideChatModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideRunModal();</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [hideChatModal, hideDrawer, hideRunModal]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const onPaneClick = useCallback(() => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideFormDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, [hideFormDrawer]);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const onNodeClick: NodeMouseHandler = useCallback(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (e, node) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (!ExcludedNodes.some((x) => x === node.data.label)) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        hideSingleDebugDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+        hideRunOrChatDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+        showFormDrawer(node);</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+      // handle single debug icon click</span>
<span style="background-color: #d4edda; color: #28a745;">+      if (</span>
<span style="background-color: #d4edda; color: #28a745;">+        get(e.target, 'dataset.play') === 'true' ||</span>
<span style="background-color: #d4edda; color: #28a745;">+        get(e.target, 'parentNode.dataset.play') === 'true'</span>
<span style="background-color: #d4edda; color: #28a745;">+      ) {</span>
<span style="background-color: #d4edda; color: #28a745;">+        showSingleDebugDrawer();</span>
<span style="background-color: #d4edda; color: #28a745;">+      }</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    [</span>
<span style="background-color: #d4edda; color: #28a745;">+      hideRunOrChatDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+      hideSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+      showFormDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+      showSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    ],</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return {</span>
<span style="background-color: #d4edda; color: #28a745;">+    chatVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    runVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    onPaneClick,</span>
<span style="background-color: #d4edda; color: #28a745;">+    singleDebugDrawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideSingleDebugDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    formDrawerVisible,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showFormDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    clickedNode,</span>
<span style="background-color: #d4edda; color: #28a745;">+    onNodeClick,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideFormDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    hideRunOrChatDrawer,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showChatModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+  };</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 82dd856a..50b62568 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/index.tsx</span>
@@ -5,7 +5,8 @@ import { ReactFlowProvider } from '#39;reactflow'#39;;
import FlowCanvas from '#39;./canvas'#39;;
import Sider from '#39;./flow-sider'#39;;
import FlowHeader from '#39;./header'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useCopyPaste, useFetchDataOnMount } from './hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCopyPaste } from './hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useFetchDataOnMount } from './hooks/use-fetch-data';</span>

const { Content } = Layout;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/interface.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/interface.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index d0b80a24..3975500f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/interface.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/interface.ts</span>
@@ -90,7 +90,7 @@ export interface ISwitchForm {
export type NodeData = {
label: string; // operator type
name: string; // operator name
<span style="background-color: #f8d7da; color: #d73a49;">-  color: string;</span>
<span style="background-color: #d4edda; color: #28a745;">+  color?: string;</span>
form:
| IBeginForm
| IRetrievalForm
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/list/hooks.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/list/hooks.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f82d9c0b..219dfa0e 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/list/hooks.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/list/hooks.ts</span>
@@ -4,18 +4,8 @@ import {
useFetchFlowTemplates,
useSetFlow,
} from '#39;@/hooks/flow-hooks'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { useCallback, useState } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback } from 'react';</span>
import { useNavigate } from '#39;umi'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-// import { dsl } from '../mock';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import headhunterZhComponents from '../../../../../graph/test/dsl_examples/headhunter_zh.json';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import dslJson from '../../../../../dls.json';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import customerServiceBase from '../../../../../graph/test/dsl_examples/customer_service.json';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import customerService from '../customer_service.json';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import interpreterBase from '../../../../../graph/test/dsl_examples/interpreter.json';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import interpreter from '../interpreter.json';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import retrievalRelevantRewriteAndGenerateBase from '../../../../../graph/test/dsl_examples/retrieval_relevant_rewrite_and_generate.json';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-// import retrievalRelevantRewriteAndGenerate from '../retrieval_relevant_rewrite_and_generate.json';</span>

export const useFetchDataOnMount = () =&gt; {
const { data, loading } = useFetchFlowList();
@@ -24,7 +14,6 @@ export const useFetchDataOnMount = () =&gt; {
};

export const useSaveFlow = () =&gt; {
<span style="background-color: #f8d7da; color: #d73a49;">-  const [currentFlow, setCurrentFlow] = useState({});</span>
const {
visible: flowSettingVisible,
hideModal: hideFlowSettingModal,
@@ -39,18 +28,10 @@ export const useSaveFlow = () =&gt; {
const templateItem = list.find((x) =&gt; x.id === templateId);

let dsl = templateItem?.dsl;
<span style="background-color: #f8d7da; color: #d73a49;">-      // if (dsl) {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      //   dsl.graph = headhunter_zh;</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      // }</span>
const ret = await setFlow({
title,
dsl,
avatar: templateItem?.avatar,
<span style="background-color: #f8d7da; color: #d73a49;">-        // dsl: dslJson,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        // dsl: {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        //   ...retrievalRelevantRewriteAndGenerateBase,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        //   graph: retrievalRelevantRewriteAndGenerate,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        // },</span>
});

if (ret?.code === 0) {
@@ -61,20 +42,12 @@ export const useSaveFlow = () =&gt; {
[setFlow, hideFlowSettingModal, navigate, list],
);

<span style="background-color: #f8d7da; color: #d73a49;">-  const handleShowFlowSettingModal = useCallback(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    async (record: any) => {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      setCurrentFlow(record);</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      showFileRenameModal();</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    },</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    [showFileRenameModal],</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  );</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
return {
flowSettingLoading: loading,
initialFlowName: '#39;'#39;,
onFlowOk,
flowSettingVisible,
hideFlowSettingModal,
<span style="background-color: #f8d7da; color: #d73a49;">-    showFlowSettingModal: handleShowFlowSettingModal,</span>
<span style="background-color: #d4edda; color: #28a745;">+    showFlowSettingModal: showFileRenameModal,</span>
};
};
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/run-drawer/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/run-drawer/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 063c5ad4..d6cf4593 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/run-drawer/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/run-drawer/index.tsx</span>
@@ -2,16 +2,14 @@ import { IModalProps } from '#39;@/interfaces/common'#39;;
import { Drawer } from '#39;antd'#39;;
import { useCallback } from '#39;react'#39;;
import { useTranslation } from '#39;react-i18next'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useGetBeginNodeDataQuery,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  useSaveGraphBeforeOpeningDebugDrawer,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-} from '../hooks';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { BeginId } from '../constant';</span>
<span style="background-color: #d4edda; color: #28a745;">+import DebugContent from '../debug-content';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useGetBeginNodeDataQuery } from '../hooks/use-get-begin-query';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { useSaveGraphBeforeOpeningDebugDrawer } from '../hooks/use-save-graph';</span>
import { BeginQuery } from '#39;../interface'#39;;
import useGraphStore from '#39;../store'#39;;
import { getDrawerWidth } from '#39;../utils'#39;;

<span style="background-color: #f8d7da; color: #d73a49;">-import DebugContent from '../debug-content';</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
const RunDrawer = ({
hideModal,
showModal: showChatModal,
@@ -28,7 +26,7 @@ const RunDrawer = ({

const handleRunAgent = useCallback(
(nextValues: Record&lt;string, any&gt;) =&gt; {
<span style="background-color: #f8d7da; color: #d73a49;">-      const currentNodes = updateNodeForm('begin', nextValues, ['query']);</span>
<span style="background-color: #d4edda; color: #28a745;">+      const currentNodes = updateNodeForm(BeginId, nextValues, ['query']);</span>
handleRun(currentNodes);
hideModal?.();
},
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/store.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/store.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 54fccb9a..3f645a40 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/store.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/store.ts</span>
@@ -1,5 +1,5 @@
import type {} from '#39;@redux-devtools/extension'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { humanId } from 'human-id';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { omit } from 'lodash';</span>
import differenceWith from '#39;lodash/differenceWith'#39;;
import intersectionWith from '#39;lodash/intersectionWith'#39;;
import lodashSet from '#39;lodash/set'#39;;
@@ -25,8 +25,8 @@ import { Operator, SwitchElseTo } from '#39;./constant'#39;;
import { NodeData } from '#39;./interface'#39;;
import {
duplicateNodeForm,
<span style="background-color: #d4edda; color: #28a745;">+  generateDuplicateNode,</span>
generateNodeNamesWithIncreasingIndex,
<span style="background-color: #f8d7da; color: #d73a49;">-  getNodeDragHandle,</span>
getOperatorIndex,
isEdgeEqual,
} from '#39;./utils'#39;;
@@ -61,13 +61,16 @@ export type RFState = {
) =&gt; void;
deletePreviousEdgeOfClassificationNode: (connection: Connection) =&gt; void;
duplicateNode: (id: string, name: string) =&gt; void;
<span style="background-color: #d4edda; color: #28a745;">+  duplicateIterationNode: (id: string, name: string) => void;</span>
deleteEdge: () =&gt; void;
deleteEdgeById: (id: string) =&gt; void;
deleteNodeById: (id: string) =&gt; void;
<span style="background-color: #d4edda; color: #28a745;">+  deleteIterationNodeById: (id: string) => void;</span>
deleteEdgeBySourceAndSourceHandle: (connection: Partial&lt;Connection&gt;) =&gt; void;
findNodeByName: (operatorName: Operator) =&gt; Node | undefined;
updateMutableNodeFormItem: (id: string, field: string, value: any) =&gt; void;
getOperatorTypeFromId: (id?: string | null) =&gt; string | undefined;
<span style="background-color: #d4edda; color: #28a745;">+  getParentIdById: (id?: string | null) => string | undefined;</span>
updateNodeName: (id: string, name: string) =&gt; void;
generateNodeName: (name: string) =&gt; string;
setClickedNodeId: (id?: string) =&gt; void;
@@ -170,6 +173,9 @@ const useGraphStore = create&lt;RFState&gt;()(
getOperatorTypeFromId: (id?: string | null) =&gt; {
return get().getNode(id)?.data?.label;
},
<span style="background-color: #d4edda; color: #28a745;">+      getParentIdById: (id?: string | null) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get().getNode(id)?.parentId;</span>
<span style="background-color: #d4edda; color: #28a745;">+      },</span>
addEdge: (connection: Connection) =&gt; {
set({
edges: addEdge(connection, get().edges),
@@ -234,12 +240,14 @@ const useGraphStore = create&lt;RFState&gt;()(
}
},
duplicateNode: (id: string, name: string) =&gt; {
<span style="background-color: #f8d7da; color: #d73a49;">-        const { getNode, addNode, generateNodeName } = get();</span>
<span style="background-color: #d4edda; color: #28a745;">+        const { getNode, addNode, generateNodeName, duplicateIterationNode } =</span>
<span style="background-color: #d4edda; color: #28a745;">+          get();</span>
const node = getNode(id);
<span style="background-color: #f8d7da; color: #d73a49;">-        const position = {</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          x: (node?.position?.x || 0) + 50,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          y: (node?.position?.y || 0) + 50,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        };</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        if (node?.data.label === Operator.Iteration) {</span>
<span style="background-color: #d4edda; color: #28a745;">+          duplicateIterationNode(id, name);</span>
<span style="background-color: #d4edda; color: #28a745;">+          return;</span>
<span style="background-color: #d4edda; color: #28a745;">+        }</span>

addNode({
...(node || {}),
@@ -247,13 +255,38 @@ const useGraphStore = create&lt;RFState&gt;()(
...duplicateNodeForm(node?.data),
name: generateNodeName(name),
},
<span style="background-color: #f8d7da; color: #d73a49;">-          selected: false,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          dragging: false,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          id: `${node?.data?.label}:${humanId()}`,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          position,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-          dragHandle: getNodeDragHandle(node?.data?.label),</span>
<span style="background-color: #d4edda; color: #28a745;">+          ...generateDuplicateNode(node?.position, node?.data?.label),</span>
});
},
<span style="background-color: #d4edda; color: #28a745;">+      duplicateIterationNode: (id: string, name: string) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+        const { getNode, generateNodeName, nodes } = get();</span>
<span style="background-color: #d4edda; color: #28a745;">+        const node = getNode(id);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        const iterationNode: Node<NodeData> = {</span>
<span style="background-color: #d4edda; color: #28a745;">+          ...(node || {}),</span>
<span style="background-color: #d4edda; color: #28a745;">+          data: {</span>
<span style="background-color: #d4edda; color: #28a745;">+            ...(node?.data || { label: Operator.Iteration, form: {} }),</span>
<span style="background-color: #d4edda; color: #28a745;">+            name: generateNodeName(name),</span>
<span style="background-color: #d4edda; color: #28a745;">+          },</span>
<span style="background-color: #d4edda; color: #28a745;">+          ...generateDuplicateNode(node?.position, node?.data?.label),</span>
<span style="background-color: #d4edda; color: #28a745;">+        };</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        const children = nodes</span>
<span style="background-color: #d4edda; color: #28a745;">+          .filter((x) => x.parentId === node?.id)</span>
<span style="background-color: #d4edda; color: #28a745;">+          .map((x) => ({</span>
<span style="background-color: #d4edda; color: #28a745;">+            ...(x || {}),</span>
<span style="background-color: #d4edda; color: #28a745;">+            data: {</span>
<span style="background-color: #d4edda; color: #28a745;">+              ...duplicateNodeForm(x?.data),</span>
<span style="background-color: #d4edda; color: #28a745;">+              name: generateNodeName(x.data.name),</span>
<span style="background-color: #d4edda; color: #28a745;">+            },</span>
<span style="background-color: #d4edda; color: #28a745;">+            ...omit(generateDuplicateNode(x?.position, x?.data?.label), [</span>
<span style="background-color: #d4edda; color: #28a745;">+              'position',</span>
<span style="background-color: #d4edda; color: #28a745;">+            ]),</span>
<span style="background-color: #d4edda; color: #28a745;">+            parentId: iterationNode.id,</span>
<span style="background-color: #d4edda; color: #28a745;">+          }));</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+        set({ nodes: nodes.concat(iterationNode, ...children) });</span>
<span style="background-color: #d4edda; color: #28a745;">+      },</span>
deleteEdge: () =&gt; {
const { edges, selectedEdgeIds } = get();
set({
@@ -323,6 +356,21 @@ const useGraphStore = create&lt;RFState&gt;()(
.filter((edge) =&gt; edge.target !== id),
});
},
<span style="background-color: #d4edda; color: #28a745;">+      deleteIterationNodeById: (id: string) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+        const { nodes, edges } = get();</span>
<span style="background-color: #d4edda; color: #28a745;">+        const children = nodes.filter((node) => node.parentId === id);</span>
<span style="background-color: #d4edda; color: #28a745;">+        set({</span>
<span style="background-color: #d4edda; color: #28a745;">+          nodes: nodes.filter((node) => node.id !== id && node.parentId !== id),</span>
<span style="background-color: #d4edda; color: #28a745;">+          edges: edges.filter(</span>
<span style="background-color: #d4edda; color: #28a745;">+            (edge) =></span>
<span style="background-color: #d4edda; color: #28a745;">+              edge.source !== id &&</span>
<span style="background-color: #d4edda; color: #28a745;">+              edge.target !== id &&</span>
<span style="background-color: #d4edda; color: #28a745;">+              !children.some(</span>
<span style="background-color: #d4edda; color: #28a745;">+                (child) => edge.source === child.id && edge.target === child.id,</span>
<span style="background-color: #d4edda; color: #28a745;">+              ),</span>
<span style="background-color: #d4edda; color: #28a745;">+          ),</span>
<span style="background-color: #d4edda; color: #28a745;">+        });</span>
<span style="background-color: #d4edda; color: #28a745;">+      },</span>
findNodeByName: (name: Operator) =&gt; {
return get().nodes.find((x) =&gt; x.data.label === name);
},
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/flow/utils.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/flow/utils.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index a4662109..6585d240 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/flow/utils.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/flow/utils.ts</span>
@@ -5,7 +5,7 @@ import { humanId } from '#39;human-id'#39;;
import { curry, get, intersectionWith, isEqual, sample } from '#39;lodash'#39;;
import pipe from '#39;lodash/fp/pipe'#39;;
import isObject from '#39;lodash/isObject'#39;;
<span style="background-color: #f8d7da; color: #d73a49;">-import { Edge, Node, Position } from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import { Edge, Node, Position, XYPosition } from 'reactflow';</span>
import { v4 as uuidv4 } from '#39;uuid'#39;;
import {
CategorizeAnchorPointPositions,
@@ -144,6 +144,7 @@ export const buildDslComponentsByGraph = (
},
downstream: buildComponentDownstreamOrUpstream(edges, id, true),
upstream: buildComponentDownstreamOrUpstream(edges, id, false),
<span style="background-color: #d4edda; color: #28a745;">+        parent_id: x?.parentId,</span>
};
});

@@ -332,3 +333,55 @@ export const getDrawerWidth = () =&gt; {
export const needsSingleStepDebugging = (label: string) =&gt; {
return !NoDebugOperatorsList.some((x) =&gt; (label as Operator) === x);
};
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+// Get the coordinates of the node relative to the Iteration node</span>
<span style="background-color: #d4edda; color: #28a745;">+export function getRelativePositionToIterationNode(</span>
<span style="background-color: #d4edda; color: #28a745;">+  nodes: Node<NodeData>[],</span>
<span style="background-color: #d4edda; color: #28a745;">+  position?: XYPosition, // relative position</span>
<span style="background-color: #d4edda; color: #28a745;">+) {</span>
<span style="background-color: #d4edda; color: #28a745;">+  if (!position) {</span>
<span style="background-color: #d4edda; color: #28a745;">+    return;</span>
<span style="background-color: #d4edda; color: #28a745;">+  }</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const iterationNodes = nodes.filter(</span>
<span style="background-color: #d4edda; color: #28a745;">+    (node) => node.data.label === Operator.Iteration,</span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  for (const iterationNode of iterationNodes) {</span>
<span style="background-color: #d4edda; color: #28a745;">+    const {</span>
<span style="background-color: #d4edda; color: #28a745;">+      position: { x, y },</span>
<span style="background-color: #d4edda; color: #28a745;">+      width,</span>
<span style="background-color: #d4edda; color: #28a745;">+      height,</span>
<span style="background-color: #d4edda; color: #28a745;">+    } = iterationNode;</span>
<span style="background-color: #d4edda; color: #28a745;">+    const halfWidth = (width || 0) / 2;</span>
<span style="background-color: #d4edda; color: #28a745;">+    if (</span>
<span style="background-color: #d4edda; color: #28a745;">+      position.x >= x - halfWidth &&</span>
<span style="background-color: #d4edda; color: #28a745;">+      position.x <= x + halfWidth &&</span>
<span style="background-color: #d4edda; color: #28a745;">+      position.y >= y &&</span>
<span style="background-color: #d4edda; color: #28a745;">+      position.y <= y + (height || 0)</span>
<span style="background-color: #d4edda; color: #28a745;">+    ) {</span>
<span style="background-color: #d4edda; color: #28a745;">+      return {</span>
<span style="background-color: #d4edda; color: #28a745;">+        parentId: iterationNode.id,</span>
<span style="background-color: #d4edda; color: #28a745;">+        position: { x: position.x - x + halfWidth, y: position.y - y },</span>
<span style="background-color: #d4edda; color: #28a745;">+      };</span>
<span style="background-color: #d4edda; color: #28a745;">+    }</span>
<span style="background-color: #d4edda; color: #28a745;">+  }</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export const generateDuplicateNode = (</span>
<span style="background-color: #d4edda; color: #28a745;">+  position?: XYPosition,</span>
<span style="background-color: #d4edda; color: #28a745;">+  label?: string,</span>
<span style="background-color: #d4edda; color: #28a745;">+) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const nextPosition = {</span>
<span style="background-color: #d4edda; color: #28a745;">+    x: (position?.x || 0) + 50,</span>
<span style="background-color: #d4edda; color: #28a745;">+    y: (position?.y || 0) + 50,</span>
<span style="background-color: #d4edda; color: #28a745;">+  };</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return {</span>
<span style="background-color: #d4edda; color: #28a745;">+    selected: false,</span>
<span style="background-color: #d4edda; color: #28a745;">+    dragging: false,</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: `${label}:${humanId()}`,</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: nextPosition,</span>
<span style="background-color: #d4edda; color: #28a745;">+    dragHandle: getNodeDragHandle(label),</span>
<span style="background-color: #d4edda; color: #28a745;">+  };</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/knowledge/index.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/knowledge/index.tsx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 3596c91f..41b45e99 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/knowledge/index.tsx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/knowledge/index.tsx</span>
@@ -38,7 +38,6 @@ const KnowledgeList = () =&gt; {
handleInputChange,
loading,
} = useInfiniteFetchKnowledgeList();
<span style="background-color: #f8d7da; color: #d73a49;">-  console.log('🚀 ~ KnowledgeList ~ data:', data);</span>
const nextList = data?.pages?.flatMap((x) =&gt; x.kbs) ?? [];

const total = useMemo(() =&gt; {
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/workflow.less</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/workflow.less</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..975ebb49</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/workflow.less</span>
@@ -0,0 +1,5 @@
<span style="background-color: #d4edda; color: #28a745;">+.react-flow-subflows-example {</span>
<span style="background-color: #d4edda; color: #28a745;">+  .react-flow__node-group {</span>
<span style="background-color: #d4edda; color: #28a745;">+    padding: 0;</span>
<span style="background-color: #d4edda; color: #28a745;">+  }</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/workflow.tsx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/workflow.tsx</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..f6b609e3</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/workflow.tsx</span>
@@ -0,0 +1,151 @@
<span style="background-color: #d4edda; color: #28a745;">+import { useCallback } from 'react';</span>
<span style="background-color: #d4edda; color: #28a745;">+import ReactFlow, {</span>
<span style="background-color: #d4edda; color: #28a745;">+  Background,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Controls,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Handle,</span>
<span style="background-color: #d4edda; color: #28a745;">+  MiniMap,</span>
<span style="background-color: #d4edda; color: #28a745;">+  NodeProps,</span>
<span style="background-color: #d4edda; color: #28a745;">+  Position,</span>
<span style="background-color: #d4edda; color: #28a745;">+  addEdge,</span>
<span style="background-color: #d4edda; color: #28a745;">+  useEdgesState,</span>
<span style="background-color: #d4edda; color: #28a745;">+  useNodesState,</span>
<span style="background-color: #d4edda; color: #28a745;">+} from 'reactflow';</span>
<span style="background-color: #d4edda; color: #28a745;">+import 'reactflow/dist/style.css';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+import './workflow.less';</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const initialNodes = [</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '1',</span>
<span style="background-color: #d4edda; color: #28a745;">+    type: 'input',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Node 0' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 250, y: 5 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '2',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Group A' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 100, y: 100 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+    style: { backgroundColor: 'rgba(255, 0, 0, 0.2)', width: 200, height: 200 },</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '2a',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Node A.1' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 10, y: 50 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    parentId: '2',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '3',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Node 1' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 320, y: 100 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '4',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Group B' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 320, y: 200 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+    style: { backgroundColor: 'rgba(255, 0, 0, 0.2)', width: 300, height: 300 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    type: 'group',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '4a',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Node B.1' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 15, y: 65 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+    parentId: '4',</span>
<span style="background-color: #d4edda; color: #28a745;">+    extent: 'parent',</span>
<span style="background-color: #d4edda; color: #28a745;">+    draggable: false,</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '4b',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Group B.A' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 15, y: 120 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+    style: {</span>
<span style="background-color: #d4edda; color: #28a745;">+      backgroundColor: 'rgba(255, 0, 255, 0.2)',</span>
<span style="background-color: #d4edda; color: #28a745;">+      height: 150,</span>
<span style="background-color: #d4edda; color: #28a745;">+      width: 270,</span>
<span style="background-color: #d4edda; color: #28a745;">+    },</span>
<span style="background-color: #d4edda; color: #28a745;">+    parentId: '4',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '4b1',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Node B.A.1' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 20, y: 40 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+    parentId: '4b',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    id: '4b2',</span>
<span style="background-color: #d4edda; color: #28a745;">+    data: { label: 'Node B.A.2' },</span>
<span style="background-color: #d4edda; color: #28a745;">+    position: { x: 100, y: 100 },</span>
<span style="background-color: #d4edda; color: #28a745;">+    className: 'light',</span>
<span style="background-color: #d4edda; color: #28a745;">+    parentId: '4b',</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
<span style="background-color: #d4edda; color: #28a745;">+];</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const initialEdges = [</span>
<span style="background-color: #d4edda; color: #28a745;">+  { id: 'e1-2', source: '1', target: '2', animated: true },</span>
<span style="background-color: #d4edda; color: #28a745;">+  { id: 'e1-3', source: '1', target: '3' },</span>
<span style="background-color: #d4edda; color: #28a745;">+  { id: 'e2a-4a', source: '2a', target: '4a' },</span>
<span style="background-color: #d4edda; color: #28a745;">+  { id: 'e3-4b', source: '3', target: '4b' },</span>
<span style="background-color: #d4edda; color: #28a745;">+  { id: 'e4a-4b1', source: '4a', target: '4b1' },</span>
<span style="background-color: #d4edda; color: #28a745;">+  { id: 'e4a-4b2', source: '4a', target: '4b2' },</span>
<span style="background-color: #d4edda; color: #28a745;">+  { id: 'e4b1-4b2', source: '4b1', target: '4b2' },</span>
<span style="background-color: #d4edda; color: #28a745;">+];</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export function RagNode({ id, data, isConnectable = true }: NodeProps<any>) {</span>
<span style="background-color: #d4edda; color: #28a745;">+  return (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <section className="ragflow-group w-full h-full"></span>
<span style="background-color: #d4edda; color: #28a745;">+      <div className="h-10 bg-slate-200 text-orange-400">header</div></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Handle</span>
<span style="background-color: #d4edda; color: #28a745;">+        id="c"</span>
<span style="background-color: #d4edda; color: #28a745;">+        type="source"</span>
<span style="background-color: #d4edda; color: #28a745;">+        position={Position.Left}</span>
<span style="background-color: #d4edda; color: #28a745;">+        isConnectable={isConnectable}</span>
<span style="background-color: #d4edda; color: #28a745;">+      ></Handle></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Handle</span>
<span style="background-color: #d4edda; color: #28a745;">+        type="source"</span>
<span style="background-color: #d4edda; color: #28a745;">+        position={Position.Right}</span>
<span style="background-color: #d4edda; color: #28a745;">+        isConnectable={isConnectable}</span>
<span style="background-color: #d4edda; color: #28a745;">+        id="b"</span>
<span style="background-color: #d4edda; color: #28a745;">+      ></Handle></span>
<span style="background-color: #d4edda; color: #28a745;">+      <div className="w-full h-10">xxx</div></span>
<span style="background-color: #d4edda; color: #28a745;">+    </section></span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const nodeTypes = { group: RagNode };</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+const NestedFlow = () => {</span>
<span style="background-color: #d4edda; color: #28a745;">+  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);</span>
<span style="background-color: #d4edda; color: #28a745;">+  const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  const onConnect = useCallback((connection) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+    setEdges((eds) => addEdge(connection, eds));</span>
<span style="background-color: #d4edda; color: #28a745;">+  }, []);</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+  return (</span>
<span style="background-color: #d4edda; color: #28a745;">+    <ReactFlow</span>
<span style="background-color: #d4edda; color: #28a745;">+      nodes={nodes}</span>
<span style="background-color: #d4edda; color: #28a745;">+      edges={edges}</span>
<span style="background-color: #d4edda; color: #28a745;">+      onNodesChange={onNodesChange}</span>
<span style="background-color: #d4edda; color: #28a745;">+      onEdgesChange={onEdgesChange}</span>
<span style="background-color: #d4edda; color: #28a745;">+      onConnect={onConnect}</span>
<span style="background-color: #d4edda; color: #28a745;">+      className="react-flow-subflows-example"</span>
<span style="background-color: #d4edda; color: #28a745;">+      fitView</span>
<span style="background-color: #d4edda; color: #28a745;">+      onNodeClick={(node) => {</span>
<span style="background-color: #d4edda; color: #28a745;">+        console.log(node);</span>
<span style="background-color: #d4edda; color: #28a745;">+      }}</span>
<span style="background-color: #d4edda; color: #28a745;">+      nodeTypes={nodeTypes}</span>
<span style="background-color: #d4edda; color: #28a745;">+    ></span>
<span style="background-color: #d4edda; color: #28a745;">+      <MiniMap /></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Controls /></span>
<span style="background-color: #d4edda; color: #28a745;">+      <Background /></span>
<span style="background-color: #d4edda; color: #28a745;">+    </ReactFlow></span>
<span style="background-color: #d4edda; color: #28a745;">+  );</span>
<span style="background-color: #d4edda; color: #28a745;">+};</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+export default NestedFlow;</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/routes.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/routes.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 456fa084..801d77a9 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/routes.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/routes.ts</span>
@@ -246,6 +246,11 @@ const routes = [
},
],
},
<span style="background-color: #d4edda; color: #28a745;">+  {</span>
<span style="background-color: #d4edda; color: #28a745;">+    path: '/workflow',</span>
<span style="background-color: #d4edda; color: #28a745;">+    component: '@/pages/workflow',</span>
<span style="background-color: #d4edda; color: #28a745;">+    layout: false,</span>
<span style="background-color: #d4edda; color: #28a745;">+  },</span>
];

export default routes;
</code></pre>

<div id="a6f41537"></div>
<h2>a6f41537</h2>

<p><strong>Message:</strong> Update UI text (#4248)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit a6f4153775a24d268382d6c82b025d05adfe8f1d
Author: Jin Hai &lt;haijin.chn@gmail.com&gt;
Date:   Fri Dec 27 10:48:11 2024 +0800

Update UI text (#4248)

### What problem does this PR solve?

Update UI text

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Refactoring</span>

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---------</span>

Signed-off-by: jinhai &lt;haijin.chn@gmail.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index a2ed4d79..73ff766f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README.md</span>
@@ -32,7 +32,7 @@

&lt;h4 align=&quot;center&quot;&gt;
&lt;a href=&quot;https://ragflow.io/docs/dev/&quot;&gt;Document&lt;/a&gt; |
<span style="background-color: #f8d7da; color: #d73a49;">-  <a href="https://github.com/infiniflow/ragflow/issues/162">Roadmap</a> |</span>
<span style="background-color: #d4edda; color: #28a745;">+  <a href="https://github.com/infiniflow/ragflow/issues/4214">Roadmap</a> |</span>
&lt;a href=&quot;https://twitter.com/infiniflowai&quot;&gt;Twitter&lt;/a&gt; |
&lt;a href=&quot;https://discord.gg/4XxujFgUN7&quot;&gt;Discord&lt;/a&gt; |
&lt;a href=&quot;https://demo.ragflow.io&quot;&gt;Demo&lt;/a&gt;
@@ -339,7 +339,7 @@ docker build -f Dockerfile -t infiniflow/ragflow:nightly .

## 📜 Roadmap

<span style="background-color: #f8d7da; color: #d73a49;">-See the [RAGFlow Roadmap 2024](https://github.com/infiniflow/ragflow/issues/162)</span>
<span style="background-color: #d4edda; color: #28a745;">+See the [RAGFlow Roadmap 2025](https://github.com/infiniflow/ragflow/issues/4214)</span>

## 🏄 Community

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_id.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_id.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 617aac2a..daa32e43 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_id.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_id.md</span>
@@ -32,7 +32,7 @@

&lt;h4 align=&quot;center&quot;&gt;
&lt;a href=&quot;https://ragflow.io/docs/dev/&quot;&gt;Dokumentasi&lt;/a&gt; |
<span style="background-color: #f8d7da; color: #d73a49;">-  <a href="https://github.com/infiniflow/ragflow/issues/162">Peta Jalan</a> |</span>
<span style="background-color: #d4edda; color: #28a745;">+  <a href="https://github.com/infiniflow/ragflow/issues/4214">Peta Jalan</a> |</span>
&lt;a href=&quot;https://twitter.com/infiniflowai&quot;&gt;Twitter&lt;/a&gt; |
&lt;a href=&quot;https://discord.gg/4XxujFgUN7&quot;&gt;Discord&lt;/a&gt; |
&lt;a href=&quot;https://demo.ragflow.io&quot;&gt;Demo&lt;/a&gt;
@@ -308,7 +308,7 @@ docker build -f Dockerfile -t infiniflow/ragflow:nightly .

## 📜 Roadmap

<span style="background-color: #f8d7da; color: #d73a49;">-Lihat [Roadmap RAGFlow 2024](https://github.com/infiniflow/ragflow/issues/162)</span>
<span style="background-color: #d4edda; color: #28a745;">+Lihat [Roadmap RAGFlow 2025](https://github.com/infiniflow/ragflow/issues/4214)</span>

## 🏄 Komunitas

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_ja.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_ja.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index a81508f2..2cf83e3f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_ja.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_ja.md</span>
@@ -33,7 +33,7 @@

&lt;h4 align=&quot;center&quot;&gt;
&lt;a href=&quot;https://ragflow.io/docs/dev/&quot;&gt;Document&lt;/a&gt; |
<span style="background-color: #f8d7da; color: #d73a49;">-  <a href="https://github.com/infiniflow/ragflow/issues/162">Roadmap</a> |</span>
<span style="background-color: #d4edda; color: #28a745;">+  <a href="https://github.com/infiniflow/ragflow/issues/4214">Roadmap</a> |</span>
&lt;a href=&quot;https://twitter.com/infiniflowai&quot;&gt;Twitter&lt;/a&gt; |
&lt;a href=&quot;https://discord.gg/4XxujFgUN7&quot;&gt;Discord&lt;/a&gt; |
&lt;a href=&quot;https://demo.ragflow.io&quot;&gt;Demo&lt;/a&gt;
@@ -304,7 +304,7 @@ docker build -f Dockerfile -t infiniflow/ragflow:nightly .

## 📜 ロードマップ

<span style="background-color: #f8d7da; color: #d73a49;">-[RAGFlow ロードマップ 2024](https://github.com/infiniflow/ragflow/issues/162) を参照</span>
<span style="background-color: #d4edda; color: #28a745;">+[RAGFlow ロードマップ 2025](https://github.com/infiniflow/ragflow/issues/4214) を参照</span>

## 🏄 コミュニティ

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_ko.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_ko.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index b0a2b038..d2fd4bd3 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_ko.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_ko.md</span>
@@ -33,7 +33,7 @@

&lt;h4 align=&quot;center&quot;&gt;
&lt;a href=&quot;https://ragflow.io/docs/dev/&quot;&gt;Document&lt;/a&gt; |
<span style="background-color: #f8d7da; color: #d73a49;">-  <a href="https://github.com/infiniflow/ragflow/issues/162">Roadmap</a> |</span>
<span style="background-color: #d4edda; color: #28a745;">+  <a href="https://github.com/infiniflow/ragflow/issues/4214">Roadmap</a> |</span>
&lt;a href=&quot;https://twitter.com/infiniflowai&quot;&gt;Twitter&lt;/a&gt; |
&lt;a href=&quot;https://discord.gg/4XxujFgUN7&quot;&gt;Discord&lt;/a&gt; |
&lt;a href=&quot;https://demo.ragflow.io&quot;&gt;Demo&lt;/a&gt;
@@ -306,7 +306,7 @@ docker build -f Dockerfile -t infiniflow/ragflow:nightly .

## 📜 로드맵

<span style="background-color: #f8d7da; color: #d73a49;">-[RAGFlow 로드맵 2024](https://github.com/infiniflow/ragflow/issues/162)을 확인하세요.</span>
<span style="background-color: #d4edda; color: #28a745;">+[RAGFlow 로드맵 2025](https://github.com/infiniflow/ragflow/issues/4214)을 확인하세요.</span>

## 🏄 커뮤니티

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_zh.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_zh.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 9c2b8552..b6eb910e 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_zh.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_zh.md</span>
@@ -33,7 +33,7 @@

&lt;h4 align=&quot;center&quot;&gt;
&lt;a href=&quot;https://ragflow.io/docs/dev/&quot;&gt;Document&lt;/a&gt; |
<span style="background-color: #f8d7da; color: #d73a49;">-  <a href="https://github.com/infiniflow/ragflow/issues/162">Roadmap</a> |</span>
<span style="background-color: #d4edda; color: #28a745;">+  <a href="https://github.com/infiniflow/ragflow/issues/4214">Roadmap</a> |</span>
&lt;a href=&quot;https://twitter.com/infiniflowai&quot;&gt;Twitter&lt;/a&gt; |
&lt;a href=&quot;https://discord.gg/4XxujFgUN7&quot;&gt;Discord&lt;/a&gt; |
&lt;a href=&quot;https://demo.ragflow.io&quot;&gt;Demo&lt;/a&gt;
@@ -319,7 +319,7 @@ docker build --build-arg NEED_MIRROR=1 -f Dockerfile -t infiniflow/ragflow:night

## 📜 路线图

<span style="background-color: #f8d7da; color: #d73a49;">-详见 [RAGFlow Roadmap 2024](https://github.com/infiniflow/ragflow/issues/162) 。</span>
<span style="background-color: #d4edda; color: #28a745;">+详见 [RAGFlow Roadmap 2025](https://github.com/infiniflow/ragflow/issues/4214) 。</span>

## 🏄 开源社区

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/en.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/en.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 8fb3fa94..f37fe951 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/en.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/en.ts</span>
@@ -114,12 +114,12 @@ export default {
testText: '#39;Test text'#39;,
testTextPlaceholder: '#39;Input your question here!'#39;,
testingLabel: '#39;Testing'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      similarity: 'Hybrid Similarity',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      termSimilarity: 'Term Similarity',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      vectorSimilarity: 'Vector Similarity',</span>
<span style="background-color: #d4edda; color: #28a745;">+      similarity: 'Hybrid similarity',</span>
<span style="background-color: #d4edda; color: #28a745;">+      termSimilarity: 'Term similarity',</span>
<span style="background-color: #d4edda; color: #28a745;">+      vectorSimilarity: 'Vector similarity',</span>
hits: '#39;Hits'#39;,
view: '#39;View'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      filesSelected: 'Files Selected',</span>
<span style="background-color: #d4edda; color: #28a745;">+      filesSelected: 'Files selected',</span>
upload: '#39;Upload'#39;,
run: '#39;Parse'#39;,
runningStatus0: '#39;UNParsed'#39;,
@@ -305,7 +305,7 @@ The above is the content you need to summarize.`,
randomSeed: '#39;Random seed'#39;,
randomSeedMessage: '#39;Random seed is required'#39;,
entityTypes: '#39;Entity types'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      vietnamese: 'Vietamese',</span>
<span style="background-color: #d4edda; color: #28a745;">+      vietnamese: 'Vietnamese',</span>
pageRank: '#39;Page rank'#39;,
pageRankTip: `This increases the relevance score of the knowledge base. Its value will be added to the relevance score of all retrieved chunks from this knowledge base. Useful when you are searching within multiple knowledge bases and wanting to assign a higher pagerank score to a specific one.`,
},
@@ -313,9 +313,9 @@ The above is the content you need to summarize.`,
chunk: '#39;Chunk'#39;,
bulk: '#39;Bulk'#39;,
selectAll: '#39;Select All'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      enabledSelected: 'Enable Selected',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      disabledSelected: 'Disable Selected',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      deleteSelected: 'Delete Selected',</span>
<span style="background-color: #d4edda; color: #28a745;">+      enabledSelected: 'Enable selected',</span>
<span style="background-color: #d4edda; color: #28a745;">+      disabledSelected: 'Disable selected',</span>
<span style="background-color: #d4edda; color: #28a745;">+      deleteSelected: 'Delete selected',</span>
search: '#39;Search'#39;,
all: '#39;All'#39;,
enabled: '#39;Enabled'#39;,
@@ -567,8 +567,8 @@ The above is the content you need to summarize.`,
SparkModelNameMessage: '#39;Please select Spark model'#39;,
addSparkAPIPassword: '#39;Spark APIPassword'#39;,
SparkAPIPasswordMessage: '#39;please input your APIPassword'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      addSparkAPPID: 'Spark APPID',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      SparkAPPIDMessage: 'please input your APPID',</span>
<span style="background-color: #d4edda; color: #28a745;">+      addSparkAPPID: 'Spark APP ID',</span>
<span style="background-color: #d4edda; color: #28a745;">+      SparkAPPIDMessage: 'please input your APP ID',</span>
addSparkAPISecret: '#39;Spark APISecret'#39;,
SparkAPISecretMessage: '#39;please input your APISecret'#39;,
addSparkAPIKey: '#39;Spark APIKey'#39;,
@@ -582,7 +582,7 @@ The above is the content you need to summarize.`,
'#39;Please give your speech synthesis model a name'#39;,
addFishAudioAK: '#39;Fish Audio API KEY'#39;,
addFishAudioAKMessage: '#39;Please input your API KEY'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      addFishAudioRefID: 'FishAudio Refrence ID',</span>
<span style="background-color: #d4edda; color: #28a745;">+      addFishAudioRefID: 'FishAudio Reference ID',</span>
addFishAudioRefIDMessage:
'#39;Please input the Reference ID (leave blank to use the default model).'#39;,
GoogleModelIDMessage: '#39;Please input your model ID!'#39;,
@@ -724,7 +724,7 @@ The above is the content you need to summarize.`,
nameRequiredMsg: '#39;Name is required'#39;,
nameRepeatedMsg: '#39;The name cannot be repeated'#39;,
keywordExtract: '#39;Keyword'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      keywordExtractDescription: `A component that extracts keywords from a user query, with Top N specifing the number of keywords to extract.`,</span>
<span style="background-color: #d4edda; color: #28a745;">+      keywordExtractDescription: `A component that extracts keywords from a user query, with Top N specifying the number of keywords to extract.`,</span>
baidu: '#39;Baidu'#39;,
baiduDescription: `A component that searches from baidu.com, using TopN to specify the number of search results. It supplements the existing knowledge bases.`,
duckDuckGo: '#39;DuckDuckGo'#39;,
@@ -779,7 +779,7 @@ The above is the content you need to summarize.`,
baiduFanyi: '#39;BaiduFanyi'#39;,
baiduFanyiDescription:
'#39;A component that gets specialized translations from https://fanyi.baidu.com/.'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      appid: 'App id',</span>
<span style="background-color: #d4edda; color: #28a745;">+      appid: 'App ID',</span>
secretKey: '#39;Secret key'#39;,
domain: '#39;Domain'#39;,
transType: '#39;Translation type'#39;,
</code></pre>

<div id="097aab09"></div>
<h2>097aab09</h2>

<p><strong>Message:</strong> Replace image2text model check with internal image. (#4250)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 097aab09a21508940a2c93126d775e5946f2d94e
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Thu Dec 26 19:46:42 2024 +0800

Replace image2text model check with internal image. (#4250)

### What problem does this PR solve?

#4243

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/llm_app.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/llm_app.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 5053aebc..494854dd 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/llm_app.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/llm_app.py</span>
@@ -15,7 +15,7 @@
#
import logging
import json
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #d4edda; color: #28a745;">+import os</span>
from flask import request
from flask_login import login_required, current_user
from api.db.services.llm_service import LLMFactoriesService, TenantLLMService, LLMService
@@ -24,8 +24,8 @@ from api.utils.api_utils import server_error_response, get_data_error_result, va
from api.db import StatusEnum, LLMType
from api.db.db_models import TenantLLM
from api.utils.api_utils import get_json_result
<span style="background-color: #d4edda; color: #28a745;">+from api.utils.file_utils import get_project_base_directory</span>
from rag.llm import EmbeddingModel, ChatModel, RerankModel, CvModel, TTSModel
<span style="background-color: #f8d7da; color: #d73a49;">-import requests</span>


@manager.route('#39;/factories'#39;, methods=['#39;GET'#39;])  # noqa: F821
@@ -254,16 +254,10 @@ def add_llm():
base_url=llm[&quot;api_base&quot;]
)
try:
<span style="background-color: #f8d7da; color: #d73a49;">-            img_url = (</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                "https://www.8848seo.cn/zb_users/upload/2022/07/20220705101240_99378.jpg"</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            )</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            res = requests.get(img_url)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            if res.status_code == 200:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                m, tc = mdl.describe(res.content)</span>
<span style="background-color: #d4edda; color: #28a745;">+            with open(os.path.join(get_project_base_directory(), "web/src/assets/yay.jpg"), "rb") as f:</span>
<span style="background-color: #d4edda; color: #28a745;">+                m, tc = mdl.describe(f.read())</span>
if not tc:
raise Exception(m)
<span style="background-color: #f8d7da; color: #d73a49;">-            else:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                pass</span>
except Exception as e:
msg += f&quot;\nFail to access model({llm['#39;llm_name'#39;]}).&quot; + str(e)
elif llm[&quot;model_type&quot;] == LLMType.TTS:
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/utils/api_utils.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/utils/api_utils.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 062cf9e5..f4e9e176 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/utils/api_utils.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/utils/api_utils.py</span>
@@ -98,14 +98,9 @@ def get_exponential_backoff_interval(retries, full_jitter=False):

def get_data_error_result(code=settings.RetCode.DATA_ERROR,
message='#39;Sorry! Data missing!'#39;):
<span style="background-color: #f8d7da; color: #d73a49;">-    import re</span>
result_dict = {
&quot;code&quot;: code,
<span style="background-color: #f8d7da; color: #d73a49;">-        "message": re.sub(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            r"rag",</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "seceum",</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            message,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            flags=re.IGNORECASE)}</span>
<span style="background-color: #d4edda; color: #28a745;">+        "message": message}</span>
response = {}
for key, value in result_dict.items():
if value is None and key != &quot;code&quot;:
@@ -250,8 +245,7 @@ def construct_response(code=settings.RetCode.SUCCESS,


def construct_result(code=settings.RetCode.DATA_ERROR, message='#39;data is missing'#39;):
<span style="background-color: #f8d7da; color: #d73a49;">-    import re</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    result_dict = {"code": code, "message": re.sub(r"rag", "seceum", message, flags=re.IGNORECASE)}</span>
<span style="background-color: #d4edda; color: #28a745;">+    result_dict = {"code": code, "message": message}</span>
response = {}
for key, value in result_dict.items():
if value is None and key != &quot;code&quot;:
@@ -314,14 +308,9 @@ def get_result(code=settings.RetCode.SUCCESS, message=&quot;&quot;, data=None):

def get_error_data_result(message='#39;Sorry! Data missing!'#39;, code=settings.RetCode.DATA_ERROR,
):
<span style="background-color: #f8d7da; color: #d73a49;">-    import re</span>
result_dict = {
&quot;code&quot;: code,
<span style="background-color: #f8d7da; color: #d73a49;">-        "message": re.sub(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            r"rag",</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "seceum",</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            message,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            flags=re.IGNORECASE)}</span>
<span style="background-color: #d4edda; color: #28a745;">+        "message": message}</span>
response = {}
for key, value in result_dict.items():
if value is None and key != &quot;code&quot;:
</code></pre>

<div id="600f435d"></div>
<h2>600f435d</h2>

<p><strong>Message:</strong> Fix text (#4244)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 600f435d27c6c224ced9d2998177d0ec1148d6fe
Author: Jin Hai &lt;haijin.chn@gmail.com&gt;
Date:   Thu Dec 26 17:03:48 2024 +0800

Fix text (#4244)

### What problem does this PR solve?

Fix frontend text

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Refactoring</span>

Signed-off-by: jinhai &lt;haijin.chn@gmail.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/locales/en.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/locales/en.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 70012055..8fb3fa94 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/locales/en.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/locales/en.ts</span>
@@ -33,7 +33,7 @@ export default {
pleaseSelect: '#39;Please select'#39;,
pleaseInput: '#39;Please input'#39;,
submit: '#39;Submit'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      embedIntoSite: 'Embed Into Site',</span>
<span style="background-color: #d4edda; color: #28a745;">+      embedIntoSite: 'Embed into webpage',</span>
},
login: {
login: '#39;Sign in'#39;,
@@ -422,15 +422,16 @@ The above is the content you need to summarize.`,
createNewKey: '#39;Create new key'#39;,
created: '#39;Created'#39;,
action: '#39;Action'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      embedModalTitle: 'Embed into website',</span>
<span style="background-color: #d4edda; color: #28a745;">+      embedModalTitle: 'Embed into webpage',</span>
comingSoon: '#39;Coming Soon'#39;,
fullScreenTitle: '#39;Full Embed'#39;,
fullScreenDescription:
'#39;Embed the following iframe into your website at the desired location'#39;,
partialTitle: '#39;Partial Embed'#39;,
extensionTitle: '#39;Chrome Extension'#39;,
<span style="background-color: #f8d7da; color: #d73a49;">-      tokenError: 'Please create API Token first!',</span>
<span style="background-color: #f8d7da; color: #d73a49;">-      betaError: 'Please acquire a RAGFlow API key from the System Settings page first.',</span>
<span style="background-color: #d4edda; color: #28a745;">+      tokenError: 'Please create API key first.',</span>
<span style="background-color: #d4edda; color: #28a745;">+      betaError:</span>
<span style="background-color: #d4edda; color: #28a745;">+        'Please acquire a RAGFlow API key from the System Settings page first.',</span>
searching: '#39;Searching...'#39;,
parsing: '#39;Parsing'#39;,
uploading: '#39;Uploading'#39;,
</code></pre>

<div id="722545e5"></div>
<h2>722545e5</h2>

<p><strong>Message:</strong> Fix bugs (#4241)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 722545e5e043b83f9a956909cdaa4878915166f8
Author: Jin Hai &lt;haijin.chn@gmail.com&gt;
Date:   Thu Dec 26 16:08:17 2024 +0800

Fix bugs (#4241)

### What problem does this PR solve?

1. Refactor error message
2. Fix knowledges are created on ES and can'#39;t be found in Infinity. The
document chunk fetch error.

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Fix bug</span>
<span style="background-color: #f8d7da; color: #d73a49;">- [x] Refactoring</span>

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---------</span>

Signed-off-by: jinhai &lt;haijin.chn@gmail.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/api_app.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/api_app.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index b38c62f8..095c5b23 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/api_app.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/api_app.py</span>
@@ -141,7 +141,7 @@ def set_conversation():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
try:
if objs[0].source == &quot;agent&quot;:
e, cvs = UserCanvasService.get_by_id(objs[0].dialog_id)
@@ -182,7 +182,7 @@ def completion():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
req = request.json
e, conv = API4ConversationService.get_by_id(req[&quot;conversation_id&quot;])
if not e:
@@ -348,7 +348,7 @@ def get(conversation_id):
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

try:
e, conv = API4ConversationService.get_by_id(conversation_id)
@@ -357,7 +357,7 @@ def get(conversation_id):

conv = conv.to_dict()
if token != APIToken.query(dialog_id=conv['#39;dialog_id'#39;])[0].token:
<span style="background-color: #f8d7da; color: #d73a49;">-            return get_json_result(data=False, message='Token is not valid for this conversation_id!"',</span>
<span style="background-color: #d4edda; color: #28a745;">+            return get_json_result(data=False, message='Authentication error: API key is invalid for this conversation_id!"',</span>
code=settings.RetCode.AUTHENTICATION_ERROR)

for referenct_i in conv['#39;reference'#39;]:
@@ -379,7 +379,7 @@ def upload():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

kb_name = request.form.get(&quot;kb_name&quot;).strip()
tenant_id = objs[0].tenant_id
@@ -491,7 +491,7 @@ def upload_parse():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

if '#39;file'#39; not in request.files:
return get_json_result(
@@ -514,7 +514,7 @@ def list_chunks():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

req = request.json

@@ -554,7 +554,7 @@ def list_kb_docs():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

req = request.json
tenant_id = objs[0].tenant_id
@@ -594,7 +594,7 @@ def docinfos():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
req = request.json
doc_ids = req[&quot;doc_ids&quot;]
docs = DocumentService.get_by_ids(doc_ids)
@@ -608,7 +608,7 @@ def document_rm():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

tenant_id = objs[0].tenant_id
req = request.json
@@ -670,7 +670,7 @@ def completion_faq():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

e, conv = API4ConversationService.get_by_id(req[&quot;conversation_id&quot;])
if not e:
@@ -809,7 +809,7 @@ def retrieval():
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-            data=False, message='Token is not valid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>
<span style="background-color: #d4edda; color: #28a745;">+            data=False, message='Authentication error: API key is invalid!"', code=settings.RetCode.AUTHENTICATION_ERROR)</span>

req = request.json
kb_ids = req.get(&quot;kb_id&quot;, [])
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/canvas_app.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/canvas_app.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 335570c1..bd4ae2b7 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/canvas_app.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/canvas_app.py</span>
@@ -94,7 +94,7 @@ def getsse(canvas_id):
token = token[1]
objs = APIToken.query(beta=token)
if not objs:
<span style="background-color: #f8d7da; color: #d73a49;">-        return get_data_error_result(message='Token is not valid!"')</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_data_error_result(message='Authentication error: API key is invalid!"')</span>
e, c = UserCanvasService.get_by_id(canvas_id)
if not e:
return get_data_error_result(message=&quot;canvas not found.&quot;)
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/conversation_app.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/conversation_app.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index dd7090e2..222a3179 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/conversation_app.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/conversation_app.py</span>
@@ -126,7 +126,7 @@ def getsse(dialog_id):
token = token[1]
objs = APIToken.query(beta=token)
if not objs:
<span style="background-color: #f8d7da; color: #d73a49;">-        return get_data_error_result(message='Token is not valid!"')</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_data_error_result(message='Authentication error: API key is invalid!"')</span>
try:
e, conv = DialogService.get_by_id(dialog_id)
if not e:
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/sdk/session.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/sdk/session.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index db00d95b..6c89dc99 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/sdk/session.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/sdk/session.py</span>
@@ -405,7 +405,7 @@ def chatbot_completions(dialog_id):
token = token[1]
objs = APIToken.query(beta=token)
if not objs:
<span style="background-color: #f8d7da; color: #d73a49;">-        return get_error_data_result(message='Token is not valid!"')</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_error_data_result(message='Authentication error: API key is invalid!"')</span>

if &quot;quote&quot; not in req:
req[&quot;quote&quot;] = False
@@ -432,7 +432,7 @@ def agent_bot_completions(agent_id):
token = token[1]
objs = APIToken.query(beta=token)
if not objs:
<span style="background-color: #f8d7da; color: #d73a49;">-        return get_error_data_result(message='Token is not valid!"')</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_error_data_result(message='Authentication error: API key is invalid!"')</span>

if &quot;quote&quot; not in req:
req[&quot;quote&quot;] = False
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/utils/api_utils.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/utils/api_utils.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 2b9fcff4..062cf9e5 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/utils/api_utils.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/utils/api_utils.py</span>
@@ -293,7 +293,7 @@ def token_required(func):
objs = APIToken.query(token=token)
if not objs:
return get_json_result(
<span style="background-color: #f8d7da; color: #d73a49;">-                data=False, message='Token is not valid!', code=settings.RetCode.AUTHENTICATION_ERROR</span>
<span style="background-color: #d4edda; color: #28a745;">+                data=False, message='Authentication error: API key is invalid!', code=settings.RetCode.AUTHENTICATION_ERROR</span>
)
kwargs['#39;tenant_id'#39;] = objs[0].tenant_id
return func(*args, **kwargs)
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/rag/utils/infinity_conn.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/rag/utils/infinity_conn.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index d5b17529..034e5378 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/rag/utils/infinity_conn.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/rag/utils/infinity_conn.py</span>
@@ -26,7 +26,8 @@ from rag.utils.doc_store_conn import (

logger = logging.getLogger('#39;ragflow.infinity_conn'#39;)

<span style="background-color: #f8d7da; color: #d73a49;">-def equivalent_condition_to_str(condition: dict) -> str|None:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+def equivalent_condition_to_str(condition: dict) -> str | None:</span>
assert &quot;_id&quot; not in condition
cond = list()
for k, v in condition.items():
@@ -59,12 +60,13 @@ def concat_dataframes(df_list: list[pl.DataFrame], selectFields: list[str]) -&gt; p
return pl.concat(df_list)
schema = dict()
for field_name in selectFields:
<span style="background-color: #f8d7da; color: #d73a49;">-        if field_name == 'score()': # Workaround: fix schema is changed to score()</span>
<span style="background-color: #d4edda; color: #28a745;">+        if field_name == 'score()':  # Workaround: fix schema is changed to score()</span>
schema['#39;SCORE'#39;] = str
else:
schema[field_name] = str
return pl.DataFrame(schema=schema)

<span style="background-color: #d4edda; color: #28a745;">+</span>
@singleton
class InfinityConnection(DocStoreConnection):
def __init__(self):
@@ -80,7 +82,7 @@ class InfinityConnection(DocStoreConnection):
connPool = ConnectionPool(infinity_uri)
inf_conn = connPool.get_conn()
res = inf_conn.show_current_node()
<span style="background-color: #f8d7da; color: #d73a49;">-                if res.error_code == ErrorCode.OK and res.server_status=="started":</span>
<span style="background-color: #d4edda; color: #28a745;">+                if res.error_code == ErrorCode.OK and res.server_status == "started":</span>
self._migrate_db(inf_conn)
self.connPool = connPool
connPool.release_conn(inf_conn)
@@ -360,7 +362,13 @@ class InfinityConnection(DocStoreConnection):
for knowledgebaseId in knowledgebaseIds:
table_name = f&quot;{indexName}_{knowledgebaseId}&quot;
table_list.append(table_name)
<span style="background-color: #f8d7da; color: #d73a49;">-            table_instance = db_instance.get_table(table_name)</span>
<span style="background-color: #d4edda; color: #28a745;">+            table_instance = None</span>
<span style="background-color: #d4edda; color: #28a745;">+            try:</span>
<span style="background-color: #d4edda; color: #28a745;">+                table_instance = db_instance.get_table(table_name)</span>
<span style="background-color: #d4edda; color: #28a745;">+            except Exception:</span>
<span style="background-color: #d4edda; color: #28a745;">+                logger.warning(</span>
<span style="background-color: #d4edda; color: #28a745;">+                    f"Table not found: {table_name}, this knowledge base isn't created in Infinity. Maybe it is created in other document engine.")</span>
<span style="background-color: #d4edda; color: #28a745;">+                continue</span>
kb_res, _ = table_instance.output([&quot;*&quot;]).filter(f&quot;id = '#39;{chunkId}'#39;&quot;).to_pl()
logger.debug(f&quot;INFINITY get table: {str(table_list)}, result: {str(kb_res)}&quot;)
df_list.append(kb_res)
@@ -403,7 +411,7 @@ class InfinityConnection(DocStoreConnection):
d[k] = &quot;###&quot;.join(v)
elif k == '#39;kb_id'#39;:
if isinstance(d[k], list):
<span style="background-color: #f8d7da; color: #d73a49;">-                        d[k] = d[k][0] # since d[k] is a list, but we need a str</span>
<span style="background-color: #d4edda; color: #28a745;">+                        d[k] = d[k][0]  # since d[k] is a list, but we need a str</span>
elif k == &quot;position_int&quot;:
assert isinstance(v, list)
arr = [num for row in v for num in row]
@@ -440,7 +448,7 @@ class InfinityConnection(DocStoreConnection):
newValue[k] = &quot; &quot;.join(v)
elif k == '#39;kb_id'#39;:
if isinstance(newValue[k], list):
<span style="background-color: #f8d7da; color: #d73a49;">-                    newValue[k] = newValue[k][0] # since d[k] is a list, but we need a str</span>
<span style="background-color: #d4edda; color: #28a745;">+                    newValue[k] = newValue[k][0]  # since d[k] is a list, but we need a str</span>
elif k == &quot;position_int&quot;:
assert isinstance(v, list)
arr = [num for row in v for num in row]
</code></pre>

<div id="9fa73771"></div>
<h2>9fa73771</h2>

<p><strong>Message:</strong> Fixed invoke component parameters #4236 (#4237)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 9fa73771eefa6d751ffe52ad44cc07595818a086
Author: Hayden Zhou &lt;gegef2009@qq.com&gt;
Date:   Thu Dec 26 16:06:19 2024 +0800

Fixed invoke component parameters #4236 (#4237)

### What problem does this PR solve?

to fixed issue https://github.com/infiniflow/ragflow/issues/4236

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/invoke.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/invoke.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 9b9053f5..a8be31f6 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/invoke.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/invoke.py</span>
@@ -57,7 +57,7 @@ class Invoke(ComponentBase, ABC):
_, out = cpn.output(allow_partial=False)
args[para[&quot;key&quot;]] = &quot;\n&quot;.join(out[&quot;content&quot;])
else:
<span style="background-color: #f8d7da; color: #d73a49;">-                args[para["key"]] = "\n".join(para["value"])</span>
<span style="background-color: #d4edda; color: #28a745;">+                args[para["key"]] = para["value"]</span>

url = self._param.url.strip()
if url.find(&quot;http&quot;) != 0:
</code></pre>

<div id="fe279754"></div>
<h2>fe279754</h2>

<p><strong>Message:</strong> Update version info (#4232)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit fe279754ace6d44598d9051099b9ac0db58599fa
Author: Jin Hai &lt;haijin.chn@gmail.com&gt;
Date:   Thu Dec 26 12:15:28 2024 +0800

Update version info (#4232)

### What problem does this PR solve?

Update version info to 0.15.1

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

Signed-off-by: Jin Hai &lt;haijin.chn@gmail.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 791208c8..a2ed4d79 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README.md</span>
@@ -20,7 +20,7 @@
&lt;img alt=&quot;Static Badge&quot; src=&quot;https://img.shields.io/badge/Online-Demo-4e6b99&quot;&gt;
&lt;/a&gt;
&lt;a href=&quot;https://hub.docker.com/r/infiniflow/ragflow&quot; target=&quot;_blank&quot;&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.0-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.0"></span>
<span style="background-color: #d4edda; color: #28a745;">+        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.1-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.1"></span>
&lt;/a&gt;
&lt;a href=&quot;https://github.com/infiniflow/ragflow/releases/latest&quot;&gt;
&lt;img src=&quot;https://img.shields.io/github/v/release/infiniflow/ragflow?color=blue&amp;label=Latest%20Release&quot; alt=&quot;Latest Release&quot;&gt;
@@ -168,7 +168,7 @@ releases! 🌟

3. Start up the server using the pre-built Docker images:

<span style="background-color: #f8d7da; color: #d73a49;">-   > The command below downloads the `v0.15.0-slim` edition of the RAGFlow Docker image. Refer to the following table for descriptions of different RAGFlow editions. To download an RAGFlow edition different from `v0.15.0-slim`, update the `RAGFLOW_IMAGE` variable accordingly in **docker/.env** before using `docker compose` to start the server. For example: set `RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0` for the full edition `v0.15.0`.</span>
<span style="background-color: #d4edda; color: #28a745;">+   > The command below downloads the `v0.15.1-slim` edition of the RAGFlow Docker image. Refer to the following table for descriptions of different RAGFlow editions. To download an RAGFlow edition different from `v0.15.1-slim`, update the `RAGFLOW_IMAGE` variable accordingly in **docker/.env** before using `docker compose` to start the server. For example: set `RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1` for the full edition `v0.15.1`.</span>

```bash
$ cd ragflow
@@ -177,8 +177,8 @@ releases! 🌟

| RAGFlow image tag | Image size (GB) | Has embedding models? | Stable?                  |
| ----------------- | --------------- | --------------------- | ------------------------ |
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0-slim      | &approx;2       | ❌                    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1-slim      | &approx;2       | ❌                    | Stable release           |</span>
| nightly           | &amp;approx;9       | :heavy_check_mark:    | *Unstable* nightly build |
| nightly-slim      | &amp;approx;2       | ❌                    | *Unstable* nightly build |

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_id.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_id.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 0aa81f51..617aac2a 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_id.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_id.md</span>
@@ -20,7 +20,7 @@
&lt;img alt=&quot;Lencana Daring&quot; src=&quot;https://img.shields.io/badge/Online-Demo-4e6b99&quot;&gt;
&lt;/a&gt;
&lt;a href=&quot;https://hub.docker.com/r/infiniflow/ragflow&quot; target=&quot;_blank&quot;&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.0-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.0"></span>
<span style="background-color: #d4edda; color: #28a745;">+        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.1-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.1"></span>
&lt;/a&gt;
&lt;a href=&quot;https://github.com/infiniflow/ragflow/releases/latest&quot;&gt;
&lt;img src=&quot;https://img.shields.io/github/v/release/infiniflow/ragflow?color=blue&amp;label=Rilis%20Terbaru&quot; alt=&quot;Rilis Terbaru&quot;&gt;
@@ -161,7 +161,7 @@ Coba demo kami di [https://demo.ragflow.io](https://demo.ragflow.io).

3. Bangun image Docker pre-built dan jalankan server:

<span style="background-color: #f8d7da; color: #d73a49;">-   > Perintah di bawah ini mengunduh edisi v0.15.0-slim dari gambar Docker RAGFlow. Silakan merujuk ke tabel berikut untuk deskripsi berbagai edisi RAGFlow. Untuk mengunduh edisi RAGFlow yang berbeda dari v0.15.0-slim, perbarui variabel RAGFLOW_IMAGE di docker/.env sebelum menggunakan docker compose untuk memulai server. Misalnya, atur RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0 untuk edisi lengkap v0.15.0.</span>
<span style="background-color: #d4edda; color: #28a745;">+   > Perintah di bawah ini mengunduh edisi v0.15.1-slim dari gambar Docker RAGFlow. Silakan merujuk ke tabel berikut untuk deskripsi berbagai edisi RAGFlow. Untuk mengunduh edisi RAGFlow yang berbeda dari v0.15.1-slim, perbarui variabel RAGFLOW_IMAGE di docker/.env sebelum menggunakan docker compose untuk memulai server. Misalnya, atur RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1 untuk edisi lengkap v0.15.1.</span>

```bash
$ cd ragflow
@@ -170,8 +170,8 @@ Coba demo kami di [https://demo.ragflow.io](https://demo.ragflow.io).

| RAGFlow image tag | Image size (GB) | Has embedding models? | Stable?                  |
| ----------------- | --------------- | --------------------- | ------------------------ |
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0-slim      | &approx;2       | ❌                    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1-slim      | &approx;2       | ❌                    | Stable release           |</span>
| nightly           | &amp;approx;9       | :heavy_check_mark:    | *Unstable* nightly build |
| nightly-slim      | &amp;approx;2       | ❌                    | *Unstable* nightly build |

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_ja.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_ja.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f01c2cd8..a81508f2 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_ja.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_ja.md</span>
@@ -20,7 +20,7 @@
&lt;img alt=&quot;Static Badge&quot; src=&quot;https://img.shields.io/badge/Online-Demo-4e6b99&quot;&gt;
&lt;/a&gt;
&lt;a href=&quot;https://hub.docker.com/r/infiniflow/ragflow&quot; target=&quot;_blank&quot;&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.0-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.0"></span>
<span style="background-color: #d4edda; color: #28a745;">+        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.1-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.1"></span>
&lt;/a&gt;
&lt;a href=&quot;https://github.com/infiniflow/ragflow/releases/latest&quot;&gt;
&lt;img src=&quot;https://img.shields.io/github/v/release/infiniflow/ragflow?color=blue&amp;label=Latest%20Release&quot; alt=&quot;Latest Release&quot;&gt;
@@ -142,7 +142,7 @@

3. ビルド済みの Docker イメージをビルドし、サーバーを起動する:

<span style="background-color: #f8d7da; color: #d73a49;">-   > 以下のコマンドは、RAGFlow Dockerイメージの v0.15.0-slim エディションをダウンロードします。異なる RAGFlow エディションの説明については、以下の表を参照してください。v0.15.0-slim とは異なるエディションをダウンロードするには、docker/.env ファイルの RAGFLOW_IMAGE 変数を適宜更新し、docker compose を使用してサーバーを起動してください。例えば、完全版 v0.15.0 をダウンロードするには、RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0 と設定します。</span>
<span style="background-color: #d4edda; color: #28a745;">+   > 以下のコマンドは、RAGFlow Dockerイメージの v0.15.1-slim エディションをダウンロードします。異なる RAGFlow エディションの説明については、以下の表を参照してください。v0.15.1-slim とは異なるエディションをダウンロードするには、docker/.env ファイルの RAGFLOW_IMAGE 変数を適宜更新し、docker compose を使用してサーバーを起動してください。例えば、完全版 v0.15.1 をダウンロードするには、RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1 と設定します。</span>

```bash
$ cd ragflow
@@ -151,8 +151,8 @@

| RAGFlow image tag | Image size (GB) | Has embedding models? | Stable?                  |
| ----------------- | --------------- | --------------------- | ------------------------ |
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0          | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0-slim      | &approx;2       | ❌                    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1          | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1-slim      | &approx;2       | ❌                    | Stable release           |</span>
| nightly           | &amp;approx;9       | :heavy_check_mark:    | *Unstable* nightly build |
| nightly-slim      | &amp;approx;2       | ❌                    | *Unstable* nightly build |

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_ko.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_ko.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 88ba88b2..b0a2b038 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_ko.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_ko.md</span>
@@ -20,7 +20,7 @@
&lt;img alt=&quot;Static Badge&quot; src=&quot;https://img.shields.io/badge/Online-Demo-4e6b99&quot;&gt;
&lt;/a&gt;
&lt;a href=&quot;https://hub.docker.com/r/infiniflow/ragflow&quot; target=&quot;_blank&quot;&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.0-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.0"></span>
<span style="background-color: #d4edda; color: #28a745;">+        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.1-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.1"></span>
&lt;/a&gt;
&lt;a href=&quot;https://github.com/infiniflow/ragflow/releases/latest&quot;&gt;
&lt;img src=&quot;https://img.shields.io/github/v/release/infiniflow/ragflow?color=blue&amp;label=Latest%20Release&quot; alt=&quot;Latest Release&quot;&gt;
@@ -147,7 +147,7 @@

3. 미리 빌드된 Docker 이미지를 생성하고 서버를 시작하세요:

<span style="background-color: #f8d7da; color: #d73a49;">-   > 아래 명령어는 RAGFlow Docker 이미지의 v0.15.0-slim 버전을 다운로드합니다. 다양한 RAGFlow 버전에 대한 설명은 다음 표를 참조하십시오. v0.15.0-slim과 다른 RAGFlow 버전을 다운로드하려면, docker/.env 파일에서 RAGFLOW_IMAGE 변수를 적절히 업데이트한 후 docker compose를 사용하여 서버를 시작하십시오. 예를 들어, 전체 버전인 v0.15.0을 다운로드하려면 RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0로 설정합니다.</span>
<span style="background-color: #d4edda; color: #28a745;">+   > 아래 명령어는 RAGFlow Docker 이미지의 v0.15.1-slim 버전을 다운로드합니다. 다양한 RAGFlow 버전에 대한 설명은 다음 표를 참조하십시오. v0.15.1-slim과 다른 RAGFlow 버전을 다운로드하려면, docker/.env 파일에서 RAGFLOW_IMAGE 변수를 적절히 업데이트한 후 docker compose를 사용하여 서버를 시작하십시오. 예를 들어, 전체 버전인 v0.15.1을 다운로드하려면 RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1로 설정합니다.</span>

```bash
$ cd ragflow
@@ -156,8 +156,8 @@

| RAGFlow image tag | Image size (GB) | Has embedding models? | Stable?                  |
| ----------------- | --------------- | --------------------- | ------------------------ |
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0-slim      | &approx;2       | ❌                    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1-slim      | &approx;2       | ❌                    | Stable release           |</span>
| nightly           | &amp;approx;9       | :heavy_check_mark:    | *Unstable* nightly build |
| nightly-slim      | &amp;approx;2       | ❌                    | *Unstable* nightly build |

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/README_zh.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/README_zh.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 9284a67c..9c2b8552 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/README_zh.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/README_zh.md</span>
@@ -20,7 +20,7 @@
&lt;img alt=&quot;Static Badge&quot; src=&quot;https://img.shields.io/badge/Online-Demo-4e6b99&quot;&gt;
&lt;/a&gt;
&lt;a href=&quot;https://hub.docker.com/r/infiniflow/ragflow&quot; target=&quot;_blank&quot;&gt;
<span style="background-color: #f8d7da; color: #d73a49;">-        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.0-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.0"></span>
<span style="background-color: #d4edda; color: #28a745;">+        <img src="https://img.shields.io/badge/docker_pull-ragflow:v0.15.1-brightgreen" alt="docker pull infiniflow/ragflow:v0.15.1"></span>
&lt;/a&gt;
&lt;a href=&quot;https://github.com/infiniflow/ragflow/releases/latest&quot;&gt;
&lt;img src=&quot;https://img.shields.io/github/v/release/infiniflow/ragflow?color=blue&amp;label=Latest%20Release&quot; alt=&quot;Latest Release&quot;&gt;
@@ -143,7 +143,7 @@

3. 进入 **docker** 文件夹，利用提前编译好的 Docker 镜像启动服务器：

<span style="background-color: #f8d7da; color: #d73a49;">-   > 运行以下命令会自动下载 RAGFlow slim Docker 镜像 `v0.15.0-slim`。请参考下表查看不同 Docker 发行版的描述。如需下载不同于 `v0.15.0-slim` 的 Docker 镜像，请在运行 `docker compose` 启动服务之前先更新 **docker/.env** 文件内的 `RAGFLOW_IMAGE` 变量。比如，你可以通过设置 `RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0` 来下载 RAGFlow 镜像的 `v0.15.0` 完整发行版。</span>
<span style="background-color: #d4edda; color: #28a745;">+   > 运行以下命令会自动下载 RAGFlow slim Docker 镜像 `v0.15.1-slim`。请参考下表查看不同 Docker 发行版的描述。如需下载不同于 `v0.15.1-slim` 的 Docker 镜像，请在运行 `docker compose` 启动服务之前先更新 **docker/.env** 文件内的 `RAGFLOW_IMAGE` 变量。比如，你可以通过设置 `RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1` 来下载 RAGFlow 镜像的 `v0.15.1` 完整发行版。</span>

```bash
$ cd ragflow
@@ -152,8 +152,8 @@

| RAGFlow image tag | Image size (GB) | Has embedding models? | Stable?                  |
| ----------------- | --------------- | --------------------- | ------------------------ |
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #f8d7da; color: #d73a49;">-   | v0.15.0-slim      | &approx;2       | ❌                    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1           | &approx;9       | :heavy_check_mark:    | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+   | v0.15.1-slim      | &approx;2       | ❌                    | Stable release           |</span>
| nightly           | &amp;approx;9       | :heavy_check_mark:    | *Unstable* nightly build |
| nightly-slim      | &amp;approx;2       | ❌                    | *Unstable* nightly build |

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docker/.env</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docker/.env</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index dce767d2..668b352c 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docker/.env</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docker/.env</span>
@@ -80,13 +80,13 @@ REDIS_PASSWORD=infini_rag_flow
SVR_HTTP_PORT=9380

# The RAGFlow Docker image to download.
<span style="background-color: #f8d7da; color: #d73a49;">-# Defaults to the v0.15.0-slim edition, which is the RAGFlow Docker image without embedding models.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0-slim</span>
<span style="background-color: #d4edda; color: #28a745;">+# Defaults to the v0.15.1-slim edition, which is the RAGFlow Docker image without embedding models.</span>
<span style="background-color: #d4edda; color: #28a745;">+RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1-slim</span>
#
# To download the RAGFlow Docker image with embedding models, uncomment the following line instead:
<span style="background-color: #f8d7da; color: #d73a49;">-# RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0</span>
<span style="background-color: #d4edda; color: #28a745;">+# RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1</span>
#
<span style="background-color: #f8d7da; color: #d73a49;">-# The Docker image of the v0.15.0 edition includes:</span>
<span style="background-color: #d4edda; color: #28a745;">+# The Docker image of the v0.15.1 edition includes:</span>
# - Built-in embedding models:
#   - BAAI/bge-large-zh-v1.5
#   - BAAI/bge-reranker-v2-m3
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docker/README.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docker/README.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 3c4216f3..b5eeb7f8 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docker/README.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docker/README.md</span>
@@ -78,8 +78,8 @@ The [.env](./.env) file contains important environment variables for Docker.
<span style="background-color: #f8d7da; color: #d73a49;">- `RAGFLOW-IMAGE`</span>
The Docker image edition. Available editions:

<span style="background-color: #f8d7da; color: #d73a49;">-  - `infiniflow/ragflow:v0.15.0-slim` (default): The RAGFlow Docker image without embedding models.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  - `infiniflow/ragflow:v0.15.0`: The RAGFlow Docker image with embedding models including:</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `infiniflow/ragflow:v0.15.1-slim` (default): The RAGFlow Docker image without embedding models.</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `infiniflow/ragflow:v0.15.1`: The RAGFlow Docker image with embedding models including:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Built-in embedding models:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `BAAI/bge-large-zh-v1.5`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `BAAI/bge-reranker-v2-m3`</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/configurations.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/configurations.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 380e259d..d63b690d 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/configurations.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/configurations.md</span>
@@ -97,8 +97,8 @@ The [.env](https://github.com/infiniflow/ragflow/blob/main/docker/.env) file con
<span style="background-color: #f8d7da; color: #d73a49;">- `RAGFLOW-IMAGE`</span>
The Docker image edition. Available editions:

<span style="background-color: #f8d7da; color: #d73a49;">-  - `infiniflow/ragflow:v0.15.0-slim` (default): The RAGFlow Docker image without embedding models.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  - `infiniflow/ragflow:v0.15.0`: The RAGFlow Docker image with embedding models including:</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `infiniflow/ragflow:v0.15.1-slim` (default): The RAGFlow Docker image without embedding models.</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `infiniflow/ragflow:v0.15.1`: The RAGFlow Docker image with embedding models including:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Built-in embedding models:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `BAAI/bge-large-zh-v1.5`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `BAAI/bge-reranker-v2-m3`</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/configure_knowledge_base.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/configure_knowledge_base.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index b5bfb541..4a3f5b6c 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/guides/configure_knowledge_base.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/guides/configure_knowledge_base.md</span>
@@ -128,7 +128,7 @@ RAGFlow uses multiple recall of both full-text search and vector search in its c

## Search for knowledge base

<span style="background-color: #f8d7da; color: #d73a49;">-As of RAGFlow v0.15.0, the search feature is still in a rudimentary form, supporting only knowledge base search by name.</span>
<span style="background-color: #d4edda; color: #28a745;">+As of RAGFlow v0.15.1, the search feature is still in a rudimentary form, supporting only knowledge base search by name.</span>

![search knowledge base](https://github.com/infiniflow/ragflow/assets/93570324/836ae94c-2438-42be-879e-c7ad2a59693e)

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/manage_files.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/manage_files.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index b871927f..7d0d3a6e 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/guides/manage_files.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/guides/manage_files.md</span>
@@ -81,4 +81,4 @@ RAGFlow'#39;s file management allows you to download an uploaded file:

![download_file](https://github.com/infiniflow/ragflow/assets/93570324/cf3b297f-7d9b-4522-bf5f-4f45743e4ed5)

<span style="background-color: #f8d7da; color: #d73a49;">-> As of RAGFlow v0.15.0, bulk download is not supported, nor can you download an entire folder.</span>
<span style="background-color: #d4edda; color: #28a745;">+> As of RAGFlow v0.15.1, bulk download is not supported, nor can you download an entire folder.</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/upgrade_ragflow.mdx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/upgrade_ragflow.mdx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 5b16a90a..eb50737f 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/guides/upgrade_ragflow.mdx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/guides/upgrade_ragflow.mdx</span>
@@ -62,16 +62,16 @@ To upgrade RAGFlow, you must upgrade **both** your code **and** your Docker imag
git clone https://github.com/infiniflow/ragflow.git
```

<span style="background-color: #f8d7da; color: #d73a49;">-2. Switch to the latest, officially published release, e.g., `v0.15.0`:</span>
<span style="background-color: #d4edda; color: #28a745;">+2. Switch to the latest, officially published release, e.g., `v0.15.1`:</span>

```bash
<span style="background-color: #f8d7da; color: #d73a49;">-   git checkout -f v0.15.0</span>
<span style="background-color: #d4edda; color: #28a745;">+   git checkout -f v0.15.1</span>
```

3. Update **ragflow/docker/.env** as follows:

```bash
<span style="background-color: #f8d7da; color: #d73a49;">-   RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0</span>
<span style="background-color: #d4edda; color: #28a745;">+   RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1</span>
```

4. Update the RAGFlow image and restart RAGFlow:
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/quickstart.mdx</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/quickstart.mdx</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 9c74ae73..6db8503a 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/quickstart.mdx</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/quickstart.mdx</span>
@@ -39,7 +39,7 @@ This section provides instructions on setting up the RAGFlow server on Linux. If

`vm.max_map_count`. This value sets the maximum number of memory map areas a process may have. Its default value is 65530. While most applications require fewer than a thousand maps, reducing this value can result in abnormal behaviors, and the system will throw out-of-memory errors when a process reaches the limitation.

<span style="background-color: #f8d7da; color: #d73a49;">-   RAGFlow v0.15.0 uses Elasticsearch or [Infinity](https://github.com/infiniflow/infinity) for multiple recall. Setting the value of `vm.max_map_count` correctly is crucial to the proper functioning of the Elasticsearch component.</span>
<span style="background-color: #d4edda; color: #28a745;">+   RAGFlow v0.15.1 uses Elasticsearch or [Infinity](https://github.com/infiniflow/infinity) for multiple recall. Setting the value of `vm.max_map_count` correctly is crucial to the proper functioning of the Elasticsearch component.</span>

&lt;Tabs
defaultValue=&quot;linux&quot;
@@ -179,13 +179,13 @@ This section provides instructions on setting up the RAGFlow server on Linux. If
```bash
$ git clone https://github.com/infiniflow/ragflow.git
$ cd ragflow
<span style="background-color: #f8d7da; color: #d73a49;">-   $ git checkout -f v0.15.0</span>
<span style="background-color: #d4edda; color: #28a745;">+   $ git checkout -f v0.15.1</span>
```

3. Use the pre-built Docker images and start up the server:

:::tip NOTE
<span style="background-color: #f8d7da; color: #d73a49;">-   The command below downloads the `v0.15.0-slim` edition of the RAGFlow Docker image. Refer to the following table for descriptions of different RAGFlow editions. To download an RAGFlow edition different from `v0.15.0-slim`, update the `RAGFLOW_IMAGE` variable accordingly in **docker/.env** before using `docker compose` to start the server. For example: set `RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0` for the full edition `v0.15.0`.</span>
<span style="background-color: #d4edda; color: #28a745;">+   The command below downloads the `v0.15.1-slim` edition of the RAGFlow Docker image. Refer to the following table for descriptions of different RAGFlow editions. To download an RAGFlow edition different from `v0.15.1-slim`, update the `RAGFLOW_IMAGE` variable accordingly in **docker/.env** before using `docker compose` to start the server. For example: set `RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1` for the full edition `v0.15.1`.</span>
:::

```bash
@@ -198,8 +198,8 @@ This section provides instructions on setting up the RAGFlow server on Linux. If

| RAGFlow image tag   | Image size (GB) | Has embedding models and Python packages? | Stable?                  |
| ------------------- | --------------- | ----------------------------------------- | ------------------------ |
<span style="background-color: #f8d7da; color: #d73a49;">-| `v0.15.0`           | &approx;9       | :heavy_check_mark:                        | Stable release           |</span>
<span style="background-color: #f8d7da; color: #d73a49;">-| `v0.15.0-slim`      | &approx;2       | ❌                                        | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+| `v0.15.1`           | &approx;9       | :heavy_check_mark:                        | Stable release           |</span>
<span style="background-color: #d4edda; color: #28a745;">+| `v0.15.1-slim`      | &approx;2       | ❌                                        | Stable release           |</span>
| `nightly`           | &amp;approx;9       | :heavy_check_mark:                        | *Unstable* nightly build |
| `nightly-slim`      | &amp;approx;2       | ❌                                        | *Unstable* nightly build |

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/faq.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/faq.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 367ba314..8be0c86a 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/faq.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/faq.md</span>
@@ -42,10 +42,10 @@ We officially support x86 CPU and nvidia GPU. While we also test RAGFlow on ARM6

### Which embedding models can be deployed locally?

<span style="background-color: #f8d7da; color: #d73a49;">-RAGFlow offers two Docker image editions, `v0.15.0-slim` and `v0.15.0`:</span>
<span style="background-color: #d4edda; color: #28a745;">+RAGFlow offers two Docker image editions, `v0.15.1-slim` and `v0.15.1`:</span>

<span style="background-color: #f8d7da; color: #d73a49;">-- `infiniflow/ragflow:v0.15.0-slim` (default): The RAGFlow Docker image without embedding models.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-- `infiniflow/ragflow:v0.15.0`: The RAGFlow Docker image with embedding models including:</span>
<span style="background-color: #d4edda; color: #28a745;">+- `infiniflow/ragflow:v0.15.1-slim` (default): The RAGFlow Docker image without embedding models.</span>
<span style="background-color: #d4edda; color: #28a745;">+- `infiniflow/ragflow:v0.15.1`: The RAGFlow Docker image with embedding models including:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Built-in embedding models:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `BAAI/bge-large-zh-v1.5`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `BAAI/bge-reranker-v2-m3`</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/helm/values.yaml</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/helm/values.yaml</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 1fd5fcd2..3606ca8b 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/helm/values.yaml</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/helm/values.yaml</span>
@@ -27,13 +27,13 @@ env:
REDIS_PASSWORD: infini_rag_flow_helm

# The RAGFlow Docker image to download.
<span style="background-color: #f8d7da; color: #d73a49;">-  # Defaults to the v0.15.0-slim edition, which is the RAGFlow Docker image without embedding models.</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  RAGFLOW_IMAGE: infiniflow/ragflow:v0.15.0-slim</span>
<span style="background-color: #d4edda; color: #28a745;">+  # Defaults to the v0.15.1-slim edition, which is the RAGFlow Docker image without embedding models.</span>
<span style="background-color: #d4edda; color: #28a745;">+  RAGFLOW_IMAGE: infiniflow/ragflow:v0.15.1-slim</span>
#
# To download the RAGFlow Docker image with embedding models, uncomment the following line instead:
<span style="background-color: #f8d7da; color: #d73a49;">-  # RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.0</span>
<span style="background-color: #d4edda; color: #28a745;">+  # RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1</span>
#
<span style="background-color: #f8d7da; color: #d73a49;">-  # The Docker image of the v0.15.0 edition includes:</span>
<span style="background-color: #d4edda; color: #28a745;">+  # The Docker image of the v0.15.1 edition includes:</span>
# - Built-in embedding models:
#   - BAAI/bge-large-zh-v1.5
#   - BAAI/bge-reranker-v2-m3
</code></pre>

<div id="7e063283"></div>
<h2>7e063283</h2>

<p><strong>Message:</strong> Removing invisible chars before tokenization. (#4233)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 7e063283ba0bbf8c727639809b0bd33463309802
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Thu Dec 26 11:48:16 2024 +0800

Removing invisible chars before tokenization. (#4233)

### What problem does this PR solve?

#4223

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/rag/nlp/rag_tokenizer.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/rag/nlp/rag_tokenizer.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 4effd026..0b78c4e0 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/rag/nlp/rag_tokenizer.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/rag/nlp/rag_tokenizer.py</span>
@@ -264,6 +264,7 @@ class RagTokenizer:
return [self.stemmer.stem(self.lemmatizer.lemmatize(t)) if re.match(r&quot;[a-zA-Z_-]+$&quot;, t) else t for t in tks]

def tokenize(self, line):
<span style="background-color: #d4edda; color: #28a745;">+        line = re.sub(r"\W+", " ", line)</span>
line = self._strQ2B(line).lower()
line = self._tradi2simp(line)
zh_num = len([1 for c in line if is_chinese(c)])
</code></pre>

<div id="28eeb29b"></div>
<h2>28eeb29b</h2>

<p><strong>Message:</strong> Fix component input error. (#4231)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 28eeb29b885bd584f8038c414742023f24c6348e
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Thu Dec 26 10:13:47 2024 +0800

Fix component input error. (#4231)

### What problem does this PR solve?

#4108

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/base.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/base.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 592515a8..cb4e1ad8 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/base.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/base.py</span>
@@ -480,7 +480,8 @@ class ComponentBase(ABC):
if q[&quot;component_id&quot;].lower().find(&quot;answer&quot;) == 0:
for r, c in self._canvas.history[::-1]:
if r == &quot;user&quot;:
<span style="background-color: #f8d7da; color: #d73a49;">-                                self._param.inputs.append(pd.DataFrame([{"content": c, "component_id": q["component_id"]}]))</span>
<span style="background-color: #d4edda; color: #28a745;">+                                self._param.inputs.append({"content": c, "component_id": q["component_id"]})</span>
<span style="background-color: #d4edda; color: #28a745;">+                                outs.append(pd.DataFrame([{"content": c}]))</span>
break
continue

</code></pre>

<div id="85511cb1"></div>
<h2>85511cb1</h2>

<p><strong>Message:</strong> Miscellaneous updates (#4228)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 85511cb1fd87d759bf043d9b08ede80b98f1831c
Author: writinwaters &lt;93570324+writinwaters@users.noreply.github.com&gt;
Date:   Wed Dec 25 20:21:38 2024 +0800

Miscellaneous updates (#4228)

### What problem does this PR solve?


### Type of change


<span style="background-color: #f8d7da; color: #d73a49;">- [x] Documentation Update</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/agent_component_reference/_category_.json</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/agentic_rag/agent_component_reference/_category_.json</div>
new file mode 100644
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 00000000..50383113</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- /dev/null</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/guides/agentic_rag/agent_component_reference/_category_.json</span>
@@ -0,0 +1,8 @@
<span style="background-color: #d4edda; color: #28a745;">+{</span>
<span style="background-color: #d4edda; color: #28a745;">+  "label": "Agent Component Reference",</span>
<span style="background-color: #d4edda; color: #28a745;">+  "position": 1,</span>
<span style="background-color: #d4edda; color: #28a745;">+  "link": {</span>
<span style="background-color: #d4edda; color: #28a745;">+    "type": "generated-index",</span>
<span style="background-color: #d4edda; color: #28a745;">+    "description": "A complete reference for RAGFlow's agent components."</span>
<span style="background-color: #d4edda; color: #28a745;">+  }</span>
<span style="background-color: #d4edda; color: #28a745;">+}</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/guides/agentic_rag/agent_introduction.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/guides/agentic_rag/agent_introduction.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 9e6ff438..ec2b0439 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/guides/agentic_rag/agent_introduction.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/guides/agentic_rag/agent_introduction.md</span>
@@ -5,6 +5,12 @@ slug: /agent_introduction

# Introduction to agents

<span style="background-color: #d4edda; color: #28a745;">+Key concepts, basic operations, a quick view of the agent editor.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+## Key concepts</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
Agents and RAG are complementary techniques, each enhancing the other’s capabilities in business applications. RAGFlow v0.8.0 introduces an agent mechanism, featuring a no-code workflow editor on the front end and a comprehensive graph-based task orchestration framework on the back end. This mechanism is built on top of RAGFlow'#39;s existing RAG solutions and aims to orchestrate search technologies such as query intent classification, conversation leading, and query rewriting to:

<span style="background-color: #f8d7da; color: #d73a49;">- Provide higher retrievals and,</span>
@@ -23,7 +29,7 @@ Before proceeding, ensure that:

Click the **Agent** tab in the middle top of the page to show the **Agent** page. As shown in the screenshot below, the cards on this page represent the created agents, which you can continue to edit.

<span style="background-color: #f8d7da; color: #d73a49;">-![agents](https://github.com/user-attachments/assets/5e10758b-ec43-49ae-bf91-ff7d04c56e9d)</span>
<span style="background-color: #d4edda; color: #28a745;">+![agent_mainpage](https://github.com/user-attachments/assets/5c0bb123-8f4e-42ea-b250-43f640dc6814)</span>

We also provide templates catered to different business scenarios. You can either generate your agent from one of our agent templates or create one from scratch:

@@ -35,7 +41,7 @@ We also provide templates catered to different business scenarios. You can eithe

*You are now taken to the **no-code workflow editor** page. The left panel lists the components (operators): Above the dividing line are the RAG-specific components; below the line are tools. We are still working to expand the component list.*

<span style="background-color: #f8d7da; color: #d73a49;">-   ![workflow_editor](https://github.com/user-attachments/assets/9fc6891c-7784-43b8-ab4a-3b08a9e551c4)</span>
<span style="background-color: #d4edda; color: #28a745;">+   ![workflow_editor](https://github.com/user-attachments/assets/47b4d5ce-b35a-4d6b-b483-ba495a75a65d)</span>

4. General speaking, now you can do the following:
<span style="background-color: #f8d7da; color: #d73a49;">- Drag and drop a desired component to your workflow,</span>
@@ -58,7 +64,7 @@ Please review the flowing description of the RAG-specific components before you
| **Message**    | A component that sends out a static message. If multiple messages are supplied, it randomly selects one to send. Ensure its downstream is **Interact**, the interface component. |
| **Relevant**   | A component that uses the LLM to assess whether the upstream output is relevant to the user'#39;s latest query. Ensure you specify the next component for each judge result. |
| **Rewrite**    | A component that refines a user query if it fails to retrieve relevant information from the knowledge base. It repeats this process until the predefined looping upper limit is reached. Ensure its upstream is **Relevant** and downstream is **Retrieval**. |
<span style="background-color: #f8d7da; color: #d73a49;">-| **Keyword**    | A component that retrieves top N search results from wikipedia.org. Ensure the TopN value is set properly before use. |</span>
<span style="background-color: #d4edda; color: #28a745;">+| **Keyword**    | A component that extracts keywords from a user query, with TopN specifying the number of keywords to extract. |</span>

:::caution NOTE

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/http_api_reference.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/http_api_reference.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 31c0b527..d1b1d14c 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/http_api_reference.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/http_api_reference.md</span>
@@ -883,6 +883,10 @@ Failure:

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>

<span style="background-color: #d4edda; color: #28a745;">+## CHUNK MANAGEMENT WITHIN DATASET</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
### Add chunk

**POST** `/api/v1/datasets/{dataset_id}/documents/{document_id}/chunks`
@@ -936,9 +940,7 @@ Success:
&quot;content&quot;: &quot;ragflow content&quot;,
&quot;create_time&quot;: &quot;2024-10-16 08:05:04&quot;,
&quot;create_timestamp&quot;: 1729065904.581025,
<span style="background-color: #f8d7da; color: #d73a49;">-            "dataset_id": [</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                "c7ee74067a2c11efb21c0242ac120006"</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            ],</span>
<span style="background-color: #d4edda; color: #28a745;">+            "dataset_id": "c7ee74067a2c11efb21c0242ac120006",</span>
&quot;document_id&quot;: &quot;5c5999ec7be811ef9cab0242ac120005&quot;,
&quot;id&quot;: &quot;d78435d142bd5cf6704da62c778795c5&quot;,
&quot;important_keywords&quot;: []
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/python_api_reference.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/python_api_reference.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 0504d9a1..e19fbc7e 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/python_api_reference.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/python_api_reference.md</span>
@@ -1,4 +1,4 @@
<span style="background-color: #f8d7da; color: #d73a49;">-from scipy.special import kwargs---</span>
<span style="background-color: #d4edda; color: #28a745;">+---</span>
sidebar_position: 2
slug: /python_api_reference
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>
@@ -641,6 +641,10 @@ print(&quot;Async bulk parsing cancelled.&quot;)

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>

<span style="background-color: #d4edda; color: #28a745;">+## CHUNK MANAGEMENT WITHIN DATASET</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+---</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
### Add chunk

```python
@@ -1436,11 +1440,11 @@ The parameters in `begin` component.
#### Examples

```python
<span style="background-color: #f8d7da; color: #d73a49;">-from ragflow_sdk import RAGFlow</span>
<span style="background-color: #d4edda; color: #28a745;">+from ragflow_sdk import RAGFlow, Agent</span>

rag_object = RAGFlow(api_key=&quot;&lt;YOUR_API_KEY&gt;&quot;, base_url=&quot;http://&lt;YOUR_BASE_URL&gt;:9380&quot;)
AGENT_ID = &quot;AGENT_ID&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-session = create_session(AGENT_ID,rag_object)</span>
<span style="background-color: #d4edda; color: #28a745;">+session = Agent.create_session(AGENT_ID, rag_object)</span>
```

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---</span>
@@ -1513,11 +1517,11 @@ A list of `Chunk` objects representing references to the message, each containin
#### Examples

```python
<span style="background-color: #f8d7da; color: #d73a49;">-from ragflow_sdk import RAGFlow,Agent</span>
<span style="background-color: #d4edda; color: #28a745;">+from ragflow_sdk import RAGFlow, Agent</span>

rag_object = RAGFlow(api_key=&quot;&lt;YOUR_API_KEY&gt;&quot;, base_url=&quot;http://&lt;YOUR_BASE_URL&gt;:9380&quot;)
AGENT_id = &quot;AGENT_ID&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-session = Agent.create_session(AGENT_id,rag_object)</span>
<span style="background-color: #d4edda; color: #28a745;">+session = Agent.create_session(AGENT_id, rag_object)</span>

print(&quot;\n===== Miss R ====\n&quot;)
print(&quot;Hello. What can I do for you?&quot;)
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/release_notes.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/release_notes.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index cf1d514d..8587bd65 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/release_notes.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/release_notes.md</span>
@@ -7,6 +7,39 @@ slug: /release_notes

Key features, improvements and bug fixes in the latest releases.

<span style="background-color: #d4edda; color: #28a745;">+## v0.15.1</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+Released on December 25, 2024.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Upgrades</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- Upgrades RAGFlow's document engine [Infinity](https://github.com/infiniflow/infinity) to v0.5.2.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Enhances the log display of document parsing status.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Fixed issues</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+This release fixes the following issues:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- The `SCORE not found` and `position_int` errors returned by [Infinity](https://github.com/infiniflow/infinity).</span>
<span style="background-color: #d4edda; color: #28a745;">+- Slow response in question-answering and AI search due to repetitive loading of the embedding model.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Fails to parse documents with RAPTOR.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Using the **Table** parsing method results in information loss.</span>
<span style="background-color: #d4edda; color: #28a745;">+- Miscellaneous API issues.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+### Related APIs</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+#### HTTP APIs</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+Adds an optional parameter `"user_id"` to the following APIs:</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+- [Create session with chat assistant](https://ragflow.io/docs/dev/http_api_reference#create-session-with-chat-assistant)</span>
<span style="background-color: #d4edda; color: #28a745;">+- [Update chat assistant's session](https://ragflow.io/docs/dev/http_api_reference#update-chat-assistants-session)</span>
<span style="background-color: #d4edda; color: #28a745;">+- [List chat assistant's sessions](https://ragflow.io/docs/dev/http_api_reference#list-chat-assistants-sessions)</span>
<span style="background-color: #d4edda; color: #28a745;">+- [Create session with agent](https://ragflow.io/docs/dev/http_api_reference#create-session-with-agent)</span>
<span style="background-color: #d4edda; color: #28a745;">+- [Converse with chat assistant](https://ragflow.io/docs/dev/http_api_reference#converse-with-chat-assistant)</span>
<span style="background-color: #d4edda; color: #28a745;">+- [Converse with agent](https://ragflow.io/docs/dev/http_api_reference#converse-with-agent)</span>
<span style="background-color: #d4edda; color: #28a745;">+- [List agent sessions](https://ragflow.io/docs/dev/http_api_reference#list-agent-sessions)</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
## v0.15.0

Released on December 18, 2024.
</code></pre>

<div id="a3eeb5de"></div>
<h2>a3eeb5de</h2>

<p><strong>Message:</strong> Fix: Q&A chunk modification (#4227)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit a3eeb5de323e044426a6e13c1bf67fe69682228a
Author: balibabu &lt;cike8899@users.noreply.github.com&gt;
Date:   Wed Dec 25 19:11:16 2024 +0800

Fix: Q&amp;A chunk modification (#4227)

### What problem does this PR solve?

_Briefly describe what this PR aims to solve. Include background context
that will help reviewers understand the purpose of the PR._

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/chunk_app.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/chunk_app.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 644353ba..feeb52f6 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/chunk_app.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/chunk_app.py</span>
@@ -148,10 +148,7 @@ def set():
t for t in re.split(
r&quot;[\n\t]&quot;,
req[&quot;content_with_weight&quot;]) if len(t) &gt; 1]
<span style="background-color: #f8d7da; color: #d73a49;">-            if len(arr) != 2:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                return get_data_error_result(</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                    message="Q&A must be separated by TAB/ENTER key.")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            q, a = rmPrefix(arr[0]), rmPrefix(arr[1])</span>
<span style="background-color: #d4edda; color: #28a745;">+            q, a = rmPrefix(arr[0]), rmPrefix("\n".join(arr[1:]))</span>
d = beAdoc(d, arr[0], arr[1], not any(
[rag_tokenizer.is_chinese(t) for t in q + a]))

</code></pre>

<div id="1160b58b"></div>
<h2>1160b58b</h2>

<p><strong>Message:</strong> Update pyproject.toml to 0.15.1 (#4222)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 1160b58b6e13cc11422c153f4124d682d87de67b
Author: Jin Hai &lt;haijin.chn@gmail.com&gt;
Date:   Wed Dec 25 14:06:00 2024 +0800

Update pyproject.toml to 0.15.1 (#4222)

### What problem does this PR solve?

Missing update information

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

Signed-off-by: jinhai &lt;haijin.chn@gmail.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/pyproject.toml</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/pyproject.toml</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 826747ac..88225382 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/pyproject.toml</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/pyproject.toml</span>
@@ -1,6 +1,6 @@
[tool.poetry]
name = &quot;ragflow&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "0.15.0"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "0.15.1"</span>
description = &quot;[RAGFlow](https://ragflow.io/) is an open-source RAG (Retrieval-Augmented Generation) engine based on deep document understanding. It offers a streamlined RAG workflow for businesses of any scale, combining LLM (Large Language Models) to provide truthful question-answering capabilities, backed by well-founded citations from various complex formatted data.&quot;
authors = [&quot;Your Name &lt;you@example.com&gt;&quot;]
license = &quot;https://github.com/infiniflow/ragflow/blob/main/LICENSE&quot;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/sdk/python/pyproject.toml</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/sdk/python/pyproject.toml</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 7889ef6e..a59459c8 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/sdk/python/pyproject.toml</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/sdk/python/pyproject.toml</span>
@@ -1,6 +1,6 @@
[tool.poetry]
name = &quot;ragflow-sdk&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "0.15.0"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "0.15.1"</span>
description = &quot;Python client sdk of [RAGFlow](https://github.com/infiniflow/ragflow). RAGFlow is an open-source RAG (Retrieval-Augmented Generation) engine based on deep document understanding.&quot;
authors = [&quot;Zhichang Yu &lt;yuzhichang@gmail.com&gt;&quot;]
license = &quot;Apache License, Version 2.0&quot;
</code></pre>

<div id="61790ebe"></div>
<h2>61790ebe</h2>

<p><strong>Message:</strong> Fix: Rename chat name, missing field 'avatar' #4125 (#4221)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 61790ebe1520ec82578b1dbb28945df9882716d2
Author: balibabu &lt;cike8899@users.noreply.github.com&gt;
Date:   Wed Dec 25 11:25:50 2024 +0800

Fix: Rename chat name, missing field '#39;avatar'#39; #4125 (#4221)

### What problem does this PR solve?

Fix: Rename chat name, missing field '#39;avatar'#39; #4125

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/hooks/chat-hooks.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/hooks/chat-hooks.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index f8f7f2d1..843a9e70 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/hooks/chat-hooks.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/hooks/chat-hooks.ts</span>
@@ -340,6 +340,7 @@ export const useUpdateNextConversation = () =&gt; {
});
if (data.code === 0) {
queryClient.invalidateQueries({ queryKey: ['#39;fetchConversationList'#39;] });
<span style="background-color: #d4edda; color: #28a745;">+        message.success(i18n.t(`message.modified`));</span>
}
return data;
},
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/web/src/pages/chat/hooks.ts</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/web/src/pages/chat/hooks.ts</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 6bf45c6c..13140c68 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/web/src/pages/chat/hooks.ts</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/web/src/pages/chat/hooks.ts</span>
@@ -535,7 +535,6 @@ export const useRenameConversation = () =&gt; {
const onConversationRenameOk = useCallback(
async (name: string) =&gt; {
const ret = await updateConversation({
<span style="background-color: #f8d7da; color: #d73a49;">-        ...conversation,</span>
conversation_id: conversation.id,
name,
is_new: false,
</code></pre>

<div id="bc3288d3"></div>
<h2>bc3288d3</h2>

<p><strong>Message:</strong> Fix misspell. (#4219)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit bc3288d390b15fa6a8a774d4c5287db205fffc14
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Wed Dec 25 10:48:59 2024 +0800

Fix misspell. (#4219)

### What problem does this PR solve?
#4216

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/sdk/session.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/sdk/session.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 42b08d50..db00d95b 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/sdk/session.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/sdk/session.py</span>
@@ -71,7 +71,7 @@ def create_agent_session(tenant_id, agent_id):
if not e:
return get_error_data_result(&quot;Agent not found.&quot;)

<span style="background-color: #f8d7da; color: #d73a49;">-    if not UserCanvasService.query(user_id=tenant_id,id=agent_id):</span>
<span style="background-color: #d4edda; color: #28a745;">+    if not UserCanvasService.query(user_id=tenant_id, id=agent_id):</span>
return get_error_data_result(&quot;You cannot access the agent.&quot;)

if not isinstance(cvs.dsl, str):
@@ -96,7 +96,7 @@ def create_agent_session(tenant_id, agent_id):
conv = {
&quot;id&quot;: get_uuid(),
&quot;dialog_id&quot;: cvs.id,
<span style="background-color: #f8d7da; color: #d73a49;">-        "user_id": req.get("usr_id","") if isinstance(req, dict) else "",</span>
<span style="background-color: #d4edda; color: #28a745;">+        "user_id": req.get("user_id", "") if isinstance(req, dict) else "",</span>
&quot;message&quot;: [{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: canvas.get_prologue()}],
&quot;source&quot;: &quot;agent&quot;,
&quot;dsl&quot;: cvs.dsl
@@ -133,11 +133,11 @@ def update(tenant_id, chat_id, session_id):
def chat_completion(tenant_id, chat_id):
req = request.json
if not req or not req.get(&quot;session_id&quot;):
<span style="background-color: #f8d7da; color: #d73a49;">-        req = {"question":""}</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    if not DialogService.query(tenant_id=tenant_id,id=chat_id,status=StatusEnum.VALID.value):</span>
<span style="background-color: #d4edda; color: #28a745;">+        req = {"question": ""}</span>
<span style="background-color: #d4edda; color: #28a745;">+    if not DialogService.query(tenant_id=tenant_id, id=chat_id, status=StatusEnum.VALID.value):</span>
return get_error_data_result(f&quot;You don'#39;t own the chat {chat_id}&quot;)
if req.get(&quot;session_id&quot;):
<span style="background-color: #f8d7da; color: #d73a49;">-        if not ConversationService.query(id=req["session_id"],dialog_id=chat_id):</span>
<span style="background-color: #d4edda; color: #28a745;">+        if not ConversationService.query(id=req["session_id"], dialog_id=chat_id):</span>
return get_error_data_result(f&quot;You don'#39;t own the session {req['#39;session_id'#39;]}&quot;)
if req.get(&quot;stream&quot;, True):
resp = Response(rag_completion(tenant_id, chat_id, **req), mimetype=&quot;text/event-stream&quot;)
@@ -158,34 +158,34 @@ def chat_completion(tenant_id, chat_id):
@manager.route('#39;/agents/&lt;agent_id&gt;/completions'#39;, methods=['#39;POST'#39;])  # noqa: F821
@token_required
def agent_completions(tenant_id, agent_id):
<span style="background-color: #f8d7da; color: #d73a49;">-        req = request.json</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        cvs = UserCanvasService.query(user_id=tenant_id, id=agent_id)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        if not cvs:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            return get_error_data_result(f"You don't own the agent {agent_id}")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        if req.get("session_id"):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            dsl = cvs[0].dsl</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            if not isinstance(dsl,str):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                dsl = json.dumps(dsl)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            canvas=Canvas(dsl,tenant_id)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            if canvas.get_preset_param():</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                req["question"]=""</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            conv = API4ConversationService.query(id=req["session_id"], dialog_id=agent_id)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            if not conv:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                return get_error_data_result(f"You don't own the session {req['session_id']}")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        else:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            req["question"]=""</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        if req.get("stream", True):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            resp = Response(agent_completion(tenant_id, agent_id, **req), mimetype="text/event-stream")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            resp.headers.add_header("Cache-control", "no-cache")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            resp.headers.add_header("Connection", "keep-alive")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            resp.headers.add_header("X-Accel-Buffering", "no")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            resp.headers.add_header("Content-Type", "text/event-stream; charset=utf-8")</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            return resp</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        try:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            for answer in agent_completion(tenant_id, agent_id, **req):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                return get_result(data=answer)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        except Exception as e:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            return get_error_data_result(str(e))</span>
<span style="background-color: #d4edda; color: #28a745;">+    req = request.json</span>
<span style="background-color: #d4edda; color: #28a745;">+    cvs = UserCanvasService.query(user_id=tenant_id, id=agent_id)</span>
<span style="background-color: #d4edda; color: #28a745;">+    if not cvs:</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_error_data_result(f"You don't own the agent {agent_id}")</span>
<span style="background-color: #d4edda; color: #28a745;">+    if req.get("session_id"):</span>
<span style="background-color: #d4edda; color: #28a745;">+        dsl = cvs[0].dsl</span>
<span style="background-color: #d4edda; color: #28a745;">+        if not isinstance(dsl, str):</span>
<span style="background-color: #d4edda; color: #28a745;">+            dsl = json.dumps(dsl)</span>
<span style="background-color: #d4edda; color: #28a745;">+        canvas = Canvas(dsl, tenant_id)</span>
<span style="background-color: #d4edda; color: #28a745;">+        if canvas.get_preset_param():</span>
<span style="background-color: #d4edda; color: #28a745;">+            req["question"] = ""</span>
<span style="background-color: #d4edda; color: #28a745;">+        conv = API4ConversationService.query(id=req["session_id"], dialog_id=agent_id)</span>
<span style="background-color: #d4edda; color: #28a745;">+        if not conv:</span>
<span style="background-color: #d4edda; color: #28a745;">+            return get_error_data_result(f"You don't own the session {req['session_id']}")</span>
<span style="background-color: #d4edda; color: #28a745;">+    else:</span>
<span style="background-color: #d4edda; color: #28a745;">+        req["question"] = ""</span>
<span style="background-color: #d4edda; color: #28a745;">+    if req.get("stream", True):</span>
<span style="background-color: #d4edda; color: #28a745;">+        resp = Response(agent_completion(tenant_id, agent_id, **req), mimetype="text/event-stream")</span>
<span style="background-color: #d4edda; color: #28a745;">+        resp.headers.add_header("Cache-control", "no-cache")</span>
<span style="background-color: #d4edda; color: #28a745;">+        resp.headers.add_header("Connection", "keep-alive")</span>
<span style="background-color: #d4edda; color: #28a745;">+        resp.headers.add_header("X-Accel-Buffering", "no")</span>
<span style="background-color: #d4edda; color: #28a745;">+        resp.headers.add_header("Content-Type", "text/event-stream; charset=utf-8")</span>
<span style="background-color: #d4edda; color: #28a745;">+        return resp</span>
<span style="background-color: #d4edda; color: #28a745;">+    try:</span>
<span style="background-color: #d4edda; color: #28a745;">+        for answer in agent_completion(tenant_id, agent_id, **req):</span>
<span style="background-color: #d4edda; color: #28a745;">+            return get_result(data=answer)</span>
<span style="background-color: #d4edda; color: #28a745;">+    except Exception as e:</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_error_data_result(str(e))</span>


@manager.route('#39;/chats/&lt;chat_id&gt;/sessions'#39;, methods=['#39;GET'#39;])  # noqa: F821
@@ -447,5 +447,3 @@ def agent_bot_completions(agent_id):

for answer in agent_completion(objs[0].tenant_id, agent_id, **req):
return get_result(data=answer)
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
</code></pre>

<div id="4e5f92f0"></div>
<h2>4e5f92f0</h2>

<p><strong>Message:</strong> Fix interface as input variable for component. (#4212)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 4e5f92f01bb99696b1992850a33d1ae799b7b426
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Tue Dec 24 17:58:11 2024 +0800

Fix interface as input variable for component. (#4212)

### What problem does this PR solve?

#4108

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/agent/component/base.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/agent/component/base.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 663ac274..592515a8 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/agent/component/base.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/agent/component/base.py</span>
@@ -477,6 +477,13 @@ class ComponentBase(ABC):
assert False, f&quot;Can'#39;t find parameter '#39;{key}'#39; for {cpn_id}&quot;
continue

<span style="background-color: #d4edda; color: #28a745;">+                    if q["component_id"].lower().find("answer") == 0:</span>
<span style="background-color: #d4edda; color: #28a745;">+                        for r, c in self._canvas.history[::-1]:</span>
<span style="background-color: #d4edda; color: #28a745;">+                            if r == "user":</span>
<span style="background-color: #d4edda; color: #28a745;">+                                self._param.inputs.append(pd.DataFrame([{"content": c, "component_id": q["component_id"]}]))</span>
<span style="background-color: #d4edda; color: #28a745;">+                                break</span>
<span style="background-color: #d4edda; color: #28a745;">+                        continue</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
outs.append(self._canvas.get_component(q[&quot;component_id&quot;])[&quot;obj&quot;].output(allow_partial=False)[1])
self._param.inputs.append({&quot;component_id&quot;: q[&quot;component_id&quot;],
&quot;content&quot;: &quot;\n&quot;.join(
</code></pre>

<div id="7d8e0602"></div>
<h2>7d8e0602</h2>

<p><strong>Message:</strong> Remove session owner check. (#4211)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 7d8e0602aa1de8b58384f63b10e6f996a01d78cc
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Tue Dec 24 17:40:31 2024 +0800

Remove session owner check. (#4211)

### What problem does this PR solve?

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/sdk/session.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/sdk/session.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index d755472c..42b08d50 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/sdk/session.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/sdk/session.py</span>
@@ -247,8 +247,6 @@ def list_agent_session(tenant_id, agent_id):
if not UserCanvasService.query(user_id=tenant_id, id=agent_id):
return get_error_data_result(message=f&quot;You don'#39;t own the agent {agent_id}.&quot;)
id = request.args.get(&quot;id&quot;)
<span style="background-color: #f8d7da; color: #d73a49;">-    if not API4ConversationService.query(id=id, user_id=tenant_id):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        return get_error_data_result(f"You don't own the session {id}")</span>
page_number = int(request.args.get(&quot;page&quot;, 1))
items_per_page = int(request.args.get(&quot;page_size&quot;, 30))
orderby = request.args.get(&quot;orderby&quot;, &quot;update_time&quot;)
</code></pre>

<div id="03cbbf77"></div>
<h2>03cbbf77</h2>

<p><strong>Message:</strong> Add user_id for third-party system to record sessions. (#4206)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 03cbbf7784b11ea8aa98f5fa129a9266e8eae191
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Tue Dec 24 15:59:11 2024 +0800

Add user_id for third-party system to record sessions. (#4206)

### What problem does this PR solve?


### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] New Feature (non-breaking change which adds functionality)</span>
<span style="background-color: #f8d7da; color: #d73a49;">- [x] Documentation Update</span>

<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">---------</span>

Co-authored-by: writinwaters &lt;93570324+writinwaters@users.noreply.github.com&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/apps/sdk/session.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/apps/sdk/session.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index da4ea12a..d755472c 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/apps/sdk/session.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/apps/sdk/session.py</span>
@@ -47,7 +47,8 @@ def create(tenant_id, chat_id):
&quot;id&quot;: get_uuid(),
&quot;dialog_id&quot;: req[&quot;dialog_id&quot;],
&quot;name&quot;: req.get(&quot;name&quot;, &quot;New session&quot;),
<span style="background-color: #f8d7da; color: #d73a49;">-        "message": [{"role": "assistant", "content": dia[0].prompt_config.get("prologue")}]</span>
<span style="background-color: #d4edda; color: #28a745;">+        "message": [{"role": "assistant", "content": dia[0].prompt_config.get("prologue")}],</span>
<span style="background-color: #d4edda; color: #28a745;">+        "user_id": req.get("user_id", "")</span>
}
if not conv.get(&quot;name&quot;):
return get_error_data_result(message=&quot;`name` can not be empty.&quot;)
@@ -71,7 +72,7 @@ def create_agent_session(tenant_id, agent_id):
return get_error_data_result(&quot;Agent not found.&quot;)

if not UserCanvasService.query(user_id=tenant_id,id=agent_id):
<span style="background-color: #f8d7da; color: #d73a49;">-        return  get_error_data_result("You cannot access the agent.")</span>
<span style="background-color: #d4edda; color: #28a745;">+        return get_error_data_result("You cannot access the agent.")</span>

if not isinstance(cvs.dsl, str):
cvs.dsl = json.dumps(cvs.dsl, ensure_ascii=False)
@@ -197,11 +198,12 @@ def list_session(tenant_id, chat_id):
page_number = int(request.args.get(&quot;page&quot;, 1))
items_per_page = int(request.args.get(&quot;page_size&quot;, 30))
orderby = request.args.get(&quot;orderby&quot;, &quot;create_time&quot;)
<span style="background-color: #d4edda; color: #28a745;">+    user_id = request.args.get("user_id")</span>
if request.args.get(&quot;desc&quot;) == &quot;False&quot; or request.args.get(&quot;desc&quot;) == &quot;false&quot;:
desc = False
else:
desc = True
<span style="background-color: #f8d7da; color: #d73a49;">-    convs = ConversationService.get_list(chat_id, page_number, items_per_page, orderby, desc, id, name)</span>
<span style="background-color: #d4edda; color: #28a745;">+    convs = ConversationService.get_list(chat_id, page_number, items_per_page, orderby, desc, id, name, user_id)</span>
if not convs:
return get_result(data=[])
for conv in convs:
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/db/db_models.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/db/db_models.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 24ad7f01..d894846c 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/db/db_models.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/db/db_models.py</span>
@@ -31,7 +31,6 @@ from peewee import (
)
from playhouse.pool import PooledMySQLDatabase, PooledPostgresqlDatabase

<span style="background-color: #f8d7da; color: #d73a49;">-</span>
from api.db import SerializedType, ParserType
from api import settings
from api import utils
@@ -926,6 +925,7 @@ class Conversation(DataBaseModel):
name = CharField(max_length=255, null=True, help_text=&quot;converastion name&quot;, index=True)
message = JSONField(null=True)
reference = JSONField(null=True, default=[])
<span style="background-color: #d4edda; color: #28a745;">+    user_id = CharField(max_length=255, null=True, help_text="user_id", index=True)</span>

class Meta:
db_table = &quot;conversation&quot;
@@ -1070,13 +1070,13 @@ def migrate_db():
pass
try:
migrate(
<span style="background-color: #f8d7da; color: #d73a49;">-                migrator.add_column("tenant_llm","max_tokens",IntegerField(default=8192,index=True))</span>
<span style="background-color: #d4edda; color: #28a745;">+                migrator.add_column("tenant_llm", "max_tokens", IntegerField(default=8192, index=True))</span>
)
except Exception:
pass
try:
migrate(
<span style="background-color: #f8d7da; color: #d73a49;">-                migrator.add_column("api_4_conversation","dsl",JSONField(null=True, default={}))</span>
<span style="background-color: #d4edda; color: #28a745;">+                migrator.add_column("api_4_conversation", "dsl", JSONField(null=True, default={}))</span>
)
except Exception:
pass
@@ -1105,3 +1105,10 @@ def migrate_db():
)
except Exception:
pass
<span style="background-color: #d4edda; color: #28a745;">+        try:</span>
<span style="background-color: #d4edda; color: #28a745;">+            migrate(</span>
<span style="background-color: #d4edda; color: #28a745;">+                migrator.add_column("conversation", "user_id",</span>
<span style="background-color: #d4edda; color: #28a745;">+                                    CharField(max_length=255, null=True, help_text="user_id", index=True))</span>
<span style="background-color: #d4edda; color: #28a745;">+            )</span>
<span style="background-color: #d4edda; color: #28a745;">+        except Exception:</span>
<span style="background-color: #d4edda; color: #28a745;">+            pass</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/db/services/api_service.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/db/services/api_service.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 640a2236..ee53fa27 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/db/services/api_service.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/db/services/api_service.py</span>
@@ -41,11 +41,14 @@ class API4ConversationService(CommonService):

@classmethod
@DB.connection_context()
<span style="background-color: #f8d7da; color: #d73a49;">-    def get_list(cls,dialog_id, tenant_id,</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                 page_number, items_per_page, orderby, desc, id):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        sessions = cls.model.select().where(cls.model.dialog_id ==dialog_id)</span>
<span style="background-color: #d4edda; color: #28a745;">+    def get_list(cls, dialog_id, tenant_id,</span>
<span style="background-color: #d4edda; color: #28a745;">+                 page_number, items_per_page,</span>
<span style="background-color: #d4edda; color: #28a745;">+                 orderby, desc, id, user_id=None):</span>
<span style="background-color: #d4edda; color: #28a745;">+        sessions = cls.model.select().where(cls.model.dialog_id == dialog_id)</span>
if id:
sessions = sessions.where(cls.model.id == id)
<span style="background-color: #d4edda; color: #28a745;">+        if user_id:</span>
<span style="background-color: #d4edda; color: #28a745;">+            sessions = sessions.where(cls.model.user_id == user_id)</span>
if desc:
sessions = sessions.order_by(cls.model.getter_by(orderby).desc())
else:
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/api/db/services/conversation_service.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/api/db/services/conversation_service.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index aeed139c..57d2f931 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/api/db/services/conversation_service.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/api/db/services/conversation_service.py</span>
@@ -28,12 +28,14 @@ class ConversationService(CommonService):

@classmethod
@DB.connection_context()
<span style="background-color: #f8d7da; color: #d73a49;">-    def get_list(cls,dialog_id,page_number, items_per_page, orderby, desc, id , name):</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        sessions = cls.model.select().where(cls.model.dialog_id ==dialog_id)</span>
<span style="background-color: #d4edda; color: #28a745;">+    def get_list(cls, dialog_id, page_number, items_per_page, orderby, desc, id, name, user_id=None):</span>
<span style="background-color: #d4edda; color: #28a745;">+        sessions = cls.model.select().where(cls.model.dialog_id == dialog_id)</span>
if id:
sessions = sessions.where(cls.model.id == id)
if name:
sessions = sessions.where(cls.model.name == name)
<span style="background-color: #d4edda; color: #28a745;">+        if user_id:</span>
<span style="background-color: #d4edda; color: #28a745;">+            sessions = sessions.where(cls.model.user_id == user_id)</span>
if desc:
sessions = sessions.order_by(cls.model.getter_by(orderby).desc())
else:
@@ -52,15 +54,16 @@ def structure_answer(conv, ans, message_id, session_id):

def get_value(d, k1, k2):
return d.get(k1, d.get(k2))
<span style="background-color: #d4edda; color: #28a745;">+</span>
chunk_list = [{
<span style="background-color: #f8d7da; color: #d73a49;">-            "id": get_value(chunk, "chunk_id", "id"),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "content": get_value(chunk, "content", "content_with_weight"),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "document_id": get_value(chunk, "doc_id", "document_id"),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "document_name": get_value(chunk, "docnm_kwd", "document_name"),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "dataset_id": get_value(chunk, "kb_id", "dataset_id"),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "image_id": get_value(chunk, "image_id", "img_id"),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-            "positions": get_value(chunk, "positions", "position_int"),</span>
<span style="background-color: #f8d7da; color: #d73a49;">-        } for chunk in reference.get("chunks", [])]</span>
<span style="background-color: #d4edda; color: #28a745;">+        "id": get_value(chunk, "chunk_id", "id"),</span>
<span style="background-color: #d4edda; color: #28a745;">+        "content": get_value(chunk, "content", "content_with_weight"),</span>
<span style="background-color: #d4edda; color: #28a745;">+        "document_id": get_value(chunk, "doc_id", "document_id"),</span>
<span style="background-color: #d4edda; color: #28a745;">+        "document_name": get_value(chunk, "docnm_kwd", "document_name"),</span>
<span style="background-color: #d4edda; color: #28a745;">+        "dataset_id": get_value(chunk, "kb_id", "dataset_id"),</span>
<span style="background-color: #d4edda; color: #28a745;">+        "image_id": get_value(chunk, "image_id", "img_id"),</span>
<span style="background-color: #d4edda; color: #28a745;">+        "positions": get_value(chunk, "positions", "position_int"),</span>
<span style="background-color: #d4edda; color: #28a745;">+    } for chunk in reference.get("chunks", [])]</span>

reference[&quot;chunks&quot;] = chunk_list
ans[&quot;id&quot;] = message_id
@@ -88,10 +91,11 @@ def completion(tenant_id, chat_id, question, name=&quot;New session&quot;, session_id=None
if not session_id:
session_id = get_uuid()
conv = {
<span style="background-color: #f8d7da; color: #d73a49;">-            "id":session_id ,</span>
<span style="background-color: #d4edda; color: #28a745;">+            "id": session_id,</span>
&quot;dialog_id&quot;: chat_id,
&quot;name&quot;: name,
<span style="background-color: #f8d7da; color: #d73a49;">-            "message": [{"role": "assistant", "content": dia[0].prompt_config.get("prologue")}]</span>
<span style="background-color: #d4edda; color: #28a745;">+            "message": [{"role": "assistant", "content": dia[0].prompt_config.get("prologue")}],</span>
<span style="background-color: #d4edda; color: #28a745;">+            "user_id": kwargs.get("user_id", "")</span>
}
ConversationService.save(**conv)
yield &quot;data:&quot; + json.dumps({&quot;code&quot;: 0, &quot;message&quot;: &quot;&quot;,
@@ -226,4 +230,3 @@ def iframe_completion(dialog_id, question, session_id=None, stream=True, **kwarg
API4ConversationService.append_message(conv.id, conv.to_dict())
break
yield answer
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docs/references/http_api_reference.md</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docs/references/http_api_reference.md</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 200f7d19..31c0b527 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docs/references/http_api_reference.md</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docs/references/http_api_reference.md</span>
@@ -1721,6 +1721,7 @@ Creates a session with a chat assistant.
<span style="background-color: #f8d7da; color: #d73a49;">- `'Authorization: Bearer <YOUR_API_KEY>'`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Body:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"name"`: `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `"user_id"`: `string`(optional)</span>

##### Request example

@@ -1741,6 +1742,8 @@ curl --request POST \
The ID of the associated chat assistant.
<span style="background-color: #f8d7da; color: #d73a49;">- `"name"`: (*Body parameter*), `string`</span>
The name of the chat session to create.
<span style="background-color: #d4edda; color: #28a745;">+- `"user_id"`: (*Body parameter*), `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  Optional user-defined ID.</span>

#### Response

@@ -1793,6 +1796,7 @@ Updates a session of a specified chat assistant.
<span style="background-color: #f8d7da; color: #d73a49;">- `'Authorization: Bearer <YOUR_API_KEY>'`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Body:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"name`: `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `"user_id`: `string`(optional)</span>

##### Request example

@@ -1815,6 +1819,8 @@ curl --request PUT \
The ID of the session to update.
<span style="background-color: #f8d7da; color: #d73a49;">- `"name"`: (*Body Parameter*), `string`</span>
The revised name of the session.
<span style="background-color: #d4edda; color: #28a745;">+- `"user_id"`: (*Body parameter*), `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  Optional user-defined ID.</span>

#### Response

@@ -1846,7 +1852,7 @@ Lists sessions associated with a specified chat assistant.
#### Request

<span style="background-color: #f8d7da; color: #d73a49;">- Method: GET</span>
<span style="background-color: #f8d7da; color: #d73a49;">-- URL: `/api/v1/chats/{chat_id}/sessions?page={page}&page_size={page_size}&orderby={orderby}&desc={desc}&name={session_name}&id={session_id}`</span>
<span style="background-color: #d4edda; color: #28a745;">+- URL: `/api/v1/chats/{chat_id}/sessions?page={page}&page_size={page_size}&orderby={orderby}&desc={desc}&name={session_name}&id={session_id}&user_id={user_id}`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Headers:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `'Authorization: Bearer <YOUR_API_KEY>'`</span>

@@ -1876,6 +1882,8 @@ curl --request GET \
The name of the chat session to retrieve.
<span style="background-color: #f8d7da; color: #d73a49;">- `id`: (*Filter parameter*), `string`</span>
The ID of the chat session to retrieve.
<span style="background-color: #d4edda; color: #28a745;">+- `user_id`: (*Filter parameter*), `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  The optional user-defined ID passed in when creating session.</span>

#### Response

@@ -2000,7 +2008,8 @@ Asks a specified chat assistant a question to start an AI-powered conversation.
<span style="background-color: #f8d7da; color: #d73a49;">- Body:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"question"`: `string`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"stream"`: `boolean`</span>
<span style="background-color: #f8d7da; color: #d73a49;">-  - `"session_id"`: `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `"session_id"`: `string`(optional)</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `"user_id`: `string`(optional)</span>

##### Request example

@@ -2038,6 +2047,8 @@ curl --request POST \
<span style="background-color: #f8d7da; color: #d73a49;">- `false`: Disable streaming.</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"session_id"`: (*Body Parameter*)</span>
The ID of session. If it is not provided, a new session will be generated.
<span style="background-color: #d4edda; color: #28a745;">+- `"user_id"`: (*Body parameter*), `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  The optional user-defined ID. Valid *only* when no `session_id` is provided.</span>

#### Response

@@ -2162,6 +2173,8 @@ Creates a session with an agent.
<span style="background-color: #f8d7da; color: #d73a49;">- Body:</span>
<span style="background-color: #f8d7da; color: #d73a49;">- the required parameters:`str`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- the optional parameters:`str`</span>
<span style="background-color: #d4edda; color: #28a745;">+    - `"user_id"`: `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+      The optional user-defined ID.</span>

##### Request example
If `begin` component in the agent doesn'#39;t have required parameters:
@@ -2337,6 +2350,7 @@ Asks a specified agent a question to start an AI-powered conversation.
<span style="background-color: #f8d7da; color: #d73a49;">- `"question"`: `string`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"stream"`: `boolean`</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"session_id"`: `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  - `"user_id"`: `string`(optional)</span>
<span style="background-color: #f8d7da; color: #d73a49;">- other parameters: `string`</span>
##### Request example
If the `begin` component doesn'#39;t have parameters, the following code will create a session.
@@ -2388,6 +2402,8 @@ curl --request POST \
<span style="background-color: #f8d7da; color: #d73a49;">- `false`: Disable streaming.</span>
<span style="background-color: #f8d7da; color: #d73a49;">- `"session_id"`: (*Body Parameter*)</span>
The ID of the session. If it is not provided, a new session will be generated.
<span style="background-color: #d4edda; color: #28a745;">+- `"user_id"`: (*Body parameter*), `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  The optional user-defined ID. Valid *only* when no `session_id` is provided.</span>
<span style="background-color: #f8d7da; color: #d73a49;">- Other parameters: (*Body Parameter*)</span>
The parameters in the begin component.
#### Response
@@ -2538,7 +2554,7 @@ Failure:

### List agent sessions

<span style="background-color: #f8d7da; color: #d73a49;">-**GET** `/api/v1/agents/{agent_id}/sessions?page={page}&page_size={page_size}&orderby={orderby}&desc={desc}&id={session_id}`</span>
<span style="background-color: #d4edda; color: #28a745;">+**GET** `/api/v1/agents/{agent_id}/sessions?page={page}&page_size={page_size}&orderby={orderby}&desc={desc}&id={session_id}&user_id={user_id}`</span>

Lists sessions associated with a specified agent.

@@ -2553,7 +2569,7 @@ Lists sessions associated with a specified agent.

```bash
curl --request GET \
<span style="background-color: #f8d7da; color: #d73a49;">-     --url http://{address}/api/v1/agents/{agent_id}/sessions?page={page}&page_size={page_size}&orderby={orderby}&desc={desc}&id={session_id} \</span>
<span style="background-color: #d4edda; color: #28a745;">+     --url http://{address}/api/v1/agents/{agent_id}/sessions?page={page}&page_size={page_size}&orderby={orderby}&desc={desc}&id={session_id}&user_id={user_id} \</span>
<span style="background-color: #f8d7da; color: #d73a49;">--header 'Authorization: Bearer <YOUR_API_KEY>'</span>
```

@@ -2573,7 +2589,9 @@ curl --request GET \
Indicates whether the retrieved sessions should be sorted in descending order. Defaults to `true`.
<span style="background-color: #f8d7da; color: #d73a49;">- `id`: (*Filter parameter*), `string`</span>
The ID of the agent session to retrieve.
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #d4edda; color: #28a745;">+- `user_id`: (*Filter parameter*), `string`</span>
<span style="background-color: #d4edda; color: #28a745;">+  The optional user-defined ID passed in when creating session.</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
#### Response

Success:
</code></pre>

<div id="b7a74134"></div>
<h2>b7a74134</h2>

<p><strong>Message:</strong> Bump infinity to 0.5.2 (#4207)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit b7a7413419ba89da27dd7e68595fdac82c415443
Author: Zhichang Yu &lt;yuzhichang@gmail.com&gt;
Date:   Tue Dec 24 15:17:37 2024 +0800

Bump infinity to 0.5.2 (#4207)

### What problem does this PR solve?

Bump infinity to 0.5.2

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Refactoring</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/docker/docker-compose-base.yml</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/docker/docker-compose-base.yml</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 618c4199..0d11facc 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/docker/docker-compose-base.yml</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/docker/docker-compose-base.yml</span>
@@ -39,7 +39,7 @@ services:
container_name: ragflow-infinity
profiles:
<span style="background-color: #f8d7da; color: #d73a49;">- infinity</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    image: infiniflow/infinity:v0.5.0</span>
<span style="background-color: #d4edda; color: #28a745;">+    image: infiniflow/infinity:v0.5.2</span>
volumes:
<span style="background-color: #f8d7da; color: #d73a49;">- infinity_data:/var/infinity</span>
<span style="background-color: #f8d7da; color: #d73a49;">- ./infinity_conf.toml:/infinity_conf.toml</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/poetry.lock</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/poetry.lock</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 742eef25..c49a780b 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/poetry.lock</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/poetry.lock</span>
@@ -1,4 +1,4 @@
<span style="background-color: #f8d7da; color: #d73a49;">-# This file is automatically @generated by Poetry 1.8.4 and should not be changed by hand.</span>
<span style="background-color: #d4edda; color: #28a745;">+# This file is automatically @generated by Poetry 1.8.5 and should not be changed by hand.</span>

[[package]]
name = &quot;accelerate&quot;
@@ -44,87 +44,87 @@ files = [

[[package]]
name = &quot;aiohttp&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "3.11.10"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "3.11.11"</span>
description = &quot;Async http client/server framework (asyncio)&quot;
optional = false
python-versions = &quot;&gt;=3.9&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:cbad88a61fa743c5d283ad501b01c153820734118b65aee2bd7dbb735475ce0d"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:80886dac673ceaef499de2f393fc80bb4481a129e6cb29e624a12e3296cc088f"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:61b9bae80ed1f338c42f57c16918853dc51775fb5cb61da70d590de14d8b5fb4"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:9e2e576caec5c6a6b93f41626c9c02fc87cd91538b81a3670b2e04452a63def6"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:02c13415b5732fb6ee7ff64583a5e6ed1c57aa68f17d2bda79c04888dfdc2769"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:4cfce37f31f20800a6a6620ce2cdd6737b82e42e06e6e9bd1b36f546feb3c44f"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:3bbbfff4c679c64e6e23cb213f57cc2c9165c9a65d63717108a644eb5a7398df"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:49c7dbbc1a559ae14fc48387a115b7d4bbc84b4a2c3b9299c31696953c2a5219"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-musllinux_1_2_aarch64.whl", hash = "sha256:68386d78743e6570f054fe7949d6cb37ef2b672b4d3405ce91fafa996f7d9b4d"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-musllinux_1_2_i686.whl", hash = "sha256:9ef405356ba989fb57f84cac66f7b0260772836191ccefbb987f414bcd2979d9"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-musllinux_1_2_ppc64le.whl", hash = "sha256:5d6958671b296febe7f5f859bea581a21c1d05430d1bbdcf2b393599b1cdce77"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-musllinux_1_2_s390x.whl", hash = "sha256:99b7920e7165be5a9e9a3a7f1b680f06f68ff0d0328ff4079e5163990d046767"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-musllinux_1_2_x86_64.whl", hash = "sha256:0dc49f42422163efb7e6f1df2636fe3db72713f6cd94688e339dbe33fe06d61d"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-win32.whl", hash = "sha256:40d1c7a7f750b5648642586ba7206999650208dbe5afbcc5284bcec6579c9b91"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp310-cp310-win_amd64.whl", hash = "sha256:68ff6f48b51bd78ea92b31079817aff539f6c8fc80b6b8d6ca347d7c02384e33"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-macosx_10_9_universal2.whl", hash = "sha256:77c4aa15a89847b9891abf97f3d4048f3c2d667e00f8a623c89ad2dccee6771b"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-macosx_10_9_x86_64.whl", hash = "sha256:909af95a72cedbefe5596f0bdf3055740f96c1a4baa0dd11fd74ca4de0b4e3f1"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-macosx_11_0_arm64.whl", hash = "sha256:386fbe79863eb564e9f3615b959e28b222259da0c48fd1be5929ac838bc65683"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:3de34936eb1a647aa919655ff8d38b618e9f6b7f250cc19a57a4bf7fd2062b6d"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:0c9527819b29cd2b9f52033e7fb9ff08073df49b4799c89cb5754624ecd98299"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:65a96e3e03300b41f261bbfd40dfdbf1c301e87eab7cd61c054b1f2e7c89b9e8"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:98f5635f7b74bcd4f6f72fcd85bea2154b323a9f05226a80bc7398d0c90763b0"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:03b6002e20938fc6ee0918c81d9e776bebccc84690e2b03ed132331cca065ee5"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-musllinux_1_2_aarch64.whl", hash = "sha256:6362cc6c23c08d18ddbf0e8c4d5159b5df74fea1a5278ff4f2c79aed3f4e9f46"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-musllinux_1_2_i686.whl", hash = "sha256:3691ed7726fef54e928fe26344d930c0c8575bc968c3e239c2e1a04bd8cf7838"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-musllinux_1_2_ppc64le.whl", hash = "sha256:31d5093d3acd02b31c649d3a69bb072d539d4c7659b87caa4f6d2bcf57c2fa2b"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-musllinux_1_2_s390x.whl", hash = "sha256:8b3cf2dc0f0690a33f2d2b2cb15db87a65f1c609f53c37e226f84edb08d10f52"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-musllinux_1_2_x86_64.whl", hash = "sha256:fbbaea811a2bba171197b08eea288b9402faa2bab2ba0858eecdd0a4105753a3"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-win32.whl", hash = "sha256:4b2c7ac59c5698a7a8207ba72d9e9c15b0fc484a560be0788b31312c2c5504e4"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp311-cp311-win_amd64.whl", hash = "sha256:974d3a2cce5fcfa32f06b13ccc8f20c6ad9c51802bb7f829eae8a1845c4019ec"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:b78f053a7ecfc35f0451d961dacdc671f4bcbc2f58241a7c820e9d82559844cf"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:ab7485222db0959a87fbe8125e233b5a6f01f4400785b36e8a7878170d8c3138"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:cf14627232dfa8730453752e9cdc210966490992234d77ff90bc8dc0dce361d5"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:076bc454a7e6fd646bc82ea7f98296be0b1219b5e3ef8a488afbdd8e81fbac50"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:482cafb7dc886bebeb6c9ba7925e03591a62ab34298ee70d3dd47ba966370d2c"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:bf3d1a519a324af764a46da4115bdbd566b3c73fb793ffb97f9111dbc684fc4d"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:24213ba85a419103e641e55c27dc7ff03536c4873470c2478cce3311ba1eee7b"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:b99acd4730ad1b196bfb03ee0803e4adac371ae8efa7e1cbc820200fc5ded109"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:14cdb5a9570be5a04eec2ace174a48ae85833c2aadc86de68f55541f66ce42ab"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:7e97d622cb083e86f18317282084bc9fbf261801b0192c34fe4b1febd9f7ae69"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:012f176945af138abc10c4a48743327a92b4ca9adc7a0e078077cdb5dbab7be0"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:44224d815853962f48fe124748227773acd9686eba6dc102578defd6fc99e8d9"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:c87bf31b7fdab94ae3adbe4a48e711bfc5f89d21cf4c197e75561def39e223bc"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-win32.whl", hash = "sha256:06a8e2ee1cbac16fe61e51e0b0c269400e781b13bcfc33f5425912391a542985"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp312-cp312-win_amd64.whl", hash = "sha256:be2b516f56ea883a3e14dda17059716593526e10fb6303189aaf5503937db408"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:8cc5203b817b748adccb07f36390feb730b1bc5f56683445bfe924fc270b8816"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:5ef359ebc6949e3a34c65ce20230fae70920714367c63afd80ea0c2702902ccf"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:9bca390cb247dbfaec3c664326e034ef23882c3f3bfa5fbf0b56cad0320aaca5"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:811f23b3351ca532af598405db1093f018edf81368e689d1b508c57dcc6b6a32"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:ddf5f7d877615f6a1e75971bfa5ac88609af3b74796ff3e06879e8422729fd01"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:6ab29b8a0beb6f8eaf1e5049252cfe74adbaafd39ba91e10f18caeb0e99ffb34"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:c49a76c1038c2dd116fa443eba26bbb8e6c37e924e2513574856de3b6516be99"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:7f3dc0e330575f5b134918976a645e79adf333c0a1439dcf6899a80776c9ab39"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:efb15a17a12497685304b2d976cb4939e55137df7b09fa53f1b6a023f01fcb4e"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:db1d0b28fcb7f1d35600150c3e4b490775251dea70f894bf15c678fdd84eda6a"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:15fccaf62a4889527539ecb86834084ecf6e9ea70588efde86e8bc775e0e7542"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:593c114a2221444f30749cc5e5f4012488f56bd14de2af44fe23e1e9894a9c60"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:7852bbcb4d0d2f0c4d583f40c3bc750ee033265d80598d0f9cb6f372baa6b836"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-win32.whl", hash = "sha256:65e55ca7debae8faaffee0ebb4b47a51b4075f01e9b641c31e554fd376595c6c"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp313-cp313-win_amd64.whl", hash = "sha256:beb39a6d60a709ae3fb3516a1581777e7e8b76933bb88c8f4420d875bb0267c6"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-macosx_10_9_universal2.whl", hash = "sha256:0580f2e12de2138f34debcd5d88894786453a76e98febaf3e8fe5db62d01c9bf"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-macosx_10_9_x86_64.whl", hash = "sha256:a55d2ad345684e7c3dd2c20d2f9572e9e1d5446d57200ff630e6ede7612e307f"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-macosx_11_0_arm64.whl", hash = "sha256:04814571cb72d65a6899db6099e377ed00710bf2e3eafd2985166f2918beaf59"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:e44a9a3c053b90c6f09b1bb4edd880959f5328cf63052503f892c41ea786d99f"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:502a1464ccbc800b4b1995b302efaf426e8763fadf185e933c2931df7db9a199"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:613e5169f8ae77b1933e42e418a95931fb4867b2991fc311430b15901ed67079"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4cca22a61b7fe45da8fc73c3443150c3608750bbe27641fc7558ec5117b27fdf"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:86a5dfcc39309470bd7b68c591d84056d195428d5d2e0b5ccadfbaf25b026ebc"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-musllinux_1_2_aarch64.whl", hash = "sha256:77ae58586930ee6b2b6f696c82cf8e78c8016ec4795c53e36718365f6959dc82"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-musllinux_1_2_i686.whl", hash = "sha256:78153314f26d5abef3239b4a9af20c229c6f3ecb97d4c1c01b22c4f87669820c"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-musllinux_1_2_ppc64le.whl", hash = "sha256:98283b94cc0e11c73acaf1c9698dea80c830ca476492c0fe2622bd931f34b487"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-musllinux_1_2_s390x.whl", hash = "sha256:53bf2097e05c2accc166c142a2090e4c6fd86581bde3fd9b2d3f9e93dda66ac1"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-musllinux_1_2_x86_64.whl", hash = "sha256:c5532f0441fc09c119e1dca18fbc0687e64fbeb45aa4d6a87211ceaee50a74c4"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-win32.whl", hash = "sha256:47ad15a65fb41c570cd0ad9a9ff8012489e68176e7207ec7b82a0940dddfd8be"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10-cp39-cp39-win_amd64.whl", hash = "sha256:c6b9e6d7e41656d78e37ce754813fa44b455c3d0d0dced2a047def7dc5570b74"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "aiohttp-3.11.10.tar.gz", hash = "sha256:b1fc6b45010a8d0ff9e88f9f2418c6fd408c99c211257334aff41597ebece42e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:a60804bff28662cbcf340a4d61598891f12eea3a66af48ecfdc975ceec21e3c8"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:4b4fa1cb5f270fb3eab079536b764ad740bb749ce69a94d4ec30ceee1b5940d5"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:731468f555656767cda219ab42e033355fe48c85fbe3ba83a349631541715ba2"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:cb23d8bb86282b342481cad4370ea0853a39e4a32a0042bb52ca6bdde132df43"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:f047569d655f81cb70ea5be942ee5d4421b6219c3f05d131f64088c73bb0917f"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:dd7659baae9ccf94ae5fe8bfaa2c7bc2e94d24611528395ce88d009107e00c6d"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:af01e42ad87ae24932138f154105e88da13ce7d202a6de93fafdafb2883a00ef"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:5854be2f3e5a729800bac57a8d76af464e160f19676ab6aea74bde18ad19d438"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-musllinux_1_2_aarch64.whl", hash = "sha256:6526e5fb4e14f4bbf30411216780c9967c20c5a55f2f51d3abd6de68320cc2f3"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-musllinux_1_2_i686.whl", hash = "sha256:85992ee30a31835fc482468637b3e5bd085fa8fe9392ba0bdcbdc1ef5e9e3c55"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-musllinux_1_2_ppc64le.whl", hash = "sha256:88a12ad8ccf325a8a5ed80e6d7c3bdc247d66175afedbe104ee2aaca72960d8e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-musllinux_1_2_s390x.whl", hash = "sha256:0a6d3fbf2232e3a08c41eca81ae4f1dff3d8f1a30bae415ebe0af2d2458b8a33"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-musllinux_1_2_x86_64.whl", hash = "sha256:84a585799c58b795573c7fa9b84c455adf3e1d72f19a2bf498b54a95ae0d194c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-win32.whl", hash = "sha256:bfde76a8f430cf5c5584553adf9926534352251d379dcb266ad2b93c54a29745"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp310-cp310-win_amd64.whl", hash = "sha256:0fd82b8e9c383af11d2b26f27a478640b6b83d669440c0a71481f7c865a51da9"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-macosx_10_9_universal2.whl", hash = "sha256:ba74ec819177af1ef7f59063c6d35a214a8fde6f987f7661f4f0eecc468a8f76"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-macosx_10_9_x86_64.whl", hash = "sha256:4af57160800b7a815f3fe0eba9b46bf28aafc195555f1824555fa2cfab6c1538"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-macosx_11_0_arm64.whl", hash = "sha256:ffa336210cf9cd8ed117011085817d00abe4c08f99968deef0013ea283547204"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:81b8fe282183e4a3c7a1b72f5ade1094ed1c6345a8f153506d114af5bf8accd9"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:3af41686ccec6a0f2bdc66686dc0f403c41ac2089f80e2214a0f82d001052c03"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:70d1f9dde0e5dd9e292a6d4d00058737052b01f3532f69c0c65818dac26dc287"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:249cc6912405917344192b9f9ea5cd5b139d49e0d2f5c7f70bdfaf6b4dbf3a2e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:0eb98d90b6690827dcc84c246811feeb4e1eea683c0eac6caed7549be9c84665"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-musllinux_1_2_aarch64.whl", hash = "sha256:ec82bf1fda6cecce7f7b915f9196601a1bd1a3079796b76d16ae4cce6d0ef89b"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-musllinux_1_2_i686.whl", hash = "sha256:9fd46ce0845cfe28f108888b3ab17abff84ff695e01e73657eec3f96d72eef34"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-musllinux_1_2_ppc64le.whl", hash = "sha256:bd176afcf8f5d2aed50c3647d4925d0db0579d96f75a31e77cbaf67d8a87742d"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-musllinux_1_2_s390x.whl", hash = "sha256:ec2aa89305006fba9ffb98970db6c8221541be7bee4c1d027421d6f6df7d1ce2"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-musllinux_1_2_x86_64.whl", hash = "sha256:92cde43018a2e17d48bb09c79e4d4cb0e236de5063ce897a5e40ac7cb4878773"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-win32.whl", hash = "sha256:aba807f9569455cba566882c8938f1a549f205ee43c27b126e5450dc9f83cc62"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp311-cp311-win_amd64.whl", hash = "sha256:ae545f31489548c87b0cced5755cfe5a5308d00407000e72c4fa30b19c3220ac"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:e595c591a48bbc295ebf47cb91aebf9bd32f3ff76749ecf282ea7f9f6bb73886"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:3ea1b59dc06396b0b424740a10a0a63974c725b1c64736ff788a3689d36c02d2"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:8811f3f098a78ffa16e0ea36dffd577eb031aea797cbdba81be039a4169e242c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:bd7227b87a355ce1f4bf83bfae4399b1f5bb42e0259cb9405824bd03d2f4336a"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:d40f9da8cabbf295d3a9dae1295c69975b86d941bc20f0a087f0477fa0a66231"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:ffb3dc385f6bb1568aa974fe65da84723210e5d9707e360e9ecb51f59406cd2e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:a8f5f7515f3552d899c61202d99dcb17d6e3b0de777900405611cd747cecd1b8"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:3499c7ffbfd9c6a3d8d6a2b01c26639da7e43d47c7b4f788016226b1e711caa8"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:8e2bf8029dbf0810c7bfbc3e594b51c4cc9101fbffb583a3923aea184724203c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-musllinux_1_2_i686.whl", hash = "sha256:b6212a60e5c482ef90f2d788835387070a88d52cf6241d3916733c9176d39eab"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-musllinux_1_2_ppc64le.whl", hash = "sha256:d119fafe7b634dbfa25a8c597718e69a930e4847f0b88e172744be24515140da"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-musllinux_1_2_s390x.whl", hash = "sha256:6fba278063559acc730abf49845d0e9a9e1ba74f85f0ee6efd5803f08b285853"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:92fc484e34b733704ad77210c7957679c5c3877bd1e6b6d74b185e9320cc716e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-win32.whl", hash = "sha256:9f5b3c1ed63c8fa937a920b6c1bec78b74ee09593b3f5b979ab2ae5ef60d7600"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp312-cp312-win_amd64.whl", hash = "sha256:1e69966ea6ef0c14ee53ef7a3d68b564cc408121ea56c0caa2dc918c1b2f553d"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:541d823548ab69d13d23730a06f97460f4238ad2e5ed966aaf850d7c369782d9"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:929f3ed33743a49ab127c58c3e0a827de0664bfcda566108989a14068f820194"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:0882c2820fd0132240edbb4a51eb8ceb6eef8181db9ad5291ab3332e0d71df5f"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:b63de12e44935d5aca7ed7ed98a255a11e5cb47f83a9fded7a5e41c40277d104"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:aa54f8ef31d23c506910c21163f22b124facb573bff73930735cf9fe38bf7dff"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:a344d5dc18074e3872777b62f5f7d584ae4344cd6006c17ba12103759d407af3"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:0b7fb429ab1aafa1f48578eb315ca45bd46e9c37de11fe45c7f5f4138091e2f1"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:c341c7d868750e31961d6d8e60ff040fb9d3d3a46d77fd85e1ab8e76c3e9a5c4"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:ed9ee95614a71e87f1a70bc81603f6c6760128b140bc4030abe6abaa988f1c3d"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-musllinux_1_2_i686.whl", hash = "sha256:de8d38f1c2810fa2a4f1d995a2e9c70bb8737b18da04ac2afbf3971f65781d87"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-musllinux_1_2_ppc64le.whl", hash = "sha256:a9b7371665d4f00deb8f32208c7c5e652059b0fda41cf6dbcac6114a041f1cc2"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-musllinux_1_2_s390x.whl", hash = "sha256:620598717fce1b3bd14dd09947ea53e1ad510317c85dda2c9c65b622edc96b12"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:bf8d9bfee991d8acc72d060d53860f356e07a50f0e0d09a8dfedea1c554dd0d5"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-win32.whl", hash = "sha256:9d73ee3725b7a737ad86c2eac5c57a4a97793d9f442599bea5ec67ac9f4bdc3d"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp313-cp313-win_amd64.whl", hash = "sha256:c7a06301c2fb096bdb0bd25fe2011531c1453b9f2c163c8031600ec73af1cc99"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-macosx_10_9_universal2.whl", hash = "sha256:3e23419d832d969f659c208557de4a123e30a10d26e1e14b73431d3c13444c2e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-macosx_10_9_x86_64.whl", hash = "sha256:21fef42317cf02e05d3b09c028712e1d73a9606f02467fd803f7c1f39cc59add"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-macosx_11_0_arm64.whl", hash = "sha256:1f21bb8d0235fc10c09ce1d11ffbd40fc50d3f08a89e4cf3a0c503dc2562247a"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:1642eceeaa5ab6c9b6dfeaaa626ae314d808188ab23ae196a34c9d97efb68350"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", hash = "sha256:2170816e34e10f2fd120f603e951630f8a112e1be3b60963a1f159f5699059a6"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:8be8508d110d93061197fd2d6a74f7401f73b6d12f8822bbcd6d74f2b55d71b1"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:4eed954b161e6b9b65f6be446ed448ed3921763cc432053ceb606f89d793927e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-manylinux_2_5_i686.manylinux1_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:d6c9af134da4bc9b3bd3e6a70072509f295d10ee60c697826225b60b9959acdd"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-musllinux_1_2_aarch64.whl", hash = "sha256:44167fc6a763d534a6908bdb2592269b4bf30a03239bcb1654781adf5e49caf1"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-musllinux_1_2_i686.whl", hash = "sha256:479b8c6ebd12aedfe64563b85920525d05d394b85f166b7873c8bde6da612f9c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-musllinux_1_2_ppc64le.whl", hash = "sha256:10b4ff0ad793d98605958089fabfa350e8e62bd5d40aa65cdc69d6785859f94e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-musllinux_1_2_s390x.whl", hash = "sha256:b540bd67cfb54e6f0865ceccd9979687210d7ed1a1cc8c01f8e67e2f1e883d28"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-musllinux_1_2_x86_64.whl", hash = "sha256:1dac54e8ce2ed83b1f6b1a54005c87dfed139cf3f777fdc8afc76e7841101226"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-win32.whl", hash = "sha256:568c1236b2fde93b7720f95a890741854c1200fba4a3471ff48b2934d2d93fd3"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11-cp39-cp39-win_amd64.whl", hash = "sha256:943a8b052e54dfd6439fd7989f67fc6a7f2138d0a2cf0a7de5f18aa4fe7eb3b1"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "aiohttp-3.11.11.tar.gz", hash = "sha256:bb49c7f1e6ebf3821a42d81d494f538107610c3a705987f53068546b0e90303e"},</span>
]

[package.dependencies]
@@ -196,13 +196,13 @@ files = [

[[package]]
name = &quot;akshare&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "1.15.49"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "1.15.53"</span>
description = &quot;AKShare is an elegant and simple financial data interface library for Python, built for human beings!&quot;
optional = false
python-versions = &quot;&gt;=3.8&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "akshare-1.15.49-py3-none-any.whl", hash = "sha256:b1bbcdc0e8fbdcd751210e93ba93ff4cf4eec1bbd7707fcb455b9c9724c5c2d8"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "akshare-1.15.49.tar.gz", hash = "sha256:ae0e400f8c61b2258363c92ec9aacf00f232b9017c8b0a9ada02a6ed3a809a4b"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "akshare-1.15.53-py3-none-any.whl", hash = "sha256:f19c951d20f967c7fa95f95ae64d8534b71bffac7c69442e9046e0e668d64591"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "akshare-1.15.53.tar.gz", hash = "sha256:8f55fe3a8d1fe1eb7d8489e1c865c95df924850b358a90760c10a9ee53dea928"},</span>
]

[package.dependencies]
@@ -565,13 +565,13 @@ dev = [&quot;freezegun (&gt;=1.0,&lt;2.0)&quot;, &quot;pytest (&gt;=6.0)&quot;, &quot;pytest-cov&quot;]

[[package]]
name = &quot;bce-python-sdk&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "0.9.23"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "0.9.25"</span>
description = &quot;BCE SDK for python&quot;
optional = false
python-versions = &quot;&gt;=2.7, !=3.0.*, !=3.1.*, !=3.2.*, &lt;4&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "bce_python_sdk-0.9.23-py3-none-any.whl", hash = "sha256:8debe21a040e00060f6044877d594765ed7b18bc765c6bf16b878bca864140a3"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "bce_python_sdk-0.9.23.tar.gz", hash = "sha256:19739fed5cd0725356fc5ffa2acbdd8fb23f2a81edb91db21a03174551d0cf41"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "bce_python_sdk-0.9.25-py3-none-any.whl", hash = "sha256:cd1ab4c887e163adba6bfb3cd40465a365e5f4255705a015b0cdbe768e649877"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "bce_python_sdk-0.9.25.tar.gz", hash = "sha256:93a0623fbb1bf3a58b4f2d7bdbd799a3b342a538f0c72950c77168e431470e86"},</span>
]

[package.dependencies]
@@ -636,12 +636,12 @@ lxml = [&quot;lxml&quot;]

[[package]]
name = &quot;bibtexparser&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "1.4.2"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "1.4.3"</span>
description = &quot;Bibtex parser for python 3&quot;
optional = false
python-versions = &quot;*&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "bibtexparser-1.4.2.tar.gz", hash = "sha256:dd5d54a1ec6d27b6485ce2f6b9aa514b183fb2b8d4bf5f19333a906eedaf8eaa"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "bibtexparser-1.4.3.tar.gz", hash = "sha256:a9c7ded64bc137720e4df0b1b7f12734edc1361185f1c9097048ff7c35af2b8f"},</span>
]

[package.dependencies]
@@ -1213,13 +1213,13 @@ files = [

[[package]]
name = &quot;click&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "8.1.7"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "8.1.8"</span>
description = &quot;Composable command line interface toolkit&quot;
optional = false
python-versions = &quot;&gt;=3.7&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "click-8.1.7-py3-none-any.whl", hash = "sha256:ae74fb96c20a0277a1d615f1e4d73c8414f5a98db8b799a7931d1582f3390c28"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "click-8.1.7.tar.gz", hash = "sha256:ca9853ad459e787e2192211578cc907e7594e294c7ccc834310722b41b9ca6de"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "click-8.1.8-py3-none-any.whl", hash = "sha256:63c132bbbed01578a06712a2d1f497bb62d9c1c0d329b7903a866228027263b2"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "click-8.1.8.tar.gz", hash = "sha256:ed53c9d8990d83c2a27deae68e4ee337473f6330c040a31d4225c9574d16096a"},</span>
]

[package.dependencies]
@@ -1993,42 +1993,42 @@ files = [

[[package]]
name = &quot;fastavro&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "1.9.7"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "1.10.0"</span>
description = &quot;Fast read/write of AVRO files&quot;
optional = false
<span style="background-color: #f8d7da; color: #d73a49;">-python-versions = ">=3.8"</span>
<span style="background-color: #d4edda; color: #28a745;">+python-versions = ">=3.9"</span>
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:cc811fb4f7b5ae95f969cda910241ceacf82e53014c7c7224df6f6e0ca97f52f"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp310-cp310-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:fb8749e419a85f251bf1ac87d463311874972554d25d4a0b19f6bdc56036d7cf"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:0b2f9bafa167cb4d1c3dd17565cb5bf3d8c0759e42620280d1760f1e778e07fc"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp310-cp310-musllinux_1_2_aarch64.whl", hash = "sha256:e87d04b235b29f7774d226b120da2ca4e60b9e6fdf6747daef7f13f218b3517a"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp310-cp310-musllinux_1_2_x86_64.whl", hash = "sha256:b525c363e267ed11810aaad8fbdbd1c3bd8837d05f7360977d72a65ab8c6e1fa"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp310-cp310-win_amd64.whl", hash = "sha256:6312fa99deecc319820216b5e1b1bd2d7ebb7d6f221373c74acfddaee64e8e60"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp311-cp311-macosx_10_9_universal2.whl", hash = "sha256:ec8499dc276c2d2ef0a68c0f1ad11782b2b956a921790a36bf4c18df2b8d4020"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:76d9d96f98052615ab465c63ba8b76ed59baf2e3341b7b169058db104cbe2aa0"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:919f3549e07a8a8645a2146f23905955c35264ac809f6c2ac18142bc5b9b6022"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp311-cp311-musllinux_1_2_aarch64.whl", hash = "sha256:9de1fa832a4d9016724cd6facab8034dc90d820b71a5d57c7e9830ffe90f31e4"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp311-cp311-musllinux_1_2_x86_64.whl", hash = "sha256:1d09227d1f48f13281bd5ceac958650805aef9a4ef4f95810128c1f9be1df736"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp311-cp311-win_amd64.whl", hash = "sha256:2db993ae6cdc63e25eadf9f93c9e8036f9b097a3e61d19dca42536dcc5c4d8b3"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp312-cp312-macosx_10_9_universal2.whl", hash = "sha256:4e1289b731214a7315884c74b2ec058b6e84380ce9b18b8af5d387e64b18fc44"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:eac69666270a76a3a1d0444f39752061195e79e146271a568777048ffbd91a27"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:9be089be8c00f68e343bbc64ca6d9a13e5e5b0ba8aa52bcb231a762484fb270e"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:d576eccfd60a18ffa028259500df67d338b93562c6700e10ef68bbd88e499731"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:ee9bf23c157bd7dcc91ea2c700fa3bd924d9ec198bb428ff0b47fa37fe160659"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp312-cp312-win_amd64.whl", hash = "sha256:b6b2ccdc78f6afc18c52e403ee68c00478da12142815c1bd8a00973138a166d0"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp38-cp38-macosx_11_0_universal2.whl", hash = "sha256:7313def3aea3dacface0a8b83f6d66e49a311149aa925c89184a06c1ef99785d"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp38-cp38-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:536f5644737ad21d18af97d909dba099b9e7118c237be7e4bd087c7abde7e4f0"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:2af559f30383b79cf7d020a6b644c42ffaed3595f775fe8f3d7f80b1c43dfdc5"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp38-cp38-musllinux_1_2_aarch64.whl", hash = "sha256:edc28ab305e3c424de5ac5eb87b48d1e07eddb6aa08ef5948fcda33cc4d995ce"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp38-cp38-musllinux_1_2_x86_64.whl", hash = "sha256:ec2e96bdabd58427fe683329b3d79f42c7b4f4ff6b3644664a345a655ac2c0a1"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp38-cp38-win_amd64.whl", hash = "sha256:3b683693c8a85ede496ebebe115be5d7870c150986e34a0442a20d88d7771224"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp39-cp39-macosx_10_9_universal2.whl", hash = "sha256:58f76a5c9a312fbd37b84e49d08eb23094d36e10d43bc5df5187bc04af463feb"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp39-cp39-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:56304401d2f4f69f5b498bdd1552c13ef9a644d522d5de0dc1d789cf82f47f73"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:2fcce036c6aa06269fc6a0428050fcb6255189997f5e1a728fc461e8b9d3e26b"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp39-cp39-musllinux_1_2_aarch64.whl", hash = "sha256:17de68aae8c2525f5631d80f2b447a53395cdc49134f51b0329a5497277fc2d2"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp39-cp39-musllinux_1_2_x86_64.whl", hash = "sha256:7c911366c625d0a997eafe0aa83ffbc6fd00d8fd4543cb39a97c6f3b8120ea87"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7-cp39-cp39-win_amd64.whl", hash = "sha256:912283ed48578a103f523817fdf0c19b1755cea9b4a6387b73c79ecb8f8f84fc"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "fastavro-1.9.7.tar.gz", hash = "sha256:13e11c6cb28626da85290933027cd419ce3f9ab8e45410ef24ce6b89d20a1f6c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:1a9fe0672d2caf0fe54e3be659b13de3cad25a267f2073d6f4b9f8862acc31eb"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp310-cp310-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:86dd0410770e0c99363788f0584523709d85e57bb457372ec5c285a482c17fe6"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:190e80dc7d77d03a6a8597a026146b32a0bbe45e3487ab4904dc8c1bebecb26d"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp310-cp310-musllinux_1_2_aarch64.whl", hash = "sha256:bf570d63be9155c3fdc415f60a49c171548334b70fff0679a184b69c29b6bc61"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp310-cp310-musllinux_1_2_x86_64.whl", hash = "sha256:e07abb6798e95dccecaec316265e35a018b523d1f3944ad396d0a93cb95e0a08"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp310-cp310-win_amd64.whl", hash = "sha256:37203097ed11d0b8fd3c004904748777d730cafd26e278167ea602eebdef8eb2"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp311-cp311-macosx_10_9_universal2.whl", hash = "sha256:d183c075f527ab695a27ae75f210d4a86bce660cda2f85ae84d5606efc15ef50"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:d7a95a2c0639bffd7c079b59e9a796bfc3a9acd78acff7088f7c54ade24e4a77"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:0a678153b5da1b024a32ec3f611b2e7afd24deac588cb51dd1b0019935191a6d"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp311-cp311-musllinux_1_2_aarch64.whl", hash = "sha256:67a597a5cfea4dddcf8b49eaf8c2b5ffee7fda15b578849185bc690ec0cd0d8f"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp311-cp311-musllinux_1_2_x86_64.whl", hash = "sha256:1fd689724760b17f69565d8a4e7785ed79becd451d1c99263c40cb2d6491f1d4"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp311-cp311-win_amd64.whl", hash = "sha256:4f949d463f9ac4221128a51e4e34e2562f401e5925adcadfd28637a73df6c2d8"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp312-cp312-macosx_10_13_universal2.whl", hash = "sha256:cfe57cb0d72f304bd0dcc5a3208ca6a7363a9ae76f3073307d095c9d053b29d4"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:74e517440c824cb65fb29d3e3903a9406f4d7c75490cef47e55c4c82cdc66270"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:203c17d44cadde76e8eecb30f2d1b4f33eb478877552d71f049265dc6f2ecd10"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:6575be7f2b5f94023b5a4e766b0251924945ad55e9a96672dc523656d17fe251"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:fe471deb675ed2f01ee2aac958fbf8ebb13ea00fa4ce7f87e57710a0bc592208"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp312-cp312-win_amd64.whl", hash = "sha256:567ff515f2a5d26d9674b31c95477f3e6022ec206124c62169bc2ffaf0889089"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp313-cp313-macosx_10_13_universal2.whl", hash = "sha256:82263af0adfddb39c85f9517d736e1e940fe506dfcc35bc9ab9f85e0fa9236d8"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:566c193109ff0ff84f1072a165b7106c4f96050078a4e6ac7391f81ca1ef3efa"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:e400d2e55d068404d9fea7c5021f8b999c6f9d9afa1d1f3652ec92c105ffcbdd"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:9b8227497f71565270f9249fc9af32a93644ca683a0167cfe66d203845c3a038"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:8e62d04c65461b30ac6d314e4197ad666371e97ae8cb2c16f971d802f6c7f514"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp313-cp313-win_amd64.whl", hash = "sha256:86baf8c9740ab570d0d4d18517da71626fe9be4d1142bea684db52bd5adb078f"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp39-cp39-macosx_10_9_universal2.whl", hash = "sha256:5bccbb6f8e9e5b834cca964f0e6ebc27ebe65319d3940b0b397751a470f45612"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp39-cp39-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:b0132f6b0b53f61a0a508a577f64beb5de1a5e068a9b4c0e1df6e3b66568eec4"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:ca37a363b711202c6071a6d4787e68e15fa3ab108261058c4aae853c582339af"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp39-cp39-musllinux_1_2_aarch64.whl", hash = "sha256:cf38cecdd67ca9bd92e6e9ba34a30db6343e7a3bedf171753ee78f8bd9f8a670"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp39-cp39-musllinux_1_2_x86_64.whl", hash = "sha256:f4dd10e0ed42982122d20cdf1a88aa50ee09e5a9cd9b39abdffb1aa4f5b76435"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0-cp39-cp39-win_amd64.whl", hash = "sha256:aaef147dc14dd2d7823246178fd06fc5e477460e070dc6d9e07dd8193a6bc93c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "fastavro-1.10.0.tar.gz", hash = "sha256:47bf41ac6d52cdfe4a3da88c75a802321321b37b663a900d12765101a5d6886f"},</span>
]

[package.extras]
@@ -2282,13 +2282,13 @@ sqlalchemy = [&quot;flask-sqlalchemy (&gt;=3.0.5)&quot;]

[[package]]
name = &quot;flatbuffers&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "24.3.25"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "24.12.23"</span>
description = &quot;The FlatBuffers serialization format for Python&quot;
optional = false
python-versions = &quot;*&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "flatbuffers-24.3.25-py2.py3-none-any.whl", hash = "sha256:8dbdec58f935f3765e4f7f3cf635ac3a77f83568138d6a2311f524ec96364812"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "flatbuffers-24.3.25.tar.gz", hash = "sha256:de2ec5b203f21441716617f38443e0a8ebf3d25bf0d9c0bb0ce68fa00ad546a4"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "flatbuffers-24.12.23-py2.py3-none-any.whl", hash = "sha256:c418e0d48890f4142b92fd3e343e73a48f194e1f80075ddcc5793779b3585444"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "flatbuffers-24.12.23.tar.gz", hash = "sha256:2910b0bc6ae9b6db78dd2b18d0b7a0709ba240fb5585f286a3a2b30785c22dac"},</span>
]

[[package]]
@@ -2643,13 +2643,13 @@ grpcio-gcp = [&quot;grpcio-gcp (&gt;=0.2.2,&lt;1.0.dev0)&quot;]

[[package]]
name = &quot;google-api-python-client&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "2.155.0"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "2.156.0"</span>
description = &quot;Google API Client Library for Python&quot;
optional = false
python-versions = &quot;&gt;=3.7&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "google_api_python_client-2.155.0-py2.py3-none-any.whl", hash = "sha256:83fe9b5aa4160899079d7c93a37be306546a17e6686e2549bcc9584f1a229747"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "google_api_python_client-2.155.0.tar.gz", hash = "sha256:25529f89f0d13abcf3c05c089c423fb2858ac16e0b3727543393468d0d7af67c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "google_api_python_client-2.156.0-py2.py3-none-any.whl", hash = "sha256:6352185c505e1f311f11b0b96c1b636dcb0fec82cd04b80ac5a671ac4dcab339"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "google_api_python_client-2.156.0.tar.gz", hash = "sha256:b809c111ded61716a9c1c7936e6899053f13bae3defcdfda904bd2ca68065b9c"},</span>
]

[package.dependencies]
@@ -3678,12 +3678,12 @@ vision = [&quot;colpali-engine (&gt;=0.3.1,&lt;0.4.0)&quot;, &quot;pillow&quot;, &quot;timm&quot;, &quot;torchvision&quot;]

[[package]]
name = &quot;infinity-sdk&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "0.5.0"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "0.5.2"</span>
description = &quot;infinity&quot;
optional = false
python-versions = &quot;&gt;=3.10&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "infinity_sdk-0.5.0-py3-none-any.whl", hash = "sha256:ac88dfe5984b45bb11cadd46567552e16dd5a7fb336e164c2e3faf63c20394ca"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "infinity_sdk-0.5.2-py3-none-any.whl", hash = "sha256:fb45ea3e7eaf834ba05fc233c23b075fce5b89f330500d53a92c417270193800"},</span>
]

[package.dependencies]
@@ -3794,13 +3794,13 @@ files = [

[[package]]
name = &quot;jinja2&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "3.1.4"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "3.1.5"</span>
description = &quot;A very fast and expressive template engine.&quot;
optional = false
python-versions = &quot;&gt;=3.7&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "jinja2-3.1.4-py3-none-any.whl", hash = "sha256:bc5dd2abb727a5319567b7a813e6a2e7318c39f4f487cfe6c89c6f9c7d25197d"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "jinja2-3.1.4.tar.gz", hash = "sha256:4a3aee7acbbe7303aede8e9648d13b8bf88a429282aa6122a993f0ac800cb369"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "jinja2-3.1.5-py3-none-any.whl", hash = "sha256:aba0f4dc9ed8013c424088f68a5c226f7d6097ed89b246d7749c2ec4175c6adb"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "jinja2-3.1.5.tar.gz", hash = "sha256:8fefff8dc3034e27bb80d67c671eb8a9bc424c0ef4c0826edbff304cceff43bb"},</span>
]

[package.dependencies]
@@ -6268,32 +6268,32 @@ files = [

[[package]]
name = &quot;psutil&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "6.1.0"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "6.1.1"</span>
description = &quot;Cross-platform lib for process and system monitoring in Python.&quot;
optional = false
python-versions = &quot;&gt;=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*, !=3.5.*&quot;
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp27-cp27m-macosx_10_9_x86_64.whl", hash = "sha256:ff34df86226c0227c52f38b919213157588a678d049688eded74c76c8ba4a5d0"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp27-cp27m-manylinux2010_i686.whl", hash = "sha256:c0e0c00aa18ca2d3b2b991643b799a15fc8f0563d2ebb6040f64ce8dc027b942"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp27-cp27m-manylinux2010_x86_64.whl", hash = "sha256:000d1d1ebd634b4efb383f4034437384e44a6d455260aaee2eca1e9c1b55f047"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp27-cp27mu-manylinux2010_i686.whl", hash = "sha256:5cd2bcdc75b452ba2e10f0e8ecc0b57b827dd5d7aaffbc6821b2a9a242823a76"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp27-cp27mu-manylinux2010_x86_64.whl", hash = "sha256:045f00a43c737f960d273a83973b2511430d61f283a44c96bf13a6e829ba8fdc"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp27-none-win32.whl", hash = "sha256:9118f27452b70bb1d9ab3198c1f626c2499384935aaf55388211ad982611407e"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp27-none-win_amd64.whl", hash = "sha256:a8506f6119cff7015678e2bce904a4da21025cc70ad283a53b099e7620061d85"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp36-abi3-macosx_10_9_x86_64.whl", hash = "sha256:6e2dcd475ce8b80522e51d923d10c7871e45f20918e027ab682f94f1c6351688"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp36-abi3-macosx_11_0_arm64.whl", hash = "sha256:0895b8414afafc526712c498bd9de2b063deaac4021a3b3c34566283464aff8e"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp36-abi3-manylinux_2_12_i686.manylinux2010_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:9dcbfce5d89f1d1f2546a2090f4fcf87c7f669d1d90aacb7d7582addece9fb38"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp36-abi3-manylinux_2_12_x86_64.manylinux2010_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:498c6979f9c6637ebc3a73b3f87f9eb1ec24e1ce53a7c5173b8508981614a90b"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp36-abi3-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:d905186d647b16755a800e7263d43df08b790d709d575105d419f8b6ef65423a"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp36-cp36m-win32.whl", hash = "sha256:6d3fbbc8d23fcdcb500d2c9f94e07b1342df8ed71b948a2649b5cb060a7c94ca"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp36-cp36m-win_amd64.whl", hash = "sha256:1209036fbd0421afde505a4879dee3b2fd7b1e14fee81c0069807adcbbcca747"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp37-abi3-win32.whl", hash = "sha256:1ad45a1f5d0b608253b11508f80940985d1d0c8f6111b5cb637533a0e6ddc13e"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0-cp37-abi3-win_amd64.whl", hash = "sha256:a8fb3752b491d246034fa4d279ff076501588ce8cbcdbb62c32fd7a377d996be"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "psutil-6.1.0.tar.gz", hash = "sha256:353815f59a7f64cdaca1c0307ee13558a0512f6db064e92fe833784f08539c7a"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-]</span>
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #f8d7da; color: #d73a49;">-[package.extras]</span>
<span style="background-color: #f8d7da; color: #d73a49;">-dev = ["black", "check-manifest", "coverage", "packaging", "pylint", "pyperf", "pypinfo", "pytest-cov", "requests", "rstcheck", "ruff", "sphinx", "sphinx-rtd-theme", "toml-sort", "twine", "virtualenv", "wheel"]</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp27-cp27m-macosx_10_9_x86_64.whl", hash = "sha256:9ccc4316f24409159897799b83004cb1e24f9819b0dcf9c0b68bdcb6cefee6a8"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp27-cp27m-manylinux2010_i686.whl", hash = "sha256:ca9609c77ea3b8481ab005da74ed894035936223422dc591d6772b147421f777"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp27-cp27m-manylinux2010_x86_64.whl", hash = "sha256:8df0178ba8a9e5bc84fed9cfa61d54601b371fbec5c8eebad27575f1e105c0d4"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp27-cp27mu-manylinux2010_i686.whl", hash = "sha256:1924e659d6c19c647e763e78670a05dbb7feaf44a0e9c94bf9e14dfc6ba50468"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp27-cp27mu-manylinux2010_x86_64.whl", hash = "sha256:018aeae2af92d943fdf1da6b58665124897cfc94faa2ca92098838f83e1b1bca"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp27-none-win32.whl", hash = "sha256:6d4281f5bbca041e2292be3380ec56a9413b790579b8e593b1784499d0005dac"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp27-none-win_amd64.whl", hash = "sha256:c777eb75bb33c47377c9af68f30e9f11bc78e0f07fbf907be4a5d70b2fe5f030"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp36-abi3-macosx_10_9_x86_64.whl", hash = "sha256:fc0ed7fe2231a444fc219b9c42d0376e0a9a1a72f16c5cfa0f68d19f1a0663e8"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp36-abi3-macosx_11_0_arm64.whl", hash = "sha256:0bdd4eab935276290ad3cb718e9809412895ca6b5b334f5a9111ee6d9aff9377"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp36-abi3-manylinux_2_12_i686.manylinux2010_i686.manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:b6e06c20c05fe95a3d7302d74e7097756d4ba1247975ad6905441ae1b5b66003"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp36-abi3-manylinux_2_12_x86_64.manylinux2010_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:97f7cb9921fbec4904f522d972f0c0e1f4fabbdd4e0287813b21215074a0f160"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp36-abi3-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:33431e84fee02bc84ea36d9e2c4a6d395d479c9dd9bba2376c1f6ee8f3a4e0b3"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp36-cp36m-win32.whl", hash = "sha256:384636b1a64b47814437d1173be1427a7c83681b17a450bfc309a1953e329603"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp36-cp36m-win_amd64.whl", hash = "sha256:8be07491f6ebe1a693f17d4f11e69d0dc1811fa082736500f649f79df7735303"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp37-abi3-win32.whl", hash = "sha256:eaa912e0b11848c4d9279a93d7e2783df352b082f40111e078388701fd479e53"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1-cp37-abi3-win_amd64.whl", hash = "sha256:f35cfccb065fff93529d2afb4a2e89e363fe63ca1e4a5da22b603a85833c2649"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "psutil-6.1.1.tar.gz", hash = "sha256:cf8496728c18f2d0b45198f06895be52f36611711746b7f30c464b422b50e2f5"},</span>
<span style="background-color: #d4edda; color: #28a745;">+]</span>
<span style="background-color: #d4edda; color: #28a745;">+</span>
<span style="background-color: #d4edda; color: #28a745;">+[package.extras]</span>
<span style="background-color: #d4edda; color: #28a745;">+dev = ["abi3audit", "black", "check-manifest", "coverage", "packaging", "pylint", "pyperf", "pypinfo", "pytest-cov", "requests", "rstcheck", "ruff", "sphinx", "sphinx-rtd-theme", "toml-sort", "twine", "virtualenv", "vulture", "wheel"]</span>
test = [&quot;enum34&quot;, &quot;futures&quot;, &quot;ipaddress&quot;, &quot;mock (==1.0.1)&quot;, &quot;pytest (==4.6.11)&quot;, &quot;pytest-xdist&quot;, &quot;setuptools&quot;, &quot;unittest2&quot;]

[[package]]
@@ -7024,24 +7024,24 @@ image = [&quot;Pillow&quot;]

[[package]]
name = &quot;pypdfium2&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "4.30.0"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "4.30.1"</span>
description = &quot;Python bindings to PDFium&quot;
optional = false
<span style="background-color: #f8d7da; color: #d73a49;">-python-versions = ">=3.6"</span>
<span style="background-color: #d4edda; color: #28a745;">+python-versions = ">= 3.6"</span>
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-macosx_10_13_x86_64.whl", hash = "sha256:b33ceded0b6ff5b2b93bc1fe0ad4b71aa6b7e7bd5875f1ca0cdfb6ba6ac01aab"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-macosx_11_0_arm64.whl", hash = "sha256:4e55689f4b06e2d2406203e771f78789bd4f190731b5d57383d05cf611d829de"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:4e6e50f5ce7f65a40a33d7c9edc39f23140c57e37144c2d6d9e9262a2a854854"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:3d0dd3ecaffd0b6dbda3da663220e705cb563918249bda26058c6036752ba3a2"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:cc3bf29b0db8c76cdfaac1ec1cde8edf211a7de7390fbf8934ad2aa9b4d6dfad"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:f1f78d2189e0ddf9ac2b7a9b9bd4f0c66f54d1389ff6c17e9fd9dc034d06eb3f"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-musllinux_1_1_aarch64.whl", hash = "sha256:5eda3641a2da7a7a0b2f4dbd71d706401a656fea521b6b6faa0675b15d31a163"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-musllinux_1_1_i686.whl", hash = "sha256:0dfa61421b5eb68e1188b0b2231e7ba35735aef2d867d86e48ee6cab6975195e"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-musllinux_1_1_x86_64.whl", hash = "sha256:f33bd79e7a09d5f7acca3b0b69ff6c8a488869a7fab48fdf400fec6e20b9c8be"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-win32.whl", hash = "sha256:ee2410f15d576d976c2ab2558c93d392a25fb9f6635e8dd0a8a3a5241b275e0e"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-win_amd64.whl", hash = "sha256:90dbb2ac07be53219f56be09961eb95cf2473f834d01a42d901d13ccfad64b4c"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0-py3-none-win_arm64.whl", hash = "sha256:119b2969a6d6b1e8d55e99caaf05290294f2d0fe49c12a3f17102d01c441bd29"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "pypdfium2-4.30.0.tar.gz", hash = "sha256:48b5b7e5566665bc1015b9d69c1ebabe21f6aee468b509531c3c8318eeee2e16"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-macosx_10_13_x86_64.whl", hash = "sha256:e07c47633732cc18d890bb7e965ad28a9c5a932e548acb928596f86be2e5ae37"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-macosx_11_0_arm64.whl", hash = "sha256:5ea2d44e96d361123b67b00f527017aa9c847c871b5714e013c01c3eb36a79fe"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:1de7a3a36803171b3f66911131046d65a732f9e7834438191cb58235e6163c4e"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", hash = "sha256:b8a4231efb13170354f568c722d6540b8d5b476b08825586d48ef70c40d16e03"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-manylinux_2_17_i686.manylinux2014_i686.whl", hash = "sha256:6f434a4934e8244aa95343ffcf24e9ad9f120dbb4785f631bb40a88c39292493"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:f454032a0bc7681900170f67d8711b3942824531e765f91c2f5ce7937f999794"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-musllinux_1_1_aarch64.whl", hash = "sha256:bbf9130a72370ee9d602e39949b902db669a2a1c24746a91e5586eb829055d9f"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-musllinux_1_1_i686.whl", hash = "sha256:5cb52884b1583b96e94fd78542c63bb42e06df5e8f9e52f8f31f5ad5a1e53367"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-musllinux_1_1_x86_64.whl", hash = "sha256:1a9e372bd4867ff223cc8c338e33fe11055dad12f22885950fc27646cc8d9122"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-win32.whl", hash = "sha256:421f1cf205e213e07c1f2934905779547f4f4a2ff2f59dde29da3d511d3fc806"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-win_amd64.whl", hash = "sha256:598a7f20264ab5113853cba6d86c4566e4356cad037d7d1f849c8c9021007e05"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1-py3-none-win_arm64.whl", hash = "sha256:c2b6d63f6d425d9416c08d2511822b54b8e3ac38e639fc41164b1d75584b3a8c"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "pypdfium2-4.30.1.tar.gz", hash = "sha256:5f5c7c6d03598e107d974f66b220a49436aceb191da34cda5f692be098a814ce"},</span>
]

[[package]]
@@ -9294,13 +9294,13 @@ tbb = [&quot;tbb (&gt;=2019.0)&quot;]

[[package]]
name = &quot;unlzw3&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "0.2.2"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "0.2.3"</span>
description = &quot;Pure Python decompression module for .Z files compressed using Unix compress utility&quot;
optional = false
<span style="background-color: #f8d7da; color: #d73a49;">-python-versions = ">=3.7"</span>
<span style="background-color: #d4edda; color: #28a745;">+python-versions = ">=3.9"</span>
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "unlzw3-0.2.2-py3-none-any.whl", hash = "sha256:f2a40fbd2a3c9648745227e5d269a851dbed7802999db4654d358a40a5d61c2f"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "unlzw3-0.2.2.tar.gz", hash = "sha256:d037a9b6823d1a455d6de1e0258af8c0f5dbf40aba3b19cc514448e78da77062"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "unlzw3-0.2.3-py3-none-any.whl", hash = "sha256:7760fb4f3afa1225623944c061991d89a061f7fb78665dbc4cddfdb562bb4a8b"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "unlzw3-0.2.3.tar.gz", hash = "sha256:ede5d928c792fff9da406f20334f9739693327f448f383ae1df1774627197bbb"},</span>
]

[package.extras]
@@ -9320,13 +9320,13 @@ files = [

[[package]]
name = &quot;urllib3&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-version = "2.2.3"</span>
<span style="background-color: #d4edda; color: #28a745;">+version = "2.3.0"</span>
description = &quot;HTTP library with thread-safe connection pooling, file post, and more.&quot;
optional = false
<span style="background-color: #f8d7da; color: #d73a49;">-python-versions = ">=3.8"</span>
<span style="background-color: #d4edda; color: #28a745;">+python-versions = ">=3.9"</span>
files = [
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "urllib3-2.2.3-py3-none-any.whl", hash = "sha256:ca899ca043dcb1bafa3e262d73aa25c465bfb49e0bd9dd5d59f1d0acba2f8fac"},</span>
<span style="background-color: #f8d7da; color: #d73a49;">-    {file = "urllib3-2.2.3.tar.gz", hash = "sha256:e7d814a81dad81e6caf2ec9fdedb284ecc9c73076b62654547cc64ccdcae26e9"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "urllib3-2.3.0-py3-none-any.whl", hash = "sha256:1cee9ad369867bfdbbb48b7dd50374c0967a0bb7710050facf0dd6911440e3df"},</span>
<span style="background-color: #d4edda; color: #28a745;">+    {file = "urllib3-2.3.0.tar.gz", hash = "sha256:f8c5449b3cf0861679ce7e0503c7b44b5ec981bec0d1d3795a07f1ba96f0204d"},</span>
]

[package.dependencies]
@@ -10150,4 +10150,4 @@ cffi = [&quot;cffi (&gt;=1.11)&quot;]
[metadata]
lock-version = &quot;2.0&quot;
python-versions = &quot;&gt;=3.10,&lt;3.13&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-content-hash = "4c592934d67923be94f92704ac2cd646f8f7a7f59c4a94707677f4be29c5a7b1"</span>
\ No newline at end of file
<span style="background-color: #d4edda; color: #28a745;">+content-hash = "fea9a86cc56c010942cd40789eb68be585721e777f069bf3158b0df98fb521df"</span>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/pyproject.toml</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/pyproject.toml</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 546077d0..826747ac 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/pyproject.toml</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/pyproject.toml</span>
@@ -48,7 +48,7 @@ hanziconv = &quot;0.3.2&quot;
html-text = &quot;0.6.2&quot;
httpx = &quot;0.27.0&quot;
huggingface-hub = &quot;^0.25.0&quot;
<span style="background-color: #f8d7da; color: #d73a49;">-infinity-sdk = "0.5.0"</span>
<span style="background-color: #d4edda; color: #28a745;">+infinity-sdk = "0.5.2"</span>
infinity-emb = &quot;^0.0.66&quot;
itsdangerous = &quot;2.1.2&quot;
markdown = &quot;3.6&quot;
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/rag/utils/infinity_conn.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/rag/utils/infinity_conn.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 53eddfc5..d5b17529 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/rag/utils/infinity_conn.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/rag/utils/infinity_conn.py</span>
@@ -142,7 +142,6 @@ class InfinityConnection(DocStoreConnection):
def health(self) -&gt; dict:
&quot;&quot;&quot;
Return the health status of the database.
<span style="background-color: #f8d7da; color: #d73a49;">-        TODO: Infinity-sdk provides health() to wrap `show global variables` and `show tables`</span>
&quot;&quot;&quot;
inf_conn = self.connPool.get_conn()
res = inf_conn.show_current_node()
</code></pre>

<div id="321e9f37"></div>
<h2>321e9f37</h2>

<p><strong>Message:</strong> fix: stop rerank by model when search result is empty (#4203)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 321e9f3719b1789727d4545993aa475cbb05111b
Author: Bo Liu &lt;liulb92@gmail.com&gt;
Date:   Tue Dec 24 14:33:46 2024 +0800

fix: stop rerank by model when search result is empty (#4203)

### What problem does this PR solve?


stop rerank by model when search result is empty, otherwise rerank may
raise an error (qwen).

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

Co-authored-by: 刘博 &lt;liubo@ynby.cn&gt;

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/rag/nlp/search.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/rag/nlp/search.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index 3fef12c9..9b0e1d5c 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/rag/nlp/search.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/rag/nlp/search.py</span>
@@ -313,7 +313,7 @@ class Dealer:
ranks[&quot;total&quot;] = sres.total

if page &lt;= RERANK_PAGE_LIMIT:
<span style="background-color: #f8d7da; color: #d73a49;">-            if rerank_mdl:</span>
<span style="background-color: #d4edda; color: #28a745;">+            if rerank_mdl and sres.total > 0:</span>
sim, tsim, vsim = self.rerank_by_model(rerank_mdl,
sres, question, 1 - vector_similarity_weight, vector_similarity_weight)
else:
</code></pre>

<div id="76cd23ee"></div>
<h2>76cd23ee</h2>

<p><strong>Message:</strong> Catch the exception while parsing pptx. (#4202)</p>

<p><strong>Details:</strong></p>
<pre><code>
commit 76cd23eecff3fef95c9f103edd300527188d19d4
Author: Kevin Hu &lt;kevinhu.sh@gmail.com&gt;
Date:   Tue Dec 24 10:49:28 2024 +0800

Catch the exception while parsing pptx. (#4202)

### What problem does this PR solve?
#4189

### Type of change

<span style="background-color: #f8d7da; color: #d73a49;">- [x] Bug Fix (non-breaking change which fixes an issue)</span>

<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">a/deepdoc/parser/ppt_parser.py</div>
<div style="background-color: #ffff00; color: #000000; display: inline-block; padding: 2px 8px; margin: 2px 4px; border-radius: 4px;">b/deepdoc/parser/ppt_parser.py</div>
<span style="background-color: #f0f0f0; padding: 2px 8px; border-radius: 4px;">index b2a08b11..eca952ba 100644</span>
<span style="background-color: #f8d7da; color: #d73a49; padding: 2px 8px; border-radius: 4px;">--- a/deepdoc/parser/ppt_parser.py</span>
<span style="background-color: #d4edda; color: #28a745; padding: 2px 8px; border-radius: 4px;">+++ b/deepdoc/parser/ppt_parser.py</span>
@@ -10,7 +10,7 @@
#  See the License for the specific language governing permissions and
#  limitations under the License.
#
<span style="background-color: #f8d7da; color: #d73a49;">-</span>
<span style="background-color: #d4edda; color: #28a745;">+import logging</span>
from io import BytesIO
from pptx import Presentation

@@ -53,9 +53,12 @@ class RAGFlowPptParser(object):
texts = []
for shape in sorted(
slide.shapes, key=lambda x: ((x.top if x.top is not None else 0) // 10, x.left)):
<span style="background-color: #f8d7da; color: #d73a49;">-                txt = self.__extract(shape)</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                if txt:</span>
<span style="background-color: #f8d7da; color: #d73a49;">-                    texts.append(txt)</span>
<span style="background-color: #d4edda; color: #28a745;">+                try:</span>
<span style="background-color: #d4edda; color: #28a745;">+                    txt = self.__extract(shape)</span>
<span style="background-color: #d4edda; color: #28a745;">+                    if txt:</span>
<span style="background-color: #d4edda; color: #28a745;">+                        texts.append(txt)</span>
<span style="background-color: #d4edda; color: #28a745;">+                except Exception as e:</span>
<span style="background-color: #d4edda; color: #28a745;">+                    logging.exception(e)</span>
txts.append(&quot;\n&quot;.join(texts))

return txts
</code></pre>

<hr>
Commits from 2024-12-30 13:11:44 to 2024-12-30 15:03:15

<hr>
No commits found between 2024-12-30 13:11:44 and 2024-12-30 15:03:15.
